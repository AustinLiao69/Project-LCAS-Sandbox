
# ðŸ”· LCAS 2.0 Firestore Database Schema

________________________________________
## 1. Overview
æè¿°æ•´é«”è³‡æ–™åº«æž¶æ§‹ã€‚

**Database Type**: Firestore (NoSQL, document-based)  
**Structure Style**: Collections â†’ Documents â†’ Subcollections  
**Version**: v2.0  
**Last Update**: 2025-12-24  
**Maintainers**: LCAS PM Team, LCAS SA Team  

**Notes**:
LCAS 2.0 æŽ¡ç”¨ Firestore ä½œç‚ºä¸»è¦è³‡æ–™åº«ï¼Œæ”¯æ´å››å¤§æ ¸å¿ƒæ¨¡çµ„ï¼š
- **AM** (Account Management) - å¸³è™Ÿç®¡ç†æ¨¡çµ„
- **BM** (Budget Management) - é ç®—ç®¡ç†æ¨¡çµ„  
- **CM** (Collaboration Management) - å”ä½œç®¡ç†æ¨¡çµ„
- **WCM** (Wallet and Category Management) - å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†æ¨¡çµ„

**æž¶æ§‹åŽŸå‰‡**:
â€¢ æ¯å€‹ä¸»é›†åˆéƒ½ä½¿ç”¨è‡ªå‹•ç”Ÿæˆçš„ ID æˆ–æœ‰æ„ç¾©çš„ ID
â€¢ åš´æ ¼å€åˆ†ä¸»é›†åˆèˆ‡å­é›†åˆï¼Œæ”¯æ´å­é›†åˆæž¶æ§‹
â€¢ æ‰€æœ‰æ™‚é–“æ¬„ä½ä½¿ç”¨ Firestore Timestamp
â€¢ æ‰€æœ‰ module éƒ½å¿…é ˆç¶­è­· backward compatibility
â€¢ æ”¯æ´è·¨å¹³å°å¸³è™Ÿçµ±ä¸€ç®¡ç† (LINE/iOS/Android)

________________________________________
## 2. Naming Conventions
å®šç¾©å‘½åè¦å‰‡ï¼ˆéžå¸¸é‡è¦ï¼‰

**Collections**: lowercase_with_underscores  
**Documents**: autoId æˆ– meaningfulId (å¦‚ user_email æ ¼å¼)  
**Fields**: camelCase  
**Timestamps**: createdAt, updatedAt  
**User Reference**: userId, UID  
**Ledger Reference**: ledgerId  
**Platform Prefix**: LINE_UID, iOS_UID, Android_UID  

________________________________________
## 3. Global Rules
é©ç”¨æ–¼æ•´å€‹è³‡æ–™åº«çš„ schema è¦å‰‡ï¼š

â€¢ æ‰€æœ‰ document å¿…é ˆåŒ…å« createdAt
â€¢ æ‰€æœ‰å¯ä¿®æ”¹ document å¿…é ˆåŒ…å« updatedAt  
â€¢ status æ¬„ä½å¿…é ˆç‚º enumï¼šactive / archived / deleted / inactive / suspended
â€¢ Boolean ä¸€å¾‹ä½¿ç”¨ true / false
â€¢ é¿å… nullï¼ˆä½¿ç”¨ç©ºå­—ä¸²ã€ç©ºç‰©ä»¶ã€ç©ºé™£åˆ—ï¼‰
â€¢ ç”¨æˆ¶é¡žåž‹çµ±ä¸€ä½¿ç”¨ï¼šM (Manager) / S (Single) / J (Join)
â€¢ æ‰€æœ‰æ¨¡çµ„æ“ä½œå¿…é ˆè¨˜éŒ„ module å’Œ version è³‡è¨Š

________________________________________
## 4. Collections Schema

### ðŸ”¹ 4.1 Collection: users (AMæ¨¡çµ„)
**Document ID**: UIDï¼ˆä¾†è‡ª Firebase Auth æˆ–çµ±ä¸€ç”Ÿæˆï¼‰

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| UID | string | required | ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| displayName | string | optional | ç”¨æˆ¶é¡¯ç¤ºåç¨± | max 50 chars |
| userType | string | required | ç”¨æˆ¶é¡žåž‹ | enum: M/S/J |
| email | string | optional | é›»å­éƒµä»¶ | unique when present |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| lastActive | timestamp | optional | æœ€å¾Œæ´»å‹•æ™‚é–“ | |
| timezone | string | optional | æ™‚å€è¨­å®š | default: Asia/Taipei |
| linkedAccounts | object | optional | è·¨å¹³å°å¸³è™Ÿé—œè¯ | see below |
| settings | object | optional | ç”¨æˆ¶è¨­å®š | see below |
| joined_ledgers | array | optional | åƒèˆ‡çš„å¸³æœ¬æ¸…å–® | |
| metadata | object | optional | å…ƒæ•¸æ“š | source, profilePicture, etc |
| defaultLedgerId | string | optional | é è¨­å¸³æœ¬ID | |
| status | string | required | å¸³è™Ÿç‹€æ…‹ | enum: active/suspended/deleted |
| userMode | string | optional | ç”¨æˆ¶æ¨¡å¼ | |

**Substructures**:
```javascript
linkedAccounts: {
  LINE_UID: string,
  iOS_UID: string,
  Android_UID: string
}

settings: {
  notifications: boolean,
  language: string
}

metadata: {
  source: string,        // ä¾†æºå¹³å°
  profilePicture: string,
  appVersion: string,
  deviceInfo: object
}
```

### ðŸ”¹ 4.2 Collection: account_mappings (AMæ¨¡çµ„)
**Document ID**: mapping_id æˆ– primary_UID

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| primary_UID | string | required | ä¸»è¦ç”¨æˆ¶ID | |
| platform_accounts | object | required | å¹³å°å¸³è™Ÿå°æ‡‰ | see below |
| email | string | optional | é›»å­éƒµä»¶ | |
| created_at | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updated_at | timestamp | required | æ›´æ–°æ™‚é–“ | |
| status | string | required | æ˜ å°„ç‹€æ…‹ | enum: active/suspended/deleted |

**Substructures**:
```javascript
platform_accounts: {
  LINE: string,
  iOS: string,
  Android: string
}
```

### ðŸ”¹ 4.3 Collection: ledgers
**Document ID**: ledgerIdï¼ˆuser_email æ ¼å¼æˆ–è‡ªå‹•ç”Ÿæˆï¼‰

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| id | string | required | å¸³æœ¬ID | primary key |
| name | string | required | å¸³æœ¬åç¨± | max 50 chars |
| owner | string | required | æ“æœ‰è€…ID | must exist in users |
| type | string | required | å¸³æœ¬é¡žåž‹ | enum: personal/shared/project/category |
| userId | string | required | ç”¨æˆ¶ID | |
| description | string | optional | æè¿° | |
| status | string | required | ç‹€æ…‹ | enum: active/archived |
| initializationComplete | boolean | required | åˆå§‹åŒ–å®Œæˆæ¨™èªŒ | |
| subjectCount | number | optional | ç§‘ç›®æ•¸é‡ | |
| walletCount | number | optional | å¸³æˆ¶æ•¸é‡ | |
| settings | object | optional | è¨­å®š | see below |
| metadata | object | optional | å…ƒæ•¸æ“š | see below |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

**Substructures**:
```javascript
settings: {
  currency: string,      // é è¨­è²¨å¹£
  timezone: string,      // æ™‚å€
  dateFormat: string,    // æ—¥æœŸæ ¼å¼
  language: string       // èªžè¨€
}

metadata: {
  version: string,
  createdBy: string,
  initializationStage: string
}
```

**Subcollections**:
| Subcollection | Description |
|---------------|-------------|
| wallets | å¸³æˆ¶åˆ—è¡¨ (WCMæ¨¡çµ„ç®¡ç†) |
| categories | ç§‘ç›®åˆ—è¡¨ (WCMæ¨¡çµ„ç®¡ç†) |
| budgets | é ç®—è¨­å®š (BMæ¨¡çµ„ç®¡ç†) |
| transactions | äº¤æ˜“è¨˜éŒ„ |
| entries | è¨˜å¸³è¨˜éŒ„ |

### ðŸ”¹ 4.4 Subcollection: ledgers/{ledgerId}/wallets (WCMæ¨¡çµ„)
**Collection Path**: `ledgers/{ledgerId}/wallets`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| id | string | required | å¸³æˆ¶ID | primary key |
| name | string | required | å¸³æˆ¶åç¨± | max 50 chars |
| type | string | required | å¸³æˆ¶é¡žåž‹ | enum: cash/bank/credit_card |
| currency | string | required | è²¨å¹£å–®ä½ | default: TWD |
| balance | number | required | å¸³æˆ¶é¤˜é¡ | |
| description | string | optional | æè¿° | |
| isDefault | boolean | optional | æ˜¯å¦ç‚ºé è¨­å¸³æˆ¶ | |
| userId | string | required | ç”¨æˆ¶ID | |
| ledgerId | string | required | å¸³æœ¬ID | |
| status | string | required | ç‹€æ…‹ | enum: active/inactive |
| dataSource | string | optional | è³‡æ–™ä¾†æº | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| module | string | required | æ¨¡çµ„æ¨™è­˜ | default: WCM |
| version | string | required | ç‰ˆæœ¬è™Ÿ | |

### ðŸ”¹ 4.5 Subcollection: ledgers/{ledgerId}/categories (WCMæ¨¡çµ„)
**Collection Path**: `ledgers/{ledgerId}/categories`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| id | string | required | ç§‘ç›®ID | primary key |
| categoryId | string | required | ç§‘ç›®ä»£ç¢¼ | |
| parentId | string/number | optional | çˆ¶ç§‘ç›®ID | |
| categoryName | string | required | ç§‘ç›®åç¨± | |
| subCategoryName | string | optional | å­ç§‘ç›®åç¨± | |
| synonyms | string | optional | åŒç¾©è©ž | comma separated |
| name | string | required | é¡¯ç¤ºåç¨± | |
| type | string | required | ç§‘ç›®é¡žåž‹ | enum: income/expense |
| level | number | optional | ç§‘ç›®å±¤ç´š | |
| color | string | optional | é¡è‰²ä»£ç¢¼ | |
| icon | string | optional | åœ–ç¤º | |
| description | string | optional | æè¿° | |
| isDefault | boolean | optional | æ˜¯å¦ç‚ºé è¨­ç§‘ç›® | |
| isActive | boolean | required | æ˜¯å¦å•Ÿç”¨ | |
| userId | string | required | ç”¨æˆ¶ID | |
| ledgerId | string | required | å¸³æœ¬ID | |
| status | string | required | ç‹€æ…‹ | enum: active/inactive |
| dataSource | string | optional | è³‡æ–™ä¾†æº | 0099. Subject_code.json |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| module | string | required | æ¨¡çµ„æ¨™è­˜ | default: WCM |
| version | string | required | ç‰ˆæœ¬è™Ÿ | |

### ðŸ”¹ 4.6 Subcollection: ledgers/{ledgerId}/budgets (BMæ¨¡çµ„)
**Collection Path**: `ledgers/{ledgerId}/budgets`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| budgetId | string | required | é ç®—å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| ledgerId | string | required | å¸³æœ¬ID | |
| name | string | required | é ç®—åç¨± | |
| type | string | required | é ç®—é¡žåž‹ | enum: monthly/yearly/quarterly/project/category |
| amount | number | required | é ç®—ç¸½é‡‘é¡ | |
| consumed_amount | number | required | å·²ä½¿ç”¨é‡‘é¡ | |
| currency | string | required | è²¨å¹£å–®ä½ | default: TWD |
| start_date | timestamp/date | required | é ç®—é–‹å§‹æ™‚é–“ | |
| end_date | timestamp/date | required | é ç®—çµæŸæ™‚é–“ | |
| categories | array | optional | é ç®—åˆ†é¡žé…ç½® | |
| alert_rules | object | required | è­¦ç¤ºè¦å‰‡è¨­å®š | see below |
| userId | string | required | ä½¿ç”¨è€…ID | |
| createdBy | string | required | å»ºç«‹è€…ID | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updated_at | timestamp | required | æ›´æ–°æ™‚é–“ | |
| status | string | required | é ç®—ç‹€æ…‹ | enum: active/completed/archived |
| config_source | string | optional | é…ç½®ä¾†æº | |
| module | string | required | æ¨¡çµ„æ¨™è­˜ | default: BM |
| version | string | required | ç‰ˆæœ¬è™Ÿ | |

**Substructures**:
```javascript
alert_rules: {
  warning_threshold: number,      // è­¦å‘Šé–¾å€¼ (%)
  critical_threshold: number,     // åš´é‡é–¾å€¼ (%)
  enable_notifications: boolean   // å•Ÿç”¨é€šçŸ¥
}

categories: [
  {
    id: string,
    name: string,
    allocated_amount: number,
    used_amount: number,
    percentage: number,
    alert_threshold: number
  }
]
```

### ðŸ”¹ 4.7 Collection: budget_alerts (BMæ¨¡çµ„)
**Document ID**: alert_id

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| alert_id | string | required | è­¦ç¤ºID | primary key |
| budget_id | string | required | é ç®—ID | |
| alert_type | string | required | è­¦ç¤ºé¡žåž‹ | enum: warning/critical/exceeded |
| trigger_condition | object | required | è§¸ç™¼æ¢ä»¶ | |
| triggered_at | timestamp | required | è§¸ç™¼æ™‚é–“ | |
| notification_sent | boolean | required | é€šçŸ¥ç™¼é€ç‹€æ…‹ | |
| recipients | array | optional | æŽ¥æ”¶è€…æ¸…å–® | |

### ðŸ”¹ 4.8 Collection: collaborations (CMæ¨¡çµ„)
**Document ID**: ledgerId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| ledgerId | string | required | å¸³æœ¬ID | primary key |
| ownerId | string | required | å¸³æœ¬æ“æœ‰è€…ID | |
| collaborationType | string | required | å”ä½œé¡žåž‹ | enum: shared/project/category |
| status | string | required | å”ä½œç‹€æ…‹ | enum: active/archived/suspended |
| members | array | required | æˆå“¡æ¸…å–® | see below |
| settings | object | required | å”ä½œè¨­å®š | see below |
| permissions | object | optional | æ¬Šé™é…ç½® | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| autoCreated | boolean | optional | æ˜¯å¦è‡ªå‹•å‰µå»º | |
| managedBy | string | optional | ç®¡ç†æ¨¡çµ„æ¨™è­˜ | |

**Substructures**:
```javascript
members: [
  {
    memberId: string,
    userId: string,
    permissionLevel: string,    // owner/admin/member/viewer
    joinedAt: timestamp,
    invitedBy: string,
    status: string             // active/invited/suspended
  }
]

settings: {
  allowInvite: boolean,
  allowEdit: boolean,
  allowDelete: boolean,
  requireApproval: boolean,
  maxMembers: number,
  invitationExpireDays: number
}

permissions: {
  owner: string,
  admins: array,
  members: array,
  viewers: array
}
```

**Subcollections**:
| Subcollection | Description |
|---------------|-------------|
| members | æˆå“¡ç®¡ç†å­é›†åˆ |
| invitations | é‚€è«‹ç®¡ç†å­é›†åˆ |

### ðŸ”¹ 4.9 Subcollection: collaborations/{ledgerId}/members (CMæ¨¡çµ„)
**Collection Path**: `collaborations/{ledgerId}/members`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| userId | string | required | ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| email | string | optional | ç”¨æˆ¶é›»å­éƒµä»¶ | |
| role | string | required | è§’è‰² | enum: owner/admin/member/viewer |
| permissions | object | optional | æ¬Šé™è¨­å®š | |
| joinedAt | timestamp | required | åŠ å…¥æ™‚é–“ | |
| status | string | required | æˆå“¡ç‹€æ…‹ | enum: active/invited/suspended |
| createdAt | timestamp | required | å‰µå»ºæ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| createdBy | string | required | å‰µå»ºè€… | |

### ðŸ”¹ 4.10 Subcollection: collaborations/{ledgerId}/invitations (CMæ¨¡çµ„)
**Collection Path**: `collaborations/{ledgerId}/invitations`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| invitationId | string | required | é‚€è«‹å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| inviterId | string | required | é‚€è«‹è€…ID | |
| inviteeEmail | string | required | è¢«é‚€è«‹è€…email | |
| role | string | required | é è¨­è§’è‰² | |
| status | string | required | é‚€è«‹ç‹€æ…‹ | enum: pending/accepted/declined/expired |
| createdAt | timestamp | required | é‚€è«‹å»ºç«‹æ™‚é–“ | |
| expiresAt | timestamp | required | é‚€è«‹éŽæœŸæ™‚é–“ | |

### ðŸ”¹ 4.11 Collection: member_invitations (CMæ¨¡çµ„)
**Document ID**: invitationId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| invitationId | string | required | é‚€è«‹ID | primary key |
| ledgerId | string | required | å¸³æœ¬ID | |
| inviterId | string | required | é‚€è«‹è€…ID | |
| inviteeInfo | object | required | è¢«é‚€è«‹è€…è³‡è¨Š | |
| permissionLevel | string | required | æ¬Šé™ç­‰ç´š | |
| status | string | required | é‚€è«‹ç‹€æ…‹ | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| expiresAt | timestamp | required | éŽæœŸæ™‚é–“ | |

### ðŸ”¹ 4.12 Collection: collaboration_logs (CMæ¨¡çµ„)
**Document ID**: logId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| logId | string | required | æ—¥èªŒID | primary key |
| ledgerId | string | required | å¸³æœ¬ID | |
| userId | string | required | ç”¨æˆ¶ID | |
| actionType | string | required | æ“ä½œé¡žåž‹ | |
| actionData | object | optional | æ“ä½œè³‡æ–™ | |
| timestamp | timestamp | required | æ™‚é–“æˆ³ | |
| ipAddress | string | optional | IPåœ°å€ | |

### ðŸ”¹ 4.13 Collection: notification_preferences (CMæ¨¡çµ„)
**Document ID**: userId_ledgerId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| userId | string | required | ç”¨æˆ¶ID | |
| ledgerId | string | required | å¸³æœ¬ID | |
| preferences | object | required | åå¥½è¨­å®š | see below |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

**Substructures**:
```javascript
preferences: {
  memberJoined: boolean,
  memberLeft: boolean,
  permissionChanged: boolean,
  dataUpdated: boolean,
  conflictDetected: boolean,
  channels: array,
  quietHours: object
}
```

### ðŸ”¹ 4.14 Collection: _system (ç³»çµ±é…ç½®)
**Document ID**: config_name

ç”¨æ–¼å„²å­˜å„ç¨®ç³»çµ±æž¶æ§‹å®šç¾©ã€é è¨­è¨­å®šé…ç½®ã€æ¨¡çµ„çµæ§‹é…ç½®ç­‰æ–‡æª”ã€‚

________________________________________
## 5. Relations
æè¿°é›†åˆèˆ‡é›†åˆçš„é—œè¯ï¼š

â€¢ **users.UID** â†’ **ledgers.owner**
â€¢ **users.UID** â†’ **ledgers.userId**  
â€¢ **users.UID** â†’ **collaborations.ownerId**
â€¢ **users.UID** â†’ **collaborations.members.userId**
â€¢ **ledgers.id** â†’ **collaborations.ledgerId**
â€¢ **ledgers.id** â†’ **budgets.ledgerId**
â€¢ **ledgers.id** â†’ **wallets.ledgerId**
â€¢ **ledgers.id** â†’ **categories.ledgerId**

**é—œè¯æ ¼å¼**:
```
users (1) â€”â€”â€” (many) ledgers
users (1) â€”â€”â€” (many) collaborations
ledgers (1) â€”â€”â€” (many) wallets
ledgers (1) â€”â€”â€” (many) categories  
ledgers (1) â€”â€”â€” (many) budgets
collaborations (1) â€”â€”â€” (many) members
collaborations (1) â€”â€”â€” (many) invitations
```

________________________________________
## 6. Validation Rules
### 6.1 ç”¨æˆ¶é¡žåž‹é©—è­‰
- userType å¿…é ˆç‚º M/S/J ä¹‹ä¸€
- M é¡žåž‹ï¼šå¯å»ºç«‹å¤šå€‹å¸³æœ¬ï¼Œå…·ç®¡ç†æ¬Šé™
- S é¡žåž‹ï¼šå–®ä¸€å¸³æœ¬ç”¨æˆ¶
- J é¡žåž‹ï¼šåƒ…å¯åŠ å…¥ä»–äººå¸³æœ¬

### 6.2 æ¬Šé™ç­‰ç´šé©—è­‰
- owner: level 4, actions: ["all"]
- admin: level 3, actions: ["invite", "remove", "edit", "view", "manage_permissions"]  
- member: level 2, actions: ["edit", "view", "invite_limited"]
- viewer: level 1, actions: ["view"]

### 6.3 é ç®—é©—è­‰è¦å‰‡
- amount å¿…é ˆ > 0
- consumed_amount >= 0
- consumed_amount <= amount * 1.5 (å…è¨±è¶…æ”¯ 50%)
- start_date < end_date

________________________________________
## 7. Lifecycle
æè¿°æ¯å€‹è³‡æ–™ç‹€æ…‹çš„ç”Ÿå‘½é€±æœŸï¼š

### 7.1 ç”¨æˆ¶ç‹€æ…‹
```
active â†’ suspended â†’ deleted
active â†’ deleted (ç›´æŽ¥åˆªé™¤)
```

### 7.2 å¸³æœ¬ç‹€æ…‹  
```
active â†’ archived â†’ deleted
```

### 7.3 å”ä½œç‹€æ…‹
```
active â†’ suspended â†’ archived
active â†’ archived (æ­£å¸¸çµæŸ)
```

### 7.4 é ç®—ç‹€æ…‹
```
active â†’ completed â†’ archived
active â†’ archived (æå‰çµæŸ)
```

________________________________________
## 8. Indexes
è¨˜éŒ„é‡è¦çš„ Firestore Index é…ç½®ï¼š

### 8.1 è¤‡åˆç´¢å¼•
```javascript
// collaborations
{
  "collectionGroup": "collaborations",
  "fields": [
    {"fieldPath": "ledgerId", "order": "ASCENDING"},
    {"fieldPath": "userId", "order": "ASCENDING"}, 
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// budgets
{
  "collectionGroup": "budgets", 
  "fields": [
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "type", "order": "ASCENDING"},
    {"fieldPath": "start_date", "order": "ASCENDING"}
  ]
}

// wallets
{
  "collectionGroup": "wallets",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "type", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// categories  
{
  "collectionGroup": "categories",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "type", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// users
{
  "collectionGroup": "users",
  "fields": [
    {"fieldPath": "userType", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}
```

________________________________________
## 9. Versioning
è¨˜éŒ„æ¯æ¬¡ schema æ”¹å‹•ï¼š

| Version | Date | Changes | Modified By |
|---------|------|---------|-------------|
| v2.0 | 2025-12-24 | åˆç‰ˆå»ºç«‹ï¼Œæ•´åˆ AM/BM/CM/WCM æ¨¡çµ„æž¶æ§‹ | LCAS SA Team |
| | | å»ºç«‹å®Œæ•´çš„å­é›†åˆæž¶æ§‹æ”¯æ´ | |
| | | å®šç¾©è·¨å¹³å°å¸³è™Ÿç®¡ç†è¦ç¯„ | |
| | | å»ºç«‹å”ä½œèˆ‡é ç®—ç®¡ç†è³‡æ–™æ¨¡åž‹ | |

________________________________________
## 10. Security Considerations

### 10.1 å­˜å–æ¬Šé™
- ç”¨æˆ¶åƒ…å¯å­˜å–è‡ªå·±çš„ ledgers å’Œç›¸é—œå­é›†åˆ
- å”ä½œå¸³æœ¬ä¾æ“š members æ¬Šé™ç­‰ç´šæŽ§åˆ¶å­˜å–
- ç³»çµ±ç®¡ç†å“¡å¯å­˜å– _system é›†åˆ

### 10.2 è³‡æ–™éš”é›¢
- æ¯å€‹ ledger çš„å­é›†åˆå®Œå…¨éš”é›¢
- è·¨å¹³å°å¸³è™Ÿé—œè¯éœ€è¦é©—è­‰
- æ•æ„Ÿè³‡è¨Š (å¦‚ device info) éœ€åŠ å¯†å„²å­˜

### 10.3 å¯©è¨ˆè¿½è¹¤
- æ‰€æœ‰é‡è¦æ“ä½œè¨˜éŒ„æ–¼ collaboration_logs
- æ¨¡çµ„æ“ä½œåŒ…å« module å’Œ version è³‡è¨Š
- ä¿ç•™å®Œæ•´çš„æ™‚é–“æˆ³è¿½è¹¤

---

**æ–‡ä»¶ç‹€æ…‹**: v2.0 - ç”Ÿç”¢å°±ç·’  
**ç¶­è­·è²¬ä»»**: LCAS æŠ€è¡“åœ˜éšŠ  
**æ›´æ–°é€±æœŸ**: æ¯å­£ reviewï¼Œé‡å¤§è®Šæ›´å³æ™‚æ›´æ–°
