# PRD_Business_Layer

**文件編號**: 1001  
**版本**: 2.0.1  
**建立日期**: 2025-08-01  
**建立者**: LCAS PM Team  
**最後更新**: 2025-08-01  

---

## 目次
1. [模組概述](#10-模組概述module-overview)
2. [功能需求](#20-功能需求functional-requirements)
3. [架構設計](#30-架構設計architecture-design)
4. [模組群詳細規格](#40-模組群詳細規格module-groups-specification)
5. [RESTful API 介面](#50-restful-api-介面restful-api-interface)
6. [資料流設計](#60-資料流設計data-flow-design)


---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
Business Layer（商業邏輯層）是 LCAS 2.0 系統的核心處理層，負責所有業務邏輯處理、資料操作和介面整合。作為 LCAS 2.0 三層架構中的關鍵層級，連接應用邏輯層與資料層，確保業務規則的一致性和系統的可維護性。

### 1.2 核心價值主張
- **模組化設計**: 採用高內聚、低耦合的模組化架構
- **多介面支援**: 同時支援 LINE OA 和 APP 兩種介面
- **統一資料處理**: 透過共用模組群確保資料一致性
- **可擴展架構**: 支援未來功能擴展和系統升級

### 1.3 目標使用者
- **展示層開發者**: 透過標準化 API 存取業務功能
- **應用邏輯層**: 整合多個業務模組提供複合功能
- **系統維護人員**: 進行業務邏輯維護和效能優化

---

## 2.0 功能需求（Functional Requirements）

### 2.1 LINE OA 介面功能
- **Webhook 請求處理**: 接收並解析 LINE 平台的 Webhook 請求
- **使用者指令分析**: 智慧解析記帳、查帳、統計等使用者指令
- **即時回應處理**: 快速處理並回覆 LINE 使用者
- **Rich Menu 互動**: 支援 Quick Reply 和 Rich Menu 操作

### 2.2 APP 介面功能
- **RESTful API 提供**: 實作標準化的 RESTful API 端點
- **身份驗證處理**: Firebase Token 和 JWT 驗證機制
- **標準化回應**: 統一的 JSON 格式回應
- **錯誤處理機制**: 完善的錯誤處理和日誌記錄

### 2.3 共用業務功能
- **記帳核心功能**: 記帳、查帳、分類管理
- **多帳本管理**: 個人帳本、群組帳本、協作管理
- **預算管理**: 預算設定、監控、警示
- **排程提醒**: 自動記帳、定期提醒、統計推播
- **報表分析**: 資料分析、報表生成、趨勢分析
- **備份服務**: 資料備份、還原、同步

---

## 3.0 架構設計（Architecture Design）

### 3.1 整體架構
Business Layer 採用三個模組群的分層架構：

```
LCAS 2.0 Business Logic Layer Architecture
├── LINE OA模組群 (LINE OA Module Group)
│   └── WH.js v2.1.0 - Webhook處理模組
├── APP模組群 (APP Module Group)
│   ├── BK.js v2.1.0 - 記帳核心模組
│   ├── AM.js v1.1.0 - 帳號管理模組
│   ├── MLS.js v2.1.0 - 多帳本管理模組
│   ├── BM.js v1.1.0 - 預算管理模組
│   ├── CM.js v1.1.0 - 協作管理模組
│   ├── SR.js v2.1.0 - 排程提醒模組
│   ├── MRA.js v1.1.0 - 報表分析模組
│   ├── BS.js v1.1.0 - 備份服務模組
│   └── LBK.js v1.1.0 - 快速記帳模組
└── 共用模組群 (Shared Module Group)
    ├── DD1.js v2.1.0 - 核心協調模組
    ├── DD2.js v2.1.0 - 智慧處理模組
    ├── DD3.js v1.1.0 - 資料服務模組
    ├── FS.js v1.1.0 - Firestore操作模組
    ├── DL.js v1.1.0 - 診斷日誌模組
    ├── GR.js v1.1.0 - 通用工具模組
    └── firebase-config.js v1.1.0 - Firebase配置模組
```

### 3.2 模組群關係設計

#### 3.2.1 LINE OA模組群
- **獨立處理**: 專門處理 LINE 平台的 Webhook 請求
- **即時回應**: 確保 LINE 平台的快速回應要求
- **共用依賴**: 呼叫共用模組群進行資料處理

#### 3.2.2 APP模組群
- **API 端點**: 提供 RESTful API 給應用邏輯層
- **業務邏輯**: 實作各項業務功能的核心邏輯
- **共用依賴**: 透過共用模組群進行資料操作

#### 3.2.3 共用模組群
- **資料管理**: 統一的 Firestore 資料操作
- **工具函數**: 日期處理、金額格式、分類解析等
- **系統支援**: 日誌記錄、錯誤處理、設定管理

---

## 4.0 模組群詳細規格（Module Groups Specification）

### 4.1 LINE OA模組群

#### 4.1.1 WH.js - Webhook處理模組 v2.1.0
**功能職責**：
- 接收 LINE 平台 Webhook 請求
- 驗證 LINE 簽章安全性
- 解析使用者指令和互動事件
- 呼叫共用模組群處理業務邏輯
- 格式化回應訊息給 LINE 平台

**技術堆疊**：Node.js + Express + Firebase Admin SDK

### 4.2 APP模組群

#### 4.2.1 BK.js - 記帳核心模組 v2.1.0
**功能職責**：
- 記帳資料的建立、修改、刪除
- 記帳分類管理和驗證
- 記帳查詢和篩選功能
- API 端點：`/api/ledger/*`

#### 4.2.2 AM.js - 帳號管理模組 v1.1.0
**功能職責**：
- 使用者註冊、登入、登出
- 使用者資料管理和設定
- 身份驗證和權限控制
- API 端點：`/api/auth/*`

#### 4.2.3 MLS.js - 多帳本管理模組 v2.1.0
**功能職責**：
- 個人帳本和群組帳本管理
- 帳本權限和成員管理
- 帳本間的資料轉移和同步
- API 端點：`/api/projects/*`

#### 4.2.4 BM.js - 預算管理模組 v1.1.0
**功能職責**：
- 預算設定和類別管理
- 預算執行監控和警示
- 預算報表和分析
- API 端點：`/api/budgets/*`

#### 4.2.5 CM.js - 協作管理模組 v1.1.0
**功能職責**：
- 協作邀請和成員管理
- 權限設定和存取控制
- 協作活動記錄和通知
- API 端點：`/api/collaborate/*`

#### 4.2.6 SR.js - 排程提醒模組 v2.1.0
**功能職責**：
- 定期記帳提醒設定
- 自動記帳執行
- 財務統計自動推播
- **通知管理功能**：
  - 通知列表管理
  - 通知狀態追蹤（已讀/未讀）
  - 通知模板管理
  - 推播規則設定
- API 端點：`/api/schedules/*`, `/api/notifications/*`

#### 4.2.7 MRA.js - 報表分析模組 v1.1.0
**功能職責**：
- 財務報表生成和分析
- 資料視覺化和圖表
- 趨勢分析和預測
- API 端點：`/api/reports/*`

#### 4.2.8 BS.js - 備份服務模組 v1.1.0
**功能職責**：
- 資料備份和還原
- 備份排程管理
- 資料匯出和匯入
- API 端點：`/api/backup/*`

#### 4.2.9 LBK.js - 快速記帳模組 v1.1.0
**功能職責**：
- 簡化記帳流程
- 常用記帳模板
- 快速記帳介面
- API 端點：`/api/quick-ledger/*`

**技術堆疊**：Node.js + Express + Firebase SDK

### 4.3 共用模組群

#### 4.3.1 DD1.js - 核心協調模組 v2.1.0
**功能職責**：
- 模組間的協調和通訊
- 業務流程的編排和控制
- 系統狀態管理

#### 4.3.2 DD2.js - 智慧處理模組 v2.1.0
**功能職責**：
- 智慧資料分析和處理
- 自動分類和標籤
- 異常檢測和處理
- **激勵系統功能**：
  - 成就解鎖邏輯（基於記帳頻率、金額等智慧分析）
  - 挑戰進度計算與追蹤
  - 積分系統管理
  - 排行榜數據生成
- **AI助理進階功能**：
  - AI對話介面
  - 智慧預算建議
  - 個人化推薦
- API 端點：`/api/ai/*`, `/api/gamification/*`

#### 4.3.3 DD3.js - 資料服務模組 v1.1.0
**功能職責**：
- 資料格式轉換和驗證
- 資料快取管理
- 資料同步協調

#### 4.3.4 FS.js - Firestore操作模組 v1.1.0
**功能職責**：
- Firestore 資料的 CRUD 操作
- 查詢最佳化和效能調整
- 交易處理和資料一致性

#### 4.3.5 DL.js - 診斷日誌模組 v1.1.0
**功能職責**：
- 系統日誌記錄和管理
- 錯誤追蹤和診斷
- 效能監控和分析

#### 4.3.6 GR.js - 通用工具模組 v1.1.0
**功能職責**：
- 日期時間處理工具
- 金額格式化和計算
- 字串處理和驗證

#### 4.3.7 firebase-config.js - Firebase配置模組 v1.1.0
**功能職責**：
- Firebase 服務初始化
- 連線設定和憑證管理
- 環境配置管理

**技術堆疊**：Firebase Admin SDK + 工具函數庫

---

## 5.0 RESTful API 介面（RESTful API Interface）

### 5.1 API 設計原則
- **RESTful 標準**: 遵循 REST 架構原則和 HTTP 方法
- **統一URL格式**: 所有API端點使用 `https://api.lcas.app/v1/` 作為基礎URL
- **統一回應格式**: 標準化的成功和錯誤回應結構
- **版本控制**: 支援 API 版本管理和向下相容
- **安全認證**: Firebase Token 和 JWT 雙重認證機制
- **時間格式**: 統一使用 UTC+8 時區格式

### 5.2 標準回應格式

#### 5.2.1 成功回應格式
```json
{
  "status": "success",
  "code": "HTTP狀態碼",
  "message": "操作成功描述",
  "data": {},
  "timestamp": "2025-07-23T16:30:00+08:00",
  "requestId": "唯一請求識別碼"
}
```

#### 5.2.2 錯誤回應格式
```json
{
  "status": "error",
  "code": "詳細錯誤代碼",
  "message": "錯誤描述",
  "error": {
    "type": "錯誤類型",
    "details": "詳細錯誤資訊",
    "field": "相關欄位(如適用)"
  },
  "timestamp": "2025-07-23T16:30:00+08:00",
  "requestId": "唯一請求識別碼"
}
```

#### 5.2.3 錯誤代碼分類標準
**HTTP狀態碼**：
- **2xx**: 成功狀態碼（如：200, 201, 204）
- **4xx**: 客戶端錯誤（如：400, 401, 403, 404, 422）
- **5xx**: 伺服器錯誤（如：500, 502, 503）

**詳細錯誤代碼**：
- **AUTH_xxxx**: 認證相關錯誤
- **VALIDATION_xxxx**: 資料驗證錯誤
- **BUSINESS_xxxx**: 業務邏輯錯誤
- **SYSTEM_xxxx**: 系統錯誤

#### 5.2.4 四模式差異化回應
根據用戶模式（簡單、標準、進階、專業）提供不同詳細程度的回應：
- **簡單模式**: 精簡回應，隱藏複雜欄位
- **標準模式**: 標準完整回應
- **進階模式**: 包含額外分析數據
- **專業模式**: 包含完整技術細節和除錯資訊

### 5.3 API 端點架構
```
https://api.lcas.app/v1/
├── auth/*              - AM 模組：使用者認證
├── users/*             - AM 模組：用戶管理
├── transactions/*      - BK 模組：記帳交易
├── ledgers/*           - MLS 模組：帳本管理
├── accounts/*          - BK 模組：帳戶管理
├── categories/*        - DD1 模組：科目管理
├── budgets/*           - BM 模組：預算管理
├── reports/*           - MRA 模組：報表分析
├── ai/*                - DD2 模組：AI助理
├── gamification/*      - DD2 模組：激勵系統
├── system/*            - GR/DL 模組：系統服務
├── backup/*            - BS 模組：備份管理
└── notifications/*     - SR 模組：通知管理
```

### 5.4 完整API端點架構（基於8020文件的132個端點）

#### 5.4.1 認證服務 (11個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `POST /auth/register` | POST | 使用者註冊 | AM.js |
| `POST /auth/login` | POST | 使用者登入 | AM.js |
| `POST /auth/google-login` | POST | Google登入 | AM.js |
| `POST /auth/logout` | POST | 使用者登出 | AM.js |
| `POST /auth/refresh` | POST | 刷新token | AM.js |
| `POST /auth/forgot-password` | POST | 忘記密碼 | AM.js |
| `GET /auth/verify-reset-token` | GET | 驗證重設連結 | AM.js |
| `POST /auth/reset-password` | POST | 重設密碼 | AM.js |
| `POST /auth/verify-email` | POST | 驗證Email | AM.js |
| `POST /auth/bind-line` | POST | LINE綁定 | AM.js |
| `GET /auth/bind-status` | GET | 綁定狀態查詢 | AM.js |

#### 5.4.2 用戶管理 (11個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /users/profile` | GET | 取得個人資料 | AM.js |
| `PUT /users/profile` | PUT | 更新個人資料 | AM.js |
| `GET /users/assessment-questions` | GET | 取得評估問卷 | AM.js |
| `POST /users/assessment` | POST | 提交評估結果 | AM.js |
| `PUT /users/preferences` | PUT | 更新偏好設定 | AM.js |
| `PUT /users/security` | PUT | 安全設定 | AM.js |
| `POST /users/verify-pin` | POST | PIN碼驗證 | AM.js |
| `PUT /users/mode` | PUT | 切換使用者模式 | AM.js |
| `GET /users/mode-defaults` | GET | 取得模式預設值 | AM.js |
| `POST /users/behavior-tracking` | POST | 使用行為追蹤 | AM.js |
| `GET /users/mode-recommendations` | GET | 模式優化建議 | AM.js |

#### 5.4.3 記帳交易 (20個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /transactions` | GET | 查詢交易列表 | BK.js |
| `POST /transactions` | POST | 新增交易 | BK.js |
| `GET /transactions/{id}` | GET | 取得交易詳情 | BK.js |
| `PUT /transactions/{id}` | PUT | 更新交易 | BK.js |
| `DELETE /transactions/{id}` | DELETE | 刪除交易 | BK.js |
| `POST /transactions/batch` | POST | 批次新增交易 | BK.js |
| `PUT /transactions/batch` | PUT | 批次更新交易 | BK.js |
| `DELETE /transactions/batch` | DELETE | 批次刪除交易 | BK.js |
| `POST /transactions/quick` | POST | 快速記帳(LINE OA) | BK.js + WH.js |
| `GET /transactions/dashboard` | GET | 儀表板數據 | BK.js |
| `GET /transactions/recent` | GET | 最近交易 | BK.js |
| `GET /transactions/statistics` | GET | 統計數據 | BK.js |
| `GET /transactions/charts` | GET | 圖表數據 | BK.js |
| `GET /transactions/recurring` | GET | 查詢重複交易 | SR.js |
| `POST /transactions/recurring` | POST | 建立重複交易 | SR.js |
| `PUT /transactions/recurring/{id}` | PUT | 更新重複交易 | SR.js |
| `DELETE /transactions/recurring/{id}` | DELETE | 刪除重複交易 | SR.js |
| `POST /transactions/{id}/attachments` | POST | 上傳附件 | BK.js |
| `DELETE /transactions/{id}/attachments/{attachmentId}` | DELETE | 刪除附件 | BK.js |
| `POST /transactions/import` | POST | 匯入交易 | BK.js |

#### 5.4.4 帳本管理 (14個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /ledgers` | GET | 取得帳本列表 | MLS.js |
| `POST /ledgers` | POST | 建立帳本 | MLS.js |
| `GET /ledgers/{id}` | GET | 取得帳本詳情 | MLS.js |
| `PUT /ledgers/{id}` | PUT | 更新帳本 | MLS.js |
| `DELETE /ledgers/{id}` | DELETE | 刪除帳本 | MLS.js |
| `GET /ledgers/types` | GET | 取得帳本類型 | MLS.js |
| `GET /ledgers/{id}/collaborators` | GET | 取得協作者 | CM.js |
| `POST /ledgers/{id}/invitations` | POST | 邀請協作者 | CM.js |
| `PUT /ledgers/{id}/collaborators/{userId}` | PUT | 更新協作者權限 | CM.js |
| `DELETE /ledgers/{id}/collaborators/{userId}` | DELETE | 移除協作者 | CM.js |
| `GET /ledgers/{id}/permissions` | GET | 取得權限狀態 | CM.js |
| `GET /ledgers/{id}/conflicts` | GET | 檢測協作衝突 | CM.js |
| `POST /ledgers/{id}/resolve-conflict` | POST | 解決協作衝突 | CM.js |
| `GET /ledgers/{id}/audit-log` | GET | 取得操作審計日誌 | DL.js |

#### 5.4.5 帳戶管理 (8個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /accounts` | GET | 取得帳戶列表 | BK.js |
| `POST /accounts` | POST | 建立帳戶 | BK.js |
| `GET /accounts/{id}` | GET | 取得帳戶詳情 | BK.js |
| `PUT /accounts/{id}` | PUT | 更新帳戶 | BK.js |
| `DELETE /accounts/{id}` | DELETE | 刪除帳戶 | BK.js |
| `GET /accounts/{id}/balance` | GET | 取得帳戶餘額 | BK.js |
| `GET /accounts/types` | GET | 取得帳戶類型 | BK.js |
| `POST /accounts/transfer` | POST | 帳戶轉帳 | BK.js |

#### 5.4.6 科目管理 (6個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /categories` | GET | 取得科目列表 | DD1.js |
| `POST /categories` | POST | 建立科目 | DD1.js |
| `GET /categories/{id}` | GET | 取得科目詳情 | DD1.js |
| `PUT /categories/{id}` | PUT | 更新科目 | DD1.js |
| `DELETE /categories/{id}` | DELETE | 刪除科目 | DD1.js |
| `GET /categories/tree` | GET | 取得科目樹狀結構 | DD1.js |

#### 5.4.7 預算管理 (8個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /budgets` | GET | 取得預算列表 | BM.js |
| `POST /budgets` | POST | 建立預算 | BM.js |
| `GET /budgets/{id}` | GET | 取得預算詳情 | BM.js |
| `PUT /budgets/{id}` | PUT | 更新預算 | BM.js |
| `DELETE /budgets/{id}` | DELETE | 刪除預算 | BM.js |
| `GET /budgets/status` | GET | 取得預算執行狀況 | BM.js |
| `GET /budgets/templates` | GET | 取得預算模板 | BM.js |
| `POST /budgets/alert` | POST | 預算警示設定 | BM.js |

#### 5.4.8 報表分析 (15個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /reports` | GET | 取得報表列表 | MRA.js |
| `POST /reports/generate` | POST | 生成報表 | MRA.js |
| `GET /reports/{id}` | GET | 取得報表詳情 | MRA.js |
| `GET /reports/{id}/status` | GET | 查詢報表生成進度 | MRA.js |
| `DELETE /reports/{id}/cancel` | DELETE | 取消報表生成 | MRA.js |
| `GET /reports/{id}/charts` | GET | 取得報表圖表 | MRA.js |
| `GET /reports/{id}/export` | GET | 匯出報表 | MRA.js |
| `POST /reports/{id}/download` | POST | 下載報表 | MRA.js |
| `POST /reports/{id}/share` | POST | 分享報表 | MRA.js |
| `GET /reports/templates` | GET | 取得報表模板 | MRA.js |
| `GET /reports/config-options` | GET | 取得報表配置選項 | MRA.js |
| `GET /analytics/insights` | GET | 深度分析洞察 | MRA.js |
| `GET /analytics/trends` | GET | 趨勢分析 | MRA.js |
| `POST /analytics/custom` | POST | 自定義分析 | MRA.js |
| `GET /analytics/scheduled` | GET | 定期報表排程 | MRA.js |

#### 5.4.9 AI助理 (6個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `POST /ai/categorize` | POST | AI智慧分類 | DD2.js |
| `GET /ai/suggestions` | GET | AI建議 | DD2.js |
| `POST /ai/budget-advice` | POST | AI預算建議 | DD2.js |
| `POST /ai/anomaly-detection` | POST | 異常檢測 | DD2.js |
| `POST /ai/spending-insights` | POST | AI支出洞察 | DD2.js |
| `GET /ai/recommendations` | GET | AI個人化推薦 | DD2.js |

#### 5.4.10 激勵系統 (6個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /gamification/achievements` | GET | 取得成就 | DD2.js |
| `GET /gamification/challenges` | GET | 取得挑戰 | DD2.js |
| `POST /gamification/claim-reward` | POST | 領取獎勵 | DD2.js |
| `GET /gamification/leaderboard` | GET | 排行榜 | DD2.js |
| `POST /gamification/join-challenge` | POST | 加入挑戰 | DD2.js |
| `GET /gamification/progress` | GET | 挑戰進度查詢 | DD2.js |

#### 5.4.11 系統服務 (13個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /system/app-info` | GET | APP資訊 | GR.js |
| `GET /system/welcome` | GET | 歡迎資訊 | GR.js |
| `GET /system/status` | GET | 系統狀態 | DL.js |
| `GET /system/health` | GET | 健康檢查 | DL.js |
| `GET /system/app-promotion` | GET | APP推廣資訊 | GR.js |
| `GET /system/config` | GET | 系統配置 | GR.js |
| `PUT /system/config` | PUT | 更新系統配置 | GR.js |
| `GET /system/maintenance` | GET | 維護狀態 | DL.js |
| `POST /feedback/report` | POST | 問題回報 | DL.js |
| `GET /help/articles` | GET | 幫助文章 | GR.js |
| `POST /help/contact` | POST | 聯繫客服 | GR.js |
| `POST /system/retry` | POST | 重試機制 | DD3.js |
| `POST /system/sync` | POST | 離線同步 | DD3.js |

#### 5.4.12 備份與資料管理 (6個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `POST /backup/create` | POST | 建立備份 | BS.js |
| `GET /backup/list` | GET | 備份列表 | BS.js |
| `POST /backup/restore` | POST | 還原備份 | BS.js |
| `GET /backup/status` | GET | 備份狀態 | BS.js |
| `POST /data/export` | POST | 匯出資料 | BS.js |
| `POST /data/import` | POST | 匯入資料 | BS.js |

#### 5.4.13 通知管理 (8個端點)
| API端點 | HTTP方法 | 功能描述 | 對應模組 |
|---------|----------|----------|----------|
| `GET /notifications/settings` | GET | 取得通知設定 | SR.js |
| `PUT /notifications/settings` | PUT | 更新通知設定 | SR.js |
| `GET /notifications/list` | GET | 通知列表 | SR.js |
| `PUT /notifications/{id}/read` | PUT | 標記已讀 | SR.js |
| `POST /notifications/reminders` | POST | 建立記帳提醒 | SR.js |
| `PUT /notifications/reminders/{id}` | PUT | 更新提醒規則 | SR.js |
| `DELETE /notifications/reminders/{id}` | DELETE | 刪除提醒 | SR.js |
| `GET /notifications/reminder-templates` | GET | 取得提醒模板 | SR.js |

---

### 5.5 API端點模組對應總表

| 模組名稱 | 負責端點數量 | 主要功能範圍 |
|----------|-------------|-------------|
| **AM.js** | 22個 | 認證服務(11) + 用戶管理(11) |
| **BK.js** | 28個 | 記帳交易(20) + 帳戶管理(8) |
| **MLS.js** | 14個 | 帳本管理(14) |
| **BM.js** | 8個 | 預算管理(8) |
| **CM.js** | 0個 | 協作管理功能已整合到MLS.js中 |
| **SR.js** | 8個 | 通知管理(8) |
| **MRA.js** | 15個 | 報表分析(15) |
| **BS.js** | 6個 | 備份與資料管理(6) |
| **LBK.js** | 0個 | 快速記帳功能已整合到BK.js中 |
| **DD1.js** | 6個 | 科目管理(6) |
| **DD2.js** | 12個 | AI助理(6) + 激勵系統(6) |
| **DD3.js** | 2個 | 系統服務中的重試與同步功能 |
| **GR.js** | 7個 | 系統配置與幫助功能 |
| **DL.js** | 4個 | 系統狀態與問題回報功能 |
| **總計** | **132個** | 涵蓋所有8020文件要求的端點 |

---

## 6.0 資料流設計（Data Flow Design）

### 6.1 LINE OA 資料流
```
LINE 平台 → WH 模組 → 共用模組群 → Firestore → 回應處理 → LINE 平台
```

### 6.2 APP 資料流
```
Flutter App → 應用邏輯層 → APP模組群 → 共用模組群 → Firestore → JSON 回應 → Flutter App
```

### 6.3 模組間協作流程
1. **請求接收**: WH 模組或 APP 模組群接收請求
2. **身份驗證**: 驗證使用者身份和權限
3. **業務處理**: 呼叫相應的業務邏輯處理
4. **資料操作**: 透過共用模組群進行 Firestore 操作
5. **回應格式化**: 格式化回應資料
6. **結果回傳**: 回傳處理結果給請求方

---

