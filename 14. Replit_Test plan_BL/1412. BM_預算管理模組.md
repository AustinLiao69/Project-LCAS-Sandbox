
# TP_BM_預算管理模組 Test Plan v2.0

## 1. 測試範圍與目標

### 1.1 模組基本資訊
- **模組名稱**: BM 預算管理模組
- **模組版本**: v2.0.0 (升級版本)
- **測試計畫版本**: v2.0
- **對應需求文件**: 1312. BM_預算管理模組.md
- **對應技術設計**: 5012. BM_預算管理模組.md
- **測試基準**: 參照 3005. SR_排程提醒模組.md 格式

### 1.2 核心測試範圍
- 1.2.1 **預算管理核心功能**: 建立、編輯、刪除、分配預算
- 1.2.2 **預算執行追蹤**: 即時進度計算、使用記錄更新
- 1.2.3 **智慧警示系統**: 閾值檢查、多管道通知發送
- 1.2.4 **報告與分析**: 執行報告、趨勢分析、跨帳本比較
- 1.2.5 **跨模組整合**: 與 BK、MLS、DD、FS 等模組協作
- 1.2.6 **資料驗證與錯誤處理**: 輸入驗證、異常處理、資料完整性

### 1.3 測試目標
- **功能完整性**: 15個核心函數 100% 功能驗證
- **整合穩定性**: 與依賴模組完美協作，無相容性問題
- **效能指標**: 預算計算 < 500ms，警示觸發 < 200ms
- **資料安全**: 預算資料準確性 100%，無遺失風險
- **使用者體驗**: 操作流程直觀，錯誤提示明確

---

## 2. 測試環境與配置

### 2.1 系統環境
- **運行環境**: Node.js v22.17.0 + Replit
- **資料庫**: Firestore 測試環境
- **模組依賴**: 
  - DL 模組 v2.0.0 (日誌記錄)
  - DD 模組 v2.0.0 (資料分發)
  - FS 模組 v2.0.0 (Firestore 操作)
  - MLS 模組 v2.0.0 (多帳本管理)
  - BK 模組 v2.0.0 (記帳處理)

### 2.2 測試資料準備
- **測試帳本**: 3個不同類型帳本 (個人、共享、專案)
- **測試用戶**: 4個不同權限角色用戶
- **預算範例**: 月度、年度、專案、分類預算各 2 個
- **記帳資料**: 100 筆測試交易記錄

### 2.3 模組整合配置
- **BM ↔ MLS**: 帳本權限驗證整合
- **BM ↔ BK**: 記帳事件監聽整合  
- **BM ↔ DD**: 資料分發事件整合
- **BM ↔ LINE OA**: 警示通知發送整合

---

## 3. 詳細測試案例 (Test Cases)

### 3.1 預算管理核心功能測試

#### TC-001: 預算建立功能測試
- **目的**: 驗證 `BM_createBudget` 函數的預算建立流程
- **前置條件**: 
  - 測試用戶具有帳本管理權限
  - 帳本 ID 有效且可存取
- **測試步驟**:
  1. 以有效帳本 ID 和用戶 ID 調用建立預算
  2. 輸入完整預算資料 (名稱、金額、期間、分類)
  3. 測試不同預算類型 (monthly, yearly, project, category)
  4. 驗證預算 ID 生成和資料儲存
  5. 測試無效輸入 (空名稱、負金額、無效日期)
  6. 測試權限不足情況
- **驗證點**:
  - 預算建立成功率 100%
  - 預算 ID 格式正確且唯一
  - 資料儲存至 Firestore 完整無誤
  - 日誌記錄操作軌跡完整
  - 權限驗證機制正確運作
- **預期結果**:
  - 有效輸入建立成功，回傳 `{success: true, budgetId: string}`
  - 無效輸入被正確拒絕，回傳錯誤訊息
  - 無權限操作被阻擋

#### TC-002: 預算編輯功能測試
- **目的**: 驗證 `BM_editBudget` 函數的預算修改流程
- **前置條件**:
  - 已存在有效預算記錄
  - 用戶具有編輯權限
- **測試步驟**:
  1. 修改預算基本資訊 (名稱、金額、期間)
  2. 修改預算分類配置
  3. 修改警示規則設定
  4. 測試部分欄位更新
  5. 測試併發編輯處理
  6. 測試編輯歷史記錄
- **驗證點**:
  - 編輯操作即時生效
  - 更新欄位記錄準確
  - 併發編輯有適當控制
  - 歷史記錄完整保存
- **預期結果**:
  - 編輯成功率 100%
  - 資料一致性保持
  - 併發操作安全處理

#### TC-003: 預算刪除功能測試
- **目的**: 驗證 `BM_deleteBudget` 函數的安全刪除機制
- **前置條件**:
  - 已存在可刪除的預算記錄
  - 用戶具有刪除權限
- **測試步驟**:
  1. 測試二次確認機制
  2. 驗證確認令牌格式
  3. 測試刪除前備份建立
  4. 驗證軟刪除 (狀態標記)
  5. 測試關聯資料清理
  6. 測試權限不足阻擋
- **驗證點**:
  - 二次確認機制運作正常
  - 確認令牌驗證嚴格
  - 刪除操作可追溯
  - 資料備份完整
- **預期結果**:
  - 安全刪除流程 100% 有效
  - 誤刪風險降至最低
  - 資料可恢復性保證

### 3.2 預算執行追蹤測試

#### TC-004: 預算進度計算測試
- **目的**: 驗證 `BM_calculateBudgetProgress` 的即時進度計算
- **前置條件**:
  - 預算資料完整且有效
  - 相關交易記錄存在
- **測試步驟**:
  1. 測試不同使用率的進度計算 (0%, 50%, 80%, 95%, 100%, 110%)
  2. 驗證剩餘金額計算準確性
  3. 測試狀態判斷邏輯 (normal, warning, critical, exceeded)
  4. 測試邊界值處理
  5. 測試大數值計算精度
  6. 測試計算效能
- **驗證點**:
  - 進度計算精確度 ±0.01%
  - 狀態判斷邏輯正確
  - 計算回應時間 < 300ms
  - 邊界值處理安全
- **預期結果**:
  - 進度計算 100% 準確
  - 效能符合要求
  - 狀態轉換正確

#### TC-005: 預算使用記錄更新測試
- **目的**: 驗證 `BM_updateBudgetUsage` 的自動更新機制
- **前置條件**:
  - BK 模組記帳事件可正常觸發
  - 預算與記帳分類匹配
- **測試步驟**:
  1. 模擬記帳事件觸發預算更新
  2. 測試不同金額交易的更新
  3. 驗證分類匹配邏輯
  4. 測試多預算同時更新
  5. 測試更新失敗重試機制
  6. 測試警示觸發聯動
- **驗證點**:
  - 自動更新響應速度 < 1秒
  - 分類匹配準確率 100%
  - 多預算更新一致性
  - 警示觸發及時性
- **預期結果**:
  - 自動更新 100% 可靠
  - 資料同步即時
  - 警示機制聯動正常

### 3.3 智慧警示系統測試

#### TC-006: 預算警示條件檢查測試
- **目的**: 驗證 `BM_checkBudgetAlert` 的警示邏輯
- **前置條件**:
  - 預算警示規則已設定
  - 預算使用資料準確
- **測試步驟**:
  1. 測試不同閾值的警示觸發 (80%, 95%, 100%)
  2. 驗證警示等級判斷 (warning, critical, exceeded)
  3. 測試警示條件邊界值
  4. 測試警示開關控制
  5. 測試自訂閾值設定
  6. 測試警示頻率控制
- **驗證點**:
  - 警示觸發準確率 100%
  - 警示等級判斷正確
  - 閾值計算精確
  - 警示開關有效
- **預期結果**:
  - 警示邏輯完全可靠
  - 無誤報或漏報
  - 用戶控制權完整

#### TC-007: 預算警示通知發送測試
- **目的**: 驗證 `BM_triggerBudgetAlert` 的多管道通知
- **前置條件**:
  - LINE OA 模組正常運作
  - 通知對象清單準確
- **測試步驟**:
  1. 測試不同警示類型的通知內容
  2. 驗證 LINE 通知發送成功率
  3. 測試通知對象權限驗證
  4. 測試通知發送失敗重試
  5. 測試通知記錄保存
  6. 測試通知頻率限制
- **驗證點**:
  - 通知發送成功率 ≥ 95%
  - 通知內容格式正確
  - 通知對象準確無誤
  - 發送記錄完整
- **預期結果**:
  - 通知系統高可用
  - 通知內容個人化
  - 發送記錄可追蹤

#### TC-008: 警示規則自訂測試
- **目的**: 驗證 `BM_setBudgetAlertRules` 的規則設定
- **前置條件**:
  - 用戶具有警示設定權限
- **測試步驟**:
  1. 測試基本警示規則設定
  2. 測試自訂閾值設定
  3. 測試通知管道選擇
  4. 測試規則驗證邏輯
  5. 測試規則衝突處理
  6. 測試規則繼承機制
- **驗證點**:
  - 規則設定成功率 100%
  - 規則驗證邏輯正確
  - 衝突處理合理
  - 規則生效即時
- **預期結果**:
  - 規則設定靈活性高
  - 驗證機制嚴謹
  - 用戶體驗良好

### 3.4 報告與分析功能測試

#### TC-009: 預算執行報告生成測試
- **目的**: 驗證 `BM_getBudgetReport` 的報告生成功能
- **前置條件**:
  - 預算執行資料充足
  - 報告模板配置正確
- **測試步驟**:
  1. 測試不同報告類型生成
  2. 驗證報告資料準確性
  3. 測試圖表生成功能
  4. 測試報告匯出格式
  5. 測試大資料量報告效能
  6. 測試報告權限控制
- **驗證點**:
  - 報告資料準確率 100%
  - 圖表生成成功率 ≥ 95%
  - 報告生成時間 < 5秒
  - 權限控制有效
- **預期結果**:
  - 報告品質專業
  - 生成效率高
  - 資料視覺化清晰

#### TC-010: 預算趨勢分析測試
- **目的**: 驗證 `BM_analyzeBudgetTrend` 的趨勢分析功能
- **前置條件**:
  - 歷史預算資料豐富
  - 分析演算法正確
- **測試步驟**:
  1. 測試不同時間範圍的趨勢分析
  2. 驗證趨勢計算準確性
  3. 測試預測演算法
  4. 測試異常資料處理
  5. 測試分析洞察生成
  6. 測試分析效能
- **驗證點**:
  - 趨勢分析準確率 ≥ 85%
  - 預測準確率 ≥ 70%
  - 分析時間 < 3秒
  - 洞察內容有價值
- **預期結果**:
  - 分析結果有意義
  - 預測具參考價值
  - 洞察幫助決策

#### TC-011: 跨帳本預算比較測試
- **目的**: 驗證 `BM_compareBudgetAcrossLedgers` 的比較功能
- **前置條件**:
  - 多個帳本預算資料
  - 比較權限驗證
- **測試步驟**:
  1. 測試不同帳本類型比較
  2. 驗證比較指標計算
  3. 測試排名邏輯
  4. 測試比較建議生成
  5. 測試權限範圍限制
  6. 測試比較效能
- **驗證點**:
  - 比較指標準確性
  - 排名邏輯正確性
  - 建議實用性
  - 權限控制嚴謹
- **預期結果**:
  - 比較分析有洞察
  - 建議切實可行
  - 權限安全可靠

### 3.5 跨模組整合測試

#### TC-012: BM-MLS 模組整合測試
- **目的**: 驗證與多帳本管理模組的整合
- **前置條件**:
  - MLS 模組正常運作
  - 帳本權限配置正確
- **測試步驟**:
  1. 測試帳本權限驗證整合
  2. 驗證帳本切換影響
  3. 測試跨帳本預算操作
  4. 測試權限變更同步
  5. 測試帳本刪除影響
  6. 測試資料一致性
- **驗證點**:
  - 權限驗證準確率 100%
  - 帳本切換響應 < 500ms
  - 資料同步即時性
  - 一致性檢查通過
- **預期結果**:
  - 整合無縫連接
  - 權限控制嚴謹
  - 資料完全一致

#### TC-013: BM-BK 模組整合測試
- **目的**: 驗證與記帳處理模組的整合
- **前置條件**:
  - BK 模組正常運作
  - 記帳事件監聽正常
- **測試步驟**:
  1. 測試記帳事件自動觸發預算更新
  2. 驗證分類匹配邏輯
  3. 測試批量記帳處理
  4. 測試記帳撤銷影響
  5. 測試記帳修改同步
  6. 測試異常記帳處理
- **驗證點**:
  - 事件觸發成功率 100%
  - 分類匹配準確率 ≥ 95%
  - 批量處理穩定性
  - 異常處理完善性
- **預期結果**:
  - 自動化程度高
  - 資料同步可靠
  - 異常處理完善

#### TC-014: BM-DD 資料分發整合測試
- **目的**: 驗證與資料分發模組的整合
- **前置條件**:
  - DD 模組正常運作
  - 事件分發配置正確
- **測試步驟**:
  1. 測試預算事件分發
  2. 驗證事件訂閱機制
  3. 測試事件處理順序
  4. 測試事件失敗重試
  5. 測試事件過濾機制
  6. 測試事件追蹤記錄
- **驗證點**:
  - 事件分發成功率 ≥ 98%
  - 事件順序正確性
  - 重試機制有效性
  - 追蹤記錄完整性
- **預期結果**:
  - 事件機制可靠
  - 分發效率高
  - 追蹤能力強

### 3.6 錯誤處理與異常測試

#### TC-015: 預算資料驗證測試
- **目的**: 驗證 `BM_validateBudgetData` 的資料驗證功能
- **前置條件**:
  - 各種有效/無效資料準備
- **測試步驟**:
  1. 測試基本欄位驗證 (必填、格式、範圍)
  2. 測試邏輯關聯驗證 (日期關係、金額一致)
  3. 測試業務規則驗證 (分類總額、權限範圍)
  4. 測試邊界值驗證
  5. 測試特殊字元處理
  6. 測試驗證效能
- **驗證點**:
  - 驗證準確率 100%
  - 錯誤訊息明確性
  - 驗證時間 < 100ms
  - 建議實用性
- **預期結果**:
  - 驗證邏輯嚴謹
  - 使用者體驗良好
  - 效能符合要求

#### TC-016: 錯誤處理機制測試
- **目的**: 驗證 `BM_handleBudgetError` 的錯誤處理
- **前置條件**:
  - 各種錯誤情境準備
- **測試步驟**:
  1. 測試不同錯誤類型處理
  2. 驗證錯誤代碼生成
  3. 測試錯誤訊息國際化
  4. 測試錯誤恢復機制
  5. 測試錯誤統計分析
  6. 測試錯誤通知機制
- **驗證點**:
  - 錯誤分類準確性
  - 錯誤代碼唯一性
  - 恢復機制有效性
  - 通知及時性
- **預期結果**:
  - 錯誤處理完善
  - 用戶體驗平滑
  - 系統穩定性高

### 3.7 效能與壓力測試

#### TC-017: 預算計算效能測試
- **目的**: 驗證預算相關計算的效能表現
- **前置條件**:
  - 大量測試資料準備
  - 效能監控工具配置
- **測試步驟**:
  1. 測試單一預算進度計算效能
  2. 測試批量預算更新效能
  3. 測試複雜報告生成效能
  4. 測試併發計算處理能力
  5. 測試記憶體使用情況
  6. 測試長時間運行穩定性
- **驗證點**:
  - 單次計算時間 < 300ms
  - 批量處理吞吐量 ≥ 100/s
  - 記憶體使用穩定
  - 併發處理無死鎖
- **預期結果**:
  - 效能表現優異
  - 資源使用合理
  - 系統穩定可靠

#### TC-018: 大資料量壓力測試
- **目的**: 驗證系統在大資料量下的表現
- **前置條件**:
  - 10,000+ 預算記錄
  - 100,000+ 交易記錄
- **測試步驟**:
  1. 測試大量預算建立
  2. 測試大量記錄查詢
  3. 測試複雜聚合計算
  4. 測試大量警示處理
  5. 測試資料庫連接池
  6. 測試系統資源監控
- **驗證點**:
  - 響應時間不顯著增加
  - 系統記憶體使用合理
  - 資料庫連接穩定
  - 無資料遺失
- **預期結果**:
  - 大資料處理能力強
  - 系統擴展性好
  - 資料完整性保證

---

## 4. 測試執行方法與工具

### 4.1 自動化測試配置
```javascript
/**
 * 3012. TC_BM_預算管理模組_2.0.0
 * @description 基於 3012. BM_預算管理模組.md 測試計畫的完整測試套件
 * @version 2.0.0
 * @date 2025-07-22
 * @author SQA Team  
 * @基於 3012. BM_預算管理模組.md 測試計畫
 * @參考格式 3005. TC_SR.js
 * @模組版本 BM v2.0.0
 */
```

### 4.2 測試資料管理
- **測試資料庫**: 獨立的 Firestore 測試環境
- **資料清理**: 每次測試後自動清理測試資料
- **資料備份**: 測試前備份生產資料
- **資料隔離**: 測試與生產環境完全隔離

### 4.3 測試報告生成
- **即時報告**: Jest 測試執行過程即時反饋
- **詳細報告**: 包含覆蓋率、效能、錯誤統計
- **趨勢分析**: 測試結果歷史趨勢追蹤
- **品質指標**: 通過率、覆蓋率、效能指標

---

## 5. 驗收標準與成功指標

### 5.1 功能完整性標準
- **核心函數測試**: 15個函數 100% 通過測試
- **功能覆蓋率**: 代碼覆蓋率 ≥ 90%
- **邊界測試**: 所有邊界條件 100% 覆蓋
- **異常處理**: 所有異常情況妥善處理

### 5.2 整合穩定性標準
- **模組整合**: 與 5 個依賴模組無縫整合
- **資料一致性**: 跨模組資料 100% 一致
- **事件處理**: 事件響應成功率 ≥ 98%
- **併發安全**: 併發操作無資料衝突

### 5.3 效能指標標準
- **響應時間**: 
  - 預算計算 < 300ms
  - 警示檢查 < 200ms  
  - 報告生成 < 5秒
- **吞吐量**: 併發處理 ≥ 50 請求/秒
- **資源使用**: 記憶體使用 < 100MB
- **穩定性**: 長期運行無記憶體洩漏

### 5.4 使用者體驗標準
- **操作直觀**: 所有操作流程清晰明確
- **錯誤提示**: 錯誤訊息準確且具指導性
- **回應及時**: 使用者操作回應 < 1秒
- **資料安全**: 敏感資料 100% 安全保護

---

## 6. 風險評估與應對

### 6.1 高風險項目
- **資料準確性風險**: 預算計算錯誤影響財務決策
  - 應對: 多重驗證機制、自動化測試覆蓋
- **整合複雜性風險**: 多模組整合可能出現相容性問題
  - 應對: 分階段整合、詳細回歸測試
- **效能瓶頸風險**: 大資料量處理可能影響系統效能
  - 應對: 效能優化、負載測試驗證

### 6.2 中風險項目
- **警示可靠性風險**: 警示機制失效影響預算控制
  - 應對: 多管道通知、失敗重試機制
- **資料同步風險**: 跨模組資料同步延遲或失敗
  - 應對: 事件驅動架構、一致性檢查

### 6.3 低風險項目
- **介面變更風險**: API 介面變更影響相容性
  - 應對: 版本控制、向下相容保證
- **配置錯誤風險**: 測試環境配置錯誤
  - 應對: 自動化配置、環境檢查

---

## 7. 測試計畫執行時程

### 7.1 Phase 1: 核心功能測試 (2週)
- Week 1: TC-001 ~ TC-005 (預算管理核心功能)
- Week 2: TC-006 ~ TC-008 (智慧警示系統)

### 7.2 Phase 2: 整合與分析測試 (2週)  
- Week 3: TC-009 ~ TC-011 (報告分析功能)
- Week 4: TC-012 ~ TC-014 (跨模組整合)

### 7.3 Phase 3: 品質保證測試 (1週)
- Week 5: TC-015 ~ TC-018 (錯誤處理、效能壓力)

### 7.4 Phase 4: 回歸與驗收測試 (1週)
- Week 6: 完整回歸測試、驗收標準確認

---

## 8. 附錄

### 8.1 參考文件
- **需求文件**: 1012. BM_預算管理模組.md
- **技術設計**: 5012. BM_預算管理模組.md  
- **測試格式參考**: 3005. SR_排程提醒模組.md
- **模組代碼**: Modules/2012. BM.js

### 8.2 測試工具清單
- **單元測試**: Jest Testing Framework
- **效能測試**: Node.js Performance API
- **覆蓋率工具**: Jest Coverage Reporter
- **資料庫**: Firestore Emulator

### 8.3 聯絡資訊
- **測試負責人**: SQA Team
- **模組開發**: AustinLiao69
- **技術支援**: LCAS 2.0 Development Team

---

**測試計畫結束**

*此測試計畫基於 3005. SR_排程提醒模組.md 格式制定，涵蓋 BM 預算管理模組 v2.0.0 的所有功能與整合需求，確保系統品質與使用者體驗達到最高標準。*
