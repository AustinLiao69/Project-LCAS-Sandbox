
# SRS_EntryService_基礎記帳_v1.0.0

**文件編號**: 8902  
**版本**: 1.0.0  
**建立日期**: 2025-01-26  
**建立者**: LCAS SA Team  
**最後更新**: 2025-01-26 05:30:00 UTC+8

---

## 目次

1. [模組概述](#10-模組概述module-overview)
2. [基礎記帳服務簡介](#20-基礎記帳服務簡介entry-service-introduction)
3. [API端點規格](#30-api端點規格api-endpoints-specification)

---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
EntryService 基礎記帳服務是 LCAS 2.0 Flutter AP Layer 的核心記帳模組，負責處理4個基礎記帳API端點，為 Flutter Presentation Layer 提供完整的記帳CRUD操作介面。

### 1.2 核心職責
- **新增記帳記錄**: 支援收入、支出、轉帳三種記帳類型
- **查詢記帳記錄**: 提供多維度篩選與分頁查詢功能
- **更新記帳記錄**: 支援記帳記錄的修改與更新
- **刪除記帳記錄**: 提供安全的記錄刪除功能

---

## 2.0 基礎記帳服務簡介（Entry Service Introduction）

### 2.1 目標與角色
基礎記帳服務在 LCAS 2.0 Flutter 架構中提供核心的記帳API功能：
- **API端點實作**: 實作4個記帳相關的API端點
- **資料驗證**: 確保記帳資料的完整性與正確性
- **業務邏輯處理**: 處理記帳相關的業務規則與計算

---

## 3.0 API端點規格（API Endpoints Specification）

### 3.1 基礎記帳API群組（F006-F009）

#### 3.1.1 F006: 新增記帳記錄
**功能描述**: 新增收入、支出或轉帳記錄

**API規格**:
- **HTTP方法**: POST
- **端點**: `/entries`
- **輸入參數**:
```dart
class CreateEntryRequest {
  final EntryType entryType;        // 記帳類型
  final double amount;              // 金額（必填）
  final String subjectCode;         // 科目代碼（必填）
  final String? subjectName;        // 科目名稱
  final String? ledgerId;           // 帳本ID（預設為default）
  final DateTime? entryDate;        // 記帳日期（預設為今日）
  final String? description;        // 備註說明
  final List<String>? tags;         // 標籤列表
  final LocationData? location;     // 地點資訊
}

enum EntryType { income, expense, transfer }

class LocationData {
  final double? latitude;
  final double? longitude;
  final String? address;
}
```

**輸出規格**:
```dart
class CreateEntryResponse {
  final bool success;
  final String entryId;
  final DateTime createdAt;
  final BalanceUpdate balanceUpdate;
  final String? errorMessage;
}

class BalanceUpdate {
  final double previousBalance;
  final double newBalance;
  final double changeAmount;
}
```

#### 3.1.2 F007: 查詢記帳記錄
**功能描述**: 多維度查詢記帳記錄

**API規格**:
- **HTTP方法**: GET
- **端點**: `/entries`
- **輸入參數**:
```dart
class QueryEntriesRequest {
  final DateRange? dateRange;           // 日期範圍
  final List<String>? subjectCodes;     // 科目代碼篩選
  final List<EntryType>? entryTypes;    // 記帳類型篩選
  final AmountRange? amountRange;       // 金額範圍
  final List<String>? ledgerIds;        // 帳本ID篩選
  final String? searchKeyword;          // 關鍵字搜尋
  final PaginationParams pagination;    // 分頁參數
  final SortOptions? sort;              // 排序選項
}

class DateRange {
  final DateTime startDate;
  final DateTime endDate;
}

class AmountRange {
  final double? minAmount;
  final double? maxAmount;
}

class PaginationParams {
  final int page;
  final int limit;
}

class SortOptions {
  final SortField field;
  final SortOrder order;
}

enum SortField { entryDate, amount, subjectName }
enum SortOrder { asc, desc }
```

**輸出規格**:
```dart
class QueryEntriesResponse {
  final bool success;
  final List<EntryData> entries;
  final QuerySummary summary;
  final PaginationInfo pagination;
  final String? errorMessage;
}

class EntryData {
  final String entryId;
  final EntryType entryType;
  final double amount;
  final String subjectCode;
  final String subjectName;
  final DateTime entryDate;
  final String? description;
  final List<String>? tags;
  final String ledgerName;
  final DateTime createdAt;
  final DateTime? updatedAt;
}

class QuerySummary {
  final int totalEntries;
  final double totalIncome;
  final double totalExpense;
  final double netAmount;
}

class PaginationInfo {
  final int currentPage;
  final int totalPages;
  final bool hasNext;
  final bool hasPrevious;
}
```

#### 3.1.3 F008: 更新記帳記錄
**功能描述**: 修改既有記帳記錄

**API規格**:
- **HTTP方法**: PUT
- **端點**: `/entries/{id}`
- **輸入參數**:
```dart
class UpdateEntryRequest {
  final String entryId;             // 記錄ID（必填）
  final EntryType? entryType;       // 記帳類型
  final double? amount;             // 金額
  final String? subjectCode;        // 科目代碼
  final String? subjectName;        // 科目名稱
  final DateTime? entryDate;        // 記帳日期
  final String? description;        // 備註說明
  final List<String>? tags;         // 標籤列表
  final LocationData? location;     // 地點資訊
  final String? updateReason;       // 更新原因
}
```

**輸出規格**:
```dart
class UpdateEntryResponse {
  final bool success;
  final String entryId;
  final DateTime updatedAt;
  final EntryData updatedEntry;
  final BalanceUpdate? balanceUpdate;
  final String? errorMessage;
}
```

#### 3.1.4 F009: 刪除記帳記錄
**功能描述**: 刪除指定記帳記錄

**API規格**:
- **HTTP方法**: DELETE
- **端點**: `/entries/{id}`
- **輸入參數**:
```dart
class DeleteEntryRequest {
  final String entryId;             // 記錄ID（必填）
  final String? deleteReason;       // 刪除原因
  final bool confirmDelete;         // 確認刪除（必填）
}
```

**輸出規格**:
```dart
class DeleteEntryResponse {
  final bool success;
  final String entryId;
  final DateTime deletedAt;
  final BalanceUpdate balanceUpdate;
  final String? errorMessage;
}
```

### 3.2 EntryService實作

#### 3.2.1 EntryService 主服務類別
```dart
class EntryService {
  final ApiClient _apiClient;

  EntryService(this._apiClient);

  // 新增記帳記錄
  Future<CreateEntryResponse> createEntry(CreateEntryRequest request) async {
    final response = await _apiClient.post('/entries', data: request.toJson());
    return CreateEntryResponse.fromJson(response.data);
  }

  // 查詢記帳記錄
  Future<QueryEntriesResponse> queryEntries(QueryEntriesRequest request) async {
    final response = await _apiClient.get('/entries', queryParameters: request.toJson());
    return QueryEntriesResponse.fromJson(response.data);
  }

  // 更新記帳記錄
  Future<UpdateEntryResponse> updateEntry(UpdateEntryRequest request) async {
    final response = await _apiClient.put('/entries/${request.entryId}', data: request.toJson());
    return UpdateEntryResponse.fromJson(response.data);
  }

  // 刪除記帳記錄
  Future<DeleteEntryResponse> deleteEntry(DeleteEntryRequest request) async {
    final response = await _apiClient.delete('/entries/${request.entryId}', data: request.toJson());
    return DeleteEntryResponse.fromJson(response.data);
  }
}
```

---

## 文件維護記錄

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| **v1.0.0** | **2025-01-26** | **LCAS SA Team** | **基礎記帳服務建立：實作4個API端點的完整記帳CRUD功能** |

---

## 備註

- **版本1.0.0特色**: 完整的基礎記帳CRUD功能，支援多維度查詢與分頁
- **4個API端點**: F006-F009 基礎記帳管理功能（新增、查詢、更新、刪除）
- **資料驗證**: 完整的輸入參數驗證與錯誤處理
- **業務邏輯**: 支援三種記帳類型、多帳本、標籤系統
- **對應模組**: 與 BK 模組 v2.1.0 整合
- **查詢功能**: 支援日期範圍、科目篩選、金額範圍、關鍵字搜尋
- **分頁支援**: 完整的分頁查詢與統計摘要功能
