# SRS_AuthService_認證服務_v1.0.0

**文件編號**: 8901  
**版本**: 1.0.0  
**建立日期**: 2025-08-02  
**建立者**: LCAS SA Team  
**最後更新**: 2025-08-02 05:00:00 UTC+8

---

## 目次

1. [模組概述](#10-模組概述module-overview)
2. [認證服務簡介](#20-認證服務簡介authentication-service-introduction)
3. [API端點規格](#30-api端點規格api-endpoints-specification)

---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
AuthService 認證服務是 LCAS 2.0 Flutter AP Layer 的基礎認證模組，負責處理5個核心認證API端點，為 Flutter Presentation Layer 提供簡單的認證服務介面。

### 1.2 核心職責
- **使用者註冊**: 支援 LINE OAuth 和 Email/Password 雙重認證方式
- **使用者登入**: 基本登入驗證功能
- **使用者登出**: 簡單登出處理
- **帳號刪除**: 基本帳號刪除功能
- **密碼重設**: 基礎密碼重設流程

---

## 2.0 認證服務簡介（Authentication Service Introduction）

### 2.1 目標與角色
認證服務在 LCAS 2.0 Flutter 架構中提供基礎的認證API功能：
- **API端點實作**: 實作5個認證相關的API端點
- **基礎認證支援**: 整合 LINE OAuth 和傳統 Email/Password 認證
- **簡單資料處理**: 處理認證相關的基本資料傳輸

---

## 3.0 API端點規格（API Endpoints Specification）

### 3.1 認證管理API群組（F001-F005）

#### 3.1.1 F001: 使用者註冊
**功能描述**: 支援新使用者註冊流程

**API規格**:
- **HTTP方法**: POST
- **端點**: `/auth/register`
- **輸入參數**:
```dart
class RegisterRequest {
  final String displayName;      // 顯示名稱（必填）
  final String? email;           // Email（可選）
  final String? password;        // 密碼（可選）
  final String? lineUserId;      // LINE User ID（LINE註冊時必填）
  final String? lineAccessToken; // LINE Access Token
  final UserMode defaultMode;    // 預設使用者模式
}
```

**輸出規格**:
```dart
class RegisterResponse {
  final bool success;
  final String userId;
  final String accessToken;
  final String refreshToken;
  final DateTime expiresAt;
  final UserProfile userProfile;
  final String? errorMessage;
}
```

#### 3.1.2 F002: 使用者登入
**功能描述**: 支援多重登入方式

**API規格**:
- **HTTP方法**: POST
- **端點**: `/auth/login`
- **輸入參數**:
```dart
class LoginRequest {
  final AuthType authType;       // 認證類型
  final String? email;           // Email登入
  final String? password;        // 密碼登入
  final String? lineCode;        // LINE授權碼
  final String? lineAccessToken; // LINE Access Token
  final bool rememberMe;         // 記住登入狀態
}

enum AuthType { email, line }
```

**輸出規格**:
```dart
class LoginResponse {
  final bool success;
  final String accessToken;
  final String refreshToken;
  final DateTime expiresAt;
  final UserProfile userProfile;
  final List<String> permissions;
  final String? errorCode;
  final String? errorMessage;
}
```

#### 3.1.3 F003: 使用者登出
**功能描述**: 基本登出處理

**API規格**:
- **HTTP方法**: POST
- **端點**: `/auth/logout`
- **輸入參數**:
```dart
class LogoutRequest {
  final String accessToken;
  final bool logoutAllDevices; // 是否登出所有裝置
}
```

**輸出規格**:
```dart
class LogoutResponse {
  final bool success;
  final String message;
}
```

#### 3.1.4 F004: 帳號刪除
**功能描述**: 基本帳號刪除功能

**API規格**:
- **HTTP方法**: DELETE
- **端點**: `/auth/account`
- **輸入參數**:
```dart
class DeleteAccountRequest {
  final String password;      // 密碼確認
  final String confirmText;   // 確認文字
  final bool deleteAllData;   // 是否刪除所有資料
}
```

**輸出規格**:
```dart
class DeleteAccountResponse {
  final bool success;
  final String message;
  final DateTime scheduledDeletionDate; // 預計刪除日期
}
```

#### 3.1.5 F005: 密碼重設
**功能描述**: 基礎密碼重設流程

**API規格**:
- **HTTP方法**: POST
- **端點**: `/auth/reset-password`
- **輸入參數**:
```dart
class ResetPasswordRequest {
  final String email;
  final String? resetToken;    // 重設 Token（第二步時提供）
  final String? newPassword;   // 新密碼（第二步時提供）
}
```

**輸出規格**:
```dart
class ResetPasswordResponse {
  final bool success;
  final String message;
  final bool tokenSent;        // 是否已發送重設 Token
}
```

### 3.2 AuthService實作

#### 3.2.1 AuthService 主服務類別
```dart
class AuthService {
  final ApiClient _apiClient;

  AuthService(this._apiClient);

  // 註冊
  Future<RegisterResponse> register(RegisterRequest request) async {
    final response = await _apiClient.post('/auth/register', data: request.toJson());
    return RegisterResponse.fromJson(response.data);
  }

  // 登入
  Future<LoginResponse> login(LoginRequest request) async {
    final response = await _apiClient.post('/auth/login', data: request.toJson());
    return LoginResponse.fromJson(response.data);
  }

  // 登出
  Future<LogoutResponse> logout(LogoutRequest request) async {
    final response = await _apiClient.post('/auth/logout', data: request.toJson());
    return LogoutResponse.fromJson(response.data);
  }

  // 刪除帳號
  Future<DeleteAccountResponse> deleteAccount(DeleteAccountRequest request) async {
    final response = await _apiClient.delete('/auth/account', data: request.toJson());
    return DeleteAccountResponse.fromJson(response.data);
  }

  // 重設密碼
  Future<ResetPasswordResponse> resetPassword(ResetPasswordRequest request) async {
    final response = await _apiClient.post('/auth/reset-password', data: request.toJson());
    return ResetPasswordResponse.fromJson(response.data);
  }
}
```

---

## 文件維護記錄

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| **v1.0.0** | **2025-01-26** | **LCAS SA Team** | **簡化版建立：僅包含5個API端點的基本功能實作** |

---

## 備註

- **版本1.0.0特色**: 簡化的認證服務模組，專注於5個API端點的基本實作
- **5個API端點**: F001-F005 認證管理功能（註冊、登入、登出、刪除、重設密碼）
- **簡化設計**: 移除token管理、安全驗證、狀態管理、錯誤處理等複雜功能
- **基礎實作**: 提供最基本的API調用和資料轉換功能
- **對應模組**: 與 AM 模組 v1.1.1 整合