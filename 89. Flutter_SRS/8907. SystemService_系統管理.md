
# SRS_SystemService_系統管理_v1.0.0

**文件編號**: 8907  
**版本**: 1.0.0  
**建立日期**: 2025-08-02  
**建立者**: LCAS SA Team  
**最後更新**: 2025-08-02 05:00:00 UTC+8

---

## 目次

1. [模組概述](#10-模組概述module-overview)
2. [系統管理服務簡介](#20-系統管理服務簡介system-service-introduction)
3. [API端點規格](#30-api端點規格api-endpoints-specification)

---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
SystemService 系統管理服務是 LCAS 2.0 Flutter AP Layer 的核心管理模組，負責處理8個系統管理API端點，為 Flutter Presentation Layer 提供全面的系統管理服務介面。

### 1.2 核心職責
- **備份管理**: 支援排程備份、手動備份、備份列表查詢
- **同步監控**: 檢查系統同步狀態和健康監控
- **日誌管理**: 錯誤日誌查看和管理功能
- **提醒系統**: 建立和執行各種系統提醒功能
- **系統維護**: 全面的系統狀態監控和維護

---

## 2.0 系統管理服務簡介（System Service Introduction）

### 2.1 目標與角色
系統管理服務在 LCAS 2.0 Flutter 架構中提供核心的系統管理API功能：
- **備份服務**: 實作3個備份相關的API端點
- **監控服務**: 實作2個系統監控API端點
- **日誌服務**: 實作1個錯誤日誌API端點
- **提醒服務**: 實作2個提醒系統API端點

---

## 3.0 API端點規格（API Endpoints Specification）

### 3.1 備份管理API群組（F025-F027）

#### 3.1.1 F025: 排程備份
**功能描述**: 設定定期自動備份排程

**API規格**:
- **HTTP方法**: POST
- **端點**: `/system/backup/schedule`
- **輸入參數**:
```dart
class ScheduleBackupRequest {
  final String userId;               // 使用者ID（必填）
  final String backupName;           // 備份名稱（必填）
  final BackupFrequency frequency;   // 備份頻率（必填）
  final String timeOfDay;            // 執行時間（必填）
  final String timezone;             // 時區設定（必填）
  final BackupScope scope;           // 備份範圍（必填）
  final BackupOptions options;       // 備份選項（必填）
}

enum BackupFrequency { daily, weekly, monthly }

class BackupScope {
  final List<String> ledgerIds;     // 帳本ID列表
  final bool includeSettings;       // 包含設定
  final bool includeReports;        // 包含報表
  final bool includeAttachments;    // 包含附件
}

class BackupOptions {
  final bool compression;           // 壓縮選項
  final bool encryption;           // 加密選項
  final String storageLocation;    // 儲存位置
  final RetentionPolicy retention; // 保留政策
}
```

**輸出規格**:
```dart
class ScheduleBackupResponse {
  final bool success;
  final String scheduleId;
  final String backupName;
  final DateTime nextExecution;
  final BackupEstimation estimation;
  final String? errorMessage;
}

class BackupEstimation {
  final String estimatedSize;
  final String estimatedDuration;
  final int includedEntries;
  final int includedLedgers;
}
```

#### 3.1.2 F026: 手動備份
**功能描述**: 執行即時手動備份操作

**API規格**:
- **HTTP方法**: POST
- **端點**: `/app/backup/manual`
- **輸入參數**:
```dart
class ManualBackupRequest {
  final String backupName;          // 備份名稱（必填）
  final String description;         // 備份描述（可選）
  final BackupScope scope;          // 備份範圍（必填）
  final BackupOptions options;      // 備份選項（必填）
  final String priority;            // 優先級（可選）
}
```

**輸出規格**:
```dart
class ManualBackupResponse {
  final bool success;
  final String backupId;
  final String operationId;
  final DateTime startedAt;
  final String estimatedDuration;
  final BackupProgress progress;
  final String? errorMessage;
}

class BackupProgress {
  final String currentStage;
  final int stagesTotal;
  final int stagesCompleted;
  final int progressPercentage;
  final String currentTask;
  final String estimatedRemaining;
}
```

#### 3.1.3 F027: 查看備份列表
**功能描述**: 查詢備份檔案列表和詳細資訊

**API規格**:
- **HTTP方法**: GET
- **端點**: `/app/backup/list`
- **輸入參數**:
```dart
class BackupListRequest {
  final String userId;              // 使用者ID（必填）
  final DateRange? dateRange;       // 日期範圍（可選）
  final List<String>? backupTypes;  // 備份類型（可選）
  final List<String>? statusFilter; // 狀態篩選（可選）
  final SortOptions? sortOptions;   // 排序選項（可選）
  final PaginationOptions? pagination; // 分頁選項（可選）
}

class DateRange {
  final DateTime startDate;
  final DateTime endDate;
}

class SortOptions {
  final String sortBy;
  final String sortOrder;
}

class PaginationOptions {
  final int page;
  final int limit;
}
```

**輸出規格**:
```dart
class BackupListResponse {
  final bool success;
  final BackupSummary summary;
  final List<BackupFile> backupFiles;
  final StorageAnalysis storageAnalysis;
  final List<String> recommendations;
  final String? errorMessage;
}

class BackupSummary {
  final int totalBackups;
  final String totalSize;
  final int healthyBackups;
  final int corruptedBackups;
  final DateTime lastBackup;
}

class BackupFile {
  final String backupId;
  final String backupName;
  final String backupType;
  final DateTime createdAt;
  final String fileSize;
  final String status;
  final IntegrityCheck integrityCheck;
  final ContentInfo contentInfo;
  final EncryptionInfo encryptionInfo;
}

class IntegrityCheck {
  final DateTime lastVerified;
  final String status;
  final bool checksumValid;
}

class ContentInfo {
  final int ledgerRecords;
  final int userSettings;
  final int customSubjects;
  final String dateRange;
}

class EncryptionInfo {
  final bool encrypted;
  final String algorithm;
  final String keyStatus;
}

class StorageAnalysis {
  final String usedSpace;
  final String availableSpace;
  final double usagePercentage;
}
```

### 3.2 系統監控API群組（F028-F030）

#### 3.2.1 F028: 檢查同步狀態
**功能描述**: 檢查多平台資料同步狀態

**API規格**:
- **HTTP方法**: GET
- **端點**: `/system/sync/status`
- **輸入參數**:
```dart
class SyncStatusRequest {
  final String checkType;           // 檢查類型（必填）
  final List<String> platforms;     // 平台列表（必填）
  final DataScope dataScope;        // 資料範圍（必填）
  final String verificationDepth;   // 驗證深度（必填）
}

class DataScope {
  final bool includeUserData;
  final bool includeLedgerData;
  final bool includeSettings;
  final DateRange? dateRange;
}
```

**輸出規格**:
```dart
class SyncStatusResponse {
  final bool success;
  final SyncStatus syncStatus;
  final ConsistencyReport consistencyReport;
  final List<PlatformStatus> platformStatus;
  final List<IdentifiedIssue> identifiedIssues;
  final PerformanceMetrics performanceMetrics;
  final String? errorMessage;
}

class SyncStatus {
  final String overallStatus;
  final DateTime lastCheck;
  final String checkDuration;
  final int platformsChecked;
}

class ConsistencyReport {
  final int totalRecordsChecked;
  final int consistentRecords;
  final int inconsistentRecords;
  final double consistencyRate;
  final int majorInconsistencies;
  final int minorInconsistencies;
}

class PlatformStatus {
  final String platform;
  final String status;
  final DateTime lastSync;
  final String syncDelay;
  final double dataCompleteness;
}

class IdentifiedIssue {
  final String issueType;
  final String severity;
  final int affectedRecords;
  final String description;
  final bool autoFixable;
}

class PerformanceMetrics {
  final String averageSyncTime;
  final double syncSuccessRate;
  final String bandwidthUsage;
}
```

#### 3.2.2 F029: 系統健康檢查
**功能描述**: 監控系統運行狀態和效能指標

**API規格**:
- **HTTP方法**: GET
- **端點**: `/system/health/check`
- **輸入參數**:
```dart
class HealthCheckRequest {
  final MonitoringScope monitoringScope;  // 監控範圍（必填）
  final AlertThresholds alertThresholds;  // 警示門檻（必填）
  final String diagnosticLevel;           // 診斷層級（必填）
}

class MonitoringScope {
  final bool includePerformance;
  final bool includeResources;
  final bool includeServices;
  final bool includeDependencies;
  final String timeWindow;
}

class AlertThresholds {
  final double cpuUsage;
  final double memoryUsage;
  final int responseTime;
  final double errorRate;
}
```

**輸出規格**:
```dart
class HealthCheckResponse {
  final bool success;
  final SystemHealth systemHealth;
  final PerformanceMetrics performanceMetrics;
  final List<ServiceStatus> serviceStatus;
  final List<Alert> alerts;
  final List<String> recommendations;
  final TrendAnalysis trends;
  final String? errorMessage;
}

class SystemHealth {
  final String overallStatus;
  final double healthScore;
  final DateTime lastCheck;
  final String uptime;
}

class PerformanceMetrics {
  final double cpuUsage;
  final double memoryUsage;
  final double diskUsage;
  final NetworkIO networkIO;
  final int averageResponseTime;
  final int requestsPerMinute;
}

class NetworkIO {
  final String incoming;
  final String outgoing;
}

class ServiceStatus {
  final String serviceName;
  final String status;
  final String health;
  final int responseTime;
  final DateTime lastRestart;
  final String? warningReason;
}

class Alert {
  final String alertId;
  final String severity;
  final String type;
  final String message;
  final DateTime triggeredAt;
  final bool autoResolved;
}

class TrendAnalysis {
  final String cpuTrend;
  final String memoryTrend;
  final String responseTimeTrend;
  final String errorRateTrend;
}
```

#### 3.2.3 F030: 查看錯誤日誌
**功能描述**: 查詢和管理系統錯誤日誌

**API規格**:
- **HTTP方法**: GET
- **端點**: `/system/logs/errors`
- **輸入參數**:
```dart
class ErrorLogRequest {
  final QueryFilters queryFilters;    // 查詢篩選（必填）
  final PaginationOptions pagination; // 分頁選項（必填）
  final SortOptions sortOptions;      // 排序選項（必填）
  final AggregationOptions? aggregation; // 聚合選項（可選）
}

class QueryFilters {
  final TimeRange timeRange;
  final List<String> severityLevels;
  final List<String> modules;
  final List<String>? errorCodes;
  final String? userId;
  final String? searchText;
}

class TimeRange {
  final DateTime startTime;
  final DateTime endTime;
}

class AggregationOptions {
  final String groupBy;
  final bool includeStatistics;
}
```

**輸出規格**:
```dart
class ErrorLogResponse {
  final bool success;
  final LogSummary logSummary;
  final List<ErrorLog> errorLogs;
  final ErrorStatistics errorStatistics;
  final List<String> insights;
  final PaginationInfo pagination;
  final String? errorMessage;
}

class LogSummary {
  final int totalErrors;
  final int uniqueErrorTypes;
  final int criticalErrors;
  final double errorRate;
  final String timeRange;
}

class ErrorLog {
  final String logId;
  final DateTime timestamp;
  final String severity;
  final String module;
  final String errorCode;
  final String errorMessage;
  final String? userId;
  final String? sessionId;
  final String stackTrace;
  final Map<String, dynamic> context;
  final String resolutionStatus;
}

class ErrorStatistics {
  final List<ModuleStatistic> byModule;
  final List<ErrorCodeStatistic> byErrorCode;
  final List<HourlyDistribution> hourlyDistribution;
}

class ModuleStatistic {
  final String module;
  final int errorCount;
  final double percentage;
}

class ErrorCodeStatistic {
  final String errorCode;
  final int count;
  final String trend;
}

class HourlyDistribution {
  final String hour;
  final int errorCount;
}

class PaginationInfo {
  final int currentPage;
  final int totalPages;
  final bool hasNext;
}
```

### 3.3 提醒系統API群組（F031-F032）

#### 3.3.1 F031: 建立提醒
**功能描述**: 設定個人化的排程提醒

**API規格**:
- **HTTP方法**: POST
- **端點**: `/schedule/reminder`
- **輸入參數**:
```dart
class CreateReminderRequest {
  final ReminderConfig reminderConfig;    // 提醒設定（必填）
  final ScheduleSettings scheduleSettings; // 排程設定（必填）
  final ContentSettings contentSettings;   // 內容設定（必填）
  final DeliverySettings deliverySettings; // 傳送設定（必填）
  final SmartFeatures? smartFeatures;     // 智慧功能（可選）
}

class ReminderConfig {
  final String userId;
  final String reminderName;
  final String reminderType;
  final bool enabled;
  final String priority;
}

class ScheduleSettings {
  final String frequency;
  final String timeOfDay;
  final String timezone;
  final List<int>? daysOfWeek;
  final List<int>? daysOfMonth;
  final CustomSchedule? customSchedule;
}

class CustomSchedule {
  final String cronExpression;
}

class ContentSettings {
  final String messageTemplate;
  final Personalization personalization;
  final DynamicContent dynamicContent;
}

class Personalization {
  final bool includeStatistics;
  final bool includeBudgetStatus;
  final bool includeTips;
}

class DynamicContent {
  final bool adaptBasedOnUsage;
  final bool varyMessageStyle;
}

class DeliverySettings {
  final List<String> channels;
  final List<String> fallbackChannels;
  final QuietHours quietHours;
  final DoNotDisturb doNotDisturb;
}

class QuietHours {
  final String start;
  final String end;
}

class DoNotDisturb {
  final bool weekends;
  final bool holidays;
}

class SmartFeatures {
  final bool adaptiveTiming;
  final bool skipIfRecentlyActive;
  final bool increaseFrequencyIfMissed;
  final bool contextAwareness;
}
```

**輸出規格**:
```dart
class CreateReminderResponse {
  final bool success;
  final ReminderInfo reminderInfo;
  final ScheduleSummary scheduleSummary;
  final SmartFeaturesStatus smartFeaturesStatus;
  final TestDelivery testDelivery;
  final EffectivenessTracking effectivenessTracking;
  final String? errorMessage;
}

class ReminderInfo {
  final String reminderId;
  final String reminderName;
  final String status;
  final DateTime createdAt;
  final DateTime nextExecution;
}

class ScheduleSummary {
  final String frequency;
  final int estimatedMonthlyReminders;
  final List<String> channels;
  final bool personalizationEnabled;
}

class SmartFeaturesStatus {
  final String adaptiveTiming;
  final String contextAwareness;
  final String messageVariation;
}

class TestDelivery {
  final bool testSent;
  final List<String> deliveryChannels;
  final DateTime deliveryTime;
  final String deliveryStatus;
}

class EffectivenessTracking {
  final bool trackingEnabled;
  final List<String> metricsCollected;
  final bool optimizationSuggestions;
}
```

#### 3.3.2 F032: 執行提醒
**功能描述**: 執行排程提醒發送

**API規格**:
- **HTTP方法**: POST
- **端點**: `/schedule/execute`
- **輸入參數**:
```dart
class ExecuteReminderRequest {
  final ExecutionRequest executionRequest;   // 執行請求（必填）
  final ExecutionOptions executionOptions;   // 執行選項（必填）
  final ContentGeneration contentGeneration; // 內容產生（必填）
  final DeliveryPreferences deliveryPreferences; // 傳送偏好（必填）
}

class ExecutionRequest {
  final String executionType;
  final List<String> reminderIds;
  final DateTime executionTime;
  final bool forceExecution;
}

class ExecutionOptions {
  final bool respectQuietHours;
  final bool checkUserActivity;
  final bool personalizeContent;
  final bool trackDelivery;
  final bool retryOnFailure;
}

class ContentGeneration {
  final bool includeStatistics;
  final bool includeContext;
  final bool messageVariation;
  final String localization;
}

class DeliveryPreferences {
  final String primaryChannel;
  final bool fallbackEnabled;
  final int deliveryTimeout;
  final bool confirmDelivery;
}
```

**輸出規格**:
```dart
class ExecuteReminderResponse {
  final bool success;
  final ExecutionSummary executionSummary;
  final List<DeliveryDetail> deliveryDetails;
  final PerformanceMetrics performanceMetrics;
  final NextExecution nextExecution;
  final List<String> optimizationInsights;
  final String? errorMessage;
}

class ExecutionSummary {
  final String executionId;
  final int totalReminders;
  final int successfulDeliveries;
  final int failedDeliveries;
  final int skippedDeliveries;
  final DateTime executionTime;
  final String totalDuration;
}

class DeliveryDetail {
  final String reminderId;
  final String userId;
  final String deliveryStatus;
  final String deliveryChannel;
  final DateTime deliveryTime;
  final String messageContent;
  final PersonalizationApplied personalizationApplied;
  final DeliveryResponse deliveryResponse;
}

class PersonalizationApplied {
  final int entryCount;
  final String budgetStatus;
  final String suggestedAction;
}

class DeliveryResponse {
  final String messageId;
  final bool deliveryConfirmed;
  final String userInteraction;
}

class NextExecution {
  final String reminderId;
  final DateTime scheduledTime;
  final int estimatedRecipients;
  final String contentPreview;
}
```

### 3.4 SystemService實作

#### 3.4.1 SystemService 主服務類別
```dart
class SystemService {
  final ApiClient _apiClient;

  SystemService(this._apiClient);

  // 排程備份
  Future<ScheduleBackupResponse> scheduleBackup(ScheduleBackupRequest request) async {
    final response = await _apiClient.post('/system/backup/schedule', data: request.toJson());
    return ScheduleBackupResponse.fromJson(response.data);
  }

  // 手動備份
  Future<ManualBackupResponse> manualBackup(ManualBackupRequest request) async {
    final response = await _apiClient.post('/app/backup/manual', data: request.toJson());
    return ManualBackupResponse.fromJson(response.data);
  }

  // 查看備份列表
  Future<BackupListResponse> getBackupList(BackupListRequest request) async {
    final response = await _apiClient.get('/app/backup/list', queryParameters: request.toJson());
    return BackupListResponse.fromJson(response.data);
  }

  // 檢查同步狀態
  Future<SyncStatusResponse> checkSyncStatus(SyncStatusRequest request) async {
    final response = await _apiClient.get('/system/sync/status', queryParameters: request.toJson());
    return SyncStatusResponse.fromJson(response.data);
  }

  // 系統健康檢查
  Future<HealthCheckResponse> healthCheck(HealthCheckRequest request) async {
    final response = await _apiClient.get('/system/health/check', queryParameters: request.toJson());
    return HealthCheckResponse.fromJson(response.data);
  }

  // 查看錯誤日誌
  Future<ErrorLogResponse> getErrorLogs(ErrorLogRequest request) async {
    final response = await _apiClient.get('/system/logs/errors', queryParameters: request.toJson());
    return ErrorLogResponse.fromJson(response.data);
  }

  // 建立提醒
  Future<CreateReminderResponse> createReminder(CreateReminderRequest request) async {
    final response = await _apiClient.post('/schedule/reminder', data: request.toJson());
    return CreateReminderResponse.fromJson(response.data);
  }

  // 執行提醒
  Future<ExecuteReminderResponse> executeReminder(ExecuteReminderRequest request) async {
    final response = await _apiClient.post('/schedule/execute', data: request.toJson());
    return ExecuteReminderResponse.fromJson(response.data);
  }
}
```

---

## 文件維護記錄

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| **v1.0.0** | **2025-08-02** | **LCAS SA Team** | **系統管理服務模組建立：包含8個API端點的完整系統管理功能實作** |

---

## 備註

- **版本1.0.0特色**: 完整的系統管理服務模組，涵蓋備份、監控、日誌、提醒等核心功能
- **8個API端點**: F025-F032 系統管理功能（備份管理、同步監控、日誌管理、提醒系統）
- **備份管理**: 支援排程備份、手動備份、備份列表查詢等完整備份解決方案
- **系統監控**: 提供同步狀態檢查、系統健康監控、錯誤日誌管理等監控功能
- **提醒系統**: 支援個人化提醒設定和執行，包含智慧功能和效果追蹤
- **基礎實作**: 提供API調用和資料轉換功能，整合後端系統管理服務
- **對應模組**: 與 BS、SR、DL 等模組整合，提供完整系統管理解決方案
