# P012_設定頁面_SRS

**文件編號**: P012-SRS  
**版本**: v1.0.0  
**建立日期**: 2025-01-26  
**建立者**: LCAS PM Team  
**最後更新**: 2025-01-26 16:45:00 UTC+8

---

## 1. 功能目的（Purpose）

設定頁面提供使用者個人化系統設定功能，包含帳戶設定、應用程式偏好設定、通知設定、隱私設定、以及系統管理等完整設定選項。

### 核心功能
- **帳戶設定**: 個人資訊、密碼變更、帳戶刪除
- **應用偏好**: 主題、語言、貨幣、預設帳本
- **通知設定**: 推送通知、提醒設定、通知類型
- **隱私安全**: 生物辨識、自動鎖定、資料隱私
- **系統管理**: 快取清理、資料匯出、版本資訊

---

## 2. 使用者故事（User Story）

**主要使用者故事**:
```
作為一個LCAS使用者
我想要個人化我的應用程式設定
以便獲得最適合我的使用體驗

作為一個重視隱私的使用者
我想要控制我的資料隱私設定
以便保護我的個人財務資訊
```

**具體場景**:
- 變更應用程式主題為深色模式
- 設定每日記帳提醒時間
- 啟用指紋解鎖功能
- 變更預設貨幣為美元
- 匯出個人財務資料
- 清理應用程式快取

---

## 3. 前置條件（Preconditions）

### 使用者狀態
- [x] 使用者已完成登入驗證
- [x] 使用者帳戶狀態正常
- [x] 具備基本應用程式存取權限

### 系統狀態  
- [x] 應用程式正常運行
- [x] 本地設定檔案可讀寫
- [x] 網路連線可用（雲端同步設定時）

### 裝置權限
- [x] 檔案系統存取權限
- [x] 通知權限（可選）
- [x] 生物辨識權限（可選）

---

## 4. 功能流程（User Flow / Functional Flow）

### 4.1 主要操作流程
```
設定頁面流程:
使用者進入 → 載入當前設定 → 選擇設定類別 → 修改設定 → 儲存變更

詳細步驟:
1. 使用者點擊「設定」入口（主選單或個人資料）
2. 系統載入使用者當前設定值
3. 顯示設定分類清單
4. 使用者選擇特定設定分類：
   - 帳戶設定：個人資訊、安全設定
   - 應用偏好：主題、語言、貨幣
   - 通知設定：推送、提醒、頻率
   - 隱私安全：生物辨識、自動鎖定
   - 系統管理：資料管理、支援資訊
5. 修改設定值並即時預覽效果
6. 確認儲存變更
7. 系統同步設定到雲端（如適用）
```

### 4.2 密碼變更流程
```
密碼變更流程:
1. 進入帳戶設定
2. 點擊「變更密碼」
3. 輸入當前密碼進行驗證
4. 輸入新密碼（符合安全規則）
5. 確認新密碼
6. 系統驗證並更新密碼
7. 強制重新登入所有裝置
8. 發送密碼變更通知
```

---

## 5. 輸入項目（Inputs）

### 5.1 帳戶設定
| 欄位名稱 | 資料型別 | 必填 | 長度限制 | 說明 |
|----------|----------|------|----------|------|
| displayName | String | 否 | 1-50字元 | 顯示名稱 |
| email | String | 是 | Email格式 | 電子郵件 |
| currentPassword | String | 是 | - | 當前密碼 |
| newPassword | String | 是 | 8-50字元 | 新密碼 |
| avatar | File | 否 | <5MB | 個人頭像 |

### 5.2 應用偏好設定
| 欄位名稱 | 資料型別 | 必填 | 選項 | 說明 |
|----------|----------|------|------|------|
| theme | Enum | 是 | light/dark/system | 主題模式 |
| language | Enum | 是 | zh-TW/zh-CN/en | 語言設定 |
| currency | String | 是 | TWD/USD/CNY等 | 預設貨幣 |
| defaultLedgerId | String | 否 | - | 預設帳本ID |
| quickEntryMode | Boolean | 否 | - | 快速記帳模式 |

### 5.3 通知設定
| 欄位名稱 | 資料型別 | 必填 | 說明 |
|----------|----------|------|------|
| pushEnabled | Boolean | 否 | 推送通知開關 |
| dailyReminder | Boolean | 否 | 每日提醒 |
| reminderTime | Time | 否 | 提醒時間 |
| budgetAlert | Boolean | 否 | 預算警示 |
| collaborationAlert | Boolean | 否 | 協作通知 |

---

## 6. 輸出項目（Outputs / Responses）

### 6.1 設定載入回應
```json
{
  "success": true,
  "data": {
    "account": {
      "displayName": "張小明",
      "email": "user@example.com",
      "avatar": "https://cdn.example.com/avatars/user123.jpg",
      "lastLogin": "2025-01-26T08:30:00Z"
    },
    "preferences": {
      "theme": "dark",
      "language": "zh-TW", 
      "currency": "TWD",
      "defaultLedgerId": "LED001",
      "quickEntryMode": true
    },
    "notifications": {
      "pushEnabled": true,
      "dailyReminder": true,
      "reminderTime": "21:00",
      "budgetAlert": true,
      "collaborationAlert": true
    },
    "security": {
      "biometricEnabled": true,
      "autoLockMinutes": 5,
      "lastPasswordChange": "2025-01-15T10:00:00Z"
    }
  },
  "message": "設定載入成功"
}
```

### 6.2 設定更新回應
```json
{
  "success": true,
  "data": {
    "updatedFields": ["theme", "language"],
    "effectiveDate": "2025-01-26T16:45:00Z",
    "syncStatus": "completed"
  },
  "message": "設定更新成功"
}
```

---

## 7. 驗證規則（Validation Rules）

### 7.1 帳戶資訊驗證
- **顯示名稱**: 1-50字元，不可包含特殊符號
- **電子郵件**: 有效的Email格式，不可重複
- **新密碼**: 至少8字元，包含大小寫字母與數字
- **頭像檔案**: 格式限定jpg/png，大小 < 5MB

### 7.2 偏好設定驗證  
- **主題模式**: 必須為預定義選項之一
- **語言設定**: 必須為支援的語言代碼
- **貨幣代碼**: 必須為有效的ISO 4217貨幣代碼
- **預設帳本**: 必須為使用者可存取的帳本

### 7.3 通知設定驗證
- **提醒時間**: 24小時制格式 HH:MM
- **時區處理**: 依使用者當地時區儲存
- **裝置權限**: 驗證通知權限狀態

---

## 8. 錯誤處理（Error Handling）

### 8.1 輸入錯誤
| 錯誤碼 | 錯誤訊息 | 處理方式 |
|--------|----------|----------|
| S001 | 顯示名稱不可為空 | 欄位驗證提示 |
| S002 | 電子郵件格式無效 | 提供格式範例 |
| S003 | 密碼強度不足 | 顯示密碼要求 |
| S004 | 頭像檔案過大 | 建議壓縮或選擇其他檔案 |

### 8.2 操作錯誤
| 錯誤碼 | 錯誤訊息 | 處理方式 |
|--------|----------|----------|
| S101 | 當前密碼驗證失敗 | 提示重新輸入 |
| S102 | 電子郵件已被使用 | 建議使用其他郵件或登入既有帳戶 |
| S103 | 生物辨識設定失敗 | 檢查裝置支援與權限 |

### 8.3 系統錯誤
- **設定同步失敗**: 提供離線模式與重試機制
- **權限不足**: 引導使用者授予必要權限
- **裝置不支援**: 隱藏不支援的功能選項

---

## 9. UI 元件與排版需求（UI Requirements）

### 9.1 頁面佈局
```
設定頁面佈局:
┌─────────────────────────────┐
│ [← 返回]  設定              │
├─────────────────────────────┤
│ 👤 張小明                   │
│    user@example.com         │
├─────────────────────────────┤
│ 🔐 帳戶設定              > │
│ 🎨 應用偏好              > │  
│ 🔔 通知設定              > │
│ 🛡️ 隱私安全              > │
│ ⚙️ 系統管理              > │
├─────────────────────────────┤
│ 📄 使用條款              > │
│ 🛠️ 意見回饋              > │
│ ℹ️ 關於我們              > │
└─────────────────────────────┘
```

### 9.2 設定分類頁面
```
應用偏好設定頁面:
┌─────────────────────────────┐
│ [← 返回]  應用偏好          │
├─────────────────────────────┤
│ 主題模式          [深色 ▼] │
│ 語言              [繁中 ▼] │
│ 預設貨幣          [TWD ▼]  │
│ 預設帳本          [個人 ▼] │
├─────────────────────────────┤
│ 快速記帳模式      [🟢開啟]  │
│ 雙擊確認記帳      [⚪關閉]  │
│ 自動備份          [🟢開啟]  │
└─────────────────────────────┘
```

### 9.3 關鍵UI元件
- **個人資訊卡片**: 頭像、姓名、郵件
- **設定群組**: 分類標題與項目清單
- **開關控制**: 切換按鈕與狀態指示
- **選擇器**: 下拉選單與選項清單
- **確認對話框**: 重要變更的二次確認

---

## 10. API 規格（API Specification）

### 10.1 獲取使用者設定
```http
GET /api/v1/user/settings
Headers: Authorization: Bearer {token}
Response: 完整的使用者設定物件
```

### 10.2 更新設定
```http
PUT /api/v1/user/settings
Headers: Authorization: Bearer {token}
Body: {
  "category": "preferences|notifications|security",
  "settings": {
    "theme": "dark",
    "language": "zh-TW"
  }
}
```

### 10.3 變更密碼
```http
POST /api/v1/user/change-password  
Headers: Authorization: Bearer {token}
Body: {
  "currentPassword": "string",
  "newPassword": "string"
}
```

### 10.4 上傳頭像
```http
POST /api/v1/user/avatar
Headers: Authorization: Bearer {token}
Content-Type: multipart/form-data
Body: avatar file
```

---

## 11. 狀態與畫面切換（State Handling）

### 11.1 頁面狀態管理
```typescript
interface SettingsState {
  userSettings: UserSettings;
  isLoading: boolean;
  isSaving: boolean;
  activeCategory: SettingsCategory;
  pendingChanges: Partial<UserSettings>;
  validationErrors: ValidationError[];
}
```

### 11.2 設定同步狀態
- **本地變更**: 即時更新UI，標記待同步
- **同步中**: 顯示同步指示器
- **同步完成**: 清除待同步標記
- **同步失敗**: 顯示錯誤與重試選項

### 11.3 頁面間導航
- **設定主頁**: 顯示所有設定分類
- **分類頁面**: 特定類別的詳細設定
- **編輯模式**: 表單編輯與驗證
- **確認對話框**: 重要操作的確認介面

---

## 12. 安全性與權限檢查（Security / Access Control）

### 12.1 身份驗證
- **當前密碼驗證**: 敏感操作需要密碼確認
- **會話檢查**: 定期驗證使用者會話有效性
- **生物辨識**: 支援指紋/Face ID驗證

### 12.2 資料保護
- **敏感資訊加密**: 密碼雜湊儲存
- **設定資料**: 加密後同步至雲端
- **本地儲存**: 使用裝置安全儲存機制

### 12.3 權限管理
- **帳戶設定**: 僅限帳戶擁有者
- **協作設定**: 依據帳本權限控制
- **系統設定**: 本地裝置設定無限制

---

## 13. 其他補充需求（Others）

### 13.1 效能需求
- **設定載入時間**: < 2秒
- **設定更新回應**: < 1秒  
- **同步時間**: < 5秒
- **頭像上傳**: < 10秒

### 13.2 無障礙支援
- **螢幕閱讀器**: 設定項目朗讀支援
- **大字體**: 支援系統字體大小設定
- **高對比**: 適配高對比顯示模式
- **語音控制**: 支援語音導航操作

### 13.3 跨平台同步
- **設定漫遊**: 跨裝置同步使用者偏好
- **衝突解決**: 多裝置設定變更衝突處理
- **版本控制**: 設定變更歷史記錄

### 13.4 本地化支援
- **多語言**: 繁體中文、簡體中文、英文
- **地區格式**: 日期、時間、數字格式本地化
- **貨幣支援**: 主要貨幣與匯率更新

---

**文件狀態**: ✅ 已完成  
**下一階段**: P017_搜尋頁面_SRS.md  
**相關文件**: P001_歡迎頁面_SRS.md、P002_登入頁面_SRS.md