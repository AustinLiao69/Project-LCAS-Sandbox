# P007_快速記帳頁面_SRS

**文件編號**: P007-SRS  
**文件版本**: v1.0.0  
**建立日期**: 2025-01-26  
**建立者**: LCAS PM Team  
**最後更新**: 2025-01-26 14:30:00 UTC+8

---

## 1. 功能目的（Purpose）

快速記帳頁面提供使用者最便捷的記帳入口，支援語音輸入、智慧識別和快速選擇，讓記帳行為能在30秒內完成，提升記帳頻率和使用體驗。

## 2. 使用者故事（User Story）

**主要使用者故事:**
- 作為一位忙碌的使用者，我希望能在30秒內完成一筆記帳，這樣我就不會因為繁瑣的操作而放棄記錄
- 作為一位習慣使用語音的使用者，我希望能透過語音快速輸入記帳資訊，提升記帳效率
- 作為一位重複消費的使用者，我希望系統能記住我的常用項目，讓我快速選擇

**次要使用者故事:**
- 作為一位新手使用者，我希望介面簡潔明瞭，不會被太多選項困擾
- 作為一位精確記帳的使用者，我希望能快速切換到詳細記帳模式

## 3. 前置條件（Preconditions）

- 使用者已完成登入驗證
- 使用者至少擁有一個有效帳本
- 裝置具備網路連線（支援離線暫存）
- 語音功能需要麥克風權限（可選）

## 4. 功能流程（User Flow / Functional Flow）

### 4.1 主要流程
1. **進入頁面** → 顯示快速記帳介面
2. **選擇記帳方式**:
   - 語音輸入記帳
   - 快速選擇記帳
   - 手動輸入記帳
3. **智慧識別與建議** → 系統提供智慧建議
4. **確認記帳資訊** → 使用者檢視並確認
5. **提交記帳** → 儲存至資料庫
6. **顯示成功回饋** → 提供後續操作選項

### 4.2 語音記帳流程
1. 點擊語音按鈕 → 開始語音識別
2. 使用者語音輸入 → 即時轉換文字
3. AI智慧解析 → 提取金額、項目、類別
4. 顯示解析結果 → 使用者確認或修正
5. 一鍵確認提交

### 4.3 快速選擇流程
1. 顯示常用項目列表
2. 使用者點選項目 → 自動填入資訊
3. 調整金額（如需要）
4. 一鍵提交記帳

## 5. 輸入項目（Inputs）

### 5.1 必填欄位
- **金額** (amount): 數字型別，支援小數點
- **項目名稱** (item): 文字型別，最多50字元
- **收支類型** (type): 選擇型別（支出/收入）

### 5.2 選填欄位
- **類別** (category): 下拉選單，可新增自訂類別
- **備註** (note): 文字型別，最多200字元
- **日期** (date): 日期選擇器，預設今日
- **帳本** (ledger): 下拉選單，預設當前帳本

### 5.3 語音輸入格式
支援自然語言輸入，例如：
- "午餐花了150元"
- "買咖啡50塊"
- "收到薪水35000"

## 6. 輸出項目（Outputs / Responses）

### 6.1 成功回應
```json
{
  "success": true,
  "data": {
    "entry_id": "ENT_20250126_001",
    "amount": 150.00,
    "item": "午餐",
    "category": "餐飲",
    "type": "expense",
    "date": "2025-01-26",
    "created_at": "2025-01-26T14:30:00+08:00"
  },
  "message": "記帳成功！"
}
```

### 6.2 智慧建議回應
```json
{
  "suggestions": {
    "category": "餐飲",
    "common_amounts": [100, 150, 200],
    "similar_items": ["早餐", "晚餐", "下午茶"]
  }
}
```

## 7. 驗證規則（Validation Rules）

### 7.1 金額驗證
- 必須為正數
- 最大金額：999,999,999
- 小數點最多2位
- 不可為空值

### 7.2 項目名稱驗證
- 長度：1-50字元
- 不可包含特殊符號：< > & " '
- 去除前後空白

### 7.3 語音識別驗證
- 語音長度：3-30秒
- 必須識別出金額資訊
- 背景噪音過大時提示重新錄音

## 8. 錯誤處理（Error Handling）

### 8.1 輸入錯誤
- **E011001**: 金額格式錯誤 → "請輸入正確的金額格式"
- **E011002**: 項目名稱過長 → "項目名稱不可超過50字元"
- **E011003**: 必填欄位空白 → "請填寫必要資訊"

### 8.2 語音識別錯誤
- **E011101**: 語音識別失敗 → "語音識別失敗，請重試或改用手動輸入"
- **E011102**: 無法提取金額 → "無法識別金額資訊，請重新說明"
- **E011103**: 麥克風權限拒絕 → "需要麥克風權限才能使用語音功能"

### 8.3 系統錯誤
- **E011201**: 網路連線失敗 → "網路連線異常，記帳已暫存至本地"
- **E011202**: 儲存失敗 → "儲存失敗，請稍後重試"

## 9. UI 元件與排版需求（UI Requirements）

### 9.1 頁面佈局
```
┌─────────────────────────────────┐
│ 🏠 快速記帳               ⚙️     │
├─────────────────────────────────┤
│                                 │
│  🎤 語音記帳                     │
│  ⚡ 快速選擇                     │
│  ✏️ 手動輸入                     │
│                                 │
├─────────────────────────────────┤
│ 常用項目                         │
│ [早餐] [午餐] [咖啡] [交通]      │
│ [加油] [購物] [娛樂] [更多...]   │
├─────────────────────────────────┤
│ 金額: _________________ 元       │
│ 項目: _________________         │
│ 類別: [餐飲 ▼]                  │
│ 備註: _________________         │
├─────────────────────────────────┤
│           [確認記帳]             │
└─────────────────────────────────┘
```

### 9.2 色彩規範
- **主要按鈕**: 藍色系 (#007AFF - #34C759)
- **語音按鈕**: 紅色系 (#FF3B30) 錄音時
- **成功提示**: 綠色系 (#34C759)
- **錯誤提示**: 紅色系 (#FF3B30)

### 9.3 響應式設計
- 手機版: 單欄佈局，大按鈕設計
- 平板版: 雙欄佈局，左側輸入右側預覽
- 桌面版: 中央對齊，最大寬度480px

## 10. API 規格（API Specification）

### 10.1 快速記帳 API
```http
POST /api/v1/entries/quick
Content-Type: application/json
Authorization: Bearer {token}

{
  "amount": 150.00,
  "item": "午餐",
  "category": "餐飲",
  "type": "expense",
  "note": "",
  "date": "2025-01-26",
  "ledger_id": "LED_001"
}
```

### 10.2 語音識別 API
```http
POST /api/v1/entries/voice-recognition
Content-Type: multipart/form-data
Authorization: Bearer {token}

Form Data:
- audio: (音訊檔案)
- format: "wav"
- duration: 10.5
```

### 10.3 智慧建議 API
```http
GET /api/v1/entries/suggestions?text={user_input}
Authorization: Bearer {token}
```

## 11. 狀態與畫面切換（State Handling）

### 11.1 頁面狀態
- **initial**: 初始載入狀態
- **voice_recording**: 語音錄音中
- **voice_processing**: 語音處理中
- **form_filling**: 表單填寫中
- **submitting**: 提交處理中
- **success**: 提交成功
- **error**: 錯誤狀態

### 11.2 狀態切換邏輯
```
initial → voice_recording → voice_processing → form_filling → submitting → success/error
initial → form_filling → submitting → success/error
```

### 11.3 離線狀態處理
- 記帳資料暫存至本地
- 恢復連線時自動同步
- 顯示離線狀態指示器

## 12. 安全性與權限檢查（Security / Access Control）

### 12.1 身份驗證
- JWT Token 驗證
- Token 過期自動更新
- 無效 Token 導向登入頁

### 12.2 權限檢查
- 帳本存取權限驗證
- 新增記帳權限檢查
- 語音功能權限確認

### 12.3 資料安全
- 敏感資料加密傳輸
- 語音資料不儲存於伺服器
- 本地暫存資料加密

## 13. 其他補充需求（Others）

### 13.1 效能需求
- 頁面載入時間 < 2秒
- 語音識別回應時間 < 5秒
- 記帳提交回應時間 < 3秒

### 13.2 無障礙支援
- 支援螢幕閱讀器
- 鍵盤導航支援
- 高對比度模式
- 文字縮放支援

### 13.3 多語言支援
- 繁體中文（預設）
- 簡體中文
- English
- 語音識別支援多語言

### 13.4 統計與分析
- 記錄使用者操作行為
- 語音識別準確率統計
- 快速記帳完成時間分析

---

**文件維護記錄**

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| v1.0.0 | 2025-01-26 | LCAS PM Team | 初始版本建立 |