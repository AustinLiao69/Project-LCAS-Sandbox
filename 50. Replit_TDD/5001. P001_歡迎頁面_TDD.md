
# 5001. TDD_P001_æ­¡è¿é é¢_v1.0.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: P001 æ­¡è¿é é¢æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v1.0.0
- **å‰µå»ºæ—¥æœŸ**: 2025-08-06 11:00:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-08-06 11:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: P001_æ­¡è¿é é¢_SRS.md
- **æ¨¡çµ„ä»£ç¢¼**: P001 (Presentation Layer)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. æŠ€è¡“æ¶æ§‹æ¦‚è¿°
   - 1.1 æ¨¡çµ„å®šä½
   - 1.2 æŠ€è¡“å †ç–Š
   - 1.3 æ¨¡çµ„æ¶æ§‹

2. å‡½æ•¸æ¸…å–®
   - 2.1 å®Œæ•´å‡½æ•¸ç´¢å¼•è¡¨
   - 2.2 å‡½æ•¸åˆ†å±¤æ¶æ§‹

3. æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ
   - 3.1 é é¢åˆå§‹åŒ–å±¤å‡½æ•¸
   - 3.2 æ¨¡å¼é¸æ“‡å±¤å‡½æ•¸
   - 3.3 ä½¿ç”¨è€…äº’å‹•å±¤å‡½æ•¸
   - 3.4 å°èˆªæ§åˆ¶å±¤å‡½æ•¸
   - 3.5 ç‹€æ…‹ç®¡ç†å±¤å‡½æ•¸

4. å››æ¨¡å¼å·®ç•°åŒ–æ¶æ§‹è¨­è¨ˆ
   - 4.1 æ¨¡å¼é¸æ“‡UIæ¶æ§‹
   - 4.2 è¦–è¦ºä¸»é¡Œåˆ‡æ›æ©Ÿåˆ¶
   - 4.3 æ¨¡å¼ç‰¹å®šåŠŸèƒ½æ•´åˆ

5. æ¨¡çµ„é–“äº’å‹•æ¶æ§‹
   - 5.1 æ ¸å¿ƒä¾è³´é—œä¿‚
   - 5.2 è³‡æ–™æµå‘è¨­è¨ˆ

6. APIæ•´åˆæ¶æ§‹è¨­è¨ˆ
   - 6.1 åˆå§‹åŒ–APIå‘¼å«åºåˆ—
   - 6.2 æ¨¡å¼è¨­å®šAPIè¦æ ¼
   - 6.3 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

7. ç‹€æ…‹ç®¡ç†è¨­è¨ˆ
   - 7.1 é é¢ç‹€æ…‹å®šç¾©
   - 7.2 ç‹€æ…‹è½‰æ›é‚è¼¯
   - 7.3 ç‹€æ…‹æŒä¹…åŒ–æ©Ÿåˆ¶

8. UIçµ„ä»¶æ¶æ§‹
   - 8.1 çµ„ä»¶æ¨¹çµæ§‹
   - 8.2 éŸ¿æ‡‰å¼ä½ˆå±€è¨­è¨ˆ
   - 8.3 å‹•ç•«èˆ‡è½‰å ´æ•ˆæœ

9. éŒ¯èª¤è™•ç†èˆ‡ç›£æ§
   - 9.1 éŒ¯èª¤é¡å‹å®šç¾©
   - 9.2 ä½¿ç”¨è€…é«”é©—é™ç´šç­–ç•¥
   - 9.3 è¨ºæ–·è³‡è¨Šæ”¶é›†

10. æ•ˆèƒ½æœ€ä½³åŒ–
    - 10.1 è¼‰å…¥æ™‚é–“å„ªåŒ–
    - 10.2 è¨˜æ†¶é«”ç®¡ç†
    - 10.3 å¿«å–ç­–ç•¥

11. æ¸¬è©¦ç­–ç•¥
    - 11.1 å–®å…ƒæ¸¬è©¦è¦†è“‹
    - 11.2 æ•´åˆæ¸¬è©¦å ´æ™¯
    - 11.3 UIæ¸¬è©¦è¦åŠƒ

12. éƒ¨ç½²é…ç½®
    - 12.1 ç’°å¢ƒé…ç½®
    - 12.2 ç‰ˆæœ¬ç®¡ç†
    - 12.3 ç†±æ›´æ–°æ©Ÿåˆ¶

13. æ–‡ä»¶ç¶­è­·è¨˜éŒ„

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
P001æ­¡è¿é é¢ä½œç‚ºLCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„å…¥å£é é¢ï¼Œè² è²¬å»ºç«‹ä½¿ç”¨è€…çš„ç¬¬ä¸€å°è±¡ä¸¦å¼•å°ä½¿ç”¨è€…é€²å…¥æ‡‰ç”¨ç¨‹å¼ã€‚æœ¬æ¨¡çµ„éœ€è¦è™•ç†å››ç¨®ä½¿ç”¨è€…æ¨¡å¼çš„å·®ç•°åŒ–å±•ç¤ºã€ç™»å…¥ç‹€æ…‹æª¢æ¸¬ã€æ¨¡å¼é¸æ“‡ã€å°èˆªæ§åˆ¶ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**: Flutter 3.0+
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **è·¯ç”±ç®¡ç†**: Navigator 2.0 + go_router
- **APIå‘¼å«**: dio + retrofit
- **æœ¬åœ°å„²å­˜**: shared_preferences + secure_storage
- **UIè¨­è¨ˆ**: Material Design 3.0
- **å‹•ç•«ç³»çµ±**: Flutter Animations + Lottie
- **åœ‹éš›åŒ–**: flutter_localizations

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * P001_æ­¡è¿é é¢_v1.0.0
 * @module P001æ­¡è¿é é¢
 * @description LCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼å…¥å£é é¢ - å››æ¨¡å¼å·®ç•°åŒ–å±•ç¤ºèˆ‡å°èˆªæ§åˆ¶
 * @update 2025-08-06: åˆç‰ˆå»ºç«‹ï¼Œå®Œæ•´å››æ¨¡å¼æ”¯æ´èˆ‡APIæ•´åˆæ¶æ§‹
 */
```

---

## 2.0 å‡½æ•¸æ¸…å–®

### 2.1 å®Œæ•´å‡½æ•¸ç´¢å¼•è¡¨

| # | å‡½æ•¸åç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾æ¨¡çµ„ |
|---|----------|------|----------|----------|----------|
| 01 | P001_initializeWelcomePage | V1.0.0 | é é¢åˆå§‹åŒ–å±¤ | åˆå§‹åŒ–æ­¡è¿é é¢è³‡æº | AuthServiceã€SystemService |
| 02 | P001_checkUserLoginStatus | V1.0.0 | é é¢åˆå§‹åŒ–å±¤ | æª¢æŸ¥ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹ | AuthService |
| 03 | P001_loadAppConfiguration | V1.0.0 | é é¢åˆå§‹åŒ–å±¤ | è¼‰å…¥æ‡‰ç”¨ç¨‹å¼é…ç½® | SystemService |
| 04 | P001_initializeThemeManager | V1.0.0 | é é¢åˆå§‹åŒ–å±¤ | åˆå§‹åŒ–ä¸»é¡Œç®¡ç†å™¨ | ThemeService |
| 05 | P001_displayModeSelection | V1.0.0 | æ¨¡å¼é¸æ“‡å±¤ | é¡¯ç¤ºå››æ¨¡å¼é¸æ“‡ä»‹é¢ | UI Components |
| 06 | P001_handleModeSelection | V1.0.0 | æ¨¡å¼é¸æ“‡å±¤ | è™•ç†ä½¿ç”¨è€…æ¨¡å¼é¸æ“‡ | AuthServiceã€API |
| 07 | P001_applyModeTheme | V1.0.0 | æ¨¡å¼é¸æ“‡å±¤ | å¥—ç”¨æ¨¡å¼å°ˆå±¬ä¸»é¡Œ | ThemeService |
| 08 | P001_validateModeSelection | V1.0.0 | æ¨¡å¼é¸æ“‡å±¤ | é©—è­‰æ¨¡å¼é¸æ“‡æœ‰æ•ˆæ€§ | ValidationService |
| 09 | P001_handleUserInteraction | V1.0.0 | ä½¿ç”¨è€…äº’å‹•å±¤ | è™•ç†ä½¿ç”¨è€…äº’å‹•äº‹ä»¶ | EventBus |
| 10 | P001_handleLoginRedirect | V1.0.0 | ä½¿ç”¨è€…äº’å‹•å±¤ | è™•ç†ç™»å…¥é‡å°å‘ | NavigationService |
| 11 | P001_handleRegistrationFlow | V1.0.0 | ä½¿ç”¨è€…äº’å‹•å±¤ | è™•ç†è¨»å†Šæµç¨‹å°èˆª | NavigationService |
| 12 | P001_handleOfflineMode | V1.0.0 | ä½¿ç”¨è€…äº’å‹•å±¤ | è™•ç†é›¢ç·šæ¨¡å¼é¡¯ç¤º | ConnectivityService |
| 13 | P001_navigateToNextPage | V1.0.0 | å°èˆªæ§åˆ¶å±¤ | æ§åˆ¶é é¢å°èˆªé‚è¼¯ | NavigationService |
| 14 | P001_setupNavigationContext | V1.0.0 | å°èˆªæ§åˆ¶å±¤ | è¨­å®šå°èˆªä¸Šä¸‹æ–‡ | NavigationService |
| 15 | P001_handleDeepLinking | V1.0.0 | å°èˆªæ§åˆ¶å±¤ | è™•ç†æ·±åº¦é€£çµ | NavigationService |
| 16 | P001_validateNavigationPermissions | V1.0.0 | å°èˆªæ§åˆ¶å±¤ | é©—è­‰å°èˆªæ¬Šé™ | AuthService |
| 17 | P001_updatePageState | V1.0.0 | ç‹€æ…‹ç®¡ç†å±¤ | æ›´æ–°é é¢ç‹€æ…‹ | StateManager |
| 18 | P001_persistUserPreferences | V1.0.0 | ç‹€æ…‹ç®¡ç†å±¤ | æŒä¹…åŒ–ä½¿ç”¨è€…åå¥½ | StorageService |
| 19 | P001_loadCachedState | V1.0.0 | ç‹€æ…‹ç®¡ç†å±¤ | è¼‰å…¥å¿«å–ç‹€æ…‹ | StorageService |
| 20 | P001_handleStateTransition | V1.0.0 | ç‹€æ…‹ç®¡ç†å±¤ | è™•ç†ç‹€æ…‹è½‰æ› | StateManager |

### 2.2 å‡½æ•¸åˆ†å±¤æ¶æ§‹

```
P001æ­¡è¿é é¢ (v1.0.0)
â”œâ”€â”€ é é¢åˆå§‹åŒ–å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ P001_initializeWelcomePage() - åˆå§‹åŒ–æ­¡è¿é é¢
â”‚   â”œâ”€â”€ P001_checkUserLoginStatus() - æª¢æŸ¥ç™»å…¥ç‹€æ…‹
â”‚   â”œâ”€â”€ P001_loadAppConfiguration() - è¼‰å…¥æ‡‰ç”¨é…ç½®
â”‚   â””â”€â”€ P001_initializeThemeManager() - åˆå§‹åŒ–ä¸»é¡Œç®¡ç†
â”œâ”€â”€ æ¨¡å¼é¸æ“‡å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ P001_displayModeSelection() - é¡¯ç¤ºæ¨¡å¼é¸æ“‡
â”‚   â”œâ”€â”€ P001_handleModeSelection() - è™•ç†æ¨¡å¼é¸æ“‡
â”‚   â”œâ”€â”€ P001_applyModeTheme() - å¥—ç”¨æ¨¡å¼ä¸»é¡Œ
â”‚   â””â”€â”€ P001_validateModeSelection() - é©—è­‰æ¨¡å¼é¸æ“‡
â”œâ”€â”€ ä½¿ç”¨è€…äº’å‹•å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ P001_handleUserInteraction() - è™•ç†ä½¿ç”¨è€…äº’å‹•
â”‚   â”œâ”€â”€ P001_handleLoginRedirect() - è™•ç†ç™»å…¥é‡å°å‘
â”‚   â”œâ”€â”€ P001_handleRegistrationFlow() - è™•ç†è¨»å†Šæµç¨‹
â”‚   â””â”€â”€ P001_handleOfflineMode() - è™•ç†é›¢ç·šæ¨¡å¼
â”œâ”€â”€ å°èˆªæ§åˆ¶å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ P001_navigateToNextPage() - æ§åˆ¶é é¢å°èˆª
â”‚   â”œâ”€â”€ P001_setupNavigationContext() - è¨­å®šå°èˆªä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ P001_handleDeepLinking() - è™•ç†æ·±åº¦é€£çµ
â”‚   â””â”€â”€ P001_validateNavigationPermissions() - é©—è­‰å°èˆªæ¬Šé™
â””â”€â”€ ç‹€æ…‹ç®¡ç†å±¤ (4å€‹å‡½æ•¸)
    â”œâ”€â”€ P001_updatePageState() - æ›´æ–°é é¢ç‹€æ…‹
    â”œâ”€â”€ P001_persistUserPreferences() - æŒä¹…åŒ–ä½¿ç”¨è€…åå¥½
    â”œâ”€â”€ P001_loadCachedState() - è¼‰å…¥å¿«å–ç‹€æ…‹
    â””â”€â”€ P001_handleStateTransition() - è™•ç†ç‹€æ…‹è½‰æ›
```

---

## 3.0 æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ

### 3.1 é é¢åˆå§‹åŒ–å±¤å‡½æ•¸

```dart
/**
 * 01. åˆå§‹åŒ–æ­¡è¿é é¢è³‡æº
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description åˆå§‹åŒ–æ­¡è¿é é¢æ‰€éœ€çš„æ‰€æœ‰è³‡æºï¼ŒåŒ…å«ä¸»é¡Œã€é…ç½®ã€ç‹€æ…‹ç®¡ç†
 */
Future<WelcomePageInitResult> P001_initializeWelcomePage(BuildContext context)
```
- **åŠŸèƒ½**: å”èª¿æ‰€æœ‰åˆå§‹åŒ–æµç¨‹ï¼Œç¢ºä¿é é¢æ­£å¸¸è¼‰å…¥
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **AuthService** `checkAuthentication()` - æª¢æŸ¥èªè­‰ç‹€æ…‹
  - **SystemService** `getAppConfig()` - å–å¾—æ‡‰ç”¨ç¨‹å¼é…ç½®
  - **ThemeService** `initializeThemes()` - åˆå§‹åŒ–ä¸»é¡Œç³»çµ±
- **å›å‚³å€¼**: `{success: bool, userAuthenticated: bool, defaultMode: UserMode, errors: List<String>}`

```dart
/**
 * 02. æª¢æŸ¥ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description æª¢æŸ¥ä½¿ç”¨è€…ç•¶å‰ç™»å…¥ç‹€æ…‹ä¸¦æ±ºå®šé¡¯ç¤ºæ¨¡å¼
 */
Future<UserAuthenticationState> P001_checkUserLoginStatus()
```
- **åŠŸèƒ½**: åˆ¤æ–·ä½¿ç”¨è€…æ˜¯å¦å·²ç™»å…¥ï¼Œæ±ºå®šé¡¯ç¤ºé‚è¼¯
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **AuthService** `getCurrentUser()` - å–å¾—ç•¶å‰ä½¿ç”¨è€…
  - **StorageService** `getSecureData()` - å–å¾—å®‰å…¨å„²å­˜çš„èªè­‰è³‡è¨Š
- **å›å‚³å€¼**: `{isAuthenticated: bool, userId: String?, lastLoginTime: DateTime?, needsReauth: bool}`

```dart
/**
 * 03. è¼‰å…¥æ‡‰ç”¨ç¨‹å¼é…ç½®
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description è¼‰å…¥æ‡‰ç”¨ç¨‹å¼åŸºæœ¬é…ç½®å’ŒåŠŸèƒ½é–‹é—œ
 */
Future<AppConfiguration> P001_loadAppConfiguration()
```
- **åŠŸèƒ½**: è¼‰å…¥é ç«¯é…ç½®ã€åŠŸèƒ½é–‹é—œã€ç‰ˆæœ¬è³‡è¨Š
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **SystemService** `getRemoteConfig()` - å–å¾—é ç«¯é…ç½®
  - **StorageService** `getCachedConfig()` - å–å¾—å¿«å–é…ç½®
- **å›å‚³å€¼**: `{version: String, featureFlags: Map<String, bool>, apiEndpoints: Map<String, String>}`

```dart
/**
 * 04. åˆå§‹åŒ–ä¸»é¡Œç®¡ç†å™¨
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description åˆå§‹åŒ–å››æ¨¡å¼ä¸»é¡Œç³»çµ±å’Œå‹•æ…‹ä¸»é¡Œåˆ‡æ›
 */
Future<ThemeManagerState> P001_initializeThemeManager()
```
- **åŠŸèƒ½**: è¨­å®šå››ç¨®ä½¿ç”¨è€…æ¨¡å¼çš„ä¸»é¡Œé…ç½®
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **ThemeService** `loadThemeConfigs()` - è¼‰å…¥ä¸»é¡Œé…ç½®
  - **StorageService** `getThemePreferences()` - å–å¾—ä¸»é¡Œåå¥½
- **å›å‚³å€¼**: `{themes: Map<UserMode, ThemeData>, currentTheme: ThemeData, animationEnabled: bool}`

### 3.2 æ¨¡å¼é¸æ“‡å±¤å‡½æ•¸

```dart
/**
 * 05. é¡¯ç¤ºå››æ¨¡å¼é¸æ“‡ä»‹é¢
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description å‹•æ…‹ç”Ÿæˆå››ç¨®ä½¿ç”¨è€…æ¨¡å¼çš„é¸æ“‡ä»‹é¢
 */
Widget P001_displayModeSelection(BuildContext context, WelcomePageState state)
```
- **åŠŸèƒ½**: æ ¹æ“šå››æ¨¡å¼ç‰¹æ€§ç”Ÿæˆå·®ç•°åŒ–é¸æ“‡ä»‹é¢
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **UI Components** `ModeSelectionCard()` - æ¨¡å¼é¸æ“‡å¡ç‰‡çµ„ä»¶
  - **ThemeService** `getModeTheme()` - å–å¾—æ¨¡å¼ä¸»é¡Œ
- **å›å‚³å€¼**: `Widget` (æ¨¡å¼é¸æ“‡UIçµ„ä»¶)

```dart
/**
 * 06. è™•ç†ä½¿ç”¨è€…æ¨¡å¼é¸æ“‡
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description è™•ç†ä½¿ç”¨è€…é¸æ“‡çš„æ¨¡å¼ä¸¦é€²è¡Œå¾ŒçºŒè¨­å®š
 */
Future<ModeSelectionResult> P001_handleModeSelection(UserMode selectedMode, String? userId)
```
- **åŠŸèƒ½**: è™•ç†æ¨¡å¼é¸æ“‡é‚è¼¯ï¼ŒåŒ…å«APIå‘¼å«å’Œæœ¬åœ°è¨­å®š
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **AuthService** `updateUserProfile()` - æ›´æ–°ä½¿ç”¨è€…æ¨¡å¼åå¥½
  - **API** `POST /app/user/mode-selection` - è¨­å®šä½¿ç”¨è€…æ¨¡å¼
  - **StorageService** `setUserMode()` - æœ¬åœ°å„²å­˜æ¨¡å¼è¨­å®š
- **å›å‚³å€¼**: `{success: bool, modeConfig: ModeConfiguration, nextRoute: String}`

```dart
/**
 * 07. å¥—ç”¨æ¨¡å¼å°ˆå±¬ä¸»é¡Œ
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description æ ¹æ“šé¸æ“‡çš„æ¨¡å¼å¥—ç”¨å°æ‡‰çš„è¦–è¦ºä¸»é¡Œ
 */
Future<void> P001_applyModeTheme(UserMode mode, {bool animated = true})
```
- **åŠŸèƒ½**: å‹•æ…‹åˆ‡æ›ä¸»é¡Œï¼ŒåŒ…å«å‹•ç•«æ•ˆæœ
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **ThemeService** `switchTheme()` - åˆ‡æ›ä¸»é¡Œ
  - **AnimationService** `themeTransition()` - ä¸»é¡Œåˆ‡æ›å‹•ç•«
- **å›å‚³å€¼**: `void`

```dart
/**
 * 08. é©—è­‰æ¨¡å¼é¸æ“‡æœ‰æ•ˆæ€§
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description é©—è­‰ä½¿ç”¨è€…é¸æ“‡çš„æ¨¡å¼æ˜¯å¦æœ‰æ•ˆä¸”å¯ç”¨
 */
ValidationResult P001_validateModeSelection(UserMode? selectedMode, UserProfile? userProfile)
```
- **åŠŸèƒ½**: ç¢ºä¿æ¨¡å¼é¸æ“‡ç¬¦åˆæ¥­å‹™é‚è¼¯å’Œä½¿ç”¨è€…æ¬Šé™
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **ValidationService** `validateUserMode()` - é©—è­‰æ¨¡å¼æœ‰æ•ˆæ€§
- **å›å‚³å€¼**: `{isValid: bool, errorMessage: String?, suggestedMode: UserMode?}`

### 3.3 ä½¿ç”¨è€…äº’å‹•å±¤å‡½æ•¸

```dart
/**
 * 09. è™•ç†ä½¿ç”¨è€…äº’å‹•äº‹ä»¶
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description çµ±ä¸€è™•ç†é é¢ä¸Šçš„æ‰€æœ‰ä½¿ç”¨è€…äº’å‹•äº‹ä»¶
 */
Future<void> P001_handleUserInteraction(UserInteractionEvent event, BuildContext context)
```
- **åŠŸèƒ½**: ä¸­å¤®äº‹ä»¶è™•ç†å™¨ï¼Œçµ±ä¸€ç®¡ç†ä½¿ç”¨è€…äº’å‹•
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **EventBus** `handleEvent()` - äº‹ä»¶åˆ†ç™¼è™•ç†
  - **AnalyticsService** `trackUserInteraction()` - è¿½è¹¤ä½¿ç”¨è€…è¡Œç‚º
- **å›å‚³å€¼**: `void`

```dart
/**
 * 10. è™•ç†ç™»å…¥é‡å°å‘
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description è™•ç†å·²è¨»å†Šä½†æœªç™»å…¥ä½¿ç”¨è€…çš„å°å‘é‚è¼¯
 */
Future<NavigationResult> P001_handleLoginRedirect(UserAuthenticationState authState)
```
- **åŠŸèƒ½**: æ™ºæ…§å°å‘é‚è¼¯ï¼Œæ ¹æ“šä½¿ç”¨è€…ç‹€æ…‹æ±ºå®šå°å‘ç›®æ¨™
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **NavigationService** `navigateToLogin()` - å°å‘ç™»å…¥é é¢
  - **AuthService** `getAuthenticationFlow()` - å–å¾—èªè­‰æµç¨‹
- **å›å‚³å€¼**: `{success: bool, targetRoute: String, navigationParams: Map<String, dynamic>}`

```dart
/**
 * 11. è™•ç†è¨»å†Šæµç¨‹å°èˆª
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description å¼•å°æ–°ä½¿ç”¨è€…é€²å…¥è¨»å†Šæµç¨‹
 */
Future<NavigationResult> P001_handleRegistrationFlow(UserMode selectedMode)
```
- **åŠŸèƒ½**: æ ¹æ“šé¸æ“‡çš„æ¨¡å¼æº–å‚™è¨»å†Šæµç¨‹åƒæ•¸
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **NavigationService** `navigateToRegistration()` - å°å‘è¨»å†Šé é¢
  - **AuthService** `prepareRegistrationFlow()` - æº–å‚™è¨»å†Šæµç¨‹
- **å›å‚³å€¼**: `{success: bool, registrationParams: Map<String, dynamic>}`

```dart
/**
 * 12. è™•ç†é›¢ç·šæ¨¡å¼é¡¯ç¤º
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description ç•¶ç¶²è·¯ä¸å¯ç”¨æ™‚é¡¯ç¤ºé›¢ç·šæ¨¡å¼ä»‹é¢
 */
Widget P001_handleOfflineMode(BuildContext context, ConnectivityState connectivityState)
```
- **åŠŸèƒ½**: æä¾›é›¢ç·šæ™‚çš„ä½¿ç”¨è€…é«”é©—
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **ConnectivityService** `getConnectivityStatus()` - å–å¾—ç¶²è·¯ç‹€æ…‹
  - **UI Components** `OfflineModeWidget()` - é›¢ç·šæ¨¡å¼çµ„ä»¶
- **å›å‚³å€¼**: `Widget` (é›¢ç·šæ¨¡å¼UIçµ„ä»¶)

### 3.4 å°èˆªæ§åˆ¶å±¤å‡½æ•¸

```dart
/**
 * 13. æ§åˆ¶é é¢å°èˆªé‚è¼¯
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description çµ±ä¸€æ§åˆ¶å¾æ­¡è¿é é¢åˆ°å…¶ä»–é é¢çš„å°èˆªé‚è¼¯
 */
Future<void> P001_navigateToNextPage(BuildContext context, NavigationTarget target, {Map<String, dynamic>? params})
```
- **åŠŸèƒ½**: ä¸­å¤®å°èˆªæ§åˆ¶å™¨ï¼Œè™•ç†æ‰€æœ‰é é¢è·³è½‰
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **NavigationService** `pushNamed()` - åŸ·è¡Œé é¢å°èˆª
  - **AuthService** `validateNavigation()` - é©—è­‰å°èˆªæ¬Šé™
- **å›å‚³å€¼**: `void`

```dart
/**
 * 14. è¨­å®šå°èˆªä¸Šä¸‹æ–‡
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description ç‚ºå¾ŒçºŒé é¢è¨­å®šå°èˆªä¸Šä¸‹æ–‡å’Œåƒæ•¸
 */
NavigationContext P001_setupNavigationContext(UserMode selectedMode, UserAuthenticationState authState)
```
- **åŠŸèƒ½**: æº–å‚™å°èˆªæ™‚æ‰€éœ€çš„ä¸Šä¸‹æ–‡è³‡è¨Š
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **NavigationService** `createContext()` - å»ºç«‹å°èˆªä¸Šä¸‹æ–‡
- **å›å‚³å€¼**: `{userMode: UserMode, authenticationRequired: bool, targetRoute: String}`

```dart
/**
 * 15. è™•ç†æ·±åº¦é€£çµ
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description è™•ç†å¾å¤–éƒ¨æ‡‰ç”¨ç¨‹å¼æˆ–ç¶²é çš„æ·±åº¦é€£çµ
 */
Future<void> P001_handleDeepLinking(String deepLink, BuildContext context)
```
- **åŠŸèƒ½**: è§£ææ·±åº¦é€£çµä¸¦åŸ·è¡Œå°æ‡‰çš„å°èˆªé‚è¼¯
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **NavigationService** `parseDeepLink()` - è§£ææ·±åº¦é€£çµ
  - **AuthService** `validateDeepLinkAccess()` - é©—è­‰æ·±åº¦é€£çµæ¬Šé™
- **å›å‚³å€¼**: `void`

```dart
/**
 * 16. é©—è­‰å°èˆªæ¬Šé™
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description é©—è­‰ä½¿ç”¨è€…æ˜¯å¦æœ‰æ¬Šé™å°èˆªåˆ°ç›®æ¨™é é¢
 */
Future<NavigationPermissionResult> P001_validateNavigationPermissions(NavigationTarget target, UserAuthenticationState authState)
```
- **åŠŸèƒ½**: ç¢ºä¿å°èˆªç¬¦åˆå®‰å…¨æ€§å’Œæ¥­å‹™é‚è¼¯è¦æ±‚
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **AuthService** `checkPermissions()` - æª¢æŸ¥ä½¿ç”¨è€…æ¬Šé™
- **å›å‚³å€¼**: `{hasPermission: bool, redirectTarget: String?, errorMessage: String?}`

### 3.5 ç‹€æ…‹ç®¡ç†å±¤å‡½æ•¸

```dart
/**
 * 17. æ›´æ–°é é¢ç‹€æ…‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description çµ±ä¸€ç®¡ç†æ­¡è¿é é¢çš„ç‹€æ…‹æ›´æ–°
 */
void P001_updatePageState(WelcomePageState newState, {bool notify = true})
```
- **åŠŸèƒ½**: ä¸­å¤®ç‹€æ…‹ç®¡ç†ï¼Œç¢ºä¿ç‹€æ…‹ä¸€è‡´æ€§
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **StateManager** `setState()` - æ›´æ–°ç‹€æ…‹
  - **UI Components** `notifyListeners()` - é€šçŸ¥UIæ›´æ–°
- **å›å‚³å€¼**: `void`

```dart
/**
 * 18. æŒä¹…åŒ–ä½¿ç”¨è€…åå¥½
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description å°‡ä½¿ç”¨è€…çš„åå¥½è¨­å®šå„²å­˜åˆ°æœ¬åœ°
 */
Future<bool> P001_persistUserPreferences(UserPreferences preferences)
```
- **åŠŸèƒ½**: ä¿å­˜ä½¿ç”¨è€…é¸æ“‡ï¼Œä¸‹æ¬¡å•Ÿå‹•æ™‚å¿«é€Ÿè¼‰å…¥
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **StorageService** `setPreferences()` - å„²å­˜åå¥½è¨­å®š
  - **EncryptionService** `encryptSensitiveData()` - åŠ å¯†æ•æ„Ÿè³‡æ–™
- **å›å‚³å€¼**: `bool` (å„²å­˜æˆåŠŸèˆ‡å¦)

```dart
/**
 * 19. è¼‰å…¥å¿«å–ç‹€æ…‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description å¾æœ¬åœ°å„²å­˜è¼‰å…¥å…ˆå‰çš„ç‹€æ…‹å’Œåå¥½
 */
Future<CachedState?> P001_loadCachedState()
```
- **åŠŸèƒ½**: å¿«é€Ÿæ¢å¾©ä½¿ç”¨è€…ä¸Šæ¬¡çš„ç‹€æ…‹ï¼Œæå‡ä½¿ç”¨é«”é©—
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **StorageService** `getCachedData()` - å–å¾—å¿«å–è³‡æ–™
  - **ValidationService** `validateCacheIntegrity()` - é©—è­‰å¿«å–å®Œæ•´æ€§
- **å›å‚³å€¼**: `CachedState?` (å¿«å–ç‹€æ…‹æˆ–null)

```dart
/**
 * 20. è™•ç†ç‹€æ…‹è½‰æ›
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 11:00:00
 * @description ç®¡ç†é é¢ç‹€æ…‹ä¹‹é–“çš„è½‰æ›é‚è¼¯
 */
Future<StateTransitionResult> P001_handleStateTransition(WelcomePageState fromState, WelcomePageState toState)
```
- **åŠŸèƒ½**: ç¢ºä¿ç‹€æ…‹è½‰æ›çš„åˆæ³•æ€§å’Œä¸€è‡´æ€§
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **StateManager** `validateTransition()` - é©—è­‰ç‹€æ…‹è½‰æ›
  - **AnimationService** `playTransitionAnimation()` - æ’­æ”¾è½‰æ›å‹•ç•«
- **å›å‚³å€¼**: `{success: bool, finalState: WelcomePageState, animationDuration: Duration}`

---

## 4.0 å››æ¨¡å¼å·®ç•°åŒ–æ¶æ§‹è¨­è¨ˆ

### 4.1 æ¨¡å¼é¸æ“‡UIæ¶æ§‹

#### 4.1.1 æ¨¡å¼å¡ç‰‡å…ƒä»¶è¨­è¨ˆ
```dart
class ModeSelectionCard extends StatelessWidget {
  final UserMode mode;
  final bool isSelected;
  final VoidCallback onTap;
  
  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: onTap,
      child: AnimatedContainer(
        duration: Duration(milliseconds: 300),
        decoration: BoxDecoration(
          gradient: _getModeGradient(mode),
          borderRadius: BorderRadius.circular(16),
          boxShadow: isSelected ? _getSelectedShadow() : _getDefaultShadow(),
        ),
        child: _buildModeContent(mode),
      ),
    );
  }
}
```

#### 4.1.2 å››æ¨¡å¼è¦–è¦ºé…ç½®
```dart
const ModeConfigurations = {
  UserMode.controller: ModeConfig(
    title: "ç²¾æº–æ§åˆ¶è€…",
    subtitle: "å°ˆæ¥­è¨˜å¸³ï¼Œç²¾ç¢ºåˆ†æ",
    primaryColor: Color(0xFF1976D2),
    gradientColors: [Color(0xFF1976D2), Color(0xFF1565C0)],
    icon: Icons.analytics,
    features: ["å®Œæ•´åŠŸèƒ½", "é€²éšåˆ†æ", "å¤šç¶­å ±è¡¨"],
  ),
  UserMode.logger: ModeConfig(
    title: "ç´€éŒ„ç¿’æ…£è€…", 
    subtitle: "å„ªé›…è¨˜å¸³ï¼Œç¾å¥½é«”é©—",
    primaryColor: Color(0xFF6A1B9A),
    gradientColors: [Color(0xFF6A1B9A), Color(0xFF4A148C)],
    icon: Icons.auto_awesome,
    features: ["ç¾è§€ä»‹é¢", "ç°¡æ½”æ“ä½œ", "è¦–è¦ºäº«å—"],
  ),
  UserMode.struggler: ModeConfig(
    title: "è½‰å‹æŒ‘æˆ°è€…",
    subtitle: "ç›®æ¨™å°å‘ï¼Œç¿’æ…£é¤Šæˆ", 
    primaryColor: Color(0xFFFF6B35),
    gradientColors: [Color(0xFFFF6B35), Color(0xFFE65100)],
    icon: Icons.trending_up,
    features: ["ç›®æ¨™è¿½è¹¤", "ç¿’æ…£æé†’", "é€²åº¦æ¿€å‹µ"],
  ),
  UserMode.sleeper: ModeConfig(
    title: "æ½›åœ¨è¦ºé†’è€…",
    subtitle: "ç°¡å–®é–‹å§‹ï¼Œè¼•é¬†è¨˜å¸³",
    primaryColor: Color(0xFF4CAF50),
    gradientColors: [Color(0xFF4CAF50), Color(0xFF2E7D32)],
    icon: Icons.spa,
    features: ["è¶…ç°¡åŒ–", "å¤§æŒ‰éˆ•", "é›¶å­¸ç¿’"],
  ),
};
```

### 4.2 è¦–è¦ºä¸»é¡Œåˆ‡æ›æ©Ÿåˆ¶

#### 4.2.1 å‹•æ…‹ä¸»é¡Œç³»çµ±
```dart
class WelcomePageThemeManager extends ChangeNotifier {
  ThemeData _currentTheme = _getDefaultTheme();
  UserMode? _selectedMode;
  
  void switchToModeTheme(UserMode mode, {bool animated = true}) {
    _selectedMode = mode;
    final newTheme = _getModeTheme(mode);
    
    if (animated) {
      _animateThemeTransition(_currentTheme, newTheme);
    } else {
      _currentTheme = newTheme;
      notifyListeners();
    }
  }
  
  void _animateThemeTransition(ThemeData from, ThemeData to) {
    // å¯¦ä½œä¸»é¡Œåˆ‡æ›å‹•ç•«
    final animationController = AnimationController(
      duration: Duration(milliseconds: 500),
      vsync: this,
    );
    
    final colorTween = ColorTween(
      begin: from.primaryColor,
      end: to.primaryColor,
    );
    
    animationController.addListener(() {
      _currentTheme = _interpolateTheme(from, to, animationController.value);
      notifyListeners();
    });
    
    animationController.forward();
  }
}
```

### 4.3 æ¨¡å¼ç‰¹å®šåŠŸèƒ½æ•´åˆ

#### 4.3.1 æ¨¡å¼ç‰¹å®šé…ç½®è¼‰å…¥
```dart
class ModeSpecificConfiguration {
  static Future<ModeConfig> loadConfigForMode(UserMode mode) async {
    switch (mode) {
      case UserMode.controller:
        return await _loadControllerConfig();
      case UserMode.logger:
        return await _loadLoggerConfig();
      case UserMode.struggler:
        return await _loadStrugglerConfig();
      case UserMode.sleeper:
        return await _loadSleeperConfig();
    }
  }
  
  static Future<ModeConfig> _loadControllerConfig() async {
    return ModeConfig(
      uiDensity: UIDensity.high,
      featureSet: FeatureSet.complete,
      navigationDepth: NavigationDepth.deep,
      informationDensity: InformationDensity.dense,
    );
  }
  
  // å…¶ä»–æ¨¡å¼é…ç½®...
}
```

---

## 5.0 æ¨¡çµ„é–“äº’å‹•æ¶æ§‹

### 5.1 æ ¸å¿ƒä¾è³´é—œä¿‚
```
P001æ­¡è¿é é¢ (v1.0.0)
â”œâ”€â”€ AuthService (èªè­‰æœå‹™)
â”‚   â”œâ”€â”€ checkAuthentication() - æª¢æŸ¥èªè­‰ç‹€æ…‹
â”‚   â”œâ”€â”€ getCurrentUser() - å–å¾—ç•¶å‰ä½¿ç”¨è€…
â”‚   â”œâ”€â”€ updateUserProfile() - æ›´æ–°ä½¿ç”¨è€…æª”æ¡ˆ
â”‚   â””â”€â”€ validateNavigation() - é©—è­‰å°èˆªæ¬Šé™
â”œâ”€â”€ SystemService (ç³»çµ±æœå‹™)
â”‚   â”œâ”€â”€ getAppConfig() - å–å¾—æ‡‰ç”¨é…ç½®
â”‚   â”œâ”€â”€ getRemoteConfig() - å–å¾—é ç«¯é…ç½®
â”‚   â””â”€â”€ checkSystemHealth() - æª¢æŸ¥ç³»çµ±å¥åº·ç‹€æ…‹
â”œâ”€â”€ ThemeService (ä¸»é¡Œæœå‹™)
â”‚   â”œâ”€â”€ initializeThemes() - åˆå§‹åŒ–ä¸»é¡Œ
â”‚   â”œâ”€â”€ getModeTheme() - å–å¾—æ¨¡å¼ä¸»é¡Œ
â”‚   â””â”€â”€ switchTheme() - åˆ‡æ›ä¸»é¡Œ
â”œâ”€â”€ NavigationService (å°èˆªæœå‹™)
â”‚   â”œâ”€â”€ navigateToLogin() - å°å‘ç™»å…¥é é¢
â”‚   â”œâ”€â”€ navigateToRegistration() - å°å‘è¨»å†Šé é¢
â”‚   â”œâ”€â”€ pushNamed() - åŸ·è¡Œå‘½åè·¯ç”±å°èˆª
â”‚   â””â”€â”€ parseDeepLink() - è§£ææ·±åº¦é€£çµ
â”œâ”€â”€ StorageService (å„²å­˜æœå‹™)
â”‚   â”œâ”€â”€ getSecureData() - å–å¾—å®‰å…¨è³‡æ–™
â”‚   â”œâ”€â”€ setUserMode() - å„²å­˜ä½¿ç”¨è€…æ¨¡å¼
â”‚   â”œâ”€â”€ getCachedConfig() - å–å¾—å¿«å–é…ç½®
â”‚   â””â”€â”€ setPreferences() - å„²å­˜åå¥½è¨­å®š
â””â”€â”€ ConnectivityService (é€£ç·šæœå‹™)
    â”œâ”€â”€ getConnectivityStatus() - å–å¾—ç¶²è·¯ç‹€æ…‹
    â””â”€â”€ monitorConnectivity() - ç›£æ§ç¶²è·¯è®ŠåŒ–
```

### 5.2 è³‡æ–™æµå‘è¨­è¨ˆ
```
ä½¿ç”¨è€…é–‹å•Ÿæ‡‰ç”¨ â†’ P001_initializeWelcomePage() â†’ 
æª¢æŸ¥ç™»å…¥ç‹€æ…‹ â†’ P001_checkUserLoginStatus() â†’
è¼‰å…¥æ‡‰ç”¨é…ç½® â†’ P001_loadAppConfiguration() â†’
åˆå§‹åŒ–ä¸»é¡Œ â†’ P001_initializeThemeManager() â†’
é¡¯ç¤ºæ¨¡å¼é¸æ“‡ â†’ P001_displayModeSelection() â†’
ä½¿ç”¨è€…é¸æ“‡æ¨¡å¼ â†’ P001_handleModeSelection() â†’
å¥—ç”¨æ¨¡å¼ä¸»é¡Œ â†’ P001_applyModeTheme() â†’
æŒä¹…åŒ–åå¥½ â†’ P001_persistUserPreferences() â†’
å°èˆªåˆ°ä¸‹ä¸€é  â†’ P001_navigateToNextPage()
```

---

## 6.0 APIæ•´åˆæ¶æ§‹è¨­è¨ˆ

### 6.1 åˆå§‹åŒ–APIå‘¼å«åºåˆ—

#### 6.1.1 æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–API
```dart
class WelcomePageApiService {
  static const String initializationEndpoint = '/app/initialization';
  static const String modeSelectionEndpoint = '/app/user/mode-selection';
  
  Future<AppInitializationResponse> initializeApplication({
    required String deviceId,
    required String platform,
    required String version,
  }) async {
    final response = await dio.get(
      initializationEndpoint,
      data: {
        'deviceInfo': {
          'platform': platform,
          'version': version,
          'deviceId': deviceId,
        },
        'accountDeletionCheck': true,
      },
    );
    
    return AppInitializationResponse.fromJson(response.data);
  }
}
```

### 6.2 æ¨¡å¼è¨­å®šAPIè¦æ ¼

#### 6.2.1 æ¨¡å¼é¸æ“‡APIæ•´åˆ
```dart
Future<ModeSelectionApiResponse> submitModeSelection({
  required String userId,
  required UserMode selectedMode,
  required DeviceInfo deviceInfo,
}) async {
  final requestData = {
    'userId': userId,
    'selectedMode': selectedMode.toString(),
    'deviceInfo': {
      'platform': deviceInfo.platform,
      'version': deviceInfo.version,
      'deviceId': deviceInfo.deviceId,
    },
  };
  
  final response = await dio.post(
    '/app/user/mode-selection',
    data: requestData,
  );
  
  if (response.statusCode == 200) {
    return ModeSelectionApiResponse.fromJson(response.data);
  } else {
    throw ApiException('Mode selection failed', response.statusCode);
  }
}
```

### 6.3 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

#### 6.3.1 APIéŒ¯èª¤è™•ç†ç­–ç•¥
```dart
class WelcomePageErrorHandler {
  static Future<T> handleApiCall<T>(Future<T> Function() apiCall) async {
    try {
      return await apiCall();
    } on DioError catch (e) {
      if (e.type == DioErrorType.connectTimeout) {
        throw NetworkException('é€£ç·šè¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®š');
      } else if (e.type == DioErrorType.response) {
        switch (e.response?.statusCode) {
          case 400:
            throw ValidationException('è«‹æ±‚è³‡æ–™æ ¼å¼éŒ¯èª¤');
          case 401:
            throw AuthenticationException('èªè­‰å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥');
          case 500:
            throw ServerException('ä¼ºæœå™¨æš«æ™‚ç„¡æ³•æœå‹™ï¼Œè«‹ç¨å¾Œå†è©¦');
          default:
            throw ApiException('æœªçŸ¥éŒ¯èª¤', e.response?.statusCode);
        }
      } else {
        throw NetworkException('ç¶²è·¯é€£ç·šç•°å¸¸');
      }
    } catch (e) {
      throw UnknownException('æ‡‰ç”¨ç¨‹å¼ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤: $e');
    }
  }
}
```

---

## 7.0 ç‹€æ…‹ç®¡ç†è¨­è¨ˆ

### 7.1 é é¢ç‹€æ…‹å®šç¾©

#### 7.1.1 ç‹€æ…‹æšèˆ‰å®šç¾©
```dart
enum WelcomePageState {
  loading,           // è¼‰å…¥ä¸­
  modeSelection,     // æ¨¡å¼é¸æ“‡
  loginRedirect,     // ç™»å…¥é‡å°å‘
  registrationFlow,  // è¨»å†Šæµç¨‹
  offline,          // é›¢ç·šæ¨¡å¼
  error,            // éŒ¯èª¤ç‹€æ…‹
}

class WelcomePageStateData {
  final WelcomePageState currentState;
  final UserAuthenticationState? authState;
  final UserMode? selectedMode;
  final AppConfiguration? appConfig;
  final String? errorMessage;
  final bool isLoading;
  final Map<String, dynamic> metadata;
  
  const WelcomePageStateData({
    required this.currentState,
    this.authState,
    this.selectedMode,
    this.appConfig,
    this.errorMessage,
    this.isLoading = false,
    this.metadata = const {},
  });
}
```

### 7.2 ç‹€æ…‹è½‰æ›é‚è¼¯

#### 7.2.1 ç‹€æ…‹è½‰æ›è¦å‰‡
```dart
class WelcomePageStateManager extends ChangeNotifier {
  WelcomePageStateData _state = WelcomePageStateData(
    currentState: WelcomePageState.loading,
  );
  
  WelcomePageStateData get state => _state;
  
  Future<void> transitionTo(WelcomePageState newState, {
    Map<String, dynamic>? metadata,
  }) async {
    final isValidTransition = _validateStateTransition(_state.currentState, newState);
    
    if (!isValidTransition) {
      throw StateTransitionException(
        'Invalid state transition from ${_state.currentState} to $newState'
      );
    }
    
    _state = _state.copyWith(
      currentState: newState,
      metadata: metadata ?? _state.metadata,
    );
    
    notifyListeners();
    
    // åŸ·è¡Œç‹€æ…‹è½‰æ›å¾Œçš„å‹•ä½œ
    await _executePostTransitionActions(newState);
  }
  
  bool _validateStateTransition(WelcomePageState from, WelcomePageState to) {
    const validTransitions = {
      WelcomePageState.loading: [
        WelcomePageState.modeSelection,
        WelcomePageState.loginRedirect,
        WelcomePageState.offline,
        WelcomePageState.error,
      ],
      WelcomePageState.modeSelection: [
        WelcomePageState.loginRedirect,
        WelcomePageState.registrationFlow,
        WelcomePageState.error,
      ],
      WelcomePageState.offline: [
        WelcomePageState.loading,
        WelcomePageState.modeSelection,
      ],
      WelcomePageState.error: [
        WelcomePageState.loading,
      ],
    };
    
    return validTransitions[from]?.contains(to) ?? false;
  }
}
```

### 7.3 ç‹€æ…‹æŒä¹…åŒ–æ©Ÿåˆ¶

#### 7.3.1 ç‹€æ…‹åºåˆ—åŒ–èˆ‡ååºåˆ—åŒ–
```dart
class WelcomePageStatePersistence {
  static const String _stateKey = 'welcome_page_state';
  
  static Future<void> saveState(WelcomePageStateData state) async {
    final prefs = await SharedPreferences.getInstance();
    final stateJson = jsonEncode(state.toJson());
    await prefs.setString(_stateKey, stateJson);
  }
  
  static Future<WelcomePageStateData?> loadState() async {
    try {
      final prefs = await SharedPreferences.getInstance();
      final stateJson = prefs.getString(_stateKey);
      
      if (stateJson != null) {
        final stateMap = jsonDecode(stateJson) as Map<String, dynamic>;
        return WelcomePageStateData.fromJson(stateMap);
      }
    } catch (e) {
      // ç‹€æ…‹è¼‰å…¥å¤±æ•—ï¼Œè¿”å›nullä½¿ç”¨é è¨­ç‹€æ…‹
      debugPrint('Failed to load welcome page state: $e');
    }
    
    return null;
  }
  
  static Future<void> clearState() async {
    final prefs = await SharedPreferences.getInstance();
    await prefs.remove(_stateKey);
  }
}
```

---

## 8.0 UIçµ„ä»¶æ¶æ§‹

### 8.1 çµ„ä»¶æ¨¹çµæ§‹

#### 8.1.1 ä¸»è¦çµ„ä»¶å±¤æ¬¡
```dart
class WelcomePage extends StatefulWidget {
  @override
  _WelcomePageState createState() => _WelcomePageState();
}

class _WelcomePageState extends State<WelcomePage> 
    with TickerProviderStateMixin {
  
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Consumer<WelcomePageStateManager>(
        builder: (context, stateManager, child) {
          switch (stateManager.state.currentState) {
            case WelcomePageState.loading:
              return _buildLoadingView();
            case WelcomePageState.modeSelection:
              return _buildModeSelectionView();
            case WelcomePageState.offline:
              return _buildOfflineView();
            case WelcomePageState.error:
              return _buildErrorView();
            default:
              return _buildDefaultView();
          }
        },
      ),
    );
  }
  
  Widget _buildModeSelectionView() {
    return Column(
      children: [
        WelcomeHeader(),
        Expanded(
          child: ModeSelectionGrid(),
        ),
        ActionButtonRow(),
        BrandFooter(),
      ],
    );
  }
}
```

### 8.2 éŸ¿æ‡‰å¼ä½ˆå±€è¨­è¨ˆ

#### 8.2.1 é©æ‡‰æ€§ä½ˆå±€å¯¦ä½œ
```dart
class ResponsiveWelcomeLayout extends StatelessWidget {
  final Widget child;
  
  const ResponsiveWelcomeLayout({required this.child});
  
  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(
      builder: (context, constraints) {
        if (constraints.maxWidth < 600) {
          return _buildMobileLayout();
        } else if (constraints.maxWidth < 1200) {
          return _buildTabletLayout();
        } else {
          return _buildDesktopLayout();
        }
      },
    );
  }
  
  Widget _buildMobileLayout() {
    return Padding(
      padding: EdgeInsets.all(16),
      child: child,
    );
  }
  
  Widget _buildTabletLayout() {
    return Center(
      child: Container(
        constraints: BoxConstraints(maxWidth: 600),
        padding: EdgeInsets.all(32),
        child: child,
      ),
    );
  }
  
  Widget _buildDesktopLayout() {
    return Center(
      child: Container(
        constraints: BoxConstraints(maxWidth: 800),
        padding: EdgeInsets.all(48),
        child: child,
      ),
    );
  }
}
```

### 8.3 å‹•ç•«èˆ‡è½‰å ´æ•ˆæœ

#### 8.3.1 é é¢è½‰å ´å‹•ç•«
```dart
class WelcomePageTransitions {
  static const Duration defaultDuration = Duration(milliseconds: 300);
  
  static Widget fadeTransition(Widget child, Animation<double> animation) {
    return FadeTransition(
      opacity: animation,
      child: child,
    );
  }
  
  static Widget slideTransition(Widget child, Animation<double> animation) {
    return SlideTransition(
      position: Tween<Offset>(
        begin: Offset(1.0, 0.0),
        end: Offset.zero,
      ).animate(CurvedAnimation(
        parent: animation,
        curve: Curves.easeInOut,
      )),
      child: child,
    );
  }
  
  static Widget scaleTransition(Widget child, Animation<double> animation) {
    return ScaleTransition(
      scale: CurvedAnimation(
        parent: animation,
        curve: Curves.elasticOut,
      ),
      child: child,
    );
  }
}
```

---

## 9.0 éŒ¯èª¤è™•ç†èˆ‡ç›£æ§

### 9.1 éŒ¯èª¤é¡å‹å®šç¾©

#### 9.1.1 æ­¡è¿é é¢ç‰¹å®šéŒ¯èª¤
```dart
abstract class WelcomePageException implements Exception {
  final String message;
  final String? userMessage;
  final ErrorSeverity severity;
  
  const WelcomePageException(
    this.message, {
    this.userMessage,
    this.severity = ErrorSeverity.medium,
  });
}

class InitializationException extends WelcomePageException {
  const InitializationException(String message, {String? userMessage})
      : super(message, userMessage: userMessage, severity: ErrorSeverity.high);
}

class ModeSelectionException extends WelcomePageException {
  const ModeSelectionException(String message, {String? userMessage})
      : super(message, userMessage: userMessage, severity: ErrorSeverity.medium);
}

class ThemeLoadingException extends WelcomePageException {
  const ThemeLoadingException(String message, {String? userMessage})
      : super(message, userMessage: userMessage, severity: ErrorSeverity.low);
}

enum ErrorSeverity { low, medium, high, critical }
```

### 9.2 ä½¿ç”¨è€…é«”é©—é™ç´šç­–ç•¥

#### 9.2.1 éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶
```dart
class WelcomePageErrorRecovery {
  static Future<void> handleError(
    WelcomePageException error,
    BuildContext context,
  ) async {
    switch (error.severity) {
      case ErrorSeverity.low:
        _showSnackBar(context, error.userMessage ?? 'ç™¼ç”Ÿè¼•å¾®éŒ¯èª¤');
        break;
      case ErrorSeverity.medium:
        await _showErrorDialog(context, error);
        break;
      case ErrorSeverity.high:
        await _showRetryDialog(context, error);
        break;
      case ErrorSeverity.critical:
        await _showCriticalErrorPage(context, error);
        break;
    }
  }
  
  static void _showSnackBar(BuildContext context, String message) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(
        content: Text(message),
        duration: Duration(seconds: 3),
        action: SnackBarAction(
          label: 'ç¢ºå®š',
          onPressed: () {},
        ),
      ),
    );
  }
  
  static Future<void> _showErrorDialog(
    BuildContext context,
    WelcomePageException error,
  ) async {
    await showDialog<void>(
      context: context,
      builder: (context) => AlertDialog(
        title: Text('æ“ä½œå¤±æ•—'),
        content: Text(error.userMessage ?? 'ç™¼ç”Ÿæœªé æœŸçš„éŒ¯èª¤'),
        actions: [
          TextButton(
            onPressed: () => Navigator.of(context).pop(),
            child: Text('ç¢ºå®š'),
          ),
        ],
      ),
    );
  }
}
```

### 9.3 è¨ºæ–·è³‡è¨Šæ”¶é›†

#### 9.3.1 éŒ¯èª¤å ±å‘Šç³»çµ±
```dart
class WelcomePageDiagnostics {
  static Future<void> reportError(
    WelcomePageException error,
    StackTrace stackTrace, {
    Map<String, dynamic>? additionalData,
  }) async {
    final diagnosticData = {
      'timestamp': DateTime.now().toIso8601String(),
      'errorType': error.runtimeType.toString(),
      'message': error.message,
      'severity': error.severity.toString(),
      'stackTrace': stackTrace.toString(),
      'deviceInfo': await _getDeviceInfo(),
      'appState': await _getAppState(),
      'additionalData': additionalData,
    };
    
    // ç™¼é€åˆ°éŒ¯èª¤è¿½è¹¤æœå‹™
    await _sendToErrorTrackingService(diagnosticData);
    
    // æœ¬åœ°æ—¥èªŒè¨˜éŒ„
    await _writeToLocalLog(diagnosticData);
  }
  
  static Future<Map<String, dynamic>> _getDeviceInfo() async {
    final deviceInfo = DeviceInfoPlugin();
    
    if (Platform.isAndroid) {
      final androidInfo = await deviceInfo.androidInfo;
      return {
        'platform': 'android',
        'model': androidInfo.model,
        'version': androidInfo.version.release,
        'sdkInt': androidInfo.version.sdkInt,
      };
    } else if (Platform.isIOS) {
      final iosInfo = await deviceInfo.iosInfo;
      return {
        'platform': 'ios',
        'model': iosInfo.model,
        'version': iosInfo.systemVersion,
        'name': iosInfo.name,
      };
    }
    
    return {'platform': 'unknown'};
  }
}
```

---

## 10.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 10.1 è¼‰å…¥æ™‚é–“å„ªåŒ–

#### 10.1.1 å»¶é²è¼‰å…¥ç­–ç•¥
```dart
class WelcomePagePerformanceOptimizer {
  static final Map<String, dynamic> _cachedData = {};
  
  static Future<void> preloadCriticalResources() async {
    // é è¼‰é—œéµè³‡æº
    final futures = <Future>[
      _preloadThemes(),
      _preloadIcons(),
      _preloadTranslations(),
    ];
    
    await Future.wait(futures);
  }
  
  static Future<void> _preloadThemes() async {
    if (_cachedData.containsKey('themes')) return;
    
    final themes = await ThemeService.loadAllThemes();
    _cachedData['themes'] = themes;
  }
  
  static Future<void> _preloadIcons() async {
    // é è¼‰å¸¸ç”¨åœ–ç¤º
    final iconPaths = [
      'assets/icons/controller.svg',
      'assets/icons/logger.svg', 
      'assets/icons/struggler.svg',
      'assets/icons/sleeper.svg',
    ];
    
    for (final path in iconPaths) {
      await precacheImage(AssetImage(path), Get.context!);
    }
  }
}
```

### 10.2 è¨˜æ†¶é«”ç®¡ç†

#### 10.2.1 è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§
```dart
class WelcomePageMemoryManager {
  static Timer? _memoryMonitorTimer;
  
  static void startMemoryMonitoring() {
    _memoryMonitorTimer = Timer.periodic(
      Duration(seconds: 30),
      (timer) => _checkMemoryUsage(),
    );
  }
  
  static void stopMemoryMonitoring() {
    _memoryMonitorTimer?.cancel();
    _memoryMonitorTimer = null;
  }
  
  static void _checkMemoryUsage() {
    final memoryInfo = ProcessInfo.currentRss;
    const maxMemoryMB = 100; // 100MB é™åˆ¶
    
    if (memoryInfo > maxMemoryMB * 1024 * 1024) {
      _performMemoryCleanup();
    }
  }
  
  static void _performMemoryCleanup() {
    // æ¸…ç†å¿«å–
    PaintingBinding.instance.imageCache.clear();
    
    // æ¸…ç†ä¸å¿…è¦çš„è³‡æ–™
    _clearUnusedCaches();
    
    // å¼·åˆ¶åƒåœ¾å›æ”¶
    System.gc();
  }
}
```

### 10.3 å¿«å–ç­–ç•¥

#### 10.3.1 æ™ºæ…§å¿«å–ç³»çµ±
```dart
class WelcomePageCacheManager {
  static const int maxCacheSize = 10 * 1024 * 1024; // 10MB
  static final Map<String, CacheItem> _cache = {};
  
  static Future<T?> get<T>(String key) async {
    final item = _cache[key];
    
    if (item == null) return null;
    
    if (item.isExpired) {
      _cache.remove(key);
      return null;
    }
    
    // æ›´æ–°æœ€å¾Œå­˜å–æ™‚é–“
    item.lastAccessed = DateTime.now();
    
    return item.data as T?;
  }
  
  static Future<void> set<T>(
    String key,
    T data, {
    Duration ttl = const Duration(hours: 1),
  }) async {
    final item = CacheItem(
      data: data,
      expiry: DateTime.now().add(ttl),
      lastAccessed: DateTime.now(),
    );
    
    _cache[key] = item;
    
    // æª¢æŸ¥å¿«å–å¤§å°
    await _enforceCacheLimit();
  }
  
  static Future<void> _enforceCacheLimit() async {
    while (_getCurrentCacheSize() > maxCacheSize) {
      _evictLeastRecentlyUsed();
    }
  }
}

class CacheItem {
  final dynamic data;
  final DateTime expiry;
  DateTime lastAccessed;
  
  CacheItem({
    required this.data,
    required this.expiry,
    required this.lastAccessed,
  });
  
  bool get isExpired => DateTime.now().isAfter(expiry);
}
```

---

## 11.0 æ¸¬è©¦ç­–ç•¥

### 11.1 å–®å…ƒæ¸¬è©¦è¦†è“‹

#### 11.1.1 æ ¸å¿ƒå‡½æ•¸å–®å…ƒæ¸¬è©¦
```dart
@TestOn('vm')
void main() {
  group('P001 Welcome Page Tests', () {
    late WelcomePageStateManager stateManager;
    late MockAuthService mockAuthService;
    late MockThemeService mockThemeService;
    
    setUp(() {
      stateManager = WelcomePageStateManager();
      mockAuthService = MockAuthService();
      mockThemeService = MockThemeService();
    });
    
    group('State Management Tests', () {
      test('should initialize with loading state', () {
        expect(stateManager.state.currentState, WelcomePageState.loading);
      });
      
      test('should transition to mode selection when initialized', () async {
        when(mockAuthService.checkAuthentication())
            .thenAnswer((_) async => AuthenticationResult.notAuthenticated());
        
        await stateManager.initialize();
        
        expect(stateManager.state.currentState, WelcomePageState.modeSelection);
      });
      
      test('should transition to login redirect for authenticated users', () async {
        when(mockAuthService.checkAuthentication())
            .thenAnswer((_) async => AuthenticationResult.authenticated('user123'));
        
        await stateManager.initialize();
        
        expect(stateManager.state.currentState, WelcomePageState.loginRedirect);
      });
    });
    
    group('Mode Selection Tests', () {
      test('should handle valid mode selection', () async {
        final result = await P001_handleModeSelection(
          UserMode.controller,
          'user123',
        );
        
        expect(result.success, isTrue);
        expect(result.modeConfig.mode, UserMode.controller);
      });
      
      test('should reject invalid mode selection', () {
        expect(
          () => P001_validateModeSelection(null, null),
          throwsA(isA<ValidationException>()),
        );
      });
    });
    
    group('API Integration Tests', () {
      test('should handle successful mode selection API call', () async {
        when(mockApiService.submitModeSelection(any))
            .thenAnswer((_) async => ModeSelectionApiResponse.success());
        
        final result = await P001_handleModeSelection(
          UserMode.logger,
          'user123',
        );
        
        expect(result.success, isTrue);
        verify(mockApiService.submitModeSelection(any)).called(1);
      });
      
      test('should handle API failure gracefully', () async {
        when(mockApiService.submitModeSelection(any))
            .thenThrow(ApiException('Network error', 500));
        
        expect(
          () => P001_handleModeSelection(UserMode.logger, 'user123'),
          throwsA(isA<ApiException>()),
        );
      });
    });
  });
}
```

### 11.2 æ•´åˆæ¸¬è©¦å ´æ™¯

#### 11.2.1 å®Œæ•´æµç¨‹æ•´åˆæ¸¬è©¦
```dart
@TestOn('vm') 
void main() {
  group('P001 Integration Tests', () {
    testWidgets('complete welcome flow for new user', (tester) async {
      // å®‰æ’æ¸¬è©¦ç’°å¢ƒ
      await tester.pumpWidget(MaterialApp(
        home: WelcomePage(),
      ));
      
      // é©—è­‰åˆå§‹è¼‰å…¥ç‹€æ…‹
      expect(find.byType(CircularProgressIndicator), findsOneWidget);
      
      // ç­‰å¾…åˆå§‹åŒ–å®Œæˆ
      await tester.pumpAndSettle();
      
      // é©—è­‰æ¨¡å¼é¸æ“‡ä»‹é¢å‡ºç¾
      expect(find.text('é¸æ“‡æ‚¨çš„è¨˜å¸³æ¨¡å¼'), findsOneWidget);
      expect(find.byType(ModeSelectionCard), findsNWidgets(4));
      
      // é¸æ“‡æ§åˆ¶è€…æ¨¡å¼
      await tester.tap(find.text('ç²¾æº–æ§åˆ¶è€…'));
      await tester.pumpAndSettle();
      
      // é©—è­‰æ¨¡å¼é¸æ“‡å¾Œçš„ç‹€æ…‹
      expect(find.text('é–‹å§‹ä½¿ç”¨'), findsOneWidget);
      
      // é»æ“Šé–‹å§‹ä½¿ç”¨æŒ‰éˆ•
      await tester.tap(find.text('é–‹å§‹ä½¿ç”¨'));
      await tester.pumpAndSettle();
      
      // é©—è­‰å°èˆªåˆ°è¨»å†Šé é¢
      expect(find.text('è¨»å†Š'), findsOneWidget);
    });
    
    testWidgets('welcome flow for returning user', (tester) async {
      // è¨­å®šå·²ç™»å…¥ä½¿ç”¨è€…
      when(mockAuthService.checkAuthentication())
          .thenAnswer((_) async => AuthenticationResult.authenticated('user123'));
      
      await tester.pumpWidget(MaterialApp(
        home: WelcomePage(),
      ));
      
      // ç­‰å¾…åˆå§‹åŒ–
      await tester.pumpAndSettle();
      
      // é©—è­‰ç›´æ¥å°å‘é¦–é 
      expect(find.text('æ­¡è¿å›ä¾†'), findsOneWidget);
    });
  });
}
```

### 11.3 UIæ¸¬è©¦è¦åŠƒ

#### 11.3.1 è¦–è¦ºå›æ­¸æ¸¬è©¦
```dart
void main() {
  group('P001 Visual Tests', () {
    testWidgets('mode selection cards visual test', (tester) async {
      await tester.pumpWidget(MaterialApp(
        home: Scaffold(
          body: ModeSelectionGrid(),
        ),
      ));
      
      await tester.pumpAndSettle();
      
      // é€²è¡Œè¦–è¦ºå¿«ç…§æ¸¬è©¦
      await expectLater(
        find.byType(ModeSelectionGrid),
        matchesGoldenFile('mode_selection_grid.png'),
      );
    });
    
    testWidgets('theme switching visual test', (tester) async {
      final widget = MaterialApp(
        home: WelcomePage(),
      );
      
      await tester.pumpWidget(widget);
      
      // æ¸¬è©¦é è¨­ä¸»é¡Œ
      await expectLater(
        find.byType(WelcomePage),
        matchesGoldenFile('welcome_page_default.png'),
      );
      
      // åˆ‡æ›åˆ°æ§åˆ¶è€…æ¨¡å¼ä¸»é¡Œ
      final stateManager = Provider.of<WelcomePageStateManager>(
        tester.element(find.byType(WelcomePage)),
        listen: false,
      );
      
      await stateManager.selectMode(UserMode.controller);
      await tester.pumpAndSettle();
      
      await expectLater(
        find.byType(WelcomePage),
        matchesGoldenFile('welcome_page_controller.png'),
      );
    });
  });
}
```

---

## 12.0 éƒ¨ç½²é…ç½®

### 12.1 ç’°å¢ƒé…ç½®

#### 12.1.1 ç’°å¢ƒè®Šæ•¸è¨­å®š
```dart
class WelcomePageEnvironment {
  static const String apiBaseUrl = String.fromEnvironment(
    'API_BASE_URL',
    defaultValue: 'https://api.lcas.app',
  );
  
  static const bool enableAnalytics = bool.fromEnvironment(
    'ENABLE_ANALYTICS',
    defaultValue: true,
  );
  
  static const bool debugMode = bool.fromEnvironment(
    'DEBUG_MODE',
    defaultValue: false,
  );
  
  static const int cacheTimeout = int.fromEnvironment(
    'CACHE_TIMEOUT_MINUTES',
    defaultValue: 60,
  );
}
```

### 12.2 ç‰ˆæœ¬ç®¡ç†

#### 12.2.1 ç‰ˆæœ¬æª¢æŸ¥æ©Ÿåˆ¶
```dart
class WelcomePageVersionManager {
  static Future<bool> checkForUpdates() async {
    try {
      final currentVersion = await PackageInfo.fromPlatform();
      final latestVersion = await _getLatestVersionFromServer();
      
      return _isUpdateRequired(currentVersion.version, latestVersion);
    } catch (e) {
      debugPrint('Version check failed: $e');
      return false;
    }
  }
  
  static bool _isUpdateRequired(String current, String latest) {
    final currentParts = current.split('.').map(int.parse).toList();
    final latestParts = latest.split('.').map(int.parse).toList();
    
    for (int i = 0; i < 3; i++) {
      if (latestParts[i] > currentParts[i]) {
        return true;
      } else if (latestParts[i] < currentParts[i]) {
        return false;
      }
    }
    
    return false;
  }
}
```

### 12.3 ç†±æ›´æ–°æ©Ÿåˆ¶

#### 12.3.1 å‹•æ…‹é…ç½®æ›´æ–°
```dart
class WelcomePageHotUpdate {
  static Timer? _configUpdateTimer;
  
  static void startConfigMonitoring() {
    _configUpdateTimer = Timer.periodic(
      Duration(minutes: 30),
      (timer) => _checkForConfigUpdates(),
    );
  }
  
  static Future<void> _checkForConfigUpdates() async {
    try {
      final remoteConfig = await SystemService.getRemoteConfig();
      final localConfig = await StorageService.getCachedConfig();
      
      if (_configHasChanged(remoteConfig, localConfig)) {
        await _applyConfigUpdate(remoteConfig);
      }
    } catch (e) {
      debugPrint('Config update check failed: $e');
    }
  }
  
  static Future<void> _applyConfigUpdate(Map<String, dynamic> newConfig) async {
    await StorageService.setCachedConfig(newConfig);
    
    // é€šçŸ¥ç›¸é—œçµ„ä»¶é…ç½®å·²æ›´æ–°
    EventBus.fire(ConfigUpdatedEvent(newConfig));
  }
}
```

---

## 13. æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| v1.0.0 | 2025-08-06 11:00:00 +08:00 | LCAS SA Team | åˆç‰ˆå»ºç«‹ï¼šå®Œæ•´P001æ­¡è¿é é¢TDDæ¶æ§‹è¨­è¨ˆï¼ŒåŒ…å«20å€‹æ ¸å¿ƒå‡½æ•¸ã€å››æ¨¡å¼å·®ç•°åŒ–å¯¦ä½œã€å®Œæ•´APIæ•´åˆã€ç‹€æ…‹ç®¡ç†ã€UIçµ„ä»¶æ¶æ§‹ã€éŒ¯èª¤è™•ç†ã€æ•ˆèƒ½æœ€ä½³åŒ–ã€æ¸¬è©¦ç­–ç•¥ã€éƒ¨ç½²é…ç½®ç­‰13å€‹ç« ç¯€ |

---

## å‚™è¨»

- **é é¢å®šä½**ï¼šP001ç‚ºLCAS 2.0æ‡‰ç”¨ç¨‹å¼å…¥å£ï¼Œè² è²¬å»ºç«‹ç¬¬ä¸€å°è±¡
- **å››æ¨¡å¼æ”¯æ´**ï¼šå®Œæ•´æ”¯æ´ç²¾æº–æ§åˆ¶è€…ã€ç´€éŒ„ç¿’æ…£è€…ã€è½‰å‹æŒ‘æˆ°è€…ã€æ½›åœ¨è¦ºé†’è€…å››ç¨®æ¨¡å¼
- **APIæ•´åˆ**ï¼šèˆ‡F004å¸³è™Ÿåˆªé™¤åŠŸèƒ½å’ŒF009ä½¿ç”¨è€…è¨­å®šåŠŸèƒ½æ·±åº¦æ•´åˆ
- **ç‹€æ…‹ç®¡ç†**ï¼šæ¡ç”¨Provideræ¨¡å¼é€²è¡ŒéŸ¿æ‡‰å¼ç‹€æ…‹ç®¡ç†
- **æ•ˆèƒ½å„ªåŒ–**ï¼šåŒ…å«è¨˜æ†¶é«”ç®¡ç†ã€å¿«å–ç­–ç•¥ã€è¼‰å…¥å„ªåŒ–
- **æ¸¬è©¦è¦†è“‹**ï¼šå–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€UIæ¸¬è©¦å®Œæ•´è¦†è“‹
- **éŒ¯èª¤è™•ç†**ï¼šå¤šå±¤ç´šéŒ¯èª¤è™•ç†èˆ‡ä½¿ç”¨è€…é«”é©—é™ç´šç­–ç•¥
- **éƒ¨ç½²å°±ç·’**ï¼šåŒ…å«ç’°å¢ƒé…ç½®ã€ç‰ˆæœ¬ç®¡ç†ã€ç†±æ›´æ–°æ©Ÿåˆ¶
