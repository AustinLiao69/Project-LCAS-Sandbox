# 8407. 預算管理服務 

**版本**: 2.4.0  
**建立日期**: 2025-09-05  
**最後更新**: 2025-09-10  
**建立者**: SQA Team  
**來源文件**: 8207. 預算管理服務.md, 8107. 預算管理服務 API 規格.yaml  
**遵循規範**: 8020. API list.md, 8088. API設計規範.md

---

## 📑 目次 (Table of Contents)

1. [測試概覽](#1-測試概覽)
   - 1.1 [測試範圍](#11-測試範圍)
   - 1.2 [測試目標](#12-測試目標)
   - 1.3 [風險評估](#13-風險評估)

2. [測試案例索引表](#2-測試案例索引表)

3. [測試環境與準備](#3-測試環境與準備)
   - 3.1 [系統環境需求](#31-系統環境需求)
   - 3.2 [測試資料準備](#32-測試資料準備)
   - 3.3 [相依模組狀態](#33-相依模組狀態)

4. [功能測試範圍](#4-功能測試範圍)
   - 4.1 [預算CRUD模組測試](#41-預算crud模組測試)
   - 4.2 [預算執行模組測試](#42-預算執行模組測試)
   - 4.3 [預算分析模組測試](#43-預算分析模組測試)
   - 4.4 [預算監控模組測試](#44-預算監控模組測試)
   - 4.5 [預算模板模組測試](#45-預算模板模組測試)

5. [詳細測試案例](#5-詳細測試案例)
   - 5.1 [核心功能測試案例](#51-核心功能測試案例)
   - 5.2 [預算類型測試案例](#52-預算類型測試案例)
   - 5.3 [四模式差異化測試案例](#53-四模式差異化測試案例)
   - 5.4 [API端點一致性測試案例](#54-api端點一致性測試案例)
   - 5.5 [異常處理測試案例](#55-異常處理測試案例)

6. [效能與壓力測試](#6-效能與壓力測試)
   - 6.1 [預算管理效能](#61-預算管理效能)
   - 6.2 [預算計算能力](#62-預算計算能力)
   - 6.3 [記憶體使用監控](#63-記憶體使用監控)

7. [安全性與權限測試](#7-安全性與權限測試)
   - 7.1 [輸入驗證測試](#71-輸入驗證測試)
   - 7.2 [預算權限測試](#72-預算權限測試)
   - 7.3 [API安全性測試](#73-api安全性測試)

---

## 1. 測試概覽

### 1.1 測試範圍

#### 1.1.1 預算管理服務核心功能測試
- **預算CRUD操作**：建立、查詢、修改、刪除預算（5個函數）
- **預算執行**：預算追蹤、執行率計算、剩餘分析（7個函數）
- **預算分析**：預算績效分析、趨勢統計、預警機制（8個函數）
- **預算監控**：即時監控、超支警告、進度提醒（2個函數）
- **預算模板**：預算範本管理、快速建立、歷史複製（4個函數）
- **計算引擎**：複雜預算計算、統計功能、週期處理（10個函數）

#### 1.1.2 API端點整合測試
- **8107 API規格對應**：7個標準API端點完整驗證
- **8088 API設計規範**：統一回應格式、錯誤處理、JWT認證
- **8020 API list映射**：S-307、S-308畫面功能支援
- **四模式差異化**：Expert、Inertial、Cultivation、Guiding模式測試

#### 1.1.3 Dart語言函數規格測試
- **函數簽名驗證**：36個核心函數版次v2.4.0規格檢查
- **類別設計驗證**：4個主要類別架構完整性
- **介面一致性**：Repository Pattern實作正確性
- **計算引擎**：CalculationEngine精確計算邏輯

### 1.2 測試目標

#### 1.2.1 功能完整性目標
- 預算管理服務36個函數100%功能驗證通過
- 4種預算類型(category、account、tag、total)完整支援驗證
- API端點與8107規格100%一致性驗證
- 四模式差異化回應100%準確性驗證

#### 1.2.2 效能指標目標
- 單次預算操作回應時間 < 1 秒
- 預算執行率計算處理回應時間 < 800ms
- 支援1000+併發預算查詢處理
- 記憶體使用率維持 < 80%

#### 1.2.3 穩定性目標
- 系統連續運行24小時無故障
- 預算操作成功率 > 99.5%
- 預算計算準確性 = 100%
- 警告通知準時性 = 100%

### 1.3 風險評估

#### 1.3.1 高風險項目
1. **預算執行率計算精確度**
   - 風險：浮點數計算誤差影響執行率準確性
   - 影響：預算監控不準確，警告機制失效
   - 緩解：使用Decimal精確計算，完整的精確度測試

2. **預算週期重疊檢查**
   - 風險：同科目預算週期重疊導致計算錯誤
   - 影響：預算控制失效，統計資料錯誤
   - 緩解：完整的週期重疊檢測與驗證機制

3. **即時監控與警告機制**
   - 風險：監控延遲或警告觸發失敗
   - 影響：超支無法及時提醒，預算控制失敗
   - 緩解：完整的即時監控與警告機制測試

#### 1.3.2 中風險項目
1. **四模式推薦演算法**
   - 風險：不同模式的推薦邏輯複雜且容易出錯
   - 影響：推薦不適當的預算設定，使用體驗下降
   - 緩解：每個模式的完整推薦測試驗證

2. **預算分析統計準確性**
   - 風險：統計計算複雜，容易產生錯誤
   - 影響：預算分析報告不準確，影響決策
   - 緩解：完整的統計計算驗證測試

---

## 2. 測試案例索引表

| 測試案例編號 | 測試案例名稱 | 測試類型 |
|-------------|-------------|----------|
| TC-001 | 預算列表查詢API綜合篩選測試 | 功能測試 |
| TC-002 | 預算建立API週期重疊檢測測試 | 功能測試 |
| TC-003 | 預算執行率計算API精確度測試 | 功能測試 |
| TC-004 | 預算更新API部分更新邏輯測試 | 功能測試 |
| TC-005 | 預算刪除API依賴檢查測試 | 功能測試 |
| TC-006 | 科目預算特殊邏輯測試 | 預算類型測試 |
| TC-007 | 帳戶預算計算邏輯測試 | 預算類型測試 |
| TC-008 | 標籤預算組合邏輯測試 | 預算類型測試 |
| TC-009 | 總預算聚合計算測試 | 預算類型測試 |
| TC-010 | Expert模式進階分析測試 | 四模式測試 |
| TC-011 | Cultivation模式成就追蹤測試 | 四模式測試 |
| TC-012 | Guiding模式簡化體驗測試 | 四模式測試 |
| TC-013 | Inertial模式標準預算測試 | 四模式測試 |
| TC-014 | 8107規格一致性驗證測試 | API一致性測試 |
| TC-015 | 統一回應格式驗證測試 | API一致性測試 |
| TC-016 | 預算計算異常處理測試 | 異常處理測試 |
| TC-017 | 預算警告機制異常測試 | 異常處理測試 |
| TC-018 | 週期重疊異常處理測試 | 異常處理測試 |
| TC-019 | 預算操作效能基準測試 | 效能測試 |
| TC-020 | 複雜計算查詢效能測試 | 效能測試 |
| TC-021 | 併發預算處理能力測試 | 效能測試 |
| TC-022 | 記憶體使用監控測試 | 效能測試 |
| TC-023 | 惡意輸入防護測試 | 安全性測試 |
| TC-024 | 預算存取權限驗證測試 | 安全性測試 |
| TC-025 | 敏感資料保護測試 | 安全性測試 |
| TC-026 | 跨帳本資料隔離測試 | 安全性測試 |
| TC-027 | 預算範本管理測試 | 功能測試 |
| TC-028 | 智慧推薦機制測試 | 功能測試 |

---

## 3. 測試環境與準備

### 3.1 系統環境需求

#### 3.1.1 核心環境
- **Dart SDK**: 3.0.0+ (Flutter 3.13.0+)
- **測試框架**: test ^1.24.0
- **HTTP客戶端**: dio ^5.3.0
- **JSON序列化**: json_annotation ^4.8.0
- **UUID生成**: uuid ^4.0.0
- **精確計算**: decimal ^2.3.3 (避免浮點誤差)
- **日期處理**: intl ^0.18.0

#### 3.1.2 API測試環境
- **測試伺服器**: https://api-staging.lcas.app/v1
- **認證方式**: Bearer Token (JWT)
- **API版本**: v1.0.0
- **回應格式**: JSON (遵循8088規範)

#### 3.1.3 預算類型測試環境
- **科目預算**: 基於特定科目的預算控制
- **帳戶預算**: 基於特定帳戶的預算控制
- **標籤預算**: 基於標籤組合的預算控制
- **總預算**: 整體支出預算控制
- **週期管理**: 月度、季度、年度、自訂週期

### 3.2 測試資料準備

#### 3.2.1 使用者測試資料
```dart
// 測試用戶類型 - v2.4.0
const Map<String, TestUser> testUsers = {
  'expertUser': TestUser('test_expert_001', UserMode.Expert),
  'inertialUser': TestUser('test_inertial_001', UserMode.Inertial),
  'cultivationUser': TestUser('test_cultivation_001', UserMode.Cultivation),
  'guidingUser': TestUser('test_guiding_001', UserMode.Guiding),
};
```

#### 3.2.2 預算測試資料
```dart
// 預算測試案例 - v2.4.0
const Map<String, CreateBudgetRequest> testBudgets = {
  'categoryBudget': CreateBudgetRequest(
    name: '食物月預算',
    type: BudgetType.category,
    amount: Decimal.fromInt(12000),
    period: BudgetPeriod.monthly,
    target: BudgetTarget(categoryId: 'category-food-001')
  ),
  'accountBudget': CreateBudgetRequest(
    name: '信用卡預算',
    type: BudgetType.account,
    amount: Decimal.fromInt(50000),
    period: BudgetPeriod.monthly,
    target: BudgetTarget(accountId: 'account-credit-001')
  ),
  'tagBudget': CreateBudgetRequest(
    name: '娛樂預算',
    type: BudgetType.tag,
    amount: Decimal.fromInt(8000),
    period: BudgetPeriod.monthly,
    target: BudgetTarget(tags: ['娛樂', '電影', '遊戲'])
  ),
  'totalBudget': CreateBudgetRequest(
    name: '總支出預算',
    type: BudgetType.total,
    amount: Decimal.fromInt(80000),
    period: BudgetPeriod.monthly
  ),
};
```

#### 3.2.3 預算週期測試資料
```dart
// 預算週期測試 - v2.4.0
const Map<String, BudgetPeriodTest> testPeriods = {
  'monthlyBudget': BudgetPeriodTest(
    type: BudgetPeriod.monthly,
    startDate: DateTime(2025, 1, 1),
    endDate: DateTime(2025, 1, 31)
  ),
  'quarterlyBudget': BudgetPeriodTest(
    type: BudgetPeriod.quarterly,
    startDate: DateTime(2025, 1, 1),
    endDate: DateTime(2025, 3, 31)
  ),
  'customBudget': BudgetPeriodTest(
    type: BudgetPeriod.custom,
    startDate: DateTime(2025, 1, 15),
    endDate: DateTime(2025, 2, 14)
  ),
};
```

#### 3.2.4 錯誤測試資料
- **無效預算金額**: 負數、零、超大數值、非數字
- **無效週期**: 結束日期早於開始日期、超長週期、重疊週期
- **無效目標**: 不存在的科目、帳戶、標籤組合
- **無效警告設定**: 超過100%的警告閾值、無效通知設定

### 3.3 相依模組狀態

#### 3.3.1 必要依賴模組
- **帳本管理服務**: v2.4.0+ (預算所屬帳本驗證)
- **科目管理服務**: v2.4.0+ (科目預算關聯)
- **帳戶管理服務**: v2.4.0+ (帳戶預算關聯)
- **記帳交易服務**: v2.4.0+ (預算執行計算)

#### 3.3.2 選用依賴模組
- **通知管理服務**: v2.4.0+ (預算警告通知)
- **報表分析服務**: v2.4.0+ (預算分析報告)

---

## 4. 功能測試範圍

### 4.1 預算CRUD模組測試

#### 4.1.1 BudgetController.getBudgets 測試重點
- **查詢參數驗證**: ledgerId、type、period、status篩選
- **分頁處理**: page、limit參數驗證，最大限制100筆
- **排序邏輯**: sortBy(name/amount/usage_percentage)正確性
- **四模式回應**: Expert詳細analytics、Guiding簡化摘要

#### 4.1.2 BudgetController.createBudget 測試重點  
- **輸入資料驗證**: name必填、type枚舉驗證、amount最小值
- **週期設定處理**: startDate、endDate邏輯驗證
- **目標設定**: 不同類型預算的target設定驗證
- **重疊檢查**: 同科目/帳戶/標籤的週期重疊防護

#### 4.1.3 BudgetController.updateBudget 測試重點
- **部分更新**: 支援選擇性欄位更新
- **週期調整**: 預算週期修改的邏輯驗證
- **金額修改**: 預算金額變更對執行率的影響
- **警告設定**: alertSettings更新邏輯

#### 4.1.4 BudgetController.deleteBudget 測試重點
- **依賴檢查**: 檢查是否有關聯的監控或分析資料
- **軟刪除**: 保留歷史資料的軟刪除邏輯
- **級聯處理**: 相關警告、統計資料的清理
- **權限驗證**: 預算刪除權限檢查

### 4.2 預算執行模組測試

#### 4.2.1 BudgetService.calculateExecutionRate 測試重點
- **精確計算**: 使用Decimal避免浮點誤差
- **執行率公式**: (已使用金額 / 預算金額) × 100 準確性
- **邊界情況**: 零預算、超支、負數處理
- **效能測試**: 大量預算並發計算效能

#### 4.2.2 BudgetService.calculateRemaining 測試重點
- **剩餘計算**: 預算金額 - 已使用金額準確性
- **日均可用**: 剩餘金額 / 剩餘天數計算
- **預測功能**: 基於當前使用率預測總支出
- **負剩餘**: 超支情況下負剩餘的處理

#### 4.2.3 BudgetController.getBudgetExecution 測試重點
- **執行狀況**: on_track、warning、exceeded、completed狀態
- **統計資料**: usedAmount、remainingAmount、projectedAmount
- **時間計算**: daysElapsed、daysRemaining準確性
- **四模式差異**: 不同模式的執行資訊詳細程度

### 4.3 預算分析模組測試

#### 4.3.1 AnalysisService.analyzeBudgetPerformance 測試重點
- **績效指標**: 達成率、控制率、改善趨勢分析
- **歷史比較**: 與上期、平均值、最佳期間比較
- **週度分析**: 每週預算執行細分統計
- **子科目分析**: 預算內各子科目使用分布

#### 4.3.2 AnalysisService.generateTrendAnalysis 測試重點
- **趨勢計算**: improving、stable、worsening趨勢判斷
- **時間序列**: 多期間趨勢變化分析
- **季節性**: 季節性支出模式識別
- **預測模型**: 基於歷史資料的預算預測

#### 4.3.3 BudgetController.getBudgetAnalysis 測試重點
- **分析報告**: 完整的預算績效分析報告
- **視覺化資料**: 圖表用資料格式正確性
- **建議生成**: 基於分析結果的改善建議
- **模式適配**: 不同模式的分析深度差異

### 4.4 預算監控模組測試

#### 4.4.1 MonitoringService.monitorBudgetExecution 測試重點
- **即時監控**: 預算執行狀況即時更新
- **閾值檢查**: 警告閾值(80%、90%、100%)觸發
- **狀態更新**: 預算狀態自動更新機制
- **效能優化**: 大量預算監控效能

#### 4.4.2 MonitoringService.checkBudgetAlerts 測試重點
- **警告觸發**: 達到閾值時警告正確觸發
- **通知去重**: 避免重複發送相同警告
- **警告級別**: warning、critical級別正確分類
- **通知延遲**: 警告通知的時效性驗證

### 4.5 預算模板模組測試

#### 4.5.1 預算範本管理測試
- **範本建立**: 從現有預算建立範本功能
- **範本應用**: 套用範本快速建立預算
- **範本更新**: 範本修改與版本管理
- **範本分享**: 預設範本與個人範本管理

#### 4.5.2 快速建立功能測試
- **智慧建議**: 基於歷史資料的預算金額建議
- **一鍵建立**: 常用預算類型快速建立
- **批次建立**: 多個預算同時建立功能
- **模式差異**: 不同模式的建立複雜度差異

---

## 5. 詳細測試案例

### 5.1 核心功能測試案例

#### TC-001: 預算列表查詢API綜合篩選測試
**測試函數表頭**:
```dart
/**
 * TC-001: 預算列表綜合篩選查詢測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，新增多維度篩選驗證
 */
Future<void> testGetBudgetsComprehensiveFiltering();
```
- **目的**: 驗證GET /budgets端點多維度篩選功能
- **前置條件**:
  - 測試帳本包含多種類型、狀態、週期的預算
  - JWT token有效
  - 四種用戶模式設定完成
- **測試步驟**:
  1. Expert模式查詢預算列表(包含analytics)
  2. 按type篩選(category、account、tag、total)
  3. 按status篩選(active、completed、exceeded)
  4. 按period篩選(monthly、quarterly、yearly)
  5. Guiding模式查詢相同預算(簡化回應)
- **驗證點**:
  - HTTP狀態碼200
  - 篩選結果準確無誤
  - 分頁資訊正確
  - 四模式回應差異正確

#### TC-002: 預算建立API週期重疊檢測測試
**測試函數表頭**:
```dart
/**
 * TC-002: 預算建立週期重疊檢測測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，強化重疊檢測邏輯
 */
Future<void> testCreateBudgetOverlapDetection();
```
- **目的**: 驗證POST /budgets端點週期重疊檢測
- **前置條件**:
  - 存在已建立的預算
  - 測試重疊週期案例準備
- **測試步驟**:
  1. 建立科目預算(2025-01-01 ~ 2025-01-31)
  2. 嘗試建立同科目重疊預算(2025-01-15 ~ 2025-02-15)
  3. 驗證重疊檢測邏輯正確觸發
  4. 建立不同科目相同週期預算(應成功)
  5. 測試邊界情況(緊鄰週期)
- **驗證點**:
  - HTTP狀態碼409(重疊時)
  - 錯誤訊息描述清楚
  - 重疊檢測邏輯準確
  - 不同科目不受影響

#### TC-003: 預算執行率計算API精確度測試
**測試函數表頭**:
```dart
/**
 * TC-003: 預算執行率精確度計算測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，加強精確度驗證
 */
Future<void> testBudgetExecutionRateAccuracy();
```
- **目的**: 驗證GET /budgets/{id}/execution端點計算精確度
- **前置條件**:
  - 預算已建立且有交易記錄
  - 包含小數點運算案例
- **測試步驟**:
  1. 建立預算金額12000元
  2. 產生使用金額8750.75元的交易
  3. 查詢預算執行狀況
  4. 驗證執行率為72.92%
  5. 驗證剩餘金額為3249.25元
- **驗證點**:
  - 執行率計算絕對精確
  - 剩餘金額計算正確
  - 日均可用預算準確
  - 預測支出合理

### 5.2 預算類型測試案例

#### TC-006: 科目預算特殊邏輯測試
**測試函數表頭**:
```dart
/**
 * TC-006: 科目預算邏輯測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，完善科目預算邏輯
 */
Future<void> testCategoryBudgetLogic();
```
- **目的**: 驗證科目預算特殊邏輯處理
- **前置條件**:
  - 科目預算已建立
  - 包含子科目的交易
- **測試步驟**:
  1. 建立"食物"科目預算
  2. 設定includeSubcategories=true
  3. 在"餐廳"(子科目)產生交易
  4. 驗證父科目預算正確計入子科目支出
  5. 測試子科目分析統計
- **驗證點**:
  - 子科目支出正確計入父預算
  - categoryBreakdown統計準確
  - 子科目分析資料完整
  - 執行率計算包含所有子科目

### 5.3 四模式差異化測試案例

#### TC-010: Expert模式進階分析測試
**測試函數表頭**:
```dart
/**
 * TC-010: Expert模式進階分析測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，新增進階分析功能
 */
Future<void> testExpertModeAdvancedAnalytics();
```
- **目的**: 驗證Expert模式完整分析功能
- **前置條件**:
  - 用戶設定為Expert模式
  - 預算包含豐富歷史資料
- **測試步驟**:
  1. 查詢預算列表(Expert模式)
  2. 驗證analytics欄位包含詳細分析
  3. 檢查historicalPerformance資料
  4. 測試weeklyBreakdown週度分析
  5. 驗證categoryBreakdown子科目分析
- **驗證點**:
  - analytics物件完整顯示
  - 歷史績效比較準確
  - 週度分析資料詳細
  - 子科目分析正確

### 5.4 API端點一致性測試案例

#### TC-014: 8107規格一致性驗證測試
**測試函數表頭**:
```dart
/**
 * TC-014: API規格一致性測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，完整覆蓋7個端點
 */
Future<void> testAPISpecificationConsistency();
```
- **目的**: 驗證實作與8107 API規格完全一致
- **前置條件**:
  - API規格文件可存取
  - 自動化規格比對工具
- **測試步驟**:
  1. 驗證7個端點定義
  2. 檢查請求參數格式與enum值
  3. 驗證回應結構與schema
  4. 測試錯誤碼對應
  5. 檢查HTTP狀態碼標準
- **驗證點**:
  - 端點路徑完全一致
  - 參數enum值符合規格
  - 回應結構符合schema
  - 錯誤處理標準統一

### 5.5 異常處理測試案例

#### TC-016: 預算計算異常處理測試
**測試函數表頭**:
```dart
/**
 * TC-016: 預算計算異常處理測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，強化異常處理
 */
Future<void> testBudgetCalculationExceptionHandling();
```
- **目的**: 驗證預算計算各種異常情況處理
- **前置條件**:
  - 異常測試環境準備
  - 錯誤模擬工具
- **測試步驟**:
  1. 測試零預算金額的執行率計算
  2. 測試負數交易對預算的影響
  3. 測試超大數值的處理邊界
  4. 測試並發計算衝突處理
  5. 驗證異常回復機制
- **驗證點**:
  - 零預算處理適當
  - 負數交易正確處理
  - 數值溢出防護有效
  - 並發衝突正確解決

---

## 6. 效能與壓力測試

### 6.1 預算管理效能

#### 6.1.1 TC-019 單一預算操作效能測試
**測試函數表頭**:
```dart
/**
 * TC-019: 預算操作效能測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，提升效能基準
 */
Future<void> testBudgetOperationPerformance();
```
- **測試目標**: 單次預算操作回應時間 < 1 秒
- **測試方法**:
  - 執行1000次預算CRUD操作
  - 監控每次處理時間
  - 記錄系統資源使用
  - 分析效能瓶頸
- **監控指標**:
  - 平均回應時間
  - 95%百分位回應時間
  - CPU使用率
  - 記憶體使用量
  - 資料庫查詢次數

### 6.2 預算計算能力

#### 6.2.1 TC-020 大量預算並發計算測試
**測試函數表頭**:
```dart
/**
 * TC-020: 複雜計算查詢效能測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，最佳化計算引擎
 */
Future<void> testComplexCalculationQueryPerformance();
```
- **測試目標**: 預算執行率計算回應時間 < 800ms
- **測試方法**:
  - 建立1000個不同類型預算
  - 同時觸發所有預算計算
  - 監控計算時間與準確性
- **驗收標準**:
  - 平均計算時間 < 800ms
  - 計算結果100%準確
  - 記憶體使用增長線性

### 6.3 記憶體使用監控

#### 6.3.1 TC-022 記憶體洩漏測試
**測試函數表頭**:
```dart
/**
 * TC-022: 記憶體洩漏監控測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，強化監控機制
 */
Future<void> testMemoryLeakMonitoring();
```
- **測試目標**: 24小時運行無記憶體洩漏
- **測試方法**:
  - 啟動長時間預算操作測試
  - 每小時記錄記憶體使用量
  - 重點監控計算引擎記憶體使用
- **驗收標準**:
  - 記憶體使用增長 < 5%/24小時
  - 無明顯記憶體洩漏模式

---

## 7. 安全性與權限測試

### 7.1 輸入驗證測試

#### 7.1.1 TC-023 惡意輸入防護測試
**測試函數表頭**:
```dart
/**
 * TC-023: 惡意輸入防護測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，加強安全檢查
 */
Future<void> testMaliciousInputProtection();
```
- **測試目標**: 防護各種惡意輸入攻擊
- **測試方法**:
  - SQL注入攻擊測試
  - XSS攻擊測試(預算名稱、描述)
  - 數值溢出攻擊測試
  - JSON注入攻擊測試
- **安全要求**:
  - 所有惡意輸入被正確過濾
  - 數值邊界檢查有效
  - 錯誤訊息不洩漏敏感資訊

### 7.2 預算權限測試

#### 7.2.1 TC-024 預算存取權限測試
**測試函數表頭**:
```dart
/**
 * TC-024: 預算存取權限測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，強化權限控制
 */
Future<void> testBudgetAccessPermissions();
```
- **測試目標**: 預算存取權限檢查正確
- **測試方法**:
  - 測試跨帳本預算存取
  - 驗證預算修改權限
  - 測試預算刪除權限
- **安全要求**:
  - 無法存取他人預算
  - 帳本權限正確檢查
  - 操作權限嚴格驗證

### 7.3 API安全性測試

#### 7.3.1 TC-025 預算資料保護測試
**測試函數表頭**:
```dart
/**
 * TC-025: 預算資料保護測試
 * @version 2.4.0
 * @date 2025-09-10
 * @update: 升版至2.4.0，完善資料保護
 */
Future<void> testBudgetDataProtection();
```
- **測試目標**: 確保預算資料得到適當保護
- **測試方法**:
  - 檢查日誌中的預算資料洩漏
  - 驗證敏感預算資訊加密
  - 測試資料傳輸安全性
- **保護要求**:
  - 敏感資料不出現在日誌
  - 預算金額適當保護
  - 資料傳輸加密

---

## 附錄

### A. Dart函數版次對照表

| 函數編號 | 函數名稱 | 版次 | 更新日期 | 更新說明 |
|---------|----------|------|----------|----------|
| 01 | getBudgets | v2.4.0 | 2025-09-10 | 四模式差異化回應 |
| 02 | getBudgetDetail | v2.4.0 | 2025-09-10 | 詳細分析資訊 |
| 03 | createBudget | v2.4.0 | 2025-09-10 | 週期重疊檢測 |
| 04 | updateBudget | v2.4.0 | 2025-09-10 | 部分更新邏輯 |
| 05 | deleteBudget | v2.4.0 | 2025-09-10 | 依賴檢查機制 |
| 06 | getBudgetExecution | v2.4.0 | 2025-09-10 | 執行率精確計算 |
| 07 | getBudgetAnalysis | v2.4.0 | 2025-09-10 | 分析報告優化 |
| 08 | calculateExecutionRate | v2.4.0 | 2025-09-10 | Decimal精確計算 |
| 09 | calculateRemaining | v2.4.0 | 2025-09-10 | 剩餘計算邏輯 |
| 10 | analyzeBudgetPerformance | v2.4.0 | 2025-09-10 | 績效分析強化 |
| 11 | generateTrendAnalysis | v2.4.0 | 2025-09-10 | 趨勢分析改進 |
| 12 | monitorBudgetExecution | v2.4.0 | 2025-09-10 | 即時監控優化 |
| 13 | checkBudgetAlerts | v2.4.0 | 2025-09-10 | 警告機制完善 |
| 14 | createBudgetTemplate | v2.4.0 | 2025-09-10 | 範本管理功能 |
| 15 | applyBudgetTemplate | v2.4.0 | 2025-09-10 | 範本應用邏輯 |
| ... | ... | v2.4.0 | 2025-09-10 | 版次統一升級 |

### B. 預算類型對照表

| 預算類型 | 英文代碼 | 中文描述 | 目標設定 | 計算邏輯 |
|----------|----------|----------|----------|----------|
| 科目 | category | 特定科目預算 | categoryId | 科目+子科目 |
| 帳戶 | account | 特定帳戶預算 | accountId | 帳戶交易 |
| 標籤 | tag | 標籤組合預算 | tags[] | 標籤AND邏輯 |
| 總計 | total | 總支出預算 | - | 全部支出 |

### C. 四模式功能對照表

| 功能項目 | Expert | Inertial | Cultivation | Guiding |
|----------|--------|----------|-------------|---------|
| 分析資訊 | 完整analytics | 基本執行狀況 | 成就追蹤 | 極簡顯示 |
| 建立選項 | 全部設定 | 標準設定 | 引導設定 | 自動設定 |
| 警告設定 | 自訂閾值 | 預設閾值 | 智慧建議 | 自動優化 |
| 推薦功能 | 手動選擇 | 基本推薦 | 智慧推薦 | 全自動 |

### D. 預算計算公式

| 計算項目 | 公式 | 說明 | 精確度要求 |
|----------|------|------|------------|
| 執行率 | (已使用/預算金額)×100 | 百分比 | 小數點後2位 |
| 剩餘金額 | 預算金額-已使用金額 | 絕對值 | 精確到分 |
| 日均可用 | 剩餘金額/剩餘天數 | 日平均 | 小數點後2位 |
| 預測支出 | 日均支出×總天數 | 預測值 | 小數點後2位 |

---

**文件版本記錄**:
- v2.4.0 (2025-09-10): 第一階段結構重整與版本升級，按照8408標準重組章節，新增測試案例索引表，升級所有函數版次至v2.4.0，重新設計28個測試案例，重點關注計算精確度、週期重疊檢測、警告機制可靠性、四模式差異化推薦，遵循8088 API設計規範統一回應格式
- v2.3.0 (2025-09-05): 升版建立，基於8207 LLD v2.2.0制定完整測試計劃