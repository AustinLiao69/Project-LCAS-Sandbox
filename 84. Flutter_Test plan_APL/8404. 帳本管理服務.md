# 8404. 帳本管理服務 

**版本**: 2.4.0  
**建立日期**: 2025-09-05  
**最後更新**: 2025-01-28  
**建立者**: SQA Team  
**來源文件**: 8204. 帳本管理服務.md, 8104. 帳本管理服務 API 規格.yaml  
**遵循規範**: 8020. API list.md, 8088. API設計規範.md

---

## 📑 目次 (Table of Contents)

1. [測試概覽](#1-測試概覽)
   - 1.1 [測試範圍](#11-測試範圍)
   - 1.2 [測試目標](#12-測試目標)
   - 1.3 [風險評估](#13-風險評估)

2. [測試案例索引表](#2-測試案例索引表)

3. [測試環境與準備](#3-測試環境與準備)
   - 3.1 [系統環境需求](#31-系統環境需求)
   - 3.2 [測試資料準備](#32-測試資料準備)
   - 3.3 [相依模組狀態](#33-相依模組狀態)

4. [功能測試範圍](#4-功能測試範圍)
   - 4.1 [帳本CRUD模組測試](#41-帳本crud模組測試)
   - 4.2 [協作管理模組測試](#42-協作管理模組測試)
   - 4.3 [權限控制模組測試](#43-權限控制模組測試)
   - 4.4 [衝突解決模組測試](#44-衝突解決模組測試)
   - 4.5 [審計日誌模組測試](#45-審計日誌模組測試)

5. [詳細測試案例](#5-詳細測試案例)
   - 5.1 [核心功能測試案例](#51-核心功能測試案例)
   - 5.2 [協作功能測試案例](#52-協作功能測試案例)
   - 5.3 [四模式差異化測試案例](#53-四模式差異化測試案例)
   - 5.4 [API端點一致性測試案例](#54-api端點一致性測試案例)
   - 5.5 [異常處理測試案例](#55-異常處理測試案例)

6. [效能與壓力測試](#6-效能與壓力測試)
   - 6.1 [帳本管理效能](#61-帳本管理效能)
   - 6.2 [協作處理能力](#62-協作處理能力)
   - 6.3 [記憶體使用監控](#63-記憶體使用監控)

7. [安全性與權限測試](#7-安全性與權限測試)
   - 7.1 [輸入驗證測試](#71-輸入驗證測試)
   - 7.2 [權限控制測試](#72-權限控制測試)
   - 7.3 [API安全性測試](#73-api安全性測試)

---

## 1. 測試概覽

### 1.1 測試範圍

#### 1.1.1 帳本管理服務核心功能測試
- **帳本CRUD操作**：建立、查詢、修改、刪除帳本（14個函數）
- **協作管理**：邀請、權限管理、成員管理（3個函數）
- **權限控制**：檢視、編輯、管理、刪除權限驗證（3個函數）
- **衝突解決**：協作衝突檢測與解決機制（2個函數）
- **審計日誌**：操作審計日誌與追蹤（1個函數）
- **類型管理**：帳本類型查詢與設定（1個函數）

#### 1.1.2 API端點整合測試
- **8104 API規格對應**：14個標準API端點完整驗證
- **8088 API設計規範**：統一回應格式、錯誤處理、JWT認證
- **8020 API list映射**：S-301~S-303畫面功能支援
- **四模式差異化**：Expert、Inertial、Cultivation、Guiding模式測試

#### 1.1.3 Dart語言函數規格測試
- **函數簽名驗證**：24個核心函數版次v2.4.0規格檢查
- **類別設計驗證**：7個主要類別架構完整性
- **介面一致性**：Repository Pattern實作正確性
- **模式適配器**：UserModeAdapter四模式回應過濾

### 1.2 測試目標

#### 1.2.1 功能完整性目標
- 帳本管理服務24個函數100%功能驗證通過
- 協作功能整合性驗證100%相容性確認
- API端點與8104規格100%一致性驗證
- 四模式差異化回應100%準確性驗證

#### 1.2.2 效能指標目標
- 單次帳本操作回應時間 < 1 秒
- 協作邀請處理回應時間 < 2 秒
- 支援500+並發帳本查詢處理
- 記憶體使用率維持 < 80%

#### 1.2.3 穩定性目標
- 系統連續運行24小時無故障
- 帳本操作成功率 > 99.5%
- 協作衝突解決成功率 > 95%
- 資料一致性100%

### 1.3 風險評估

#### 1.3.1 高風險項目
1. **協作衝突處理複雜度**
   - 風險：多使用者同時修改帳本造成資料衝突
   - 影響：帳本資料不一致，協作功能中斷
   - 緩解：完整的衝突檢測與解決機制測試

2. **四模式差異化邏輯**
   - 風險：UserModeAdapter過濾邏輯錯誤
   - 影響：使用者看到不適合其模式的功能
   - 緩解：每個模式的完整回應測試驗證

3. **權限矩陣複雜性**
   - 風險：權限檢查邏輯錯誤或遺漏
   - 影響：資料安全性問題，未授權存取
   - 緩解：完整的權限矩陣測試覆蓋

#### 1.3.2 中風險項目
1. **API端點版本相容性**
   - 風險：8104規格與實作不同步
   - 影響：前端整合失敗
   - 緩解：API規格一致性自動化測試

2. **帳本軟刪除邏輯**
   - 風險：刪除與恢復邏輯不完整
   - 影響：資料意外遺失或無法恢復
   - 緩解：完整的刪除流程測試

---

## 2. 測試案例索引表

| 測試案例編號 | 測試案例名稱 | 測試類型 | 優先級 |
|-------------|-------------|----------|--------|
| TC-001 | 帳本列表查詢API正常流程測試 | 功能測試 | P1 |
| TC-002 | 帳本建立API正常流程測試 | 功能測試 | P1 |
| TC-003 | 協作者邀請API正常流程測試 | 功能測試 | P1 |
| TC-004 | 協作衝突檢測與解決測試 | 協作功能測試 | P1 |
| TC-005 | Expert模式功能完整性測試 | 四模式測試 | P2 |
| TC-006 | Guiding模式簡化功能測試 | 四模式測試 | P2 |
| TC-007 | Inertial模式標準功能測試 | 四模式測試 | P2 |
| TC-008 | Cultivation模式教育功能測試 | 四模式測試 | P2 |
| TC-009 | 8104規格一致性驗證測試 | API一致性測試 | P1 |
| TC-010 | 統一回應格式驗證測試 | API一致性測試 | P1 |
| TC-011 | 權限不足異常處理測試 | 異常處理測試 | P1 |
| TC-012 | 資源不存在異常處理測試 | 異常處理測試 | P1 |
| TC-013 | 協作衝突解決機制測試 | 異常處理測試 | P1 |
| TC-014 | 大量協作處理異常測試 | 異常處理測試 | P2 |
| TC-015 | 帳本操作效能基準測試 | 效能測試 | P2 |
| TC-016 | 高併發協作處理測試 | 效能測試 | P2 |
| TC-017 | 長時間運行穩定性測試 | 效能測試 | P2 |
| TC-018 | 記憶體使用監控測試 | 效能測試 | P2 |
| TC-019 | 惡意輸入防護測試 | 安全性測試 | P1 |
| TC-020 | 權限矩陣完整性測試 | 安全性測試 | P1 |
| TC-021 | JWT Token安全測試 | 安全性測試 | P1 |
| TC-022 | 跨帳本資料隔離測試 | 安全性測試 | P1 |
| TC-023 | API端點權限檢查測試 | 安全性測試 | P1 |
| TC-024 | 敏感資料保護測試 | 安全性測試 | P2 |
| TC-025 | 審計日誌完整性測試 | 安全性測試 | P2 |
| TC-026 | 協作權限變更測試 | 安全性測試 | P2 |

---

## 3. 測試環境與準備

### 2.1 系統環境需求

#### 2.1.1 核心環境
- **Dart SDK**: 3.0.0+ (Flutter 3.13.0+)
- **測試框架**: test ^1.24.0
- **HTTP客戶端**: dio ^5.3.0
- **JSON序列化**: json_annotation ^4.8.0
- **UUID生成**: uuid ^4.0.0

#### 2.1.2 API測試環境
- **測試伺服器**: https://api-staging.lcas.app/v1
- **認證方式**: Bearer Token (JWT)
- **API版本**: v1.0.0
- **回應格式**: JSON (遵循8088規範)

#### 2.1.3 四模式測試環境
- **Expert模式**: 完整功能權限
- **Inertial模式**: 標準功能權限
- **Cultivation模式**: 引導式功能
- **Guiding模式**: 簡化功能集

### 2.2 測試資料準備

#### 2.2.1 使用者測試資料
```dart
// 測試用戶類型 - v2.4.0
const Map<String, TestUser> testUsers = {
  'expertUser': TestUser('test_expert_001', UserMode.Expert),
  'inertialUser': TestUser('test_inertial_001', UserMode.Inertial),
  'cultivationUser': TestUser('test_cultivation_001', UserMode.Cultivation),
  'guidingUser': TestUser('test_guiding_001', UserMode.Guiding),
};
```

#### 2.2.2 帳本測試資料
```dart
// 帳本測試案例 - v2.4.0
const Map<String, CreateLedgerRequest> testLedgers = {
  'personalLedger': CreateLedgerRequest(
    name: '個人測試帳本',
    type: 'personal',
    settings: LedgerSettings(currency: 'TWD')
  ),
  'collaborationLedger': CreateLedgerRequest(
    name: '協作測試帳本',
    type: 'collaboration',
    settings: LedgerSettings(currency: 'TWD')
  ),
};
```

#### 2.2.3 錯誤測試資料
- **無效帳本名稱**: 空字串、超長字串、特殊字元
- **無效帳本類型**: 不支援的類型、空值
- **無效權限設定**: 不存在的角色、權限衝突
- **無效協作邀請**: 無效email、自邀、重複邀請

### 2.3 相依模組狀態

#### 2.3.1 必要依賴模組
- **認證服務**: v2.3.0+ (JWT Token驗證)
- **用戶管理服務**: v2.3.0+ (使用者資訊查詢)
- **通知管理服務**: v2.3.0+ (協作邀請通知)

#### 2.3.2 選用依賴模組
- **報表分析服務**: v2.3.0+ (帳本統計資料)
- **備份服務**: v2.3.0+ (帳本資料備份)

---

## 3. 功能測試範圍

### 3.1 帳本CRUD模組測試

#### 3.1.1 LedgerController.getLedgers 測試重點
- **查詢參數驗證**: type、role、status、search篩選
- **分頁處理**: page、limit參數驗證
- **排序邏輯**: sortBy、sortOrder正確性
- **四模式回應**: Expert詳細統計、Guiding簡化顯示

#### 3.1.2 LedgerController.createLedger 測試重點  
- **輸入資料驗證**: name必填、type枚舉驗證
- **設定處理**: currency、timezone、isDefault邏輯
- **權限設定**: 建立者自動成為owner
- **回應格式**: 符合8088統一格式

#### 3.1.3 LedgerController.updateLedger 測試重點
- **權限檢查**: 需要manage權限才能更新
- **部分更新**: 支援選擇性欄位更新
- **版本衝突**: 並發更新衝突檢測
- **審計記錄**: 更新操作完整記錄

### 3.2 協作管理模組測試

#### 3.2.1 CollaborationService.processInvitation 測試重點
- **邀請驗證**: email格式、使用者存在性檢查
- **權限分配**: role設定、permissions映射
- **通知發送**: 邀請通知正確發送
- **重複邀請**: 防止重複邀請同一使用者

#### 3.2.2 CollaborationService.processPermissionUpdate 測試重點
- **權限驗證**: 只能降低權限、不能提升owner
- **角色轉換**: owner→admin→editor→viewer完整性
- **權限生效**: 更新後立即生效驗證
- **審計追蹤**: 權限變更完整記錄

### 3.3 權限控制模組測試

#### 3.3.1 PermissionService.checkUserPermission 測試重點
- **權限矩陣**: owner/admin/editor/viewer權限正確性
- **動作驗證**: view/edit/manage/delete/invite權限
- **快取機制**: 權限查詢快取有效性
- **即時更新**: 權限變更後快取更新

#### 3.3.2 PermissionService.getUserPermissions 測試重點
- **完整權限**: 回傳使用者所有權限清單
- **權限繼承**: 角色權限正確繼承
- **動態權限**: 特殊情況下權限動態調整
- **效能驗證**: 權限查詢回應時間< 100ms

### 3.4 衝突解決模組測試

#### 3.4.1 ConflictDetection 測試重點
- **衝突類型**: 同時修改、權限衝突、資料版本衝突
- **檢測準確性**: 正確識別各種衝突情況
- **檢測效能**: 大型帳本衝突檢測效能
- **回應格式**: 衝突詳情完整描述

#### 3.4.2 ConflictResolution 測試重點
- **解決策略**: 最後修改勝出、合併策略、手動解決
- **資料一致性**: 解決後資料完整性保證
- **使用者通知**: 衝突解決結果通知
- **回滾機制**: 解決失敗時的回滾處理

### 3.5 審計日誌模組測試

#### 3.5.1 AuditService 測試重點
- **操作記錄**: create/update/delete/invite完整記錄
- **使用者追蹤**: 操作者資訊完整記錄
- **時間戳記**: UTC時間格式正確性
- **查詢效能**: 大量日誌查詢效能測試

---

## 4. 詳細測試案例

### 4.1 核心功能測試案例

#### TC-001: 帳本列表查詢API正常流程測試
**測試函數表頭**:
```dart
/**
 * TC-001: 帳本列表查詢測試
 * @version 2.4.0
 * @date 2025-01-28
 * @update: 升版至2.4.0，強化四模式差異化驗證，新增測試案例索引
 */
Future<void> testGetLedgersNormalFlow();
```
- **目的**: 驗證GET /ledgers端點正常查詢流程
- **前置條件**:
  - 測試用戶已建立多個帳本
  - JWT token有效
  - 四種用戶模式設定完成
- **測試步驟**:
  1. Expert模式查詢帳本列表
  2. 驗證回應包含完整統計資訊
  3. Guiding模式查詢相同帳本
  4. 驗證回應為簡化版本
  5. 測試分頁、排序、篩選參數
- **驗證點**:
  - HTTP狀態碼200
  - 回應格式符合8088規範
  - 四模式回應內容差異正確
  - 分頁資訊正確

#### TC-002: 帳本建立API正常流程測試
**測試函數表頭**:
```dart
/**
 * TC-002: 帳本建立測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化驗證邏輯
 */
Future<void> testCreateLedgerNormalFlow();
```
- **目的**: 驗證POST /ledgers端點帳本建立功能
- **前置條件**:
  - 用戶已認證
  - 測試資料準備完成
- **測試步驟**:
  1. 發送建立個人帳本請求
  2. 驗證帳本成功建立
  3. 發送建立協作帳本請求
  4. 驗證協作功能正確設定
  5. 檢查審計日誌記錄
- **驗證點**:
  - HTTP狀態碼201
  - 帳本ID正確生成
  - 建立者自動設為owner
  - 審計記錄完整

#### TC-003: 協作者邀請API正常流程測試
**測試函數表頭**:
```dart
/**
 * TC-003: 協作者邀請測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，新增通知驗證
 */
Future<void> testInviteCollaboratorsNormalFlow();
```
- **目的**: 驗證POST /ledgers/{id}/invitations端點
- **前置條件**:
  - 協作帳本已建立
  - 邀請者有invite權限
  - 被邀請者用戶存在
- **測試步驟**:
  1. 發送協作者邀請請求
  2. 驗證邀請資料正確儲存
  3. 檢查通知服務調用
  4. 驗證權限正確設定
  5. 測試重複邀請防護
- **驗證點**:
  - HTTP狀態碼200
  - 邀請通知發送
  - 權限設定正確
  - 重複邀請被拒絕

### 4.2 協作功能測試案例

#### TC-004: 協作衝突檢測與解決測試
**測試函數表頭**:
```dart
/**
 * TC-004: 協作衝突處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，優化衝突檢測演算法
 */
Future<void> testCollaborationConflictHandling();
```
- **目的**: 驗證協作衝突檢測與解決機制
- **前置條件**:
  - 多用戶協作帳本
  - 模擬並發修改場景
- **測試步驟**:
  1. 用戶A和B同時修改帳本
  2. 觸發衝突檢測
  3. 驗證衝突正確識別
  4. 執行衝突解決
  5. 檢查解決結果正確性
- **驗證點**:
  - 衝突正確檢測
  - 解決策略有效
  - 資料一致性保證
  - 用戶通知發送

### 4.3 四模式差異化測試案例

#### TC-005: Expert模式功能完整性測試
**測試函數表頭**:
```dart
/**
 * TC-005: Expert模式測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，新增進階功能驗證
 */
Future<void> testExpertModeFeatures();
```
- **目的**: 驗證Expert模式完整功能存取
- **前置條件**:
  - 用戶設定為Expert模式
  - 測試帳本包含完整資料
- **測試步驟**:
  1. 查詢帳本列表（Expert模式）
  2. 驗證統計資訊顯示
  3. 檢查進階功能可用性
  4. 測試詳細審計日誌存取
  5. 驗證協作管理功能
- **驗證點**:
  - 完整統計資訊顯示
  - 所有功能可存取
  - 進階選項可用
  - 審計日誌詳細

#### TC-006: Guiding模式簡化功能測試
**測試函數表頭**:
```dart
/**
 * TC-006: Guiding模式測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，優化簡化邏輯
 */
Future<void> testGuidingModeFeatures();
```
- **目的**: 驗證Guiding模式簡化使用者體驗
- **前置條件**:
  - 用戶設定為Guiding模式
  - 預設設定已配置
- **測試步驟**:
  1. 查詢帳本列表（Guiding模式）
  2. 驗證簡化回應內容
  3. 檢查複雜功能隱藏
  4. 測試預設設定應用
  5. 驗證引導式操作
- **驗證點**:
  - 回應內容簡化
  - 複雜功能不顯示
  - 預設設定正確
  - 操作引導清晰

### 4.4 API端點一致性測試案例

#### TC-007: 8104規格一致性驗證測試
**測試函數表頭**:
```dart
/**
 * TC-007: API規格一致性測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，加強規格檢查
 */
Future<void> testAPISpecificationConsistency();
```
- **目的**: 驗證實作與8104 API規格完全一致
- **前置條件**:
  - API規格文件可存取
  - 自動化規格比對工具
- **測試步驟**:
  1. 驗證13個端點定義
  2. 檢查請求參數格式
  3. 驗證回應結構一致
  4. 測試錯誤碼對應
  5. 檢查HTTP狀態碼
- **驗證點**:
  - 端點路徑正確
  - 參數格式一致
  - 回應結構符合
  - 錯誤處理正確

### 4.5 異常處理測試案例

#### TC-008: 權限不足異常處理測試
**測試函數表頭**:
```dart
/**
 * TC-008: 權限不足處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，完善權限檢查
 */
Future<void> testInsufficientPermissionHandling();
```
- **目的**: 驗證權限不足情況的正確處理
- **前置條件**:
  - 多層級權限用戶
  - 權限矩陣設定完成
- **測試步驟**:
  1. viewer用戶嘗試編輯帳本
  2. editor用戶嘗試刪除帳本
  3. 非成員用戶嘗試存取
  4. 驗證錯誤回應格式
  5. 檢查安全日誌記錄
- **驗證點**:
  - HTTP狀態碼403
  - 錯誤訊息明確
  - 安全日誌記錄
  - 無敏感資訊洩漏

#### TC-009: 資源不存在異常處理測試
**測試函數表頭**:
```dart
/**
 * TC-009: 資源不存在處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，統一錯誤格式
 */
Future<void> testResourceNotFoundHandling();
```
- **目的**: 驗證資源不存在的正確處理
- **前置條件**:
  - 無效資源ID準備
  - 錯誤處理機制啟用
- **測試步驟**:
  1. 查詢不存在的帳本ID
  2. 邀請不存在的用戶
  3. 更新已刪除的帳本
  4. 驗證404錯誤回應
  5. 檢查錯誤訊息內容
- **驗證點**:
  - HTTP狀態碼404
  - 錯誤格式統一
  - 訊息內容明確
  - 無系統資訊洩漏

---

## 5. 效能與壓力測試

### 5.1 帳本管理效能

#### 5.1.1 單一帳本操作效能測試
**測試函數表頭**:
```dart
/**
 * 帳本操作效能測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，提升效能基準
 */
Future<void> testLedgerOperationPerformance();
```
- **測試目標**: 單次帳本操作回應時間 < 1 秒
- **測試方法**:
  - 執行1000次帳本CRUD操作
  - 監控每次處理時間
  - 記錄系統資源使用
  - 分析效能瓶頸
- **監控指標**:
  - 平均回應時間
  - 95%百分位回應時間
  - CPU使用率
  - 記憶體使用量
  - API呼叫次數

### 5.2 協作處理能力

#### 5.2.1 高併發協作測試
**測試函數表頭**:
```dart
/**
 * 高併發協作測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，加強併發處理
 */
Future<void> testHighConcurrencyCollaboration();
```
- **測試目標**: 支援500+併發協作操作
- **測試方法**:
  - 模擬500個用戶同時操作
  - 監控回應時間和成功率
  - 測試資料一致性
- **驗收標準**:
  - 平均回應時間 < 2 秒
  - 成功率 > 99%
  - 無資料競爭或衝突

### 5.3 記憶體使用監控

#### 5.3.1 記憶體洩漏測試
**測試函數表頭**:
```dart
/**
 * 記憶體洩漏監控測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化監控機制
 */
Future<void> testMemoryLeakMonitoring();
```
- **測試目標**: 24小時運行無記憶體洩漏
- **測試方法**:
  - 啟動長時間帳本操作測試
  - 每小時記錄記憶體使用量
  - 分析記憶體增長趨勢
- **驗收標準**:
  - 記憶體使用增長 < 5%/24小時
  - 無明顯記憶體洩漏模式

---

## 6. 安全性與權限測試

### 6.1 輸入驗證測試

#### 6.1.1 惡意輸入防護測試
**測試函數表頭**:
```dart
/**
 * 惡意輸入防護測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，加強安全檢查
 */
Future<void> testMaliciousInputProtection();
```
- **測試目標**: 防護各種惡意輸入攻擊
- **測試方法**:
  - SQL注入攻擊測試
  - XSS攻擊測試
  - 超長輸入測試
  - 特殊字元處理測試
- **安全要求**:
  - 所有惡意輸入被正確過濾
  - 輸入長度限制有效執行
  - 錯誤訊息不洩漏敏感資訊

### 6.2 權限控制測試

#### 6.2.1 權限矩陣完整性測試
**測試函數表頭**:
```dart
/**
 * 權限矩陣測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，完善權限檢查
 */
Future<void> testPermissionMatrixIntegrity();
```
- **測試目標**: 確保權限矩陣完整正確
- **測試方法**:
  - 測試owner/admin/editor/viewer所有權限
  - 驗證權限繼承關係
  - 測試權限邊界條件
- **安全要求**:
  - 權限檢查100%準確
  - 無權限越權問題
  - 權限變更立即生效

### 6.3 API安全性測試

#### 6.3.1 JWT Token安全測試
**測試函數表頭**:
```dart
/**
 * JWT Token安全測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化Token驗證
 */
Future<void> testJWTTokenSecurity();
```
- **測試目標**: 確保JWT Token使用安全
- **測試方法**:
  - 測試過期Token處理
  - 驗證無效Token拒絕
  - 測試Token偽造防護
- **安全要求**:
  - 過期Token完全拒絕
  - 無效Token檢測準確
  - Token偽造無法成功

---

## 附錄

### A. Dart函數版次對照表

| 函數編號 | 函數名稱 | 版次 | 更新日期 | 更新說明 |
|---------|----------|------|----------|----------|
| 01 | getLedgers | v2.4.0 | 2025-01-28 | 強化四模式差異化回應，新增索引機制 |
| 02 | createLedger | v2.4.0 | 2025-01-28 | 強化驗證邏輯，完善錯誤處理 |
| 03 | getLedgerById | v2.4.0 | 2025-01-28 | 優化查詢效能，增強權限檢查 |
| 04 | updateLedger | v2.4.0 | 2025-01-28 | 完善並發控制，強化版本衝突檢測 |
| 05 | deleteLedger | v2.4.0 | 2025-01-28 | 實作軟刪除機制，增強安全性 |
| 06 | getLedgerTypes | v2.4.0 | 2025-01-28 | 新增快取機制，提升回應速度 |
| 07 | getCollaborators | v2.4.0 | 2025-01-28 | 強化權限過濾，優化查詢邏輯 |
| 08 | inviteCollaborator | v2.4.0 | 2025-01-28 | 完善邀請流程，增強通知機制 |
| 09 | updateCollaboratorPermission | v2.4.0 | 2025-01-28 | 強化權限驗證，完善審計追蹤 |
| 10 | removeCollaborator | v2.4.0 | 2025-01-28 | 增強安全檢查，完善清理邏輯 |
| 11 | getLedgerPermissions | v2.4.0 | 2025-01-28 | 優化權限查詢，增強快取機制 |
| 12 | checkUserPermission | v2.4.0 | 2025-01-28 | 完善權限檢查邏輯，提升效能 |
| 13 | getUserPermissions | v2.4.0 | 2025-01-28 | 強化權限繼承，優化回應格式 |
| 14 | detectConflicts | v2.4.0 | 2025-01-28 | 完善衝突檢測演算法，提升準確性 |
| 15 | resolveConflict | v2.4.0 | 2025-01-28 | 強化解決策略，完善通知機制 |
| 16 | getAuditLog | v2.4.0 | 2025-01-28 | 優化日誌查詢，增強過濾功能 |
| 17 | createAuditEntry | v2.4.0 | 2025-01-28 | 完善記錄機制，強化資料完整性 |
| 18 | validateLedgerAccess | v2.4.0 | 2025-01-28 | 強化存取驗證，提升安全性 |
| 19 | processCollaborationRequest | v2.4.0 | 2025-01-28 | 完善協作流程，增強錯誤處理 |
| 20 | syncLedgerData | v2.4.0 | 2025-01-28 | 優化同步機制，完善衝突處理 |
| 21 | backupLedger | v2.4.0 | 2025-01-28 | 新增備份功能，強化資料保護 |
| 22 | restoreLedger | v2.4.0 | 2025-01-28 | 完善恢復機制，增強驗證邏輯 |
| 23 | getLedgerStatistics | v2.4.0 | 2025-01-28 | 優化統計計算，增強效能 |
| 24 | getUserModeAdapter | v2.4.0 | 2025-01-28 | 強化模式適配，完善過濾邏輯 |

### B. API端點與畫面對照表

| API端點 | HTTP方法 | 對應畫面 | 功能描述 |
|---------|----------|----------|----------|
| /ledgers | GET | S-301 | 帳本列表查詢 |
| /ledgers | POST | S-302 | 建立新帳本 |
| /ledgers/{id} | GET | S-301 | 帳本詳情查詢 |
| ... | ... | ... | ... |

### C. 四模式差異化對照表

| 功能項目 | Expert | Inertial | Cultivation | Guiding |
|----------|--------|----------|-------------|---------|
| 統計資訊 | 完整顯示 | 基本顯示 | 進度導向 | 隱藏 |
| 協作功能 | 全部可用 | 基本協作 | 引導協作 | 簡化協作 |
| 設定選項 | 詳細設定 | 標準設定 | 推薦設定 | 預設設定 |

---

**文件版本記錄**:
- v2.4.0 (2025-01-28): 結構重整與版本升級，對齊8408標準目次結構，新增測試案例索引表，升級模組版次至v2.4.0，升級所有函數版次至v2.4.0，建立完整版本追蹤機制
- v2.3.0 (2025-09-05): 升版建立，基於8204 LLD v1.0.0制定完整測試計畫，重點關注四模式差異化、協作功能穩定性、API規格一致性驗證，遵循8088 API設計規範統一回應格式