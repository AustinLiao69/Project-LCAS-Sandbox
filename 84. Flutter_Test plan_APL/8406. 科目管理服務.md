# 8406. 科目管理服務 

**版本**: 2.3.0  
**建立日期**: 2025-09-05  
**最後更新**: 2025-09-05  
**建立者**: SQA Team  
**來源文件**: 8206. 科目管理服務.md, 8106. 科目管理服務 API 規格.yaml  
**遵循規範**: 8020. API list.md, 8088. API設計規範.md

---

## 📑 目次 (Table of Contents)

1. [測試概覽](#1-測試概覽)
   - 1.1 [測試範圍](#11-測試範圍)
   - 1.2 [測試目標](#12-測試目標)
   - 1.3 [風險評估](#13-風險評估)

2. [測試環境與準備](#2-測試環境與準備)
   - 2.1 [系統環境需求](#21-系統環境需求)
   - 2.2 [測試資料準備](#22-測試資料準備)
   - 2.3 [相依模組狀態](#23-相依模組狀態)

3. [功能測試範圍](#3-功能測試範圍)
   - 3.1 [科目CRUD模組測試](#31-科目crud模組測試)
   - 3.2 [階層管理模組測試](#32-階層管理模組測試)
   - 3.3 [科目分類模組測試](#33-科目分類模組測試)
   - 3.4 [使用統計模組測試](#34-使用統計模組測試)
   - 3.5 [個人化設定模組測試](#35-個人化設定模組測試)

4. [詳細測試案例](#4-詳細測試案例)
   - 4.1 [核心功能測試案例](#41-核心功能測試案例)
   - 4.2 [階層結構測試案例](#42-階層結構測試案例)
   - 4.3 [四模式差異化測試案例](#43-四模式差異化測試案例)
   - 4.4 [API端點一致性測試案例](#44-api端點一致性測試案例)
   - 4.5 [異常處理測試案例](#45-異常處理測試案例)

5. [效能與壓力測試](#5-效能與壓力測試)
   - 5.1 [科目管理效能](#51-科目管理效能)
   - 5.2 [階層查詢能力](#52-階層查詢能力)
   - 5.3 [記憶體使用監控](#53-記憶體使用監控)

6. [安全性與權限測試](#6-安全性與權限測試)
   - 6.1 [輸入驗證測試](#61-輸入驗證測試)
   - 6.2 [階層安全測試](#62-階層安全測試)
   - 6.3 [API安全性測試](#63-api安全性測試)

---

## 1. 測試概覽

### 1.1 測試範圍

#### 1.1.1 科目管理服務核心功能測試
- **科目CRUD操作**：建立、查詢、修改、刪除科目（5個函數）
- **階層管理**：科目樹狀結構、父子關係管理（9個函數）
- **科目分類**：收入、支出、轉帳科目類型處理（3個函數）
- **使用統計**：科目使用頻率、金額分析（2個函數）
- **個人化設定**：常用科目、快速選擇、預設科目（4個函數）
- **模式適配**：四模式差異化回應處理（8個函數）

#### 1.1.2 API端點整合測試
- **8106 API規格對應**：5個標準API端點完整驗證
- **8088 API設計規範**：統一回應格式、錯誤處理、JWT認證
- **8020 API list映射**：S-204、S-306畫面功能支援
- **四模式差異化**：Expert、Inertial、Cultivation、Guiding模式測試

#### 1.1.3 Dart語言函數規格測試
- **函數簽名驗證**：31個核心函數版次v2.3.0規格檢查
- **類別設計驗證**：4個主要類別架構完整性
- **介面一致性**：Repository Pattern實作正確性
- **模式適配器**：UserModeAdapter四模式回應過濾

### 1.2 測試目標

#### 1.2.1 功能完整性目標
- 科目管理服務31個函數100%功能驗證通過
- 3種科目類型(income、expense、transfer)完整支援驗證
- API端點與8106規格100%一致性驗證
- 四模式差異化回應100%準確性驗證

#### 1.2.2 效能指標目標
- 單次科目操作回應時間 < 1 秒
- 科目樹狀結構查詢處理回應時間 < 800ms
- 支援1000+併發科目查詢處理
- 記憶體使用率維持 < 80%

#### 1.2.3 穩定性目標
- 系統連續運行24小時無故障
- 科目操作成功率 > 99.5%
- 階層結構一致性 = 100%
- 統計資料準確性 = 100%

### 1.3 風險評估

#### 1.3.1 高風險項目
1. **階層結構一致性**
   - 風險：科目父子關係複雜，容易產生循環引用
   - 影響：樹狀結構錯誤，科目管理功能失效
   - 緩解：完整的階層驗證與循環檢測機制測試

2. **科目刪除級聯處理**
   - 風險：刪除父科目時子科目處理邏輯複雜
   - 影響：資料不一致，關聯交易記錄錯誤
   - 緩解：完整的級聯刪除與依賴檢查測試

3. **使用統計計算精確度**
   - 風險：併發使用下統計計算錯誤
   - 影響：統計資料不準確，影響分析與建議
   - 緩解：完整的統計計算並發控制測試

#### 1.3.2 中風險項目
1. **四模式推薦邏輯**
   - 風險：不同模式的推薦演算法複雜
   - 影響：推薦不適當的科目，使用體驗下降
   - 緩解：每個模式的完整推薦測試驗證

2. **科目名稱重複檢查**
   - 風險：同階層科目名稱重複檢查邏輯錯誤
   - 影響：科目管理混亂，查詢結果不明確
   - 緩解：完整的名稱唯一性檢查測試

---

## 2. 測試環境與準備

### 2.1 系統環境需求

#### 2.1.1 核心環境
- **Dart SDK**: 3.0.0+ (Flutter 3.13.0+)
- **測試框架**: test ^1.24.0
- **HTTP客戶端**: dio ^5.3.0
- **JSON序列化**: json_annotation ^4.8.0
- **UUID生成**: uuid ^4.0.0
- **樹狀結構**: collection ^1.17.0

#### 2.1.2 API測試環境
- **測試伺服器**: https://api-staging.lcas.app/v1
- **認證方式**: Bearer Token (JWT)
- **API版本**: v1.0.0
- **回應格式**: JSON (遵循8088規範)

#### 2.1.3 科目類型測試環境
- **收入科目**: 薪資、投資收益、其他收入
- **支出科目**: 餐飲、交通、購物、娛樂等
- **轉帳科目**: 帳戶間轉移、還款等
- **階層結構**: 最深5層、支援樹狀結構

### 2.2 測試資料準備

#### 2.2.1 使用者測試資料
```dart
// 測試用戶類型 - v2.3.0
const Map<String, TestUser> testUsers = {
  'expertUser': TestUser('test_expert_001', UserMode.Expert),
  'inertialUser': TestUser('test_inertial_001', UserMode.Inertial),
  'cultivationUser': TestUser('test_cultivation_001', UserMode.Cultivation),
  'guidingUser': TestUser('test_guiding_001', UserMode.Guiding),
};
```

#### 2.2.2 科目測試資料
```dart
// 科目測試案例 - v2.3.0
const Map<String, CreateCategoryRequest> testCategories = {
  'incomeCategory': CreateCategoryRequest(
    name: '薪資收入',
    type: CategoryType.income,
    icon: '💰',
    color: '#4CAF50'
  ),
  'expenseParentCategory': CreateCategoryRequest(
    name: '餐飲',
    type: CategoryType.expense,
    icon: '🍽️',
    color: '#FF5722'
  ),
  'expenseChildCategory': CreateCategoryRequest(
    name: '早餐',
    type: CategoryType.expense,
    parentId: 'category-food-parent',
    icon: '🥞',
    color: '#FFC107'
  ),
  'transferCategory': CreateCategoryRequest(
    name: '帳戶轉移',
    type: CategoryType.transfer,
    icon: '🔄',
    color: '#2196F3'
  ),
};
```

#### 2.2.3 階層結構測試資料
```dart
// 複雜階層結構測試 - v2.3.0
const Map<String, CategoryHierarchy> testHierarchies = {
  'normalHierarchy': CategoryHierarchy([
    'Level0: 支出',
    '  Level1: 餐飲',
    '    Level2: 早餐',
    '    Level2: 午餐', 
    '    Level2: 晚餐'
  ]),
  'deepHierarchy': CategoryHierarchy([
    'L0: 投資',
    '  L1: 股票',
    '    L2: 台股',
    '      L3: 金融股',
    '        L4: 銀行股',
    '          L5: 特定銀行'
  ]),
};
```

#### 2.2.4 錯誤測試資料
- **無效科目名稱**: 空字串、超長字串、特殊字元、重複名稱
- **無效階層**: 循環引用、超深階層(>5層)、不存在父科目
- **無效科目類型**: 不支援的類型、空值、錯誤格式
- **無效顏色圖示**: 不符合格式、不存在的圖示

### 2.3 相依模組狀態

#### 2.3.1 必要依賴模組
- **帳本管理服務**: v2.3.0+ (科目所屬帳本驗證)
- **認證服務**: v2.3.0+ (JWT Token驗證)
- **記帳交易服務**: v2.3.0+ (科目使用統計計算)

#### 2.3.2 選用依賴模組
- **報表分析服務**: v2.3.0+ (科目分析統計)
- **預算管理服務**: v2.3.0+ (科目預算關聯)

---

## 3. 功能測試範圍

### 3.1 科目CRUD模組測試

#### 3.1.1 CategoryController.getCategories 測試重點
- **查詢參數驗證**: ledgerId、type、parentId、level篩選
- **樹狀結構**: 階層科目的完整樹狀回應
- **排序邏輯**: sortBy(name/type/usage/amount)正確性
- **四模式回應**: Expert完整統計、Guiding簡化顯示

#### 3.1.2 CategoryController.createCategory 測試重點  
- **輸入資料驗證**: name必填、type枚舉驗證、ledgerId存在性
- **階層設定處理**: parentId驗證、level自動計算
- **重複檢查**: 同階層內科目名稱唯一性
- **預設設定**: 不同模式的預設值應用

#### 3.1.3 CategoryController.updateCategory 測試重點
- **部分更新**: 支援選擇性欄位更新
- **階層調整**: 父科目變更、階層重新計算
- **名稱重複**: 更新後名稱不與同階層科目重複
- **子科目影響**: 父科目變更對子科目的影響

#### 3.1.4 CategoryController.deleteCategory 測試重點
- **依賴檢查**: 檢查是否有子科目或交易記錄
- **級聯處理**: 子科目的處理策略(轉移/刪除)
- **軟刪除**: 有交易記錄時軟刪除邏輯
- **統計更新**: 刪除後統計資料重新計算

### 3.2 階層管理模組測試

#### 3.2.1 CategoryService.buildCategoryTree 測試重點
- **樹狀建構**: 平面科目列表轉換為樹狀結構
- **階層正確性**: 父子關係、level層級正確性
- **循環檢測**: 階層循環引用檢測與防護
- **效能測試**: 大量科目(1000+)樹狀建構效能

#### 3.2.2 CategoryService.validateHierarchy 測試重點
- **循環驗證**: 防止父子關係形成循環
- **深度限制**: 階層深度不超過5層限制
- **權限檢查**: 階層操作權限驗證
- **一致性**: 階層變更後資料一致性

### 3.3 科目分類模組測試

#### 3.3.1 三種科目類型處理測試
- **收入科目**: income類型特定功能與限制
- **支出科目**: expense類型特定功能與限制  
- **轉帳科目**: transfer類型特定功能與限制
- **類型轉換**: 科目類型變更的限制與邏輯

#### 3.3.2 科目類型驗證測試
- **類型一致性**: 父子科目類型一致性檢查
- **使用限制**: 不同類型科目的使用限制
- **統計區分**: 按類型分別統計功能
- **預設科目**: 系統預設科目類型管理

### 3.4 使用統計模組測試

#### 3.4.1 StatisticsService.calculateUsageStatistics 測試重點
- **使用次數**: 科目使用次數統計準確性
- **金額統計**: 總金額、平均金額計算準確性
- **時間區間**: 不同時間區間統計正確性
- **並發處理**: 並發使用下統計計算正確性

#### 3.4.2 StatisticsService.generateUsageReport 測試重點
- **報告生成**: 多科目使用報告生成
- **排名計算**: 使用頻率排名計算準確性
- **習慣分析**: Cultivation模式習慣分析功能
- **快取機制**: 統計結果快取有效性

### 3.5 個人化設定模組測試

#### 3.5.1 快速存取功能測試
- **常用科目**: 常用科目列表自動維護
- **最近使用**: 最近使用科目記錄更新
- **智慧建議**: 基於使用模式的智慧建議
- **個人化排序**: 個人化科目排序功能

#### 3.5.2 預設科目管理測試
- **預設設定**: 用戶預設科目設定功能
- **快速選擇**: 記帳時預設科目快速選擇
- **模式差異**: 不同模式預設科目策略
- **同步更新**: 預設科目變更同步更新

---

## 4. 詳細測試案例

### 4.1 核心功能測試案例

#### TC-001: 科目列表查詢API樹狀結構測試
**測試函數表頭**:
```dart
/**
 * TC-001: 科目列表樹狀結構查詢測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，新增樹狀結構驗證
 */
Future<void> testGetCategoriesTreeStructure();
```
- **目的**: 驗證GET /categories端點樹狀結構回應
- **前置條件**:
  - 測試帳本包含多層級科目
  - JWT token有效
  - 四種用戶模式設定完成
- **測試步驟**:
  1. Expert模式查詢科目列表
  2. 驗證tree欄位包含完整樹狀結構
  3. 驗證每個節點的children欄位正確
  4. Guiding模式查詢相同科目
  5. 驗證簡化的平面結構回應
- **驗證點**:
  - HTTP狀態碼200
  - 樹狀結構層級正確
  - 父子關係完整無誤
  - 四模式回應差異正確

#### TC-002: 科目建立API階層處理測試
**測試函數表頭**:
```dart
/**
 * TC-002: 科目建立階層處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化階層驗證
 */
Future<void> testCreateCategoryHierarchyHandling();
```
- **目的**: 驗證POST /categories端點階層處理功能
- **前置條件**:
  - 父科目已存在
  - 階層深度未超過限制
- **測試步驟**:
  1. 建立根層級科目(無parentId)
  2. 建立二層科目(指定parentId)
  3. 驗證level欄位自動計算
  4. 建立超深層科目(測試限制)
  5. 驗證階層限制錯誤處理
- **驗證點**:
  - HTTP狀態碼201
  - level欄位計算正確
  - path欄位完整路徑正確
  - 階層限制有效執行

#### TC-003: 科目刪除API級聯處理測試
**測試函數表頭**:
```dart
/**
 * TC-003: 科目刪除級聯處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，完善級聯邏輯
 */
Future<void> testDeleteCategoryCascadeHandling();
```
- **目的**: 驗證DELETE /categories/{id}端點級聯處理
- **前置條件**:
  - 科目有子科目或交易記錄
  - 使用者有刪除權限
- **測試步驟**:
  1. 刪除無子科目無交易記錄科目
  2. 刪除有子科目無交易記錄科目
  3. 刪除無子科目有交易記錄科目
  4. 刪除有子科目有交易記錄科目
  5. 驗證各種情況處理策略
- **驗證點**:
  - 適當的HTTP狀態碼
  - 子科目處理策略正確
  - 交易記錄影響考慮
  - 級聯操作完整性

### 4.2 階層結構測試案例

#### TC-004: 階層循環檢測測試
**測試函數表頭**:
```dart
/**
 * TC-004: 階層循環檢測測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，優化檢測演算法
 */
Future<void> testHierarchyCycleDetection();
```
- **目的**: 驗證階層結構循環引用檢測
- **前置條件**:
  - 多層級科目結構存在
  - 循環檢測機制啟用
- **測試步驟**:
  1. 嘗試建立A->B->A的循環結構
  2. 嘗試建立A->B->C->A的複雜循環
  3. 驗證循環檢測演算法正確性
  4. 測試深層循環檢測性能
  5. 驗證錯誤訊息明確性
- **驗證點**:
  - 循環正確檢測並拒絕
  - HTTP狀態碼400
  - 錯誤訊息描述清楚
  - 檢測效能可接受

#### TC-005: 科目樹建構效能測試
**測試函數表頭**:
```dart
/**
 * TC-005: 科目樹建構效能測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，提升效能基準
 */
Future<void> testCategoryTreeBuildingPerformance();
```
- **目的**: 驗證大量科目樹狀結構建構效能
- **前置條件**:
  - 測試帳本包含1000+科目
  - 多層級複雜結構
- **測試步驟**:
  1. 查詢包含1000個科目的樹狀結構
  2. 監控樹狀建構處理時間
  3. 測試記憶體使用量
  4. 測試不同階層深度影響
  5. 驗證建構結果正確性
- **驗證點**:
  - 建構時間 < 800ms
  - 記憶體使用合理
  - 樹狀結構完整正確
  - 效能隨規模線性增長

### 4.3 四模式差異化測試案例

#### TC-006: Expert模式完整功能測試
**測試函數表頭**:
```dart
/**
 * TC-006: Expert模式科目管理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，新增進階統計功能
 */
Future<void> testExpertModeCategoryFeatures();
```
- **目的**: 驗證Expert模式完整功能存取
- **前置條件**:
  - 用戶設定為Expert模式
  - 科目包含完整統計資料
- **測試步驟**:
  1. 查詢科目列表(Expert模式)
  2. 驗證完整統計資訊顯示
  3. 檢查樹狀結構完整性
  4. 測試進階管理功能
  5. 驗證批次操作支援
- **驗證點**:
  - 統計資訊包含usage、amount、rank
  - 樹狀結構完整顯示
  - 進階設定選項可用
  - 批次操作功能正常

#### TC-007: Guiding模式簡化體驗測試
**測試函數表頭**:
```dart
/**
 * TC-007: Guiding模式簡化測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，優化簡化邏輯
 */
Future<void> testGuidingModeSimplifiedExperience();
```
- **目的**: 驗證Guiding模式簡化使用者體驗
- **前置條件**:
  - 用戶設定為Guiding模式
  - 預設科目設定完成
- **測試步驟**:
  1. 查詢科目列表(Guiding模式)
  2. 驗證簡化平面結構回應
  3. 檢查複雜功能隱藏
  4. 測試預設科目推薦
  5. 驗證簡化建立流程
- **驗證點**:
  - 不包含樹狀結構(tree)
  - 統計資訊簡化或隱藏
  - 科目數量限制在必要範圍
  - 預設推薦科目正確

#### TC-008: Cultivation模式習慣分析測試
**測試函數表頭**:
```dart
/**
 * TC-008: Cultivation模式習慣分析測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，新增習慣分析功能
 */
Future<void> testCultivationModeHabitsAnalysis();
```
- **目的**: 驗證Cultivation模式習慣分析功能
- **前置條件**:
  - 用戶設定為Cultivation模式
  - 有足夠使用歷史資料
- **測試步驟**:
  1. 查詢科目列表(Cultivation模式)
  2. 驗證habits欄位包含使用模式分析
  3. 檢查frequencyPattern分析正確性
  4. 測試時間偏好(preferredTimeSlots)
  5. 驗證個人化建議準確性
- **驗證點**:
  - habits物件包含完整分析
  - 使用頻率模式準確
  - 時間偏好分析合理
  - 建議具有教育意義

### 4.4 API端點一致性測試案例

#### TC-009: 8106規格一致性驗證測試
**測試函數表頭**:
```dart
/**
 * TC-009: API規格一致性測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，完整覆蓋5個端點
 */
Future<void> testAPISpecificationConsistency();
```
- **目的**: 驗證實作與8106 API規格完全一致
- **前置條件**:
  - API規格文件可存取
  - 自動化規格比對工具
- **測試步驟**:
  1. 驗證5個端點定義
  2. 檢查請求參數格式與enum值
  3. 驗證回應結構與schema
  4. 測試錯誤碼對應
  5. 檢查HTTP狀態碼標準
- **驗證點**:
  - 端點路徑完全一致
  - 參數enum值符合規格
  - 回應結構符合schema
  - 錯誤處理標準統一

### 4.5 異常處理測試案例

#### TC-010: 階層結構異常處理測試
**測試函數表頭**:
```dart
/**
 * TC-010: 階層結構異常處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化異常處理
 */
Future<void> testHierarchyExceptionHandling();
```
- **目的**: 驗證階層結構各種異常情況處理
- **前置條件**:
  - 異常測試環境準備
  - 錯誤模擬工具
- **測試步驟**:
  1. 測試不存在父科目建立子科目
  2. 測試超過5層深度限制
  3. 測試移動科目造成循環
  4. 測試併發階層修改衝突
  5. 驗證異常回復機制
- **驗證點**:
  - HTTP狀態碼400/409正確
  - 錯誤訊息明確詳細
  - 資料一致性保證
  - 異常不影響其他科目

#### TC-011: 科目統計異常處理測試
**測試函數表頭**:
```dart
/**
 * TC-011: 科目統計異常處理測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，完善統計容錯
 */
Future<void> testCategoryStatisticsExceptionHandling();
```
- **目的**: 驗證科目統計計算異常處理
- **前置條件**:
  - 統計資料完整性測試環境
  - 異常資料注入工具
- **測試步驟**:
  1. 測試統計資料缺失情況
  2. 測試並發統計更新衝突
  3. 測試統計計算溢出處理
  4. 測試歷史資料不完整
  5. 驗證統計修復機制
- **驗證點**:
  - 統計缺失時優雅降級
  - 並發衝突正確解決
  - 異常值處理適當
  - 自動修復機制有效

---

## 5. 效能與壓力測試

### 5.1 科目管理效能

#### 5.1.1 單一科目操作效能測試
**測試函數表頭**:
```dart
/**
 * 科目操作效能測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，提升效能基準
 */
Future<void> testCategoryOperationPerformance();
```
- **測試目標**: 單次科目操作回應時間 < 1 秒
- **測試方法**:
  - 執行1000次科目CRUD操作
  - 監控每次處理時間
  - 記錄系統資源使用
  - 分析效能瓶頸
- **監控指標**:
  - 平均回應時間
  - 95%百分位回應時間
  - CPU使用率
  - 記憶體使用量
  - 資料庫查詢次數

### 5.2 階層查詢能力

#### 5.2.1 大型樹狀結構查詢測試
**測試函數表頭**:
```dart
/**
 * 大型樹狀結構查詢測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，最佳化樹建構
 */
Future<void> testLargeTreeStructureQuery();
```
- **測試目標**: 樹狀結構查詢回應時間 < 800ms
- **測試方法**:
  - 建立1000+科目的複雜樹狀結構
  - 測試完整樹狀查詢效能
  - 測試部分樹狀查詢效能
- **驗收標準**:
  - 平均樹建構時間 < 800ms
  - 記憶體使用增長線性
  - 查詢結果完整正確

#### 5.2.2 階層深度查詢效能測試
**測試函數表頭**:
```dart
/**
 * 階層深度查詢效能測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，優化深度查詢
 */
Future<void> testHierarchyDepthQueryPerformance();
```
- **測試目標**: 不同深度階層查詢效能穩定
- **測試方法**:
  - 測試1-5層不同深度查詢
  - 監控查詢時間隨深度變化
  - 測試路徑查詢效能
- **驗收標準**:
  - 深度查詢時間增長可控
  - 路徑計算準確快速
  - 深層查詢不影響系統穩定

### 5.3 記憶體使用監控

#### 5.3.1 記憶體洩漏測試
**測試函數表頭**:
```dart
/**
 * 記憶體洩漏監控測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化監控機制
 */
Future<void> testMemoryLeakMonitoring();
```
- **測試目標**: 24小時運行無記憶體洩漏
- **測試方法**:
  - 啟動長時間科目操作測試
  - 每小時記錄記憶體使用量
  - 分析記憶體增長趨勢
  - 重點監控樹狀結構建構
- **驗收標準**:
  - 記憶體使用增長 < 5%/24小時
  - 無明顯記憶體洩漏模式

---

## 6. 安全性與權限測試

### 6.1 輸入驗證測試

#### 6.1.1 惡意輸入防護測試
**測試函數表頭**:
```dart
/**
 * 惡意輸入防護測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，加強安全檢查
 */
Future<void> testMaliciousInputProtection();
```
- **測試目標**: 防護各種惡意輸入攻擊
- **測試方法**:
  - SQL注入攻擊測試
  - XSS攻擊測試(科目名稱、描述)
  - 超長輸入測試
  - 特殊字元處理測試
  - JSON注入攻擊測試
- **安全要求**:
  - 所有惡意輸入被正確過濾
  - 輸入長度限制有效執行
  - 錯誤訊息不洩漏敏感資訊

### 6.2 階層安全測試

#### 6.2.1 階層權限檢查測試
**測試函數表頭**:
```dart
/**
 * 階層權限檢查測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，強化權限控制
 */
Future<void> testHierarchyPermissionControl();
```
- **測試目標**: 階層操作權限檢查正確
- **測試方法**:
  - 測試跨帳本階層操作
  - 驗證子科目權限繼承
  - 測試階層修改權限
- **安全要求**:
  - 無法操作他人帳本科目
  - 階層權限檢查嚴格
  - 權限繼承邏輯正確

### 6.3 API安全性測試

#### 6.3.1 科目存取權限測試
**測試函數表頭**:
```dart
/**
 * 科目存取權限測試
 * @version 2.3.0
 * @date 2025-09-05
 * @update: 升版至2.3.0，完善權限檢查
 */
Future<void> testCategoryAccessPermissions();
```
- **測試目標**: 確保科目存取權限正確
- **測試方法**:
  - 測試跨使用者科目存取
  - 驗證帳本權限檢查
  - 測試停用科目存取
- **安全要求**:
  - 無法存取他人科目
  - 帳本權限正確檢查
  - 停用科目適當處理

---

## 附錄

### A. Dart函數版次對照表

| 函數編號 | 函數名稱 | 版次 | 更新日期 | 更新說明 |
|---------|----------|------|----------|----------|
| 01 | getCategories | v2.3.0 | 2025-09-05 | 四模式差異化回應 |
| 02 | getCategoryDetail | v2.3.0 | 2025-09-05 | 詳細統計資訊 |
| 03 | createCategory | v2.3.0 | 2025-09-05 | 階層驗證強化 |
| ... | ... | v2.3.0 | 2025-09-05 | 版次統一升級 |

### B. 科目類型對照表

| 科目類型 | 英文代碼 | 中文描述 | 使用場景 | 階層支援 |
|----------|----------|----------|----------|----------|
| 收入 | income | 薪資、獎金、投資收益等 | 資金流入 | 支援 |
| 支出 | expense | 餐飲、交通、購物等 | 資金支出 | 支援 |
| 轉帳 | transfer | 帳戶間轉移、還款等 | 資金轉移 | 限制 |

### C. 四模式功能對照表

| 功能項目 | Expert | Inertial | Cultivation | Guiding |
|----------|--------|----------|-------------|---------|
| 統計資訊 | 完整詳細 | 基本統計 | 習慣分析 | 隱藏 |
| 樹狀結構 | 完整樹狀 | 基本樹狀 | 簡化結構 | 平面列表 |
| 建立選項 | 全部選項 | 標準選項 | 引導選項 | 簡化選項 |
| 推薦功能 | 手動選擇 | 基本推薦 | 智慧推薦 | 自動推薦 |

### D. 階層深度限制

| 項目 | 限制值 | 檢查點 | 錯誤處理 |
|------|--------|--------|----------|
| 最大深度 | 5層 | 建立/移動時 | HTTP 400 |
| 循環檢測 | 強制 | 階層變更時 | HTTP 409 |
| 子科目數量 | 無限制 | - | - |
| 路徑長度 | 200字元 | 計算時 | 自動截斷 |

---

**文件版本記錄**:
- v2.3.0 (2025-09-05): 升版建立，基於8206 LLD v2.2.0制定完整測試計劃，重點關注階層結構一致性、樹狀查詢效能、四模式推薦準確性、API規格一致性驗證，遵循8088 API設計規範統一回應格式