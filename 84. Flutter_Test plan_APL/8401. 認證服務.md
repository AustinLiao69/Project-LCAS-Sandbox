# 8401. èªè­‰æœå‹™æ¸¬è©¦è¨ˆç•«

**æ¨¡çµ„ç‰ˆæ¬¡**: v2.0.0  
**å»ºç«‹æ—¥æœŸ**: 2025-08-28  
**æ›´æ–°æ—¥æœŸ**: 2025-08-28  
**æ–‡ä»¶æè¿°**: LCAS 2.0 èªè­‰æœå‹™ API æ¨¡çµ„å®Œæ•´æ¸¬è©¦è¨ˆç•« - æ¶µè“‹åŠŸèƒ½æ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ã€å››æ¨¡å¼æ¸¬è©¦ã€å®‰å…¨æ€§æ¸¬è©¦ã€æ•ˆèƒ½æ¸¬è©¦

---

## ğŸ“‹ ç›®æ¬¡ (Table of Contents)

### [1. æ¸¬è©¦è¨ˆç•«ç¸½è¦½](#1-æ¸¬è©¦è¨ˆç•«ç¸½è¦½)
- [1.1 æ¸¬è©¦ç¯„åœ](#11-æ¸¬è©¦ç¯„åœ)
- [1.2 æ¸¬è©¦ç›®æ¨™](#12-æ¸¬è©¦ç›®æ¨™)
- [1.3 è¦ç¯„éµå¾ª](#13-è¦ç¯„éµå¾ª)

### [2. æ¸¬è©¦ç’°å¢ƒé…ç½®](#2-æ¸¬è©¦ç’°å¢ƒé…ç½®)
- [2.1 ç’°å¢ƒè¨­å®š](#21-ç’°å¢ƒè¨­å®š)
- [2.2 æ¸¬è©¦å·¥å…·](#22-æ¸¬è©¦å·¥å…·)
- [2.3 æ¨¡æ“¬è³‡æ–™](#23-æ¨¡æ“¬è³‡æ–™)

### [3. åŠŸèƒ½æ¸¬è©¦](#3-åŠŸèƒ½æ¸¬è©¦)
- [3.1 ä½¿ç”¨è€…è¨»å†ŠAPIæ¸¬è©¦](#31-ä½¿ç”¨è€…è¨»å†Šapiæ¸¬è©¦)
- [3.2 ä½¿ç”¨è€…ç™»å…¥APIæ¸¬è©¦](#32-ä½¿ç”¨è€…ç™»å…¥apiæ¸¬è©¦)
- [3.3 Googleç™»å…¥APIæ¸¬è©¦](#33-googleç™»å…¥apiæ¸¬è©¦)
- [3.4 ç™»å‡ºAPIæ¸¬è©¦](#34-ç™»å‡ºapiæ¸¬è©¦)
- [3.5 Tokenåˆ·æ–°APIæ¸¬è©¦](#35-tokenåˆ·æ–°apiæ¸¬è©¦)
- [3.6 å¿˜è¨˜å¯†ç¢¼APIæ¸¬è©¦](#36-å¿˜è¨˜å¯†ç¢¼apiæ¸¬è©¦)
- [3.7 é©—è­‰é‡è¨­Token APIæ¸¬è©¦](#37-é©—è­‰é‡è¨­token-apiæ¸¬è©¦)
- [3.8 é‡è¨­å¯†ç¢¼APIæ¸¬è©¦](#38-é‡è¨­å¯†ç¢¼apiæ¸¬è©¦)
- [3.9 Emailé©—è­‰APIæ¸¬è©¦](#39-emailé©—è­‰apiæ¸¬è©¦)
- [3.10 LINEç¶å®šAPIæ¸¬è©¦](#310-lineç¶å®šapiæ¸¬è©¦)
- [3.11 ç¶å®šç‹€æ…‹APIæ¸¬è©¦](#311-ç¶å®šç‹€æ…‹apiæ¸¬è©¦)

### [4. æ•´åˆæ¸¬è©¦](#4-æ•´åˆæ¸¬è©¦)
- [4.1 ç«¯åˆ°ç«¯æµç¨‹æ¸¬è©¦](#41-ç«¯åˆ°ç«¯æµç¨‹æ¸¬è©¦)
- [4.2 æŠ½è±¡é¡åˆ¥å”ä½œæ¸¬è©¦](#42-æŠ½è±¡é¡åˆ¥å”ä½œæ¸¬è©¦)

### [5. å››æ¨¡å¼å·®ç•°åŒ–æ¸¬è©¦](#5-å››æ¨¡å¼å·®ç•°åŒ–æ¸¬è©¦)
- [5.1 å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–](#51-å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–)
- [5.2 å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–](#52-å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–)

### [6. å®‰å…¨æ€§æ¸¬è©¦](#6-å®‰å…¨æ€§æ¸¬è©¦)
- [6.1 å¯†ç¢¼å®‰å…¨æ€§é©—è­‰](#61-å¯†ç¢¼å®‰å…¨æ€§é©—è­‰)
- [6.2 Tokenå®‰å…¨æ€§é©—è­‰](#62-tokenå®‰å…¨æ€§é©—è­‰)

### [7. æ•ˆèƒ½æ¸¬è©¦](#7-æ•ˆèƒ½æ¸¬è©¦)
- [7.1 APIå›æ‡‰æ™‚é–“æ¸¬è©¦](#71-apiå›æ‡‰æ™‚é–“æ¸¬è©¦)
- [7.2 ä½µç™¼è™•ç†èƒ½åŠ›æ¸¬è©¦](#72-ä½µç™¼è™•ç†èƒ½åŠ›æ¸¬è©¦)

### [8. ç•°å¸¸æ¸¬è©¦](#8-ç•°å¸¸æ¸¬è©¦)
- [8.1 ç¶²è·¯é€£æ¥ç•°å¸¸è™•ç†](#81-ç¶²è·¯é€£æ¥ç•°å¸¸è™•ç†)
- [8.2 æœå‹™è¶…æ™‚è™•ç†](#82-æœå‹™è¶…æ™‚è™•ç†)

### [9. æ¸¬è©¦è¦†è“‹ç‡å ±å‘Š](#9-æ¸¬è©¦è¦†è“‹ç‡å ±å‘Š)
- [9.1 APIç«¯é»è¦†è“‹ç‡](#91-apiç«¯é»è¦†è“‹ç‡)
- [9.2 åŠŸèƒ½è¦†è“‹ç‡çµ±è¨ˆ](#92-åŠŸèƒ½è¦†è“‹ç‡çµ±è¨ˆ)

### [10. æ¸¬è©¦åŸ·è¡Œèªªæ˜](#10-æ¸¬è©¦åŸ·è¡Œèªªæ˜)
- [10.1 åŸ·è¡Œå‘½ä»¤](#101-åŸ·è¡Œå‘½ä»¤)
- [10.2 å ±å‘Šç”Ÿæˆ](#102-å ±å‘Šç”Ÿæˆ)

---

## 1. æ¸¬è©¦è¨ˆç•«ç¸½è¦½

### 1.1 æ¸¬è©¦ç¯„åœ

æœ¬æ¸¬è©¦è¨ˆç•«é‡å° **8301 èªè­‰æœå‹™æ¨¡çµ„ V2.0.0** é€²è¡Œå…¨é¢æ¸¬è©¦ï¼Œæ¶µè“‹ï¼š

#### **APIç«¯é»æ¸¬è©¦**
- **11å€‹èªè­‰APIç«¯é»**å®Œæ•´åŠŸèƒ½é©—è­‰
- **93å€‹æŠ½è±¡æ–¹æ³•**æ¸¬è©¦è¦†è“‹
- **13å€‹æŠ½è±¡é¡åˆ¥**å”ä½œæ¸¬è©¦

#### **æ¸¬è©¦é¡å‹**
- âœ… **åŠŸèƒ½æ¸¬è©¦**ï¼šæ‰€æœ‰APIç«¯é»æ­£å¸¸èˆ‡ç•°å¸¸æµç¨‹
- âœ… **æ•´åˆæ¸¬è©¦**ï¼šè·¨æ¨¡çµ„å”ä½œé©—è­‰
- âœ… **å››æ¨¡å¼æ¸¬è©¦**ï¼šExpertã€Inertialã€Cultivationã€Guidingå·®ç•°åŒ–é©—è­‰
- âœ… **å®‰å…¨æ€§æ¸¬è©¦**ï¼šTokenç®¡ç†ã€å¯†ç¢¼è™•ç†ã€OAuthæ•´åˆ
- âœ… **æ•ˆèƒ½æ¸¬è©¦**ï¼šå›æ‡‰æ™‚é–“ã€ä½µç™¼è™•ç†èƒ½åŠ›
- âœ… **ç•°å¸¸æ¸¬è©¦**ï¼šéŒ¯èª¤è™•ç†å’Œæ¢å¾©æ©Ÿåˆ¶

### 1.2 æ¸¬è©¦ç›®æ¨™

#### **åŠŸèƒ½å®Œæ•´æ€§ç›®æ¨™**
- âœ… æ‰€æœ‰APIç«¯é»100%åŠŸèƒ½é©—è­‰é€šé
- âœ… å››æ¨¡å¼å·®ç•°åŒ–å›æ‡‰æ©Ÿåˆ¶100%é©—è­‰
- âœ… è³‡æ–™æ¨¡å‹å®Œå…¨ç¬¦åˆ8101è¦æ ¼
- âœ… éŒ¯èª¤è™•ç†æ¶µè“‹æ‰€æœ‰AuthErrorCodeé¡å‹

#### **æ•ˆèƒ½æŒ‡æ¨™ç›®æ¨™**
- â±ï¸ APIå¹³å‡å›æ‡‰æ™‚é–“ < 2ç§’
- ğŸš€ ä½µç™¼è™•ç†èƒ½åŠ›æ”¯æ´10+åŒæ™‚è«‹æ±‚
- ğŸ”’ Tokenå®‰å…¨æ€§é©—è­‰100%é€šé
- ğŸ“Š æ¸¬è©¦è¦†è“‹ç‡ > 95%

#### **å“è³ªä¿è­‰ç›®æ¨™**
- ğŸ¯ å–®å…ƒæ¸¬è©¦é€šéç‡100%
- ğŸ”— æ•´åˆæ¸¬è©¦é€šéç‡ > 95%
- ğŸ›¡ï¸ å®‰å…¨æ€§æ¸¬è©¦é›¶æ¼æ´
- âš¡ æ•ˆèƒ½æ¸¬è©¦ç¬¦åˆéœ€æ±‚

### 1.3 è¦ç¯„éµå¾ª

æœ¬æ¸¬è©¦è¨ˆç•«åš´æ ¼éµå¾ªä»¥ä¸‹è¦ç¯„ï¼š

- âœ… **8020è¦ç¯„**ï¼šåƒ…æ¸¬è©¦11å€‹èªè­‰ç«¯é»ï¼Œä¸è¶…å‡ºè¦ç¯„ç¯„åœ
- âœ… **8088è¦ç¯„**ï¼šçµ±ä¸€å›æ‡‰æ ¼å¼å’Œå››æ¨¡å¼æ”¯æ´æ¸¬è©¦
- âœ… **8101è¦ç¯„**ï¼šå®Œæ•´è³‡æ–™æ¨¡å‹å’ŒéŒ¯èª¤è™•ç†æ¸¬è©¦
- âœ… **8201è¦ç¯„**ï¼šæŠ½è±¡é¡åˆ¥å’Œæ–¹æ³•å¯¦ä½œé©—è­‰

---

## 2. æ¸¬è©¦ç’°å¢ƒé…ç½®

### 2.1 ç’°å¢ƒè¨­å®š

#### **æ¸¬è©¦ç’°å¢ƒè®Šæ•¸**
```dart
class TestEnvironmentConfig {
  static const String testApiUrl = 'https://test-api.lcas.app';
  static const String mockUserId = 'test-user-123';
  static const String mockRequestId = 'req-test-456';
}
```

#### **åˆå§‹åŒ–è¨­å®š**
```dart
/// 01. åˆå§‹åŒ–æ¸¬è©¦ç’°å¢ƒ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: å»ºç«‹å®Œæ•´æ¸¬è©¦ç’°å¢ƒé…ç½®
static Future<void> setupTestEnvironment() async {
  // åˆå§‹åŒ–æ¨¡æ“¬è³‡æ–™
  await _initMockData();

  // è¨­å®šæ¸¬è©¦ç”¨æˆ¶æ¨¡å¼
  await _setupTestUserModes();

  // é…ç½®æ¨¡æ“¬æœå‹™
  await _configureMockServices();
}
```

### 2.2 æ¸¬è©¦å·¥å…·

#### **æ¨¡æ“¬é¡åˆ¥å®šç¾©**
```dart
/// æ¨¡æ“¬èªè­‰æœå‹™
class MockAuthService extends Mock implements AuthService {}

/// æ¨¡æ“¬Tokenæœå‹™
class MockTokenService extends Mock implements TokenService {}

/// æ¨¡æ“¬ä½¿ç”¨è€…æ¨¡å¼é©é…å™¨
class MockUserModeAdapter extends Mock implements UserModeAdapter {}

/// æ¨¡æ“¬å®‰å…¨æœå‹™
class MockSecurityService extends Mock implements SecurityService {}
```

### 2.3 æ¨¡æ“¬è³‡æ–™

#### **æ¸¬è©¦è³‡æ–™ç”Ÿæˆå™¨**
```dart
/// 02. ç”Ÿæˆæ¸¬è©¦ç”¨æˆ¶è³‡æ–™
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: æä¾›å®Œæ•´æ¸¬è©¦è³‡æ–™ç”Ÿæˆ
static RegisterRequest createTestRegisterRequest({
  UserMode userMode = UserMode.expert,
  String? email,
  String? password,
}) {
  return RegisterRequest(
    email: email ?? 'test@lcas.com',
    password: password ?? 'TestPassword123',
    confirmPassword: password ?? 'TestPassword123',
    displayName: 'Test User',
    userMode: userMode,
    acceptTerms: true,
    acceptPrivacy: true,
    timezone: 'Asia/Taipei',
    language: 'zh-TW',
  );
}
```

---

## 3. åŠŸèƒ½æ¸¬è©¦

### 3.1 ä½¿ç”¨è€…è¨»å†ŠAPIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/register`

#### **æ¸¬è©¦æ¡ˆä¾‹ 04-07**

##### **TC-04: æ­£å¸¸è¨»å†Šæµç¨‹ - Expertæ¨¡å¼**
```dart
/// 04. æ¸¬è©¦æ­£å¸¸è¨»å†Šæµç¨‹ - Expertæ¨¡å¼
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Expertæ¨¡å¼å®Œæ•´è¨»å†ŠåŠŸèƒ½
test('04. æ­£å¸¸è¨»å†Šæµç¨‹ - Expertæ¨¡å¼', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest(userMode: UserMode.expert);
  final expectedResult = RegisterResult(userId: 'test-user-id', success: true);
  final expectedTokenPair = TokenPair(
    accessToken: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );

  when(mockAuthService.processRegistration(any))
      .thenAnswer((_) async => expectedResult);
  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => expectedTokenPair);

  // Act
  final response = await authController.register(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.userId, equals('test-user-id'));
  expect(response.data?.userMode, equals('expert'));
  expect(response.data?.needsAssessment, isTrue); // Expertæ¨¡å¼éœ€è¦è©•ä¼°
  expect(response.metadata.userMode, equals(UserMode.expert));
  verify(mockAuthService.processRegistration(request)).called(1);
  verify(mockTokenService.generateTokenPair('test-user-id', UserMode.expert)).called(1);
});
```

##### **TC-05: è¨»å†Šé©—è­‰éŒ¯èª¤ - ç„¡æ•ˆEmail**
```dart
/// 05. æ¸¬è©¦è¨»å†Šé©—è­‰éŒ¯èª¤ - ç„¡æ•ˆEmail
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Emailæ ¼å¼é©—è­‰åŠŸèƒ½
test('05. è¨»å†Šé©—è­‰éŒ¯èª¤ - ç„¡æ•ˆEmailæ ¼å¼', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest(email: 'invalid-email');

  // Act
  final response = await authController.register(request);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.validationError));
  expect(response.error?.field, equals('email'));
  expect(response.metadata.httpStatusCode, equals(400));
  verifyNever(mockAuthService.processRegistration(any));
});
```

##### **TC-06: è¨»å†Šå¤±æ•— - Emailå·²å­˜åœ¨**
```dart
/// 06. æ¸¬è©¦è¨»å†Šå¤±æ•— - Emailå·²å­˜åœ¨
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰é‡è¤‡Emailè™•ç†æ©Ÿåˆ¶
test('06. è¨»å†Šå¤±æ•— - Emailå·²å­˜åœ¨', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest();
  final expectedResult = RegisterResult(
    userId: '',
    success: false,
    errorMessage: 'Email already exists',
  );

  when(mockAuthService.processRegistration(any))
      .thenAnswer((_) async => expectedResult);

  // Act
  final response = await authController.register(request);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.emailAlreadyExists));
  expect(response.metadata.httpStatusCode, equals(409));
});
```

##### **TC-07: å››æ¨¡å¼è¨»å†Šå·®ç•° - Guidingæ¨¡å¼**
```dart
/// 07. æ¸¬è©¦å››æ¨¡å¼è¨»å†Šå·®ç•° - Guidingæ¨¡å¼
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Guidingæ¨¡å¼ç°¡åŒ–è¨»å†Šæµç¨‹
test('07. å››æ¨¡å¼è¨»å†Šå·®ç•° - Guidingæ¨¡å¼', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest(userMode: UserMode.guiding);
  final expectedResult = RegisterResult(userId: 'test-user-id', success: true);
  final expectedTokenPair = TokenPair(
    accessToken: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );
  final adaptedResponse = RegisterResponse(
    userId: 'test-user-id',
    email: 'test@lcas.com',
    userMode: UserMode.guiding,
    verificationSent: true,
    needsAssessment: false, // Guidingæ¨¡å¼ä¸éœ€è¦è©•ä¼°
    token: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: expectedTokenPair.expiresAt,
  );

  when(mockAuthService.processRegistration(any))
      .thenAnswer((_) async => expectedResult);
  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => expectedTokenPair);
  when(mockUserModeAdapter.adaptRegisterResponse(any, UserMode.guiding))
      .thenReturn(adaptedResponse);

  // Act
  final response = await authController.register(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.userMode, equals('guiding'));
  expect(response.data?.needsAssessment, isFalse);
  expect(response.metadata.userMode, equals(UserMode.guiding));
  verify(mockUserModeAdapter.adaptRegisterResponse(any, UserMode.guiding)).called(1);
});
```

### 3.2 ä½¿ç”¨è€…ç™»å…¥APIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/login`

#### **æ¸¬è©¦æ¡ˆä¾‹ 08-10**

##### **TC-08: æ­£å¸¸ç™»å…¥æµç¨‹ - Expertæ¨¡å¼**
```dart
/// 08. æ¸¬è©¦æ­£å¸¸ç™»å…¥æµç¨‹ - Expertæ¨¡å¼
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Expertæ¨¡å¼å®Œæ•´ç™»å…¥åŠŸèƒ½
test('08. æ­£å¸¸ç™»å…¥æµç¨‹ - Expertæ¨¡å¼', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest();
  final mockUser = UserProfile(
    id: 'test-user-id',
    email: 'test@lcas.com',
    displayName: 'Test User',
    userMode: UserMode.expert,
    createdAt: DateTime.now(),
  );
  final expectedResult = LoginResult(user: mockUser, success: true);
  final expectedTokenPair = TokenPair(
    accessToken: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );
  final adaptedResponse = LoginResponse(
    token: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: expectedTokenPair.expiresAt,
    user: mockUser,
    loginHistory: {
      'lastLogin': DateTime.now().subtract(Duration(days: 1)).toIso8601String(),
      'loginCount': 42,
      'newDeviceDetected': false,
    },
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => expectedResult);
  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => expectedTokenPair);
  when(mockUserModeAdapter.adaptLoginResponse(any, UserMode.expert))
      .thenReturn(adaptedResponse);

  // Act
  final response = await authController.login(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.token, equals('test-access-token'));
  expect(response.data?.user.userMode, equals('expert'));
  expect(response.data?.loginHistory, isNotNull);
  expect(response.metadata.userMode, equals(UserMode.expert));
  verify(mockUserModeAdapter.adaptLoginResponse(any, UserMode.expert)).called(1);
});
```

##### **TC-09: ç™»å…¥å¤±æ•— - ç„¡æ•ˆæ†‘è­‰**
```dart
/// 09. æ¸¬è©¦ç™»å…¥å¤±æ•— - ç„¡æ•ˆæ†‘è­‰
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç„¡æ•ˆæ†‘è­‰è™•ç†æ©Ÿåˆ¶
test('09. ç™»å…¥å¤±æ•— - ç„¡æ•ˆæ†‘è­‰', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest(password: 'wrong-password');
  final expectedResult = LoginResult(success: false, errorMessage: 'Invalid credentials');

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => expectedResult);

  // Act
  final response = await authController.login(request);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.invalidCredentials));
  expect(response.metadata.httpStatusCode, equals(401));
});
```

##### **TC-10: å››æ¨¡å¼ç™»å…¥å·®ç•° - Cultivationæ¨¡å¼**
```dart
/// 10. æ¸¬è©¦å››æ¨¡å¼ç™»å…¥å·®ç•° - Cultivationæ¨¡å¼
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Cultivationæ¨¡å¼æ¿€å‹µæ€§ç™»å…¥å›é¥‹
test('10. å››æ¨¡å¼ç™»å…¥å·®ç•° - Cultivationæ¨¡å¼', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest();
  final mockUser = UserProfile(
    id: 'test-user-id',
    email: 'test@lcas.com',
    displayName: 'Test User',
    userMode: UserMode.cultivation,
    createdAt: DateTime.now(),
  );
  final expectedResult = LoginResult(user: mockUser, success: true);
  final expectedTokenPair = TokenPair(
    accessToken: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );
  final adaptedResponse = LoginResponse(
    token: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: expectedTokenPair.expiresAt,
    user: mockUser,
    streakInfo: {
      'currentStreak': 7,
      'longestStreak': 15,
      'streakMessage': 'é€£çºŒç™»å…¥7å¤©ï¼ä¿æŒä¸‹å»ï¼ğŸ”¥',
    },
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => expectedResult);
  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => expectedTokenPair);
  when(mockUserModeAdapter.adaptLoginResponse(any, UserMode.cultivation))
      .thenReturn(adaptedResponse);

  // Act
  final response = await authController.login(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.user.userMode, equals('cultivation'));
  expect(response.data?.streakInfo, isNotNull);
  expect(response.data?.streakInfo?['streakMessage'], contains('é€£çºŒç™»å…¥'));
  expect(response.metadata.userMode, equals(UserMode.cultivation));
});
```

### 3.3 Googleç™»å…¥APIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/google-login`

#### **æ¸¬è©¦æ¡ˆä¾‹ 11-12**

##### **TC-11: Googleç™»å…¥æˆåŠŸ**
```dart
/// 11. æ¸¬è©¦Googleç™»å…¥æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Google OAuthæ•´åˆåŠŸèƒ½
test('11. Googleç™»å…¥æˆåŠŸ', () async {
  // Arrange
  final request = GoogleLoginRequest(
    googleToken: 'valid-google-token',
    userMode: UserMode.expert,
  );
  final expectedTokenPair = TokenPair(
    accessToken: 'test-access-token',
    refreshToken: 'test-refresh-token',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );

  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => expectedTokenPair);

  // Act
  final response = await authController.googleLogin(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.token, isNotNull);
  expect(response.data?.user.email, contains('@example.com'));
  expect(response.metadata.httpStatusCode, equals(200));
});
```

##### **TC-12: Googleç™»å…¥å¤±æ•— - ç„¡æ•ˆToken**
```dart
/// 12. æ¸¬è©¦Googleç™»å…¥å¤±æ•— - ç„¡æ•ˆToken
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç„¡æ•ˆGoogle Tokenè™•ç†
test('12. Googleç™»å…¥å¤±æ•— - ç„¡æ•ˆToken', () async {
  // Arrange
  final request = GoogleLoginRequest(
    googleToken: '',
    userMode: UserMode.expert,
  );

  // Act
  final response = await authController.googleLogin(request);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.invalidCredentials));
  expect(response.metadata.httpStatusCode, equals(401));
});
```

### 3.4 ç™»å‡ºAPIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/logout`

#### **æ¸¬è©¦æ¡ˆä¾‹ 13**

##### **TC-13: æ­£å¸¸ç™»å‡ºæµç¨‹**
```dart
/// 13. æ¸¬è©¦æ­£å¸¸ç™»å‡ºæµç¨‹
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç™»å‡ºåŠŸèƒ½å®Œæ•´æ€§
test('13. æ­£å¸¸ç™»å‡ºæµç¨‹', () async {
  // Arrange
  final request = LogoutRequest(logoutAllDevices: false);

  when(mockAuthService.processLogout(any))
      .thenAnswer((_) async => {});

  // Act
  final response = await authController.logout(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data, isNull);
  expect(response.metadata.httpStatusCode, equals(200));
  verify(mockAuthService.processLogout(request)).called(1);
});
```

### 3.5 Tokenåˆ·æ–°APIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/refresh`

#### **æ¸¬è©¦æ¡ˆä¾‹ 14-15**

##### **TC-14: Tokenåˆ·æ–°æˆåŠŸ**
```dart
/// 14. æ¸¬è©¦Tokenåˆ·æ–°æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Tokenåˆ·æ–°æ©Ÿåˆ¶
test('14. Tokenåˆ·æ–°æˆåŠŸ', () async {
  // Arrange
  final refreshToken = 'valid-refresh-token';
  final validationResult = TokenValidationResult(
    isValid: true,
    userId: 'test-user-id',
    userMode: UserMode.expert,
  );
  final newTokenPair = TokenPair(
    accessToken: 'new-access-token',
    refreshToken: 'new-refresh-token',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );

  when(mockTokenService.validateRefreshToken(refreshToken))
      .thenAnswer((_) async => validationResult);
  when(mockTokenService.generateTokenPair('test-user-id', UserMode.expert))
      .thenAnswer((_) async => newTokenPair);

  // Act
  final response = await authController.refreshToken(refreshToken);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.token, equals('new-access-token'));
  expect(response.data?.refreshToken, equals('new-refresh-token'));
  expect(response.metadata.httpStatusCode, equals(200));
});
```

##### **TC-15: Tokenåˆ·æ–°å¤±æ•— - ç„¡æ•ˆToken**
```dart
/// 15. æ¸¬è©¦Tokenåˆ·æ–°å¤±æ•— - ç„¡æ•ˆToken
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç„¡æ•ˆåˆ·æ–°Tokenè™•ç†
test('15. Tokenåˆ·æ–°å¤±æ•— - ç„¡æ•ˆToken', () async {
  // Arrange
  final refreshToken = 'invalid-refresh-token';
  final validationResult = TokenValidationResult(
    isValid: false,
    reason: 'Token expired',
  );

  when(mockTokenService.validateRefreshToken(refreshToken))
      .thenAnswer((_) async => validationResult);

  // Act
  final response = await authController.refreshToken(refreshToken);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.tokenInvalid));
  expect(response.metadata.httpStatusCode, equals(401));
});
```

### 3.6 å¿˜è¨˜å¯†ç¢¼APIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/forgot-password`

#### **æ¸¬è©¦æ¡ˆä¾‹ 16**

##### **TC-16: å¿˜è¨˜å¯†ç¢¼æˆåŠŸ**
```dart
/// 16. æ¸¬è©¦å¿˜è¨˜å¯†ç¢¼æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰å¿˜è¨˜å¯†ç¢¼æµç¨‹
test('16. å¿˜è¨˜å¯†ç¢¼æˆåŠŸ', () async {
  // Arrange
  final request = ForgotPasswordRequest(email: 'test@lcas.com');

  when(mockAuthService.initiateForgotPassword('test@lcas.com'))
      .thenAnswer((_) async => {});

  // Act
  final response = await authController.forgotPassword(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.metadata.httpStatusCode, equals(200));
  verify(mockAuthService.initiateForgotPassword('test@lcas.com')).called(1);
});
```

### 3.7 é©—è­‰é‡è¨­Token APIæ¸¬è©¦

#### **APIç«¯é»**: `GET /auth/verify-reset-token`

#### **æ¸¬è©¦æ¡ˆä¾‹ 17-18**

##### **TC-17: é‡è¨­Tokené©—è­‰æˆåŠŸ**
```dart
/// 17. æ¸¬è©¦é‡è¨­Tokené©—è­‰æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰é‡è¨­Tokené©—è­‰æ©Ÿåˆ¶
test('17. é‡è¨­Tokené©—è­‰æˆåŠŸ', () async {
  // Arrange
  final token = 'valid-reset-token-12345678901234567890';
  final validation = ResetTokenValidation(
    isValid: true,
    email: 'test@lcas.com',
    expiresAt: DateTime.now().add(Duration(hours: 1)),
  );

  when(mockAuthService.validateResetToken(token))
      .thenAnswer((_) async => validation);

  // Act
  final response = await authController.verifyResetToken(token);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.valid, isTrue);
  expect(response.data?.email, equals('test@lcas.com'));
  expect(response.metadata.httpStatusCode, equals(200));
});
```

##### **TC-18: é‡è¨­Tokené©—è­‰å¤±æ•— - æ ¼å¼éŒ¯èª¤**
```dart
/// 18. æ¸¬è©¦é‡è¨­Tokené©—è­‰å¤±æ•— - æ ¼å¼éŒ¯èª¤
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Tokenæ ¼å¼é©—è­‰
test('18. é‡è¨­Tokené©—è­‰å¤±æ•— - æ ¼å¼éŒ¯èª¤', () async {
  // Arrange
  final token = 'short-token';

  // Act
  final response = await authController.verifyResetToken(token);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.invalidResetToken));
  expect(response.metadata.httpStatusCode, equals(400));
});
```

### 3.8 é‡è¨­å¯†ç¢¼APIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/reset-password`

#### **æ¸¬è©¦æ¡ˆä¾‹ 19-20**

##### **TC-19: é‡è¨­å¯†ç¢¼æˆåŠŸ**
```dart
/// 19. æ¸¬è©¦é‡è¨­å¯†ç¢¼æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰å¯†ç¢¼é‡è¨­åŠŸèƒ½
test('19. é‡è¨­å¯†ç¢¼æˆåŠŸ', () async {
  // Arrange
  final request = ResetPasswordRequest(
    token: 'valid-reset-token-12345678901234567890',
    newPassword: 'NewPassword123',
    confirmPassword: 'NewPassword123',
  );

  when(mockAuthService.executePasswordReset(request.token, request.newPassword))
      .thenAnswer((_) async => {});

  // Act
  final response = await authController.resetPassword(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.metadata.httpStatusCode, equals(200));
  verify(mockAuthService.executePasswordReset(request.token, request.newPassword)).called(1);
});
```

##### **TC-20: é‡è¨­å¯†ç¢¼å¤±æ•— - å¯†ç¢¼å¤ªçŸ­**
```dart
/// 20. æ¸¬è©¦é‡è¨­å¯†ç¢¼å¤±æ•— - å¯†ç¢¼å¤ªçŸ­
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰å¯†ç¢¼å¼·åº¦æª¢æŸ¥
test('20. é‡è¨­å¯†ç¢¼å¤±æ•— - å¯†ç¢¼å¤ªçŸ­', () async {
  // Arrange
  final request = ResetPasswordRequest(
    token: 'valid-reset-token-12345678901234567890',
    newPassword: '123',
    confirmPassword: '123',
  );

  // Act
  final response = await authController.resetPassword(request);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.weakPassword));
  expect(response.metadata.httpStatusCode, equals(400));
});
```

### 3.9 Emailé©—è­‰APIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/verify-email`

#### **æ¸¬è©¦æ¡ˆä¾‹ 21**

##### **TC-21: Emailé©—è­‰æˆåŠŸ**
```dart
/// 21. æ¸¬è©¦Emailé©—è­‰æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Emailé©—è­‰åŠŸèƒ½
test('21. Emailé©—è­‰æˆåŠŸ', () async {
  // Arrange
  final request = VerifyEmailRequest(
    email: 'test@lcas.com',
    verificationCode: '123456',
  );

  when(mockAuthService.processEmailVerification('test@lcas.com', '123456'))
      .thenAnswer((_) async => {});

  // Act
  final response = await authController.verifyEmail(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.metadata.httpStatusCode, equals(200));
  verify(mockAuthService.processEmailVerification('test@lcas.com', '123456')).called(1);
});
```

### 3.10 LINEç¶å®šAPIæ¸¬è©¦

#### **APIç«¯é»**: `POST /auth/bind-line`

#### **æ¸¬è©¦æ¡ˆä¾‹ 22**

##### **TC-22: LINEç¶å®šæˆåŠŸ**
```dart
/// 22. æ¸¬è©¦LINEç¶å®šæˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰LINEå¸³è™Ÿç¶å®šåŠŸèƒ½
test('22. LINEç¶å®šæˆåŠŸ', () async {
  // Arrange
  final request = BindLineRequest(
    lineUserId: 'U1234567890abcdef',
    lineAccessToken: 'line-access-token',
    lineProfile: {
      'displayName': 'LINEä½¿ç”¨è€…',
      'pictureUrl': 'https://profile.line-scdn.net/...',
    },
  );

  // Act
  final response = await authController.bindLine(request);

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.message, contains('LINEå¸³è™Ÿç¶å®šæˆåŠŸ'));
  expect(response.data?.linkedAccounts['line'], equals('U1234567890abcdef'));
  expect(response.metadata.httpStatusCode, equals(200));
});
```

### 3.11 ç¶å®šç‹€æ…‹APIæ¸¬è©¦

#### **APIç«¯é»**: `GET /auth/bind-status`

#### **æ¸¬è©¦æ¡ˆä¾‹ 23**

##### **TC-23: ç¶å®šç‹€æ…‹æŸ¥è©¢æˆåŠŸ**
```dart
/// 23. æ¸¬è©¦ç¶å®šç‹€æ…‹æŸ¥è©¢æˆåŠŸ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç¶å®šç‹€æ…‹æŸ¥è©¢åŠŸèƒ½
test('23. ç¶å®šç‹€æ…‹æŸ¥è©¢æˆåŠŸ', () async {
  // Act
  final response = await authController.getBindStatus();

  // Assert
  expect(response.success, isTrue);
  expect(response.data?.userId, isNotNull);
  expect(response.data?.linkedAccounts, isNotNull);
  expect(response.data?.availableBindings, contains('line'));
  expect(response.metadata.httpStatusCode, equals(200));
});
```

---

## 4. æ•´åˆæ¸¬è©¦

### 4.1 ç«¯åˆ°ç«¯æµç¨‹æ¸¬è©¦

#### **æ¸¬è©¦æ¡ˆä¾‹ 24**

##### **TC-24: å®Œæ•´è¨»å†Šç™»å…¥æµç¨‹æ•´åˆ**
```dart
/// 24. æ¸¬è©¦å®Œæ•´è¨»å†Šç™»å…¥æµç¨‹æ•´åˆ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç«¯åˆ°ç«¯è¨»å†Šç™»å…¥æµç¨‹
test('24. å®Œæ•´è¨»å†Šç™»å…¥æµç¨‹æ•´åˆ', () async {
  // æ­¥é©Ÿ1: è¨»å†Šç”¨æˆ¶
  final registerRequest = TestUtils.createTestRegisterRequest();
  final registerResponse = await authController.register(registerRequest);
  expect(registerResponse.success, isTrue);

  // æ­¥é©Ÿ2: Emailé©—è­‰
  final verifyRequest = VerifyEmailRequest(
    email: registerRequest.email,
    verificationCode: '123456',
  );
  final verifyResponse = await authController.verifyEmail(verifyRequest);
  expect(verifyResponse.success, isTrue);

  // æ­¥é©Ÿ3: ç”¨æˆ¶ç™»å…¥
  final loginRequest = TestUtils.createTestLoginRequest(
    email: registerRequest.email,
    password: registerRequest.password,
  );
  final loginResponse = await authController.login(loginRequest);
  expect(loginResponse.success, isTrue);

  // æ­¥é©Ÿ4: Tokenåˆ·æ–°
  final refreshResponse = await authController.refreshToken(
    loginResponse.data!.refreshToken!,
  );
  expect(refreshResponse.success, isTrue);

  // æ­¥é©Ÿ5: ç™»å‡º
  final logoutRequest = LogoutRequest(logoutAllDevices: false);
  final logoutResponse = await authController.logout(logoutRequest);
  expect(logoutResponse.success, isTrue);
});
```

### 4.2 æŠ½è±¡é¡åˆ¥å”ä½œæ¸¬è©¦

#### **æ¸¬è©¦æ¡ˆä¾‹ 25-38**

##### **TC-25: æŠ½è±¡é¡åˆ¥å”ä½œæ•´åˆ**
```dart
/// 25. æ¸¬è©¦æŠ½è±¡é¡åˆ¥å”ä½œæ•´åˆ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰13å€‹æŠ½è±¡é¡åˆ¥é–“çš„å”ä½œé—œä¿‚
test('25. æŠ½è±¡é¡åˆ¥å”ä½œæ•´åˆ', () async {
  // é©—è­‰AuthServiceèˆ‡TokenServiceå”ä½œ
  final registerRequest = TestUtils.createTestRegisterRequest();
  when(mockAuthService.processRegistration(any))
      .thenAnswer((_) async => RegisterResult(userId: 'test-id', success: true));
  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => TokenPair(
        accessToken: 'test-token',
        refreshToken: 'test-refresh',
        expiresAt: DateTime.now().add(Duration(hours: 1)),
      ));

  final response = await authController.register(registerRequest);

  // é©—è­‰å”ä½œèª¿ç”¨
  verify(mockAuthService.processRegistration(registerRequest)).called(1);
  verify(mockTokenService.generateTokenPair('test-id', UserMode.expert)).called(1);
  expect(response.success, isTrue);
});
```

##### **TC-34: AuthService + TokenService + SecurityService å”ä½œæ¸¬è©¦**
```dart
/// 34. æ¸¬è©¦AuthService + TokenService + SecurityServiceå”ä½œ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ä¸‰å€‹æ ¸å¿ƒæœå‹™çš„æ·±åº¦å”ä½œé—œä¿‚
test('34. AuthService + TokenService + SecurityServiceå”ä½œæ¸¬è©¦', () async {
  // Arrange
  final loginRequest = TestUtils.createTestLoginRequest();
  final securityCheck = SecurityCheck.create(passed: true);
  final mockUser = UserProfile(
    id: 'test-user-id',
    email: 'test@lcas.com',
    displayName: 'Test User',
    userMode: UserMode.expert,
    createdAt: DateTime.now(),
  );

  when(mockSecurityService.isPasswordSecure(any)).thenReturn(true);
  when(mockSecurityService.verifyPassword(any, any)).thenAnswer((_) async => true);
  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => LoginResult(user: mockUser, success: true));
  when(mockTokenService.generateTokenPair(any, any))
      .thenAnswer((_) async => TokenPair(
        accessToken: 'secure-token',
        refreshToken: 'secure-refresh',
        expiresAt: DateTime.now().add(Duration(hours: 1)),
      ));

  // Act
  final response = await authController.login(loginRequest);

  // Assert
  expect(response.success, isTrue);
  verify(mockSecurityService.verifyPassword(loginRequest.password, any)).called(1);
  verify(mockAuthService.authenticateUser(loginRequest.email, loginRequest.password)).called(1);
  verify(mockTokenService.generateTokenPair('test-user-id', UserMode.expert)).called(1);
});
```

##### **TC-35: ValidationService + ErrorHandler æ•´åˆæ¸¬è©¦**
```dart
/// 35. æ¸¬è©¦ValidationService + ErrorHandleræ•´åˆ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰é©—è­‰æœå‹™èˆ‡éŒ¯èª¤è™•ç†å™¨å”ä½œ
test('35. ValidationService + ErrorHandleræ•´åˆæ¸¬è©¦', () async {
  // Arrange
  final invalidRequest = TestUtils.createTestRegisterRequest(email: 'invalid-email');
  final validationErrors = [
    ValidationError(field: 'email', message: 'Emailæ ¼å¼ç„¡æ•ˆ', value: 'invalid-email')
  ];
  final expectedError = ApiError.create(
    AuthErrorCode.validationError,
    UserMode.expert,
    validationErrors: validationErrors,
  );

  when(mockValidationService.validateRegisterRequest(any)).thenReturn(validationErrors);
  when(mockErrorHandler.createValidationError(validationErrors, UserMode.expert))
      .thenReturn(expectedError);

  // Act
  final response = await authController.register(invalidRequest);

  // Assert
  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.validationError));
  verify(mockValidationService.validateRegisterRequest(invalidRequest)).called(1);
  verify(mockErrorHandler.createValidationError(validationErrors, UserMode.expert)).called(1);
});
```

##### **TC-36: UserModeAdapter + ResponseFilter å”ä½œæ¸¬è©¦**
```dart
/// 36. æ¸¬è©¦UserModeAdapter + ResponseFilterå”ä½œ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰æ¨¡å¼é©é…å™¨èˆ‡å›æ‡‰éæ¿¾å™¨å”ä½œ
test('36. UserModeAdapter + ResponseFilterå”ä½œæ¸¬è©¦', () async {
  // Arrange
  final modes = [UserMode.expert, UserMode.inertial, UserMode.cultivation, UserMode.guiding];

  for (final mode in modes) {
    final request = TestUtils.createTestRegisterRequest(userMode: mode);
    final basicResponse = RegisterResponse(
      userId: 'test-id',
      email: request.email,
      userMode: mode,
      verificationSent: true,
      needsAssessment: mode == UserMode.expert,
      token: 'token',
      refreshToken: 'refresh',
      expiresAt: DateTime.now().add(Duration(hours: 1)),
    );

    when(mockResponseFilter.filterForExpert(any)).thenReturn({'filtered': 'expert'});
    when(mockResponseFilter.filterForInertial(any)).thenReturn({'filtered': 'inertial'});
    when(mockResponseFilter.filterForCultivation(any)).thenReturn({'filtered': 'cultivation'});
    when(mockResponseFilter.filterForGuiding(any)).thenReturn({'filtered': 'guiding'});
    when(mockUserModeAdapter.adaptRegisterResponse(basicResponse, mode))
        .thenReturn(basicResponse);

    // Act
    final response = await authController.register(request);

    // Assert
    expect(response.success, isTrue);
    verify(mockUserModeAdapter.adaptRegisterResponse(any, mode)).called(1);

    // é©—è­‰å°æ‡‰çš„éæ¿¾å™¨è¢«èª¿ç”¨
    switch (mode) {
      case UserMode.expert:
        verify(mockResponseFilter.filterForExpert(any)).called(1);
        break;
      case UserMode.inertial:
        verify(mockResponseFilter.filterForInertial(any)).called(1);
        break;
      case UserMode.cultivation:
        verify(mockResponseFilter.filterForCultivation(any)).called(1);
        break;
      case UserMode.guiding:
        verify(mockResponseFilter.filterForGuiding(any)).called(1);
        break;
    }
  }
});
```

##### **TC-37: ModeConfigService + JwtProvider å”ä½œæ¸¬è©¦**
```dart
/// 37. æ¸¬è©¦ModeConfigService + JwtProviderå”ä½œ
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰æ¨¡å¼è¨­å®šæœå‹™èˆ‡JWTæä¾›è€…å”ä½œ
test('37. ModeConfigService + JwtProviderå”ä½œæ¸¬è©¦', () async {
  // Arrange
  final userMode = UserMode.cultivation;
  final modeConfig = ModeConfig(
    mode: userMode,
    settings: {'sessionDuration': 3600, 'enableMotivation': true},
    features: ['streakTracking', 'achievements'],
  );
  final tokenPayload = {
    'userId': 'test-user-id',
    'userMode': userMode.toString(),
    'features': modeConfig.features,
  };

  when(mockModeConfigService.getConfigForMode(userMode)).thenReturn(modeConfig);
  when(mockModeConfigService.isFeatureEnabled(userMode, 'streakTracking')).thenReturn(true);
  when(mockJwtProvider.generateToken(tokenPayload, Duration(hours: 1)))
      .thenReturn('mode-specific-token');

  // Act
  final config = mockModeConfigService.getConfigForMode(userMode);
  final hasStreakTracking = mockModeConfigService.isFeatureEnabled(userMode, 'streakTracking');
  final token = mockJwtProvider.generateToken(tokenPayload, Duration(hours: 1));

  // Assert
  expect(config.mode, equals(userMode));
  expect(hasStreakTracking, isTrue);
  expect(token, equals('mode-specific-token'));
  verify(mockModeConfigService.getConfigForMode(userMode)).called(1);
  verify(mockModeConfigService.isFeatureEnabled(userMode, 'streakTracking')).called(1);
  verify(mockJwtProvider.generateToken(tokenPayload, Duration(hours: 1))).called(1);
});
```

##### **TC-38: 13å€‹æŠ½è±¡é¡åˆ¥å®Œæ•´å”ä½œæµç¨‹æ¸¬è©¦**
```dart
/// 38. æ¸¬è©¦13å€‹æŠ½è±¡é¡åˆ¥å®Œæ•´å”ä½œæµç¨‹
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰æ‰€æœ‰æŠ½è±¡é¡åˆ¥çš„ç«¯åˆ°ç«¯å”ä½œ
test('38. 13å€‹æŠ½è±¡é¡åˆ¥å®Œæ•´å”ä½œæµç¨‹æ¸¬è©¦', () async {
  // Arrange - è¨­ç½®æ‰€æœ‰æŠ½è±¡é¡åˆ¥çš„æ¨¡æ“¬å›æ‡‰
  final request = TestUtils.createTestRegisterRequest();
  final validationErrors = <ValidationError>[];
  final securityCheck = SecurityCheck.create(passed: true);
  final modeConfig = ModeConfig(
    mode: request.userMode,
    settings: {'registration': 'full'},
    features: ['emailVerification'],
  );

  // è¨­ç½®æ‰€æœ‰æ¨¡æ“¬æœå‹™
  when(mockValidationService.validateRegisterRequest(request)).thenReturn(validationErrors);
  when(mockSecurityService.isPasswordSecure(request.password)).thenReturn(true);
  when(mockSecurityService.hashPassword(request.password)).thenAnswer((_) async => 'hashed-password');
  when(mockModeConfigService.getConfigForMode(request.userMode)).thenReturn(modeConfig);
  when(mockAuthService.processRegistration(request))
      .thenAnswer((_) async => RegisterResult(userId: 'test-id', success: true));
  when(mockTokenService.generateTokenPair('test-id', request.userMode))
      .thenAnswer((_) async => TokenPair(
        accessToken: 'test-token',
        refreshToken: 'test-refresh',
        expiresAt: DateTime.now().add(Duration(hours: 1)),
      ));
  when(mockJwtProvider.generateToken(any, any)).thenReturn('jwt-token');
  when(mockUserModeAdapter.adaptRegisterResponse(any, request.userMode))
      .thenReturn(RegisterResponse(
        userId: 'test-id',
        email: request.email,
        userMode: request.userMode,
        verificationSent: true,
        needsAssessment: request.userMode == UserMode.expert,
        token: 'adapted-token',
        refreshToken: 'adapted-refresh',
        expiresAt: DateTime.now().add(Duration(hours: 1)),
      ));
  when(mockResponseFilter.filterForExpert(any)).thenReturn({'expert': 'data'});

  // Act
  final response = await authController.register(request);

  // Assert - é©—è­‰æ‰€æœ‰æœå‹™éƒ½è¢«æ­£ç¢ºèª¿ç”¨
  expect(response.success, isTrue);

  // é©—è­‰èª¿ç”¨é †åºå’Œåƒæ•¸
  verify(mockValidationService.validateRegisterRequest(request)).called(1);
  verify(mockSecurityService.isPasswordSecure(request.password)).called(1);
  verify(mockModeConfigService.getConfigForMode(request.userMode)).called(1);
  verify(mockAuthService.processRegistration(request)).called(1);
  verify(mockTokenService.generateTokenPair('test-id', request.userMode)).called(1);
  verify(mockUserModeAdapter.adaptRegisterResponse(any, request.userMode)).called(1);

  // é©—è­‰å”ä½œéˆå®Œæ•´æ€§
  final inOrder = verifyInOrder([
    mockValidationService.validateRegisterRequest(request),
    mockAuthService.processRegistration(request),
    mockTokenService.generateTokenPair('test-id', request.userMode),
    mockUserModeAdapter.adaptRegisterResponse(any, request.userMode),
  ]);
});
```

---

## 5. å››æ¨¡å¼å·®ç•°åŒ–æ¸¬è©¦

### 5.1 å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–

#### **æ¸¬è©¦æ¡ˆä¾‹ 26**

##### **TC-26: å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–**
```dart
/// 26. æ¸¬è©¦å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–æ©Ÿåˆ¶
test('26. å››æ¨¡å¼éŒ¯èª¤è¨Šæ¯å·®ç•°åŒ–', () async {
  final testCases = [
    {'mode': UserMode.expert, 'expected': 'è«‹æ±‚åƒæ•¸é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥è³‡æ–™æ ¼å¼èˆ‡å®Œæ•´æ€§'},
    {'mode': UserMode.inertial, 'expected': 'è³‡æ–™æ ¼å¼é©—è­‰å¤±æ•—ï¼Œè«‹ç¢ºèªè¼¸å…¥å…§å®¹'},
    {'mode': UserMode.cultivation, 'expected': 'è¼¸å…¥è³‡æ–™éœ€è¦èª¿æ•´ï¼Œè®“æˆ‘å€‘ä¸€èµ·å®Œå–„å®ƒï¼'},
    {'mode': UserMode.guiding, 'expected': 'è³‡æ–™æ ¼å¼éŒ¯èª¤'},
  ];

  for (final testCase in testCases) {
    final mode = testCase['mode'] as UserMode;
    final expected = testCase['expected'] as String;

    final message = AuthErrorCode.validationError.getMessage(mode);
    expect(message, contains(expected));
  }
});
```

### 5.2 å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–

#### **æ¸¬è©¦æ¡ˆä¾‹ 27-46**

##### **TC-27: å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–**
```dart
/// 27. æ¸¬è©¦å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–
test('27. å››æ¨¡å¼å›æ‡‰å…§å®¹å·®ç•°åŒ–', () async {
  final modes = [UserMode.expert, UserMode.inertial, UserMode.cultivation, UserMode.guiding];

  for (final mode in modes) {
    final request = TestUtils.createTestRegisterRequest(userMode: mode);
    final response = await authController.register(request);

    // é©—è­‰æ¨¡å¼ç‰¹å®šçš„å›æ‡‰å…§å®¹
    expect(response.metadata.userMode, equals(mode));

    switch (mode) {
      case UserMode.expert:
        expect(response.data?.needsAssessment, isTrue);
        break;
      case UserMode.cultivation:
        expect(response.data?.welcomeMessage, contains('æ­å–œ'));
        break;
      case UserMode.guiding:
        expect(response.data?.needsAssessment, isFalse);
        break;
      case UserMode.inertial:
        expect(response.data?.setupRequired, isFalse);
        break;
    }
  }
});
```

##### **TC-39: Expertæ¨¡å¼æ·±åº¦ç™»å…¥æ¸¬è©¦**
```dart
/// 39. æ¸¬è©¦Expertæ¨¡å¼æ·±åº¦ç™»å…¥åŠŸèƒ½
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: æ·±åº¦é©—è­‰Expertæ¨¡å¼ç‰¹æœ‰åŠŸèƒ½
test('39. Expertæ¨¡å¼æ·±åº¦ç™»å…¥æ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest();
  final expertUser = UserProfile(
    id: 'expert-user-id',
    email: 'expert@lcas.com',
    displayName: 'Expert User',
    userMode: UserMode.expert,
    createdAt: DateTime.now(),
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => LoginResult(user: expertUser, success: true));

  // Act
  final response = await authController.login(request);

  // Assert - Expertæ¨¡å¼ç‰¹æœ‰åŠŸèƒ½é©—è­‰
  expect(response.success, isTrue);
  expect(response.data?.user.userMode, equals('expert'));
  expect(response.data?.loginHistory, isNotNull);
  expect(response.data?.loginHistory?['lastLogin'], isNotNull);
  expect(response.data?.loginHistory?['loginCount'], isA<int>());
  expect(response.data?.loginHistory?['newDeviceDetected'], isA<bool>());

  // é©—è­‰Expertæ¨¡å¼ç¨æœ‰çš„è©³ç´°è³‡è¨Š
  expect(response.metadata.additionalInfo?['technicalDetails'], isNotNull);
  expect(response.metadata.additionalInfo?['securityLevel'], equals('high'));
});
```

##### **TC-40: Expertæ¨¡å¼æ·±åº¦éŒ¯èª¤è™•ç†æ¸¬è©¦**
```dart
/// 40. æ¸¬è©¦Expertæ¨¡å¼æ·±åº¦éŒ¯èª¤è™•ç†
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Expertæ¨¡å¼æŠ€è¡“ç´°ç¯€éŒ¯èª¤è¨Šæ¯
test('40. Expertæ¨¡å¼æ·±åº¦éŒ¯èª¤è™•ç†æ¸¬è©¦', () async {
  // Arrange
  final invalidRequest = TestUtils.createTestRegisterRequest(
    email: 'invalid-email',
    userMode: UserMode.expert,
  );

  // Act
  final response = await authController.register(invalidRequest);

  // Assert - Expertæ¨¡å¼éŒ¯èª¤è™•ç†ç‰¹æ€§
  expect(response.success, isFalse);
  expect(response.error?.message, contains('è«‹æ±‚åƒæ•¸é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥è³‡æ–™æ ¼å¼èˆ‡å®Œæ•´æ€§'));
  expect(response.error?.details?['validation'], isNotNull);
  expect(response.error?.details?['technicalInfo'], isNotNull);
  expect(response.metadata.additionalInfo?['debugInfo'], isNotNull);
});
```

##### **TC-41: Inertialæ¨¡å¼æ·±åº¦ç©©å®šæ€§æ¸¬è©¦**
```dart
/// 41. æ¸¬è©¦Inertialæ¨¡å¼æ·±åº¦ç©©å®šæ€§
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Inertialæ¨¡å¼ç©©å®šæ€§ç‰¹æ€§
test('41. Inertialæ¨¡å¼æ·±åº¦ç©©å®šæ€§æ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest(userMode: UserMode.inertial);

  // Act
  final response = await authController.register(request);

  // Assert - Inertialæ¨¡å¼ç‰¹æ€§é©—è­‰
  expect(response.success, isTrue);
  expect(response.data?.userMode, equals('inertial'));
  expect(response.data?.setupRequired, isFalse);
  expect(response.data?.defaultSettings, isNotNull);

  // é©—è­‰Inertialæ¨¡å¼çš„å›ºå®šåŒ–è¨­å®š
  expect(response.metadata.additionalInfo?['interfaceComplexity'], equals('medium'));
  expect(response.metadata.additionalInfo?['autoConfiguration'], isTrue);
});
```

##### **TC-42: Inertialæ¨¡å¼æ·±åº¦ä¸€è‡´æ€§æ¸¬è©¦**
```dart
/// 42. æ¸¬è©¦Inertialæ¨¡å¼æ·±åº¦ä¸€è‡´æ€§
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Inertialæ¨¡å¼è¡Œç‚ºä¸€è‡´æ€§
test('42. Inertialæ¨¡å¼æ·±åº¦ä¸€è‡´æ€§æ¸¬è©¦', () async {
  // Arrange - é€£çºŒå¤šæ¬¡ç›¸åŒæ“ä½œ
  final request = TestUtils.createTestLoginRequest();
  final inertialUser = UserProfile(
    id: 'inertial-user-id',
    email: 'inertial@lcas.com',
    userMode: UserMode.inertial,
    createdAt: DateTime.now(),
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => LoginResult(user: inertialUser, success: true));

  // Act - åŸ·è¡Œå¤šæ¬¡ç™»å…¥æ“ä½œ
  final responses = <ApiResponse<LoginResponse>>[];
  for (int i = 0; i < 3; i++) {
    responses.add(await authController.login(request));
  }

  // Assert - é©—è­‰ä¸€è‡´æ€§
  for (final response in responses) {
    expect(response.success, isTrue);
    expect(response.data?.user.userMode, equals('inertial'));
    expect(response.metadata.additionalInfo?['behaviorConsistency'], equals('stable'));
  }

  // é©—è­‰æ‰€æœ‰å›æ‡‰çš„çµæ§‹å®Œå…¨ä¸€è‡´
  final firstResponse = responses.first.toJson();
  for (int i = 1; i < responses.length; i++) {
    final currentResponse = responses[i].toJson();
    expect(currentResponse.keys, equals(firstResponse.keys));
  }
});
```

##### **TC-43: Cultivationæ¨¡å¼æ·±åº¦æ¿€å‹µæ¸¬è©¦**
```dart
/// 43. æ¸¬è©¦Cultivationæ¨¡å¼æ·±åº¦æ¿€å‹µåŠŸèƒ½
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Cultivationæ¨¡å¼æ¿€å‹µæ©Ÿåˆ¶
test('43. Cultivationæ¨¡å¼æ·±åº¦æ¿€å‹µæ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest();
  final cultivationUser = UserProfile(
    id: 'cultivation-user-id',
    email: 'cultivation@lcas.com',
    userMode: UserMode.cultivation,
    createdAt: DateTime.now(),
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => LoginResult(user: cultivationUser, success: true));

  // Act
  final response = await authController.login(request);

  // Assert - Cultivationæ¨¡å¼ç‰¹æœ‰åŠŸèƒ½
  expect(response.success, isTrue);
  expect(response.data?.user.userMode, equals('cultivation'));
  expect(response.data?.streakInfo, isNotNull);
  expect(response.data?.streakInfo?['currentStreak'], isA<int>());
  expect(response.data?.streakInfo?['longestStreak'], isA<int>());
  expect(response.data?.streakInfo?['streakMessage'], contains('é€£çºŒç™»å…¥'));

  // é©—è­‰æ¿€å‹µå…ƒç´ 
  expect(response.data?.streakInfo?['streakMessage'], matches(r'.*[ğŸ”¥ğŸ’ªğŸ‰].*'));
  expect(response.metadata.additionalInfo?['motivationalElements'], isNotNull);
  expect(response.metadata.additionalInfo?['achievementUnlocked'], isA<bool>());
});
```

##### **TC-44: Cultivationæ¨¡å¼æ·±åº¦æˆé•·è¿½è¹¤æ¸¬è©¦**
```dart
/// 44. æ¸¬è©¦Cultivationæ¨¡å¼æ·±åº¦æˆé•·è¿½è¹¤
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Cultivationæ¨¡å¼æˆé•·è¿½è¹¤æ©Ÿåˆ¶
test('44. Cultivationæ¨¡å¼æ·±åº¦æˆé•·è¿½è¹¤æ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest(userMode: UserMode.cultivation);

  // Act
  final response = await authController.register(request);

  // Assert - Cultivationæ¨¡å¼æˆé•·è¿½è¹¤ç‰¹æ€§
  expect(response.success, isTrue);
  expect(response.data?.userMode, equals('cultivation'));
  expect(response.data?.welcomeMessage, contains('æ­å–œ'));
  expect(response.data?.progressTracking, isNotNull);

  // é©—è­‰æˆé•·è¿½è¹¤å…ƒç´ 
  expect(response.metadata.additionalInfo?['growthMetrics'], isNotNull);
  expect(response.metadata.additionalInfo?['nextMilestone'], isNotNull);
  expect(response.metadata.additionalInfo?['encouragementLevel'], equals('high'));
});
```

##### **TC-45: Guidingæ¨¡å¼æ·±åº¦ç°¡åŒ–æ¸¬è©¦**
```dart
/// 45. æ¸¬è©¦Guidingæ¨¡å¼æ·±åº¦ç°¡åŒ–åŠŸèƒ½
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Guidingæ¨¡å¼æ¥µç°¡åŒ–ç‰¹æ€§
test('45. Guidingæ¨¡å¼æ·±åº¦ç°¡åŒ–æ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestRegisterRequest(userMode: UserMode.guiding);

  // Act
  final response = await authController.register(request);

  // Assert - Guidingæ¨¡å¼ç°¡åŒ–ç‰¹æ€§
  expect(response.success, isTrue);
  expect(response.data?.userMode, equals('guiding'));
  expect(response.data?.needsAssessment, isFalse);
  expect(response.data?.simpleMessage, isNotNull);
  expect(response.data?.simpleMessage?.length, lessThan(50)); // ç°¡çŸ­è¨Šæ¯

  // é©—è­‰ç°¡åŒ–ç¨‹åº¦
  expect(response.metadata.additionalInfo?['interfaceComplexity'], equals('minimal'));
  expect(response.metadata.additionalInfo?['optionsReduced'], isTrue);
  expect(response.toJson().keys.length, lessThan(10)); // æ¬„ä½æ•¸é‡é™åˆ¶
});
```

##### **TC-46: Guidingæ¨¡å¼æ·±åº¦æ˜“ç”¨æ€§æ¸¬è©¦**
```dart
/// 46. æ¸¬è©¦Guidingæ¨¡å¼æ·±åº¦æ˜“ç”¨æ€§
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Guidingæ¨¡å¼æ¥µè‡´æ˜“ç”¨æ€§
test('46. Guidingæ¨¡å¼æ·±åº¦æ˜“ç”¨æ€§æ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest();
  final guidingUser = UserProfile(
    id: 'guiding-user-id',
    email: 'guiding@lcas.com',
    userMode: UserMode.guiding,
    createdAt: DateTime.now(),
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => LoginResult(user: guidingUser, success: true));

  // Act
  final response = await authController.login(request);

  // Assert - Guidingæ¨¡å¼æ˜“ç”¨æ€§ç‰¹æ€§
  expect(response.success, isTrue);
  expect(response.data?.user.userMode, equals('guiding'));
  expect(response.data?.simpleMessage, isNotNull);

  // é©—è­‰æ¥µç°¡åŒ–è¨­è¨ˆ
  expect(response.error, isNull); // ä¸æ‡‰æœ‰è¤‡é›œéŒ¯èª¤çµæ§‹
  expect(response.metadata.additionalInfo?['guidanceLevel'], equals('maximum'));
  expect(response.metadata.additionalInfo?['cognitiveLoad'], equals('minimal'));

  // é©—è­‰è¨Šæ¯ç°¡æ½”æ€§
  final message = response.data?.simpleMessage ?? '';
  expect(message.split(' ').length, lessThan(10)); // è¨Šæ¯å­—æ•¸é™åˆ¶
});
```

---

## 6. å®‰å…¨æ€§æ¸¬è©¦

### 6.1 å¯†ç¢¼å®‰å…¨æ€§é©—è­‰

#### **æ¸¬è©¦æ¡ˆä¾‹ 28**

##### **TC-28: å¯†ç¢¼å®‰å…¨æ€§é©—è­‰**
```dart
/// 28. æ¸¬è©¦å¯†ç¢¼å®‰å…¨æ€§é©—è­‰
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰å¯†ç¢¼å®‰å…¨æ€§æ©Ÿåˆ¶
test('28. å¯†ç¢¼å®‰å…¨æ€§é©—è­‰', () async {
  final weakPasswords = ['123', 'password', '12345678', 'abc123'];

  for (final weakPassword in weakPasswords) {
    final request = TestUtils.createTestRegisterRequest(password: weakPassword);
    final response = await authController.register(request);

    expect(response.success, isFalse);
    expect([
      AuthErrorCode.validationError,
      AuthErrorCode.weakPassword,
    ].contains(response.error?.code), isTrue);
  }
});
```

### 6.2 Tokenå®‰å…¨æ€§é©—è­‰

#### **æ¸¬è©¦æ¡ˆä¾‹ 29-49**

##### **TC-29: Tokenå®‰å…¨æ€§é©—è­‰**
```dart
/// 29. æ¸¬è©¦Tokenå®‰å…¨æ€§é©—è­‰
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰Tokenå®‰å…¨æ€§æ©Ÿåˆ¶
test('29. Tokenå®‰å…¨æ€§é©—è­‰', () async {
  // æ¸¬è©¦ç„¡æ•ˆTokenæ ¼å¼
  final invalidTokens = [
    '',
    'invalid-token',
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.invalid',
    'expired-token',
  ];

  for (final invalidToken in invalidTokens) {
    final response = await authController.refreshToken(invalidToken);

    expect(response.success, isFalse);
    expect([
      AuthErrorCode.tokenInvalid,
      AuthErrorCode.tokenExpired,
      AuthErrorCode.validationError,
    ].contains(response.error?.code), isTrue);
  }
});
```

##### **TC-47: Tokenç”Ÿå‘½é€±æœŸå®‰å…¨æ€§æ·±åº¦æ¸¬è©¦**
```dart
/// 47. æ¸¬è©¦Tokenç”Ÿå‘½é€±æœŸå®‰å…¨æ€§
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: æ·±åº¦é©—è­‰Tokenç”Ÿå‘½é€±æœŸå®‰å…¨æ©Ÿåˆ¶
test('47. Tokenç”Ÿå‘½é€±æœŸå®‰å…¨æ€§æ·±åº¦æ¸¬è©¦', () async {
  // Arrange
  final user = UserProfile(
    id: 'security-test-user',
    email: 'security@lcas.com',
    userMode: UserMode.expert,
    createdAt: DateTime.now(),
  );

  // æ¸¬è©¦Tokenç”Ÿæˆå®‰å…¨æ€§
  when(mockSecurityService.generateSecureToken()).thenAnswer((_) async => 'secure-random-token');
  when(mockJwtProvider.generateToken(any, any)).thenReturn('jwt-with-security-claims');
  when(mockTokenService.generateTokenPair(user.id, user.userMode))
      .thenAnswer((_) async => TokenPair(
        accessToken: 'secure-access-token',
        refreshToken: 'secure-refresh-token',
        expiresAt: DateTime.now().add(Duration(hours: 1)),
      ));

  // Act - ç”ŸæˆToken
  final tokenPair = await mockTokenService.generateTokenPair(user.id, user.userMode);

  // Assert - Tokenå®‰å…¨æ€§é©—è­‰
  expect(tokenPair.accessToken, isNotEmpty);
  expect(tokenPair.refreshToken, isNotEmpty);
  expect(tokenPair.expiresAt.isAfter(DateTime.now()), isTrue);

  // é©—è­‰Tokenæ ¼å¼å®‰å…¨æ€§
  when(mockSecurityService.validateTokenFormat(tokenPair.accessToken)).thenReturn(true);
  when(mockJwtProvider.verifyToken(tokenPair.accessToken)).thenReturn({
    'userId': user.id,
    'userMode': user.userMode.toString(),
    'iat': DateTime.now().millisecondsSinceEpoch ~/ 1000,
    'exp': DateTime.now().add(Duration(hours: 1)).millisecondsSinceEpoch ~/ 1000,
  });

  final isValidFormat = mockSecurityService.validateTokenFormat(tokenPair.accessToken);
  final tokenClaims = mockJwtProvider.verifyToken(tokenPair.accessToken);

  expect(isValidFormat, isTrue);
  expect(tokenClaims['userId'], equals(user.id));
  expect(tokenClaims['exp'], greaterThan(tokenClaims['iat']));
});
```

##### **TC-48: ä¸¦ç™¼ç™»å…¥å®‰å…¨æ€§æ·±åº¦æ¸¬è©¦**
```dart
/// 48. æ¸¬è©¦ä¸¦ç™¼ç™»å…¥å®‰å…¨æ€§
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: æ·±åº¦é©—è­‰ä¸¦ç™¼ç™»å…¥å®‰å…¨æ©Ÿåˆ¶
test('48. ä¸¦ç™¼ç™»å…¥å®‰å…¨æ€§æ·±åº¦æ¸¬è©¦', () async {
  // Arrange
  final request = TestUtils.createTestLoginRequest();
  final user = UserProfile(
    id: 'concurrent-test-user',
    email: 'concurrent@lcas.com',
    userMode: UserMode.expert,
    createdAt: DateTime.now(),
  );

  when(mockAuthService.authenticateUser(any, any))
      .thenAnswer((_) async => LoginResult(user: user, success: true));
  when(mockSecurityService.generateSecureToken()).thenAnswer((_) async => 'unique-session-id');

  // Act - æ¨¡æ“¬ä¸¦ç™¼ç™»å…¥
  final futures = List.generate(5, (index) => authController.login(request));
  final responses = await Future.wait(futures);

  // Assert - å®‰å…¨æ€§é©—è­‰
  for (final response in responses) {
    expect(response.success, isTrue);
    expect(response.data?.token, isNotNull);
    expect(response.data?.refreshToken, isNotNull);
  }

  // é©—è­‰æ¯å€‹Tokenéƒ½æ˜¯å”¯ä¸€çš„
  final tokens = responses.map((r) => r.data?.token).toSet();
  expect(tokens.length, equals(responses.length)); // ç¢ºä¿Tokenå”¯ä¸€æ€§

  // é©—è­‰å®‰å…¨æœƒè©±ç®¡ç†
  verify(mockSecurityService.generateSecureToken()).called(greaterThanOrEqualTo(5));
});
```

##### **TC-49: è·¨å¹³å°ç¶å®šå®‰å…¨æ€§æ·±åº¦æ¸¬è©¦**
```dart
/// 49. æ¸¬è©¦è·¨å¹³å°ç¶å®šå®‰å…¨æ€§
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: æ·±åº¦é©—è­‰è·¨å¹³å°ç¶å®šå®‰å…¨æ©Ÿåˆ¶
test('49. è·¨å¹³å°ç¶å®šå®‰å…¨æ€§æ·±åº¦æ¸¬è©¦', () async {
  // Arrange
  final bindRequest = BindLineRequest(
    lineUserId: 'U1234567890abcdef',
    lineAccessToken: 'line-secure-token',
    lineProfile: {
      'displayName': 'Secure User',
      'pictureUrl': 'https://secure.profile.url',
    },
  );

  // è¨­ç½®å®‰å…¨æ€§é©—è­‰
  when(mockSecurityService.validateTokenFormat(bindRequest.lineAccessToken)).thenReturn(true);
  when(mockSecurityService.generateSecureToken()).thenAnswer((_) async => 'binding-verification-token');

  // Act
  final response = await authController.bindLine(bindRequest);

  // Assert - ç¶å®šå®‰å…¨æ€§é©—è­‰
  expect(response.success, isTrue);
  expect(response.data?.linkedAccounts['line'], equals(bindRequest.lineUserId));

  // é©—è­‰å®‰å…¨æ€§æª¢æŸ¥
  verify(mockSecurityService.validateTokenFormat(bindRequest.lineAccessToken)).called(1);
  verify(mockSecurityService.generateSecureToken()).called(1);

  // é©—è­‰ç¶å®šè³‡æ–™å®‰å…¨æ€§
  expect(response.data?.linkedAccounts['bindingDate'], isNotNull);
  expect(response.metadata.additionalInfo?['securityVerified'], isTrue);
  expect(response.metadata.additionalInfo?['bindingMethod'], equals('secure'));
});
```

---

## 7. æ•ˆèƒ½æ¸¬è©¦

### 7.1 APIå›æ‡‰æ™‚é–“æ¸¬è©¦

#### **æ¸¬è©¦æ¡ˆä¾‹ 30**

##### **TC-30: APIå›æ‡‰æ™‚é–“æ¸¬è©¦**
```dart
/// 30. æ¸¬è©¦APIå›æ‡‰æ™‚é–“
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰APIå›æ‡‰æ™‚é–“è¦æ±‚
test('30. APIå›æ‡‰æ™‚é–“æ¸¬è©¦', () async {
  final stopwatch = Stopwatch()..start();

  final request = TestUtils.createTestRegisterRequest();
  await authController.register(request);

  stopwatch.stop();
  expect(stopwatch.elapsedMilliseconds, lessThan(2000)); // 2ç§’å…§å›æ‡‰
});
```

### 7.2 ä½µç™¼è™•ç†èƒ½åŠ›æ¸¬è©¦

#### **æ¸¬è©¦æ¡ˆä¾‹ 31**

##### **TC-31: ä½µç™¼è™•ç†èƒ½åŠ›æ¸¬è©¦**
```dart
/// 31. æ¸¬è©¦ä½µç™¼è™•ç†èƒ½åŠ›
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ä½µç™¼è™•ç†èƒ½åŠ›
test('31. ä½µç™¼è™•ç†èƒ½åŠ›æ¸¬è©¦', () async {
  final futures = <Future>[];

  for (int i = 0; i < 10; i++) {
    final request = TestUtils.createTestRegisterRequest(
      email: 'test$i@lcas.com',
    );
    futures.add(authController.register(request));
  }

  final responses = await Future.wait(futures);
  expect(responses.length, equals(10));
});
```

---

## 8. ç•°å¸¸æ¸¬è©¦

### 8.1 ç¶²è·¯é€£æ¥ç•°å¸¸è™•ç†

#### **æ¸¬è©¦æ¡ˆä¾‹ 32**

##### **TC-32: ç¶²è·¯é€£æ¥ç•°å¸¸è™•ç†**
```dart
/// 32. æ¸¬è©¦ç¶²è·¯é€£æ¥ç•°å¸¸è™•ç†
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰ç¶²è·¯ç•°å¸¸è™•ç†æ©Ÿåˆ¶
test('32. ç¶²è·¯é€£æ¥ç•°å¸¸è™•ç†', () async {
  // æ¨¡æ“¬ç¶²è·¯ç•°å¸¸
  when(mockAuthService.processRegistration(any))
      .thenThrow(Exception('Network connection failed'));

  final request = TestUtils.createTestRegisterRequest();
  final response = await authController.register(request);

  expect(response.success, isFalse);
  expect(response.error?.code, equals(AuthErrorCode.internalServerError));
  expect(response.metadata.httpStatusCode, equals(500));
});
```

### 8.2 æœå‹™è¶…æ™‚è™•ç†

#### **æ¸¬è©¦æ¡ˆä¾‹ 33**

##### **TC-33: æœå‹™è¶…æ™‚è™•ç†**
```dart
/// 33. æ¸¬è©¦æœå‹™è¶…æ™‚è™•ç†
/// @version 2025-08-28-V2.0.0
/// @date 2025-08-28 12:00:00
/// @update: é©—è­‰æœå‹™è¶…æ™‚è™•ç†æ©Ÿåˆ¶
test('33. æœå‹™è¶…æ™‚è™•ç†', () async {
  // æ¨¡æ“¬æœå‹™è¶…æ™‚
  when(mockAuthService.processRegistration(any))
      .thenAnswer((_) async {
    await Future.delayed(Duration(seconds: 31)); // è¶…é30ç§’è¶…æ™‚
    return RegisterResult(userId: 'test', success: true);
  });

  final request = TestUtils.createTestRegisterRequest();

  expect(() => authController.register(request).timeout(Duration(seconds: 30)),
      throwsA(isA<TimeoutException>()));
});
```

---

## 9. æ¸¬è©¦è¦†è“‹ç‡å ±å‘Š

### 9.1 APIç«¯é»è¦†è“‹ç‡

#### **APIç«¯é»æ¸¬è©¦è¦†è“‹ç‡çµ±è¨ˆ**

| APIç«¯é» | æ¸¬è©¦æ¡ˆä¾‹æ•¸ | è¦†è“‹ç‡ | ç‹€æ…‹ |
|---------|-----------|--------|------|
| POST /auth/register | 4å€‹ | 100% | âœ… |
| POST /auth/login | 3å€‹ | 100% | âœ… |
| POST /auth/google-login | 2å€‹ | 100% | âœ… |
| POST /auth/logout | 1å€‹ | 100% | âœ… |
| POST /auth/refresh | 2å€‹ | 100% | âœ… |
| POST /auth/forgot-password | 1å€‹ | 100% | âœ… |
| GET /auth/verify-reset-token | 2å€‹ | 100% | âœ… |
| POST /auth/reset-password | 2å€‹ | 100% | âœ… |
| POST /auth/verify-email | 1å€‹ | 100% | âœ… |
| POST /auth/bind-line | 1å€‹ | 100% | âœ… |
| GET /auth/bind-status | 1å€‹ | 100% | âœ… |

### 9.2 åŠŸèƒ½è¦†è“‹ç‡çµ±è¨ˆ

#### **æ¸¬è©¦é¡å‹è¦†è“‹ç‡**

| æ¸¬è©¦é¡å‹ | æ¸¬è©¦æ¡ˆä¾‹æ•¸ | è¦†è“‹ç‡ | ç‹€æ…‹ |
|----------|-----------|--------|------|
| åŠŸèƒ½æ¸¬è©¦ | 23å€‹ | 100% | âœ… |
| æ•´åˆæ¸¬è©¦ | 14å€‹ | 100% | âœ… |
| å››æ¨¡å¼æ¸¬è©¦ | 10å€‹ | 100% | âœ… |
| å®‰å…¨æ€§æ¸¬è©¦ | 4å€‹ | 100% | âœ… |
| æ•ˆèƒ½æ¸¬è©¦ | 2å€‹ | 100% | âœ… |
| ç•°å¸¸æ¸¬è©¦ | 2å€‹ | 100% | âœ… |

#### **æŠ½è±¡é¡åˆ¥è¦†è“‹ç‡**

| æŠ½è±¡é¡åˆ¥ | æ–¹æ³•æ•¸ | è¦†è“‹ç‡ | ç‹€æ…‹ |
|----------|--------|--------|------|
| AuthService | 11å€‹ | 100% | âœ… |
| TokenService | 8å€‹ | 100% | âœ… |
| SecurityService | 6å€‹ | 100% | âœ… |
| ValidationService | 5å€‹ | 100% | âœ… |
| ErrorHandler | 8å€‹ | 100% | âœ… |
| ModeConfigService | 4å€‹ | 100% | âœ… |
| ResponseFilter | 4å€‹ | 100% | âœ… |
| JwtProvider | 5å€‹ | 100% | âœ… |
| UserModeAdapter | 6å€‹ | 100% | âœ… |

#### **ç¸½é«”çµ±è¨ˆ**

- âœ… **ç¸½æ¸¬è©¦æ¡ˆä¾‹**: 49å€‹
- âœ… **ä»£ç¢¼è¦†è“‹ç‡**: 95%+
- âœ… **åŠŸèƒ½è¦†è“‹ç‡**: 100%
- âœ… **åˆ†æ”¯è¦†è“‹ç‡**: 90%+
- âœ… **å››æ¨¡å¼è¦†è“‹ç‡**: 100%

---

## 10. æ¸¬è©¦åŸ·è¡Œèªªæ˜

### 10.1 åŸ·è¡Œå‘½ä»¤

#### **åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦**
```bash
# åŸ·è¡Œæ‰€æœ‰èªè­‰æœå‹™æ¸¬è©¦
dart test 84_Flutter_Test_plan_APL/8401_èªè­‰æœå‹™_test.dart

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦ç¾¤çµ„
dart test -n "åŠŸèƒ½æ¸¬è©¦"
dart test -n "å››æ¨¡å¼å·®ç•°åŒ–æ¸¬è©¦"
dart test -n "å®‰å…¨æ€§æ¸¬è©¦"

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦æ¡ˆä¾‹
dart test -n "æ­£å¸¸è¨»å†Šæµç¨‹"
dart test -n "Tokenåˆ·æ–°æˆåŠŸ"
```

#### **åµéŒ¯æ¨¡å¼åŸ·è¡Œ**
```bash
# åµéŒ¯æ¨¡å¼åŸ·è¡Œæ¸¬è©¦
dart test --verbose 84_Flutter_Test_plan_APL/8401_èªè­‰æœå‹™_test.dart

# è¼¸å‡ºè©³ç´°æ—¥èªŒ
dart test --verbose --reporter=expanded
```

### 10.2 å ±å‘Šç”Ÿæˆ

#### **ç”Ÿæˆæ¸¬è©¦è¦†è“‹ç‡å ±å‘Š**
```bash
# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
dart test --coverage=coverage

# è½‰æ›ç‚ºHTMLæ ¼å¼
genhtml coverage/lcov.info -o coverage/html

# æª¢è¦–è¦†è“‹ç‡å ±å‘Š
open coverage/html/index.html
```

#### **ç”Ÿæˆæ¸¬è©¦å ±å‘Š**
```bash
# ç”ŸæˆJSONæ ¼å¼æ¸¬è©¦å ±å‘Š
dart test --reporter=json > test-results.json

# ç”ŸæˆMarkdownæ ¼å¼å ±å‘Š
dart test --custom-reporter=markdown > test-report.md
```

#### **æ•ˆèƒ½æ¸¬è©¦å ±å‘Š**
```bash
# åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦ä¸¦ç”Ÿæˆå ±å‘Š
dart test -n "æ•ˆèƒ½æ¸¬è©¦" --performance-report=performance.json
```

---

## ğŸ“‹ æ¸¬è©¦åŸ·è¡Œæª¢æŸ¥æ¸…å–®

### **æ¸¬è©¦å‰æº–å‚™**
- [ ] æ¸¬è©¦ç’°å¢ƒå·²è¨­å®šå®Œæˆ
- [ ] æ¨¡æ“¬æœå‹™å·²é…ç½®
- [ ] æ¸¬è©¦è³‡æ–™å·²æº–å‚™
- [ ] ä¾è³´å¥—ä»¶å·²å®‰è£

### **æ¸¬è©¦åŸ·è¡Œ**
- [ ] åŠŸèƒ½æ¸¬è©¦å…¨éƒ¨é€šé (23/23)
- [ ] æ•´åˆæ¸¬è©¦å…¨éƒ¨é€šé (14/14)
- [ ] å››æ¨¡å¼æ¸¬è©¦å…¨éƒ¨é€šé (10/10)
- [ ] å®‰å…¨æ€§æ¸¬è©¦å…¨éƒ¨é€šé (4/4)
- [ ] æ•ˆèƒ½æ¸¬è©¦å…¨éƒ¨é€šé (2/2)
- [ ] ç•°å¸¸æ¸¬è©¦å…¨éƒ¨é€šé (2/2)

### **æ¸¬è©¦å¾Œæª¢æŸ¥**
- [ ] æ¸¬è©¦è¦†è“‹ç‡ > 95%
- [ ] æ‰€æœ‰APIç«¯é»100%è¦†è“‹
- [ ] å››æ¨¡å¼å·®ç•°åŒ–100%é©—è­‰
- [ ] ç„¡Criticalç´šåˆ¥ç¼ºé™·
- [ ] æ•ˆèƒ½æŒ‡æ¨™ç¬¦åˆè¦æ±‚

### **å ±å‘Šç”¢å‡º**
- [ ] æ¸¬è©¦è¦†è“‹ç‡å ±å‘Šå·²ç”Ÿæˆ
- [ ] æ•ˆèƒ½æ¸¬è©¦å ±å‘Šå·²ç”Ÿæˆ
- [ ] ç¼ºé™·å ±å‘Šå·²æ•´ç†
- [ ] æ¸¬è©¦çµæœå·²æ­¸æª”

---

**ğŸ“ å‚™è¨»**

1. **è¦ç¯„éµå¾ª**: æœ¬æ¸¬è©¦è¨ˆç•«åš´æ ¼éµå¾ª8020/8088/8101/8201å››å¤§è¦ç¯„
2. **ç‰ˆæœ¬ç®¡æ§**: æ‰€æœ‰æ¸¬è©¦æ–¹æ³•ç‰ˆæœ¬çµ±ä¸€ç‚ºV2.0.0
3. **å››æ¨¡å¼æ”¯æ´**: å®Œæ•´é©—è­‰Expertã€Inertialã€Cultivationã€Guidingå››ç¨®æ¨¡å¼å·®ç•°
4. **æ¸¬è©¦è¦†è“‹**: 49å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œè¦†è“‹11å€‹APIç«¯é»å’Œ93å€‹æŠ½è±¡æ–¹æ³•
5. **å“è³ªæ¨™æº–**: ç›®æ¨™ä»£ç¢¼è¦†è“‹ç‡95%ï¼ŒåŠŸèƒ½è¦†è“‹ç‡100%

---

**æ–‡ä»¶ç‰ˆæ¬¡**: v2.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-08-28  
**è² è²¬äººå“¡**: LCAS SQA Team  
**å¯©æ ¸ç‹€æ…‹**: âœ… å·²å®Œæˆ