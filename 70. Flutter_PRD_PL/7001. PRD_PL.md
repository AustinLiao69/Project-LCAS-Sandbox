# PRD_Flutter_Presentation_Layer

**文件編號**: 7001  
**版本**: v1.0.5  
**建立日期**: 2025-09-09  
**建立者**: LCAS PM Team  
**最後更新**: 2025-11-13  

---

## 目次
1. [模組概述](#10-模組概述module-overview)
2. [功能需求](#20-功能群概述function-groups-overview)
3. [架構設計](#30-架構設計architecture-design)
4. [頁面群詳細規格](#40-頁面群詳細規格Page-groups-specification)

---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
展示層(Presentation Layer, PL)是 LCAS 2.0 系統的前端用戶介面層，負責提供跨平台（iOS/Android）的原生體驗。作為用戶與系統互動的主要介面，確保四模式差異化體驗的完整實現，並透過標準化的 RESTful API 與應用邏輯層(AP layer, APL)進行資料交換。

### 1.2 核心價值主張
- **四模式個人化體驗**：支援 Expert、Inertial、Cultivation、Guiding 四種使用者模式的差異化設計
- **跨平台一致性**：Flutter 框架確保 iOS 和 Android 平台的一致使用體驗
- **響應式設計**：支援手機、平板等多種螢幕尺寸的自適應佈局
- **離線優先架構**：支援離線記帳與數據同步機制

### 1.3 目標使用者
- **Expert模式使用者**：需要完整功能、深度分析、專業控制的進階用戶
- **Inertial模式使用者**：習慣固定流程、簡潔介面、一致體驗的穩定用戶
- **Cultivation模式使用者**：需要習慣養成、激勵機制、進度追蹤的成長用戶
- **Guiding模式使用者**：需要極簡介面、被動引導、最少決策的入門用戶

### 1.4 主要職責與技術定位

主要職責： PL 的主要負責領域為：UI及Mobile端業務邏輯。

技術定位： PL 採用 Flutter 跨平台框架，基於 Dart 語言開發，支援：
- Material Design 和 Cupertino 設計語言
- 狀態管理（Provider/Bloc）
- 本地資料存儲（SQLite/Hive）
- RESTful API 整合
- 多語言國際化（i18n）

---

## 2.0 功能群概述（Function Groups Overview）(待修改)

基於7021 Screen list文件的40個畫面規格，Presentation Layer 分成五大功能群：

### 2.1 系統進入功能群（Epic 1）
基於6021文件 S-101 至 S-108 畫面規格：

#### 2.1.1 APP 啟動與註冊功能
- **APP 啟動頁（S-102）**：品牌展示、版本資訊、載入進度
- **APP 註冊頁（S-103）**：Email 輸入、密碼設定、驗證流程
- **APP 登入頁（S-104）**：帳號密碼、Google 登入、忘記密碼
- **忘記密碼頁（S-105）**：Email 輸入、重設說明、返回登入

#### 2.1.2 模式評估與綁定功能
- **模式評估問卷頁（S-106）**：5 題評估問卷、模式說明、設定確認
- **跨平台綁定頁（S-107）**：LINE OA 介紹、QR Code、綁定確認

### 2.2 記帳核心功能群（Epic 2）
基於6021文件 S-201 至 S-211 畫面規格：

#### 2.2.1 核心記帳功能
- **APP 記帳主頁（S-202）**：快速記帳按鈕、最近記錄、統計摘要
- **APP 記帳表單頁（S-203）**：金額、科目、帳戶、帳本、備註、重複設定
- **科目選擇頁（S-204）**：收支切換、科目樹狀結構、快速搜尋
- **帳戶選擇頁（S-205）**：帳戶列表、餘額顯示、快速切換

#### 2.2.2 進階記帳功能
- **帳本選擇頁（S-206）**：個人/協作帳本、權限狀態、新增按鈕
- **圖片附加頁（S-207）**：拍照、相冊選擇、圖片預覽、壓縮設定
- **重複設定頁（S-208）**：頻率選擇、結束條件、預覽排程
- **記錄管理頁（S-209）**：記錄列表、篩選搜尋、編輯刪除

#### 2.2.3 記錄管理與統計
- **記錄編輯頁（S-210）**：完整記錄編輯、歷史記錄、刪除確認
- **統計圖表頁（S-211）**：圓餅圖、長條圖、折線圖、時間篩選

### 2.3 預算管理與帳本協作功能群（Epic 3-6）
基於6021文件 S-301 至 S-308 畫面規格：

#### 2.3.1 帳本管理功能
- **帳本管理主頁（S-301）**：帳本列表、新增按鈕、權限標示
- **建立帳本頁（S-302）**：帳本類型、名稱描述、權限設定
- **協作管理頁（S-303）**：協作者列表、權限管理、邀請功能

#### 2.3.2 帳戶與科目管理
- **帳戶管理主頁（S-304）**：帳戶列表、餘額統計、新增刪除
- **建立帳戶頁（S-305）**：帳戶類型、初始餘額、幣值圖標
- **科目管理主頁（S-306）**：科目樹狀結構、新增編輯、使用統計

#### 2.3.3 預算管理功能
- **預算管理主頁（S-307）**：預算列表、執行狀況、新增按鈕
- **建立預算頁（S-308）**：預算範圍、金額時間、監控設定

### 2.4 分析功能群（Epic 7-9）
基於6021文件 S-401 至 S-406 畫面規格：

#### 2.4.1 報表分析功能
- **報表分析主頁（S-401）**：報表類型、快速生成、模板管理
- **報表設定頁（S-402）**：時間範圍、資料篩選、圖表選擇
- **圖表展示頁（S-403）**：動態圖表、數據鑽取、匯出分享
- **報表下載頁（S-404）**：格式選擇、自訂範圍、分享設定

#### 2.4.2 AI 智慧分析
- **深度分析頁（S-405）**：趨勢分析、異常檢測、AI 建議
- **AI 助理頁（S-406）**：智慧分類、預算建議、異常提醒

### 2.5 系統功能群（Epic 10-15）
基於6021文件 S-501 至 S-507 畫面規格：

#### 2.5.1 激勵與備份功能
- **激勵系統頁（S-501）**：挑戰進度、成就徽章、獎勵記錄
- **資料備份頁（S-502）**：備份設定、恢復選項、同步狀態

#### 2.5.2 系統設定功能
- **安全設定頁（S-503）**：應用鎖、隱私模式、驗證設定
- **通知設定頁（S-504）**：提醒類型、時間設定、頻率管理
- **個人設定頁（S-505）**：個人資料、主題語言、偏好設定

#### 2.5.3 幫助與回報功能
- **幫助中心頁（S-506）**：操作教學、FAQ、客服聯繫
- **社群回報頁（S-507）**：錯誤回報、功能建議、系統狀態

---

## 3.0 架構設計（Architecture Design）

### 3.1 整體架構(待修改)
Presentation layer 採用分層架構設計，確保清晰的職責分離與高度可維護性：

```
LCAS 2.0 Presentation layer Architecture
├── 展示層 (Presentation Layer)
│   ├── 頁面層 (Pages Layer)
│   │   ├── 進入階段頁面群 (Entry Pages Group)
│   │   ├── 記帳功能頁面群 (Bookkeeping Pages Group)
│   │   ├── 管理功能頁面群 (Management Pages Group)
│   │   ├── 分析功能頁面群 (Analytics Pages Group)
│   │   └── 系統功能頁面群 (System Pages Group)
│   ├── 組件層 (Components Layer)
│   │   ├── 四模式差異化組件 (Mode-specific Components)
│   │   ├── 共用UI組件 (Shared UI Components)
│   │   └── 業務邏輯組件 (Business Logic Components)
│   └── 主題層 (Theme Layer)
│       ├── Expert模式主題 (Expert Mode Theme)
│       ├── Inertial模式主題 (Inertial Mode Theme)
│       ├── Cultivation模式主題 (Cultivation Mode Theme)
│       └── Guiding模式主題 (Guiding Mode Theme)
├── 業務邏輯層 (Business Logic Layer)
│   ├── 狀態管理 (State Management)
│   │   ├── 認證狀態管理 (Auth State Management)
│   │   ├── 記帳狀態管理 (Bookkeeping State Management)
│   │   ├── 模式狀態管理 (Mode State Management)
│   │   └── 系統狀態管理 (System State Management)
│   └── 服務層 (Services Layer)
│       ├── API服務 (API Services)
│       ├── 本地儲存服務 (Local Storage Services)
│       ├── 通知服務 (Notification Services)
│       └── 同步服務 (Sync Services)
├── 資料層 (Data Layer)
│   ├── 遠端資料源 (Remote Data Source)
│   │   └── RESTful API Client
│   ├── 本地資料源 (Local Data Source)
│   │   ├── SQLite Database
│   │   └── SharedPreferences
│   └── 快取層 (Cache Layer)
│       ├── 記憶體快取 (Memory Cache)
│       └── 持久快取 (Persistent Cache)
└── 核心層 (Core Layer)
    ├── 配置管理 (Configuration Management)
    ├── 錯誤處理 (Error Handling)
    ├── 網路管理 (Network Management)
    └── 工具類 (Utilities)
```

### 3.2 四模式架構設計(待修改)

#### 3.2.1 模式識別機制(待修改)
依照問卷分成四個模式

#### 3.2.2 差異化組件架構
- **條件渲染組件**：根據用戶模式動態顯示不同UI元素
- **模式適配器**：自動調整功能複雜度與介面佈局
- **主題切換器**：四模式專屬的視覺風格與色彩配置

### 3.3 頁面路由架構

#### 3.3.1 路由結構設計
```dart
// 基於6021 Screen list的完整40個畫面路由架構

// Epic 1: 進入階段畫面群 (S-101 至 S-108)
const String ROUTE_LINE_WELCOME = '/line-welcome';          // S-101 LINE OA 歡迎頁
const String ROUTE_APP_START = '/start';                    // S-102 APP 啟動頁
const String ROUTE_REGISTER = '/register';                  // S-103 APP 註冊頁
const String ROUTE_LOGIN = '/login';                        // S-104 APP 登入頁
const String ROUTE_FORGOT_PASSWORD = '/forgot';             // S-105 忘記密碼頁
const String ROUTE_MODE_ASSESSMENT = '/assessment';         // S-106 模式評估問卷頁
const String ROUTE_PLATFORM_BINDING = '/binding';           // S-107 跨平台綁定頁
const String ROUTE_APP_PROMOTION = '/promotion';            // S-108 APP 下載推廣頁

// Epic 2: 記帳功能畫面群 (S-201 至 S-211)
const String ROUTE_LINE_BOOKKEEPING = '/line-bookkeeping';  // S-201 LINE OA 記帳對話
const String ROUTE_BOOKKEEPING_HOME = '/home';              // S-202 APP 記帳主頁
const String ROUTE_BOOKKEEPING_FORM = '/form';              // S-203 APP 記帳表單頁
const String ROUTE_CATEGORY_SELECTOR = '/category-select';   // S-204 科目選擇頁
const String ROUTE_ACCOUNT_SELECTOR = '/account-select';     // S-205 帳戶選擇頁
const String ROUTE_LEDGER_SELECTOR = '/ledger-select';       // S-206 帳本選擇頁
const String ROUTE_IMAGE_ATTACHMENT = '/attachment';         // S-207 圖片附加頁
const String ROUTE_RECURRING_SETTING = '/recurring';        // S-208 重複設定頁
const String ROUTE_RECORD_MANAGEMENT = '/records';          // S-209 記錄管理頁
const String ROUTE_RECORD_EDIT = '/record-edit';            // S-210 記錄編輯頁
const String ROUTE_STATISTICS_CHART = '/charts';            // S-211 統計圖表頁

// Epic 3-6: 管理功能畫面群 (S-301 至 S-308)
const String ROUTE_LEDGER_MANAGEMENT = '/ledger-management'; // S-301 帳本管理主頁
const String ROUTE_CREATE_LEDGER = '/create-ledger';        // S-302 建立帳本頁
const String ROUTE_COLLABORATION = '/collaboration';         // S-303 協作管理頁
const String ROUTE_ACCOUNT_MANAGEMENT = '/account-management'; // S-304 帳戶管理主頁
const String ROUTE_CREATE_ACCOUNT = '/create-account';       // S-305 建立帳戶頁
const String ROUTE_CATEGORY_MANAGEMENT = '/category-management'; // S-306 科目管理主頁
const String ROUTE_BUDGET_MANAGEMENT = '/budget-management'; // S-307 預算管理主頁
const String ROUTE_CREATE_BUDGET = '/create-budget';        // S-308 建立預算頁

// Epic 7-9: 分析功能畫面群 (S-401 至 S-406)
const String ROUTE_REPORT_ANALYTICS = '/report-analytics';   // S-401 報表分析主頁
const String ROUTE_REPORT_CONFIG = '/report-config';        // S-402 報表設定頁
const String ROUTE_CHART_DISPLAY = '/chart-display';        // S-403圖表展示頁
const String ROUTE_REPORT_DOWNLOAD = '/report-download';    // S-404 報表下載頁
const String ROUTE_DEEP_ANALYTICS = '/deep-analytics';      // S-405 深度分析頁
const String ROUTE_AI_ASSISTANT = '/ai-assistant';          // S-406 AI 助理頁

// Epic 10-15: 系統功能畫面群 (S-501 至 S-507)
const String ROUTE_GAMIFICATION = '/gamification';          // S-501 激勵系統頁
const String ROUTE_DATA_BACKUP = '/backup';                 // S-502 資料備份頁
const String ROUTE_SECURITY_SETTINGS = '/security';         // S-503 安全設定頁
const String ROUTE_NOTIFICATION_SETTINGS = '/notifications'; // S-504 通知設定頁
const String ROUTE_PROFILE_SETTINGS = '/profile';           // S-505 個人設定頁
const String ROUTE_HELP_CENTER = '/help';                   // S-506 幫助中心頁
const String ROUTE_FEEDBACK = '/feedback';                  // S-507 社群回報頁

// 路由群組分類
class AppRoutes {
  // 進入階段路由群
  static const List<String> entryRoutes = [
    ROUTE_LINE_WELCOME,
    ROUTE_APP_START,
    ROUTE_REGISTER,
    ROUTE_LOGIN,
    ROUTE_FORGOT_PASSWORD,
    ROUTE_MODE_ASSESSMENT,
    ROUTE_PLATFORM_BINDING,
    ROUTE_APP_PROMOTION,
  ];

  // 記帳功能路由群
  static const List<String> bookkeepingRoutes = [
    ROUTE_LINE_BOOKKEEPING,
    ROUTE_BOOKKEEPING_HOME,
    ROUTE_BOOKKEEPING_FORM,
    ROUTE_CATEGORY_SELECTOR,
    ROUTE_ACCOUNT_SELECTOR,
    ROUTE_LEDGER_SELECTOR,
    ROUTE_IMAGE_ATTACHMENT,
    ROUTE_RECURRING_SETTING,
    ROUTE_RECORD_MANAGEMENT,
    ROUTE_RECORD_EDIT,
    ROUTE_STATISTICS_CHART,
  ];

  // 管理功能路由群
  static const List<String> managementRoutes = [
    ROUTE_LEDGER_MANAGEMENT,
    ROUTE_CREATE_LEDGER,
    ROUTE_COLLABORATION,
    ROUTE_ACCOUNT_MANAGEMENT,
    ROUTE_CREATE_ACCOUNT,
    ROUTE_CATEGORY_MANAGEMENT,
    ROUTE_BUDGET_MANAGEMENT,
    ROUTE_CREATE_BUDGET,
  ];

  // 分析功能路由群
  static const List<String> analyticsRoutes = [
    ROUTE_REPORT_ANALYTICS,
    ROUTE_REPORT_CONFIG,
    ROUTE_CHART_DISPLAY,
    ROUTE_REPORT_DOWNLOAD,
    ROUTE_DEEP_ANALYTICS,
    ROUTE_AI_ASSISTANT,
  ];

  // 系統功能路由群
  static const List<String> systemRoutes = [
    ROUTE_GAMIFICATION,
    ROUTE_DATA_BACKUP,
    ROUTE_SECURITY_SETTINGS,
    ROUTE_NOTIFICATION_SETTINGS,
    ROUTE_PROFILE_SETTINGS,
    ROUTE_HELP_CENTER,
    ROUTE_FEEDBACK,
  ];

  // 所有路由列表（共40個）
  static const List<String> allRoutes = [
    ...entryRoutes,
    ...bookkeepingRoutes,
    ...managementRoutes,
    ...analyticsRoutes,
    ...systemRoutes,
  ];
}
```

#### 3.3.2 導航控制邏輯
- **模式基礎導航**：根據用戶模式調整導航流程
- **權限控制導航**：基於用戶權限的頁面存取控制
- **深層連結支援**：支援外部應用的深層連結導航

### 3.4 狀態管理架構

#### 3.4.1 本地狀態與全域狀態分離
- **全域狀態**：用戶認證、模式設定、系統配置
- **頁面狀態**：表單輸入、載入狀態、錯誤處理
- **組件狀態**：UI互動、動畫效果、臨時資料

## 4.0 頁面群詳細規格（Page Groups Specification）

基於7021 Screen list的40個畫面，將Presentation Layer分為5大頁面群，每個頁面群對應特定的功能範圍與畫面群組：

### 4.1 進入階段頁面群（Entry Page Group）

#### 4.1.1 頁面群職責範圍
**對應畫面**：S-101至S-108（Epic 1: 進入階段畫面群）
**核心功能**：APP啟動、使用者認證、模式評估、跨平台整合

### 4.2 記帳核心頁面群（Bookkeeping Core Page Group）

#### 4.2.1 頁面群職責範圍
**對應畫面**：S-201至S-211（Epic 2: 記帳功能畫面群）
**核心功能**：記帳交易UI、統計圖表展示、記錄管理頁面

### 4.3 管理功能頁面群（Management Page Group）

#### 4.3.1 頁面群職責範圍
**對應畫面**：S-301至S-308（Epic 3-6: 管理功能畫面群）
**核心功能**：帳本管理頁面、帳戶管理頁面、科目管理頁面、預算管理頁面

### 4.4 分析智慧頁面群（Analytics Intelligence Page Group）

#### 4.4.1 頁面群職責範圍
**對應畫面**：S-401至S-406（Epic 7-9: 分析功能畫面群）
**核心功能**：報表分析頁面、深度分析頁面、AI助理頁面

### 4.5 系統功能頁面群（System Function Page Group）

#### 4.5.1 頁面群職責範圍
**對應畫面**：S-501至S-507（Epic 10-15: 系統功能畫面群）
**核心功能**：激勵系統頁面、資料管理頁面、系統設定頁面、幫助支援頁面
