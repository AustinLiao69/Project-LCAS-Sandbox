
openapi: 3.0.3
info:
  title: ç§‘ç›®ç®¡ç†æœå‹™ API è¦æ ¼
  description: LCAS ç§‘ç›®ç®¡ç†æœå‹™APIè¦æ ¼ï¼Œæä¾›ç§‘ç›®CRUDã€æ¨¹ç‹€çµæ§‹ç®¡ç†å’Œåˆ†é¡åŠŸèƒ½
  version: 2.0.0
  contact:
    name: LCAS SA Team
    email: sa@lcas.com

servers:
  - url: https://api.lcas.com/v2
    description: Production server
  - url: https://staging-api.lcas.com/v2
    description: Staging server

tags:
  - name: Subject Management
    description: ç§‘ç›®ç®¡ç†ç›¸é—œæ“ä½œ
  - name: Subject Tree
    description: ç§‘ç›®æ¨¹ç‹€çµæ§‹ç®¡ç†
  - name: Subject Categories
    description: ç§‘ç›®åˆ†é¡ç®¡ç†

paths:
  /subjects:
    get:
      tags:
        - Subject Management
      summary: å–å¾—ç§‘ç›®åˆ—è¡¨
      description: å–å¾—ç”¨æˆ¶å¯å­˜å–çš„ç§‘ç›®åˆ—è¡¨ï¼Œæ”¯æ´åˆ†é ã€ç¯©é¸å’Œæ¨¹ç‹€çµæ§‹
      operationId: getSubjects
      parameters:
        - name: userId
          in: query
          required: true
          description: ç”¨æˆ¶ID
          schema:
            type: string
            example: "Uae47d9d496e4596d70ed724a7d6e2948"
        - name: ledgerId
          in: query
          description: å¸³æœ¬IDç¯©é¸
          schema:
            type: string
            example: "user_Uae47d9d496e4596d70ed724a7d6e2948"
        - name: userMode
          in: query
          description: ç”¨æˆ¶æ¨¡å¼ï¼ˆå½±éŸ¿å›æ‡‰å…§å®¹ï¼‰
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Expert
            example: "Expert"
        - name: type
          in: query
          description: ç§‘ç›®é¡å‹ç¯©é¸
          schema:
            type: string
            enum: [income, expense, asset, liability, equity]
            example: "expense"
        - name: category
          in: query
          description: ç§‘ç›®åˆ†é¡ç¯©é¸
          schema:
            type: string
            example: "é£Ÿç‰©"
        - name: level
          in: query
          description: éšå±¤ç­‰ç´šç¯©é¸
          schema:
            type: integer
            minimum: 1
            maximum: 5
            example: 1
        - name: parentId
          in: query
          description: çˆ¶ç§‘ç›®IDç¯©é¸
          schema:
            type: string
            example: "subject_food"
        - name: status
          in: query
          description: ç§‘ç›®ç‹€æ…‹ç¯©é¸
          schema:
            type: string
            enum: [active, inactive, archived]
            default: active
            example: "active"
        - name: keyword
          in: query
          description: é—œéµå­—æœå°‹ï¼ˆç§‘ç›®åç¨±ã€ä»£ç¢¼ï¼‰
          schema:
            type: string
            example: "é¤è²»"
        - name: includeTree
          in: query
          description: æ˜¯å¦è¿”å›æ¨¹ç‹€çµæ§‹
          schema:
            type: boolean
            default: false
            example: true
        - name: includeUsage
          in: query
          description: æ˜¯å¦åŒ…å«ä½¿ç”¨çµ±è¨ˆ
          schema:
            type: boolean
            default: false
            example: true
        - name: page
          in: query
          description: é ç¢¼
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: limit
          in: query
          description: æ¯é ç­†æ•¸
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
            example: 50
        - name: sort
          in: query
          description: æ’åºæ–¹å¼
          schema:
            type: string
            enum: [code_asc, code_desc, name_asc, name_desc, usage_desc, createdAt_desc]
            default: code_asc
            example: "code_asc"
        - name: filter
          in: query
          description: é€²éšç¯©é¸æ¢ä»¶ï¼ˆJSONæ ¼å¼ï¼‰
          schema:
            type: string
            example: '{"hasChildren":true,"usageCount":{"min":5}}'
      responses:
        '200':
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      subjects:
                        type: array
                        items:
                          type: object
                          properties:
                            subjectId:
                              type: string
                              description: ç§‘ç›®ID
                              example: "subject_food_restaurant"
                            code:
                              type: string
                              description: ç§‘ç›®ä»£ç¢¼
                              example: "5011001"
                            name:
                              type: string
                              description: ç§‘ç›®åç¨±
                              example: "é¤å»³ç”¨é¤"
                            description:
                              type: string
                              description: ç§‘ç›®æè¿°
                              example: "åœ¨é¤å»³ã€é£¯åº—ç­‰å ´æ‰€ç”¨é¤çš„è²»ç”¨"
                            type:
                              type: string
                              enum: [income, expense, asset, liability, equity]
                              description: ç§‘ç›®é¡å‹
                              example: "expense"
                            category:
                              type: string
                              description: ç§‘ç›®åˆ†é¡
                              example: "é£Ÿç‰©"
                            level:
                              type: integer
                              description: éšå±¤ç­‰ç´š
                              example: 3
                            parentId:
                              type: string
                              description: çˆ¶ç§‘ç›®ID
                              example: "subject_food"
                            parentPath:
                              type: string
                              description: çˆ¶ç§‘ç›®è·¯å¾‘
                              example: "æ”¯å‡º/é£Ÿç‰©"
                            ledgerId:
                              type: string
                              description: æ‰€å±¬å¸³æœ¬ID
                              example: "user_Uae47d9d496e4596d70ed724a7d6e2948"
                            ownerId:
                              type: string
                              description: æ“æœ‰è€…ID
                              example: "Uae47d9d496e4596d70ed724a7d6e2948"
                            status:
                              type: string
                              enum: [active, inactive, archived]
                              description: ç§‘ç›®ç‹€æ…‹
                              example: "active"
                            isSystem:
                              type: boolean
                              description: æ˜¯å¦ç‚ºç³»çµ±é è¨­ç§‘ç›®
                              example: true
                            isLeaf:
                              type: boolean
                              description: æ˜¯å¦ç‚ºè‘‰ç¯€é»ï¼ˆç„¡å­ç§‘ç›®ï¼‰
                              example: true
                            hasChildren:
                              type: boolean
                              description: æ˜¯å¦æœ‰å­ç§‘ç›®
                              example: false
                            childrenCount:
                              type: integer
                              description: å­ç§‘ç›®æ•¸é‡
                              example: 0
                            settings:
                              type: object
                              description: ç§‘ç›®è¨­å®šï¼ˆExpertæ¨¡å¼é¡¯ç¤ºï¼‰
                              properties:
                                allowManualEntry:
                                  type: boolean
                                  example: true
                                suggestOnInput:
                                  type: boolean
                                  example: true
                                trackBudget:
                                  type: boolean
                                  example: true
                                defaultAccount:
                                  type: string
                                  example: "account_default"
                            usage:
                              type: object
                              description: ä½¿ç”¨çµ±è¨ˆï¼ˆéœ€è¦includeUsage=trueï¼‰
                              properties:
                                transactionCount:
                                  type: integer
                                  example: 45
                                totalAmount:
                                  type: number
                                  example: 15678.90
                                lastUsed:
                                  type: string
                                  format: date-time
                                  example: "2025-08-22T10:30:00Z"
                                monthlyAverage:
                                  type: number
                                  example: 2500.00
                            children:
                              type: array
                              description: å­ç§‘ç›®ï¼ˆæ¨¹ç‹€çµæ§‹æ¨¡å¼ï¼‰
                              items:
                                $ref: '#/components/schemas/Subject'
                            createdAt:
                              type: string
                              format: date-time
                              description: å‰µå»ºæ™‚é–“
                              example: "2025-08-22T12:00:00Z"
                            updatedAt:
                              type: string
                              format: date-time
                              description: æœ€å¾Œæ›´æ–°æ™‚é–“
                              example: "2025-08-22T12:00:00Z"
                      tree:
                        type: array
                        description: æ¨¹ç‹€çµæ§‹ï¼ˆincludeTree=trueæ™‚ï¼‰
                        items:
                          $ref: '#/components/schemas/SubjectTree'
                  metadata:
                    type: object
                    properties:
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          totalPages:
                            type: integer
                            example: 4
                          totalCount:
                            type: integer
                            example: 156
                          hasNext:
                            type: boolean
                            example: true
                          hasPrevious:
                            type: boolean
                            example: false
                          pageSize:
                            type: integer
                            example: 50
                      filters:
                        type: object
                        properties:
                          appliedFilters:
                            type: object
                            example: {"type": "expense", "status": "active"}
                          userMode:
                            type: string
                            example: "Expert"
                          includeTree:
                            type: boolean
                            example: true
                          includeUsage:
                            type: boolean
                            example: true
                      summary:
                        type: object
                        properties:
                          totalSubjects:
                            type: integer
                            example: 156
                          subjectTypes:
                            type: object
                            properties:
                              income:
                                type: integer
                                example: 25
                              expense:
                                type: integer
                                example: 95
                              asset:
                                type: integer
                                example: 20
                              liability:
                                type: integer
                                example: 16
                          maxLevel:
                            type: integer
                            example: 4
                          systemSubjects:
                            type: integer
                            example: 140
                          customSubjects:
                            type: integer
                            example: 16

    post:
      tags:
        - Subject Management
      summary: å‰µå»ºæ–°ç§‘ç›®
      description: å‰µå»ºæ–°çš„æœƒè¨ˆç§‘ç›®
      operationId: createSubject
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - type
                - ledgerId
                - ownerId
              properties:
                name:
                  type: string
                  description: ç§‘ç›®åç¨±
                  example: "å’–å•¡åº—æ¶ˆè²»"
                description:
                  type: string
                  description: ç§‘ç›®æè¿°
                  example: "åœ¨å’–å•¡åº—ã€èŒ¶é£²åº—ç­‰æ¶ˆè²»"
                code:
                  type: string
                  description: ç§‘ç›®ä»£ç¢¼ï¼ˆå¯é¸ï¼Œç³»çµ±è‡ªå‹•ç”Ÿæˆï¼‰
                  example: "5011002"
                type:
                  type: string
                  enum: [income, expense, asset, liability, equity]
                  description: ç§‘ç›®é¡å‹
                  example: "expense"
                category:
                  type: string
                  description: ç§‘ç›®åˆ†é¡
                  example: "é£Ÿç‰©"
                parentId:
                  type: string
                  description: çˆ¶ç§‘ç›®IDï¼ˆå¯é¸ï¼‰
                  example: "subject_food"
                ledgerId:
                  type: string
                  description: æ‰€å±¬å¸³æœ¬ID
                  example: "user_Uae47d9d496e4596d70ed724a7d6e2948"
                ownerId:
                  type: string
                  description: æ“æœ‰è€…ID
                  example: "Uae47d9d496e4596d70ed724a7d6e2948"
                settings:
                  type: object
                  description: ç§‘ç›®è¨­å®š
                  properties:
                    allowManualEntry:
                      type: boolean
                      default: true
                      example: true
                    suggestOnInput:
                      type: boolean
                      default: true
                      example: true
                    trackBudget:
                      type: boolean
                      default: true
                      example: true
                    defaultAccount:
                      type: string
                      example: "account_cash"
                tags:
                  type: array
                  description: ç§‘ç›®æ¨™ç±¤
                  items:
                    type: string
                  example: ["é£²æ–™", "æ—¥å¸¸", "å¤–é£Ÿ"]
      responses:
        '201':
          description: å‰µå»ºæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      subjectId:
                        type: string
                        description: ç§‘ç›®ID
                        example: "subject_coffee_shop"
                      code:
                        type: string
                        description: ç§‘ç›®ä»£ç¢¼
                        example: "5011002"
                      name:
                        type: string
                        description: ç§‘ç›®åç¨±
                        example: "å’–å•¡åº—æ¶ˆè²»"
                      type:
                        type: string
                        description: ç§‘ç›®é¡å‹
                        example: "expense"
                      level:
                        type: integer
                        description: éšå±¤ç­‰ç´š
                        example: 3
                      parentId:
                        type: string
                        description: çˆ¶ç§‘ç›®ID
                        example: "subject_food"
                      createdAt:
                        type: string
                        format: date-time
                        description: å‰µå»ºæ™‚é–“
                        example: "2025-08-22T12:00:00Z"
                  metadata:
                    type: object
                    properties:
                      autoGeneratedCode:
                        type: boolean
                        example: true
                      parentPath:
                        type: string
                        example: "æ”¯å‡º/é£Ÿç‰©"

  /subjects/{subjectId}:
    get:
      tags:
        - Subject Management
      summary: å–å¾—ç§‘ç›®è©³ç´°è³‡è¨Š
      description: å–å¾—æŒ‡å®šç§‘ç›®çš„è©³ç´°è³‡è¨Š
      operationId: getSubjectDetails
      parameters:
        - name: subjectId
          in: path
          required: true
          description: ç§‘ç›®ID
          schema:
            type: string
            example: "subject_food_restaurant"
        - name: userId
          in: query
          required: true
          description: è«‹æ±‚ç”¨æˆ¶ID
          schema:
            type: string
            example: "Uae47d9d496e4596d70ed724a7d6e2948"
        - name: userMode
          in: query
          description: ç”¨æˆ¶æ¨¡å¼ï¼ˆå½±éŸ¿å›æ‡‰å…§å®¹ç´°ç¯€ï¼‰
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Expert
            example: "Expert"
        - name: includeChildren
          in: query
          description: æ˜¯å¦åŒ…å«å­ç§‘ç›®
          schema:
            type: boolean
            default: false
            example: true
        - name: includeParents
          in: query
          description: æ˜¯å¦åŒ…å«çˆ¶ç§‘ç›®è·¯å¾‘
          schema:
            type: boolean
            default: true
            example: true
        - name: includeUsage
          in: query
          description: æ˜¯å¦åŒ…å«ä½¿ç”¨çµ±è¨ˆ
          schema:
            type: boolean
            default: true
            example: true
        - name: includeTransactions
          in: query
          description: æ˜¯å¦åŒ…å«æœ€è¿‘äº¤æ˜“
          schema:
            type: boolean
            default: false
            example: true
      responses:
        '200':
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      subjectId:
                        type: string
                        description: ç§‘ç›®ID
                        example: "subject_food_restaurant"
                      code:
                        type: string
                        description: ç§‘ç›®ä»£ç¢¼
                        example: "5011001"
                      name:
                        type: string
                        description: ç§‘ç›®åç¨±
                        example: "é¤å»³ç”¨é¤"
                      description:
                        type: string
                        description: ç§‘ç›®æè¿°
                        example: "åœ¨é¤å»³ã€é£¯åº—ç­‰å ´æ‰€ç”¨é¤çš„è²»ç”¨"
                      type:
                        type: string
                        description: ç§‘ç›®é¡å‹
                        example: "expense"
                      category:
                        type: string
                        description: ç§‘ç›®åˆ†é¡
                        example: "é£Ÿç‰©"
                      level:
                        type: integer
                        description: éšå±¤ç­‰ç´š
                        example: 3
                      parentId:
                        type: string
                        description: çˆ¶ç§‘ç›®ID
                        example: "subject_food"
                      ledgerId:
                        type: string
                        description: æ‰€å±¬å¸³æœ¬ID
                        example: "user_Uae47d9d496e4596d70ed724a7d6e2948"
                      ownerId:
                        type: string
                        description: æ“æœ‰è€…ID
                        example: "Uae47d9d496e4596d70ed724a7d6e2948"
                      status:
                        type: string
                        description: ç§‘ç›®ç‹€æ…‹
                        example: "active"
                      isSystem:
                        type: boolean
                        description: æ˜¯å¦ç‚ºç³»çµ±é è¨­ç§‘ç›®
                        example: true
                      isLeaf:
                        type: boolean
                        description: æ˜¯å¦ç‚ºè‘‰ç¯€é»
                        example: true
                      parentPath:
                        type: array
                        description: çˆ¶ç§‘ç›®è·¯å¾‘
                        items:
                          type: object
                          properties:
                            subjectId:
                              type: string
                              example: "subject_expense"
                            name:
                              type: string
                              example: "æ”¯å‡º"
                            level:
                              type: integer
                              example: 1
                      children:
                        type: array
                        description: å­ç§‘ç›®åˆ—è¡¨
                        items:
                          type: object
                          properties:
                            subjectId:
                              type: string
                              example: "subject_fast_food"
                            name:
                              type: string
                              example: "é€Ÿé£Ÿ"
                            code:
                              type: string
                              example: "5011002"
                            isLeaf:
                              type: boolean
                              example: true
                      settings:
                        type: object
                        description: ç§‘ç›®è¨­å®š
                        properties:
                          allowManualEntry:
                            type: boolean
                            example: true
                          suggestOnInput:
                            type: boolean
                            example: true
                          trackBudget:
                            type: boolean
                            example: true
                          defaultAccount:
                            type: string
                            example: "account_cash"
                          notifications:
                            type: boolean
                            example: true
                      usage:
                        type: object
                        description: ä½¿ç”¨çµ±è¨ˆ
                        properties:
                          transactionCount:
                            type: integer
                            example: 45
                          totalAmount:
                            type: number
                            example: 15678.90
                          averageAmount:
                            type: number
                            example: 348.42
                          lastUsed:
                            type: string
                            format: date-time
                            example: "2025-08-22T10:30:00Z"
                          monthlyStats:
                            type: object
                            properties:
                              currentMonth:
                                type: number
                                example: 3500.00
                              previousMonth:
                                type: number
                                example: 2800.00
                              average:
                                type: number
                                example: 2500.00
                      recentTransactions:
                        type: array
                        description: æœ€è¿‘äº¤æ˜“
                        items:
                          type: object
                          properties:
                            transactionId:
                              type: string
                              example: "txn_123"
                            amount:
                              type: number
                              example: 500.00
                            description:
                              type: string
                              example: "åˆé¤"
                            date:
                              type: string
                              format: date-time
                              example: "2025-08-22T12:00:00Z"
                      tags:
                        type: array
                        description: ç§‘ç›®æ¨™ç±¤
                        items:
                          type: string
                        example: ["å¤–é£Ÿ", "æ­£é¤", "å•†å‹™"]
                      permissions:
                        type: object
                        description: ç”¨æˆ¶æ¬Šé™
                        properties:
                          canRead:
                            type: boolean
                            example: true
                          canWrite:
                            type: boolean
                            example: true
                          canDelete:
                            type: boolean
                            example: false
                          canModifySettings:
                            type: boolean
                            example: true
                      createdAt:
                        type: string
                        format: date-time
                        description: å‰µå»ºæ™‚é–“
                        example: "2025-08-22T12:00:00Z"
                      updatedAt:
                        type: string
                        format: date-time
                        description: æœ€å¾Œæ›´æ–°æ™‚é–“
                        example: "2025-08-22T12:00:00Z"
                  metadata:
                    type: object
                    properties:
                      userMode:
                        type: string
                        example: "Expert"
                      includeChildren:
                        type: boolean
                        example: true
                      includeUsage:
                        type: boolean
                        example: true

    put:
      tags:
        - Subject Management
      summary: æ›´æ–°ç§‘ç›®è³‡è¨Š
      description: æ›´æ–°ç§‘ç›®çš„åŸºæœ¬è³‡è¨Šå’Œè¨­å®š
      operationId: updateSubject
      parameters:
        - name: subjectId
          in: path
          required: true
          description: ç§‘ç›®ID
          schema:
            type: string
            example: "subject_food_restaurant"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: ç§‘ç›®åç¨±
                  example: "æ›´æ–°å¾Œçš„ç§‘ç›®åç¨±"
                description:
                  type: string
                  description: ç§‘ç›®æè¿°
                  example: "æ›´æ–°å¾Œçš„ç§‘ç›®æè¿°"
                category:
                  type: string
                  description: ç§‘ç›®åˆ†é¡
                  example: "æ–°åˆ†é¡"
                parentId:
                  type: string
                  description: çˆ¶ç§‘ç›®IDï¼ˆç§»å‹•ç§‘ç›®ï¼‰
                  example: "subject_new_parent"
                status:
                  type: string
                  enum: [active, inactive, archived]
                  description: ç§‘ç›®ç‹€æ…‹
                  example: "active"
                settings:
                  type: object
                  description: ç§‘ç›®è¨­å®š
                  properties:
                    allowManualEntry:
                      type: boolean
                      example: true
                    suggestOnInput:
                      type: boolean
                      example: false
                    trackBudget:
                      type: boolean
                      example: true
                    defaultAccount:
                      type: string
                      example: "account_new_default"
                tags:
                  type: array
                  description: ç§‘ç›®æ¨™ç±¤
                  items:
                    type: string
                  example: ["æ–°æ¨™ç±¤1", "æ–°æ¨™ç±¤2"]
                userId:
                  type: string
                  description: æ“ä½œç”¨æˆ¶ID
                  example: "Uae47d9d496e4596d70ed724a7d6e2948"
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      subjectId:
                        type: string
                        example: "subject_food_restaurant"
                      updatedFields:
                        type: array
                        items:
                          type: string
                        example: ["name", "description", "settings"]
                      parentChanged:
                        type: boolean
                        description: æ˜¯å¦è®Šæ›´äº†çˆ¶ç§‘ç›®
                        example: false
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-08-22T12:00:00Z"

    delete:
      tags:
        - Subject Management
      summary: åˆªé™¤ç§‘ç›®
      description: åˆªé™¤æŒ‡å®šçš„ç§‘ç›®ï¼ˆéœ€è¦æ¬Šé™é©—è­‰ï¼‰
      operationId: deleteSubject
      parameters:
        - name: subjectId
          in: path
          required: true
          description: ç§‘ç›®ID
          schema:
            type: string
            example: "subject_food_restaurant"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - confirmationToken
                - userId
              properties:
                confirmationToken:
                  type: string
                  description: ç¢ºèªåˆªé™¤çš„ä»¤ç‰Œ
                  example: "confirm_delete_subject_food_restaurant"
                userId:
                  type: string
                  description: æ“ä½œç”¨æˆ¶ID
                  example: "Uae47d9d496e4596d70ed724a7d6e2948"
                transferTransactions:
                  type: string
                  description: äº¤æ˜“è½‰ç§»åˆ°çš„ç§‘ç›®IDï¼ˆå¯é¸ï¼‰
                  example: "subject_other"
                deleteTransactions:
                  type: boolean
                  description: æ˜¯å¦åŒæ™‚åˆªé™¤ç›¸é—œäº¤æ˜“
                  default: false
                  example: false
                handleChildren:
                  type: string
                  enum: [delete, move_to_parent, keep_orphan]
                  description: å­ç§‘ç›®è™•ç†æ–¹å¼
                  default: move_to_parent
                  example: "move_to_parent"
      responses:
        '200':
          description: åˆªé™¤æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      subjectId:
                        type: string
                        example: "subject_food_restaurant"
                      transferredTransactions:
                        type: integer
                        description: è½‰ç§»çš„äº¤æ˜“æ•¸é‡
                        example: 25
                      deletedTransactions:
                        type: integer
                        description: åˆªé™¤çš„äº¤æ˜“æ•¸é‡
                        example: 0
                      affectedChildren:
                        type: integer
                        description: å—å½±éŸ¿çš„å­ç§‘ç›®æ•¸é‡
                        example: 3
                      deletedAt:
                        type: string
                        format: date-time
                        example: "2025-08-22T12:00:00Z"

  /subjects/tree:
    get:
      tags:
        - Subject Tree
      summary: å–å¾—ç§‘ç›®æ¨¹ç‹€çµæ§‹
      description: å–å¾—å®Œæ•´çš„ç§‘ç›®æ¨¹ç‹€çµæ§‹
      operationId: getSubjectTree
      parameters:
        - name: userId
          in: query
          required: true
          description: ç”¨æˆ¶ID
          schema:
            type: string
            example: "Uae47d9d496e4596d70ed724a7d6e2948"
        - name: ledgerId
          in: query
          description: å¸³æœ¬IDç¯©é¸
          schema:
            type: string
            example: "user_Uae47d9d496e4596d70ed724a7d6e2948"
        - name: userMode
          in: query
          description: ç”¨æˆ¶æ¨¡å¼ï¼ˆå½±éŸ¿å›æ‡‰å…§å®¹ï¼‰
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Expert
            example: "Expert"
        - name: type
          in: query
          description: ç§‘ç›®é¡å‹ç¯©é¸
          schema:
            type: string
            enum: [income, expense, asset, liability, equity]
            example: "expense"
        - name: maxLevel
          in: query
          description: æœ€å¤§å±¤ç´š
          schema:
            type: integer
            minimum: 1
            maximum: 10
            default: 5
            example: 3
        - name: includeUsage
          in: query
          description: æ˜¯å¦åŒ…å«ä½¿ç”¨çµ±è¨ˆ
          schema:
            type: boolean
            default: false
            example: true
        - name: includeInactive
          in: query
          description: æ˜¯å¦åŒ…å«éæ´»å‹•ç§‘ç›®
          schema:
            type: boolean
            default: false
            example: false
      responses:
        '200':
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      tree:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubjectTree'
                  metadata:
                    type: object
                    properties:
                      userMode:
                        type: string
                        example: "Expert"
                      maxLevel:
                        type: integer
                        example: 3
                      includeUsage:
                        type: boolean
                        example: true
                      totalNodes:
                        type: integer
                        example: 156
                      totalLevels:
                        type: integer
                        example: 4

  /subjects/categories:
    get:
      tags:
        - Subject Categories
      summary: å–å¾—ç§‘ç›®åˆ†é¡åˆ—è¡¨
      description: å–å¾—ç³»çµ±æ”¯æ´çš„ç§‘ç›®åˆ†é¡
      operationId: getSubjectCategories
      parameters:
        - name: type
          in: query
          description: ç§‘ç›®é¡å‹ç¯©é¸
          schema:
            type: string
            enum: [income, expense, asset, liability, equity]
            example: "expense"
        - name: userMode
          in: query
          description: ç”¨æˆ¶æ¨¡å¼ï¼ˆå½±éŸ¿å›æ‡‰å…§å®¹ç´°ç¯€ï¼‰
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Expert
            example: "Expert"
      responses:
        '200':
          description: å–å¾—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      categories:
                        type: array
                        items:
                          type: object
                          properties:
                            category:
                              type: string
                              example: "é£Ÿç‰©"
                            displayName:
                              type: string
                              example: "é£²é£Ÿè²»ç”¨"
                            description:
                              type: string
                              example: "æ‰€æœ‰èˆ‡é£²é£Ÿç›¸é—œçš„è²»ç”¨"
                            type:
                              type: string
                              example: "expense"
                            subjectCount:
                              type: integer
                              example: 15
                            examples:
                              type: array
                              items:
                                type: string
                              example: ["é¤å»³ç”¨é¤", "é€Ÿé£Ÿ", "å’–å•¡"]
                            icon:
                              type: string
                              example: "ğŸ½ï¸"
                            color:
                              type: string
                              example: "#FF6B6B"
                  metadata:
                    type: object
                    properties:
                      userMode:
                        type: string
                        example: "Expert"
                      totalCategories:
                        type: integer
                        example: 25

components:
  schemas:
    Subject:
      type: object
      properties:
        subjectId:
          type: string
          description: ç§‘ç›®ID
          example: "subject_food_restaurant"
        code:
          type: string
          description: ç§‘ç›®ä»£ç¢¼
          example: "5011001"
        name:
          type: string
          description: ç§‘ç›®åç¨±
          example: "é¤å»³ç”¨é¤"
        type:
          type: string
          enum: [income, expense, asset, liability, equity]
          description: ç§‘ç›®é¡å‹
          example: "expense"
        level:
          type: integer
          description: éšå±¤ç­‰ç´š
          example: 3

    SubjectTree:
      type: object
      properties:
        subjectId:
          type: string
          example: "subject_expense"
        code:
          type: string
          example: "5000"
        name:
          type: string
          example: "æ”¯å‡º"
        type:
          type: string
          example: "expense"
        level:
          type: integer
          example: 1
        hasChildren:
          type: boolean
          example: true
        children:
          type: array
          items:
            $ref: '#/components/schemas/SubjectTree'

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              example: "ERROR_CODE"
            message:
              type: string
              example: "éŒ¯èª¤è¨Šæ¯"
            details:
              type: string
              example: "è©³ç´°éŒ¯èª¤èªªæ˜"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

security:
  - BearerAuth: []
