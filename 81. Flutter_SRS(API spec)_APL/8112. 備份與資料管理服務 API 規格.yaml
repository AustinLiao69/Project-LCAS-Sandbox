openapi: 3.0.3
info:
  title: LCAS 2.0 å‚™ä»½èˆ‡è³‡æ–™ç®¡ç†æœå‹™ API
  version: 1.0.0
  description: |
    **å‚™ä»½èˆ‡è³‡æ–™ç®¡ç†æœå‹™ API è¦æ ¼æ›¸**

    **ç‰ˆæœ¬**: 1.0.0  
    **å»ºç«‹æ—¥æœŸ**: 2025-08-22  
    **æœ€å¾Œæ›´æ–°**: 2025-08-22  
    **å»ºç«‹è€…**: AustinLiao69  

    ---

    ## ğŸ“‹ æœå‹™æ¦‚è¿°

    å‚™ä»½èˆ‡è³‡æ–™ç®¡ç†æœå‹™æä¾›å®Œæ•´çš„è³‡æ–™å‚™ä»½ã€é‚„åŸèˆ‡åŒ¯å…¥åŒ¯å‡ºåŠŸèƒ½ï¼Œç¢ºä¿ä½¿ç”¨è€…è³‡æ–™çš„å®‰å…¨æ€§èˆ‡å¯æ”œæ€§ã€‚

    ### ğŸ¯ æ ¸å¿ƒåŠŸèƒ½
    - **å‚™ä»½ç®¡ç†**: å»ºç«‹ã€åˆ—è¡¨ã€ç‹€æ…‹æŸ¥è©¢
    - **è³‡æ–™é‚„åŸ**: å¾å‚™ä»½æª”æ¡ˆé‚„åŸè³‡æ–™
    - **è³‡æ–™åŒ¯å‡º**: æ”¯æ´å¤šç¨®æ ¼å¼åŒ¯å‡º
    - **è³‡æ–™åŒ¯å…¥**: å¾å¤–éƒ¨æª”æ¡ˆåŒ¯å…¥è³‡æ–™

    ### ğŸ”§ å››æ¨¡å¼æ”¯æ´
    - **Expert**: è©³ç´°å‚™ä»½æ§åˆ¶ã€é€²éšè¨­å®šé¸é …
    - **Inertial**: æ¨™æº–å‚™ä»½æµç¨‹ã€å›ºå®šè¨­å®š
    - **Cultivation**: å¼•å°å¼å‚™ä»½ã€é€²åº¦è¿½è¹¤
    - **Guiding**: è‡ªå‹•å‚™ä»½ã€æœ€ç°¡åŒ–æ“ä½œ

    ### ğŸ“Š å°æ‡‰ç•«é¢
    - **S-502**: è³‡æ–™å‚™ä»½é 

servers:
  - url: https://api.lcas.app/v1
    description: Production server
  - url: https://staging-api.lcas.app/v1
    description: Staging server

security:
  - BearerAuth: []

tags:
  - name: backup
    description: å‚™ä»½ç®¡ç†ç›¸é—œ API
  - name: data
    description: è³‡æ–™åŒ¯å…¥åŒ¯å‡ºç›¸é—œ API

paths:
  /backup/create:
    post:
      tags:
        - backup
      summary: å»ºç«‹å‚™ä»½
      description: |
        å»ºç«‹ä½¿ç”¨è€…è³‡æ–™çš„å®Œæ•´å‚™ä»½

        **å°æ‡‰ç•«é¢**: S-502 è³‡æ–™å‚™ä»½é 
        **User Story**: US-031

        **å››æ¨¡å¼å·®ç•°**:
        - **Expert**: æ”¯æ´è‡ªå®šç¾©å‚™ä»½ç¯„åœã€å£“ç¸®ç­‰ç´š
        - **Inertial**: æ¨™æº–å…¨é‡å‚™ä»½
        - **Cultivation**: å¼•å°å¼å‚™ä»½è¨­å®š
        - **Guiding**: è‡ªå‹•åŒ–ä¸€éµå‚™ä»½
      parameters:
        - name: X-User-Mode
          in: header
          description: ä½¿ç”¨è€…æ¨¡å¼
          required: false
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Inertial
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                backupName:
                  type: string
                  description: å‚™ä»½åç¨±
                  example: "æ¯é€±å‚™ä»½_2025-08-22"
                  maxLength: 100
                description:
                  type: string
                  description: å‚™ä»½æè¿°
                  example: "åŒ…å«æ‰€æœ‰è¨˜å¸³è³‡æ–™çš„å®Œæ•´å‚™ä»½"
                  maxLength: 500
                includeData:
                  type: object
                  description: è¦å‚™ä»½çš„è³‡æ–™é¡å‹
                  properties:
                    transactions:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«äº¤æ˜“è¨˜éŒ„
                      default: true
                    ledgers:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«å¸³æœ¬è³‡æ–™
                      default: true
                    accounts:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«å¸³æˆ¶è³‡æ–™
                      default: true
                    categories:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«ç§‘ç›®è³‡æ–™
                      default: true
                    budgets:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«é ç®—è³‡æ–™
                      default: true
                    settings:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«ä½¿ç”¨è€…è¨­å®š
                      default: true
                dateRange:
                  type: object
                  description: å‚™ä»½çš„æ™‚é–“ç¯„åœï¼ˆåƒ…Expertæ¨¡å¼ï¼‰
                  properties:
                    startDate:
                      type: string
                      format: date
                      description: é–‹å§‹æ—¥æœŸ
                      example: "2025-01-01"
                    endDate:
                      type: string
                      format: date
                      description: çµæŸæ—¥æœŸ
                      example: "2025-08-22"
                compressionLevel:
                  type: integer
                  description: å£“ç¸®ç­‰ç´š (1-9ï¼Œåƒ…Expertæ¨¡å¼)
                  minimum: 1
                  maximum: 9
                  default: 6
                isEncrypted:
                  type: boolean
                  description: æ˜¯å¦åŠ å¯†å‚™ä»½æª”æ¡ˆ
                  default: true
              required:
                - backupName
            examples:
              expert_backup:
                summary: Expertæ¨¡å¼ - è‡ªå®šç¾©å‚™ä»½
                value:
                  backupName: "å°ˆæ¡ˆè¨˜å¸³å‚™ä»½_Q3"
                  description: "2025å¹´ç¬¬ä¸‰å­£å°ˆæ¡ˆç›¸é—œè¨˜å¸³è³‡æ–™"
                  includeData:
                    transactions: true
                    ledgers: true
                    accounts: true
                    categories: false
                    budgets: true
                    settings: false
                  dateRange:
                    startDate: "2025-07-01"
                    endDate: "2025-09-30"
                  compressionLevel: 9
                  isEncrypted: true
              simple_backup:
                summary: ç°¡å–®æ¨¡å¼ - å®Œæ•´å‚™ä»½
                value:
                  backupName: "å®Œæ•´å‚™ä»½_2025-08-22"
                  description: "æ‰€æœ‰è³‡æ–™çš„å®Œæ•´å‚™ä»½"
      responses:
        '200':
          description: å‚™ä»½å»ºç«‹æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      backupId:
                        type: string
                        format: uuid
                        description: å‚™ä»½ä»»å‹™ID
                        example: "backup_67890"
                      status:
                        type: string
                        enum: [queued, processing]
                        description: å‚™ä»½ç‹€æ…‹
                        example: "queued"
                      estimatedTime:
                        type: integer
                        description: é ä¼°å®Œæˆæ™‚é–“ï¼ˆç§’ï¼‰
                        example: 120
                      createdAt:
                        type: string
                        format: date-time
                        description: å»ºç«‹æ™‚é–“
                        example: "2025-08-22T10:30:00Z"
                      message:
                        type: string
                        description: ç‹€æ…‹è¨Šæ¯
                        example: "å‚™ä»½å·²æ’å…¥ä½‡åˆ—ï¼Œè«‹ç¨å€™"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        description: "API å›æ‡‰æ™‚é–“æˆ³"
                        example: "2025-08-22T10:30:00Z"
                      requestId:
                        type: string
                        format: uuid
                        description: "è«‹æ±‚å”¯ä¸€è­˜åˆ¥ç¢¼"
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        description: "ç”¨æˆ¶ç•¶å‰æ¨¡å¼"
                        example: "Expert"
                      apiVersion:
                        type: string
                        example: "v1.0.0"
                        description: "API ç‰ˆæœ¬"
                      processingTimeMs:
                        type: number
                        example: 200
                        description: "è™•ç†æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰"
                      modeFeatures:
                        type: object
                        description: "å››æ¨¡å¼ç‰¹å®šæ¬„ä½"
                        properties:
                          detailedAnalytics:
                            type: boolean
                            example: true
                          advancedOptions:
                            type: boolean
                            example: true
                          performanceMetrics:
                            type: boolean
                            example: true
              examples:
                expert_response:
                  summary: Expertæ¨¡å¼å›æ‡‰
                  value:
                    success: true
                    data:
                      backupId: "backup_67890"
                      status: "processing"
                      estimatedTime: 180
                      createdAt: "2025-08-22T10:30:00Z"
                      message: "æ­£åœ¨å»ºç«‹è‡ªå®šç¾©ç¯„åœå‚™ä»½"
                      details:
                        totalItems: 15420
                        processedItems: 0
                        compressionLevel: 9
                guiding_response:
                  summary: Guidingæ¨¡å¼å›æ‡‰
                  value:
                    success: true
                    data:
                      backupId: "backup_67890"
                      status: "processing"
                      estimatedTime: 60
                      createdAt: "2025-08-22T10:30:00Z"
                      message: "æ­£åœ¨ç‚ºæ‚¨å»ºç«‹å‚™ä»½..."
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/TooManyRequests'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /backup/list:
    get:
      tags:
        - backup
      summary: å‚™ä»½åˆ—è¡¨
      description: |
        å–å¾—ä½¿ç”¨è€…çš„å‚™ä»½æª”æ¡ˆåˆ—è¡¨

        **å°æ‡‰ç•«é¢**: S-502 è³‡æ–™å‚™ä»½é 
        **User Story**: US-031

        **å››æ¨¡å¼å·®ç•°**:
        - **Expert**: é¡¯ç¤ºè©³ç´°å‚™ä»½è³‡è¨Šã€å¤§å°ã€è¨­å®š
        - **Inertial**: é¡¯ç¤ºåŸºæœ¬å‚™ä»½åˆ—è¡¨
        - **Cultivation**: é¡¯ç¤ºå‚™ä»½é€²åº¦ã€æˆå°±
        - **Guiding**: é¡¯ç¤ºæœ€è¿‘å‚™ä»½ç‹€æ…‹
      parameters:
        - name: X-User-Mode
          in: header
          description: ä½¿ç”¨è€…æ¨¡å¼
          required: false
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Inertial
        - name: page
          in: query
          description: åˆ†é ç·¨è™Ÿ
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: æ¯é ç­†æ•¸
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: status
          in: query
          description: å‚™ä»½ç‹€æ…‹ç¯©é¸
          required: false
          schema:
            type: string
            enum: [all, completed, processing, failed]
            default: all
        - name: sortBy
          in: query
          description: æ’åºæ¬„ä½
          required: false
          schema:
            type: string
            enum: [createdAt, name, size]
            default: createdAt
        - name: sortOrder
          in: query
          description: æ’åºæ–¹å‘
          required: false
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: æˆåŠŸå–å¾—å‚™ä»½åˆ—è¡¨
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      backups:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              format: uuid
                              description: å‚™ä»½ID
                              example: "backup_67890"
                            name:
                              type: string
                              description: å‚™ä»½åç¨±
                              example: "æ¯é€±å‚™ä»½_2025-08-22"
                            description:
                              type: string
                              description: å‚™ä»½æè¿°
                              example: "åŒ…å«æ‰€æœ‰è¨˜å¸³è³‡æ–™çš„å®Œæ•´å‚™ä»½"
                            status:
                              type: string
                              enum: [completed, processing, failed, queued]
                              description: å‚™ä»½ç‹€æ…‹
                              example: "completed"
                            size:
                              type: integer
                              description: æª”æ¡ˆå¤§å°ï¼ˆä½å…ƒçµ„ï¼‰
                              example: 2048576
                            sizeFormatted:
                              type: string
                              description: æ ¼å¼åŒ–çš„æª”æ¡ˆå¤§å°
                              example: "2.0 MB"
                            createdAt:
                              type: string
                              format: date-time
                              description: å»ºç«‹æ™‚é–“
                              example: "2025-08-22T10:30:00Z"
                            completedAt:
                              type: string
                              format: date-time
                              description: å®Œæˆæ™‚é–“
                              example: "2025-08-22T10:32:15Z"
                            expiresAt:
                              type: string
                              format: date-time
                              description: éæœŸæ™‚é–“
                              example: "2025-11-22T10:30:00Z"
                            isEncrypted:
                              type: boolean
                              description: æ˜¯å¦åŠ å¯†
                              example: true
                            dataTypes:
                              type: array
                              items:
                                type: string
                              description: åŒ…å«çš„è³‡æ–™é¡å‹
                              example: ["transactions", "ledgers", "accounts"]
                            downloadUrl:
                              type: string
                              format: uri
                              description: ä¸‹è¼‰é€£çµï¼ˆåƒ…completedç‹€æ…‹ï¼‰
                              example: "https://api.lcas.app/v1/backup/backup_67890/download"
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          totalPages:
                            type: integer
                            example: 3
                          totalItems:
                            type: integer
                            example: 15
                          pageSize:
                            type: integer
                            example: 20
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        description: å›æ‡‰æ™‚é–“æˆ³
                        example: "2025-08-22T11:00:00Z"
                      requestId:
                        type: string
                        format: uuid
                        description: è«‹æ±‚è¿½è¹¤ID
                        example: "req-uuid-456"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        description: ä½¿ç”¨è€…æ¨¡å¼
                        example: "Expert"
              examples:
                expert_response:
                  summary: Expertæ¨¡å¼ - è©³ç´°å‚™ä»½è³‡è¨Š
                  value:
                    success: true
                    data:
                      backups:
                        - id: "backup_67890"
                          name: "å°ˆæ¡ˆè¨˜å¸³å‚™ä»½_Q3"
                          description: "2025å¹´ç¬¬ä¸‰å­£å°ˆæ¡ˆç›¸é—œè¨˜å¸³è³‡æ–™"
                          status: "completed"
                          size: 2048576
                          sizeFormatted: "2.0 MB"
                          createdAt: "2025-08-22T10:30:00Z"
                          completedAt: "2025-08-22T10:32:15Z"
                          expiresAt: "2025-11-22T10:30:00Z"
                          isEncrypted: true
                          compressionLevel: 9
                          dataTypes: ["transactions", "ledgers", "budgets"]
                          downloadUrl: "https://api.lcas.app/v1/backup/backup_67890/download"
                          statistics:
                            transactionCount: 1520
                            ledgerCount: 3
                            accountCount: 8
                guiding_response:
                  summary: Guidingæ¨¡å¼ - ç°¡åŒ–è³‡è¨Š
                  value:
                    success: true
                    data:
                      backups:
                        - id: "backup_67890"
                          name: "è‡ªå‹•å‚™ä»½_2025-08-22"
                          status: "completed"
                          createdAt: "2025-08-22T10:30:00Z"
                          downloadUrl: "https://api.lcas.app/v1/backup/backup_67890/download"
                          message: "å‚™ä»½å®Œæˆï¼Œå¯ä»¥ä¸‹è¼‰"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /backup/restore:
    post:
      tags:
        - backup
      summary: é‚„åŸå‚™ä»½
      description: |
        å¾å‚™ä»½æª”æ¡ˆé‚„åŸä½¿ç”¨è€…è³‡æ–™

        **å°æ‡‰ç•«é¢**: S-502 è³‡æ–™å‚™ä»½é 
        **User Story**: US-032

        **å››æ¨¡å¼å·®ç•°**:
        - **Expert**: é¸æ“‡æ€§é‚„åŸã€è¡çªè™•ç†é¸é …
        - **Inertial**: æ¨™æº–å®Œæ•´é‚„åŸ
        - **Cultivation**: å¼•å°å¼é‚„åŸæµç¨‹
        - **Guiding**: ä¸€éµå®Œæ•´é‚„åŸ
      parameters:
        - name: X-User-Mode
          in: header
          description: ä½¿ç”¨è€…æ¨¡å¼
          required: false
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Inertial
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                backupId:
                  type: string
                  format: uuid
                  description: å‚™ä»½æª”æ¡ˆID
                  example: "backup_67890"
                restoreOptions:
                  type: object
                  description: é‚„åŸé¸é …
                  properties:
                    dataTypes:
                      type: array
                      items:
                        type: string
                        enum: [transactions, ledgers, accounts, categories, budgets, settings]
                      description: è¦é‚„åŸçš„è³‡æ–™é¡å‹
                      example: ["transactions", "ledgers", "accounts"]
                    conflictResolution:
                      type: string
                      enum: [overwrite, merge, skip]
                      description: è³‡æ–™è¡çªè™•ç†æ–¹å¼
                      default: merge
                    deleteExisting:
                      type: boolean
                      description: æ˜¯å¦åˆªé™¤ç¾æœ‰è³‡æ–™
                      default: false
                    restoreToDate:
                      type: string
                      format: date
                      description: é‚„åŸåˆ°ç‰¹å®šæ—¥æœŸï¼ˆåƒ…Expertæ¨¡å¼ï¼‰
                      example: "2025-08-20"
                confirmDeletion:
                  type: boolean
                  description: ç¢ºèªåˆªé™¤ç¾æœ‰è³‡æ–™ï¼ˆç•¶deleteExisting=trueæ™‚å¿…å¡«ï¼‰
                  example: false
              required:
                - backupId
            examples:
              expert_restore:
                summary: Expertæ¨¡å¼ - é¸æ“‡æ€§é‚„åŸ
                value:
                  backupId: "backup_67890"
                  restoreOptions:
                    dataTypes: ["transactions", "ledgers"]
                    conflictResolution: "merge"
                    deleteExisting: false
                    restoreToDate: "2025-08-20"
              simple_restore:
                summary: ç°¡å–®æ¨¡å¼ - å®Œæ•´é‚„åŸ
                value:
                  backupId: "backup_67890"
                  restoreOptions:
                    conflictResolution: "merge"
      responses:
        '202':
          description: é‚„åŸè«‹æ±‚å·²æ¥å—ï¼Œé–‹å§‹è™•ç†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      restoreId:
                        type: string
                        format: uuid
                        description: é‚„åŸä»»å‹™ID
                        example: "restore_78901"
                      status:
                        type: string
                        enum: [queued, processing]
                        description: é‚„åŸç‹€æ…‹
                        example: "queued"
                      estimatedTime:
                        type: integer
                        description: é ä¼°å®Œæˆæ™‚é–“ï¼ˆç§’ï¼‰
                        example: 90
                      startedAt:
                        type: string
                        format: date-time
                        description: é–‹å§‹æ™‚é–“
                        example: "2025-08-22T11:00:00Z"
                      message:
                        type: string
                        description: ç‹€æ…‹è¨Šæ¯
                        example: "æ­£åœ¨æº–å‚™é‚„åŸè³‡æ–™..."
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        description: å›æ‡‰æ™‚é–“æˆ³
                        example: "2025-08-22T11:00:00Z"
                      requestId:
                        type: string
                        format: uuid
                        description: è«‹æ±‚è¿½è¹¤ID
                        example: "req-uuid-789"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        description: ä½¿ç”¨è€…æ¨¡å¼
                        example: "Expert"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: å‚™ä»½æª”æ¡ˆä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /backup/status:
    get:
      tags:
        - backup
      summary: å‚™ä»½ç‹€æ…‹
      description: |
        æŸ¥è©¢ç‰¹å®šå‚™ä»½æˆ–é‚„åŸä»»å‹™çš„ç‹€æ…‹

        **å°æ‡‰ç•«é¢**: S-502 è³‡æ–™å‚™ä»½é 
        **User Story**: US-031, US-032
      parameters:
        - name: taskId
          in: query
          description: ä»»å‹™IDï¼ˆå‚™ä»½IDæˆ–é‚„åŸIDï¼‰
          required: true
          schema:
            type: string
            format: uuid
            example: "backup_67890"
        - name: taskType
          in: query
          description: ä»»å‹™é¡å‹
          required: true
          schema:
            type: string
            enum: [backup, restore]
            example: "backup"
      responses:
        '200':
          description: æˆåŠŸå–å¾—ä»»å‹™ç‹€æ…‹
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      taskId:
                        type: string
                        format: uuid
                        description: ä»»å‹™ID
                        example: "backup_67890"
                      taskType:
                        type: string
                        enum: [backup, restore]
                        description: ä»»å‹™é¡å‹
                        example: "backup"
                      status:
                        type: string
                        enum: [queued, processing, completed, failed, cancelled]
                        description: ä»»å‹™ç‹€æ…‹
                        example: "processing"
                      progress:
                        type: integer
                        minimum: 0
                        maximum: 100
                        description: å®Œæˆé€²åº¦ï¼ˆç™¾åˆ†æ¯”ï¼‰
                        example: 65
                      startedAt:
                        type: string
                        format: date-time
                        description: é–‹å§‹æ™‚é–“
                        example: "2025-08-22T10:30:00Z"
                      completedAt:
                        type: string
                        format: date-time
                        description: å®Œæˆæ™‚é–“ï¼ˆè‹¥å·²å®Œæˆï¼‰
                        example: "2025-08-22T10:32:15Z"
                      estimatedTimeRemaining:
                        type: integer
                        description: é ä¼°å‰©é¤˜æ™‚é–“ï¼ˆç§’ï¼‰
                        example: 45
                      currentStep:
                        type: string
                        description: ç•¶å‰åŸ·è¡Œæ­¥é©Ÿ
                        example: "æ­£åœ¨å‚™ä»½äº¤æ˜“è¨˜éŒ„..."
                      result:
                        type: object
                        description: åŸ·è¡Œçµæœï¼ˆè‹¥å·²å®Œæˆï¼‰
                        properties:
                          totalItems:
                            type: integer
                            description: ç¸½é …ç›®æ•¸
                            example: 1520
                          processedItems:
                            type: integer
                            description: å·²è™•ç†é …ç›®æ•¸
                            example: 1520
                          skippedItems:
                            type: integer
                            description: è·³éé …ç›®æ•¸
                            example: 0
                          errors:
                            type: array
                            items:
                              type: string
                            description: éŒ¯èª¤è¨Šæ¯åˆ—è¡¨
                            example: []
                          fileSize:
                            type: integer
                            description: æª”æ¡ˆå¤§å°ï¼ˆåƒ…å‚™ä»½ï¼‰
                            example: 2048576
                          downloadUrl:
                            type: string
                            format: uri
                            description: ä¸‹è¼‰é€£çµï¼ˆåƒ…å‚™ä»½æˆåŠŸï¼‰
                            example: "https://api.lcas.app/v1/backup/backup_67890/download"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        description: å›æ‡‰æ™‚é–“æˆ³
                        example: "2025-08-22T11:15:00Z"
                      requestId:
                        type: string
                        format: uuid
                        description: è«‹æ±‚è¿½è¹¤ID
                        example: "req-uuid-101"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        description: ä½¿ç”¨è€…æ¨¡å¼
                        example: "Expert"
        '404':
          description: ä»»å‹™ä¸å­˜åœ¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/export:
    post:
      tags:
        - data
      summary: åŒ¯å‡ºè³‡æ–™
      description: |
        å°‡ä½¿ç”¨è€…è³‡æ–™åŒ¯å‡ºç‚ºæŒ‡å®šæ ¼å¼

        **å°æ‡‰ç•«é¢**: S-502 è³‡æ–™å‚™ä»½é 
        **User Story**: US-031

        **æ”¯æ´æ ¼å¼**:
        - CSV: é©åˆ Excel é–‹å•Ÿ
        - JSON: é©åˆç¨‹å¼è™•ç†
        - PDF: é©åˆåˆ—å°åˆ†äº«
        - XLSX: Excel æ ¼å¼
      parameters:
        - name: X-User-Mode
          in: header
          description: ä½¿ç”¨è€…æ¨¡å¼
          required: false
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Inertial
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                format:
                  type: string
                  enum: [csv, json, pdf, xlsx]
                  description: åŒ¯å‡ºæ ¼å¼
                  example: "csv"
                dataType:
                  type: string
                  enum: [transactions, ledgers, accounts, categories, budgets, all]
                  description: è¦åŒ¯å‡ºçš„è³‡æ–™é¡å‹
                  example: "transactions"
                dateRange:
                  type: object
                  description: è³‡æ–™æ™‚é–“ç¯„åœ
                  properties:
                    startDate:
                      type: string
                      format: date
                      description: é–‹å§‹æ—¥æœŸ
                      example: "2025-01-01"
                    endDate:
                      type: string
                      format: date
                      description: çµæŸæ—¥æœŸ
                      example: "2025-08-22"
                filters:
                  type: object
                  description: è³‡æ–™ç¯©é¸æ¢ä»¶
                  properties:
                    ledgerIds:
                      type: array
                      items:
                        type: string
                        format: uuid
                      description: å¸³æœ¬IDåˆ—è¡¨
                      example: ["ledger_123", "ledger_456"]
                    categoryIds:
                      type: array
                      items:
                        type: string
                        format: uuid
                      description: ç§‘ç›®IDåˆ—è¡¨
                      example: ["cat_789"]
                    accountIds:
                      type: array
                      items:
                        type: string
                        format: uuid
                      description: å¸³æˆ¶IDåˆ—è¡¨
                      example: ["acc_101"]
                    transactionType:
                      type: string
                      enum: [income, expense, transfer, all]
                      description: äº¤æ˜“é¡å‹
                      default: all
                options:
                  type: object
                  description: åŒ¯å‡ºé¸é …
                  properties:
                    includeAttachments:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«é™„ä»¶
                      default: false
                    includeDeleted:
                      type: boolean
                      description: æ˜¯å¦åŒ…å«å·²åˆªé™¤è³‡æ–™
                      default: false
                    currency:
                      type: string
                      description: é‡‘é¡é¡¯ç¤ºå¹£åˆ¥
                      example: "TWD"
                      default: "TWD"
                    locale:
                      type: string
                      description: èªè¨€åœ°å€è¨­å®š
                      example: "zh-TW"
                      default: "zh-TW"
              required:
                - format
                - dataType
            examples:
              csv_export:
                summary: CSV æ ¼å¼åŒ¯å‡ºäº¤æ˜“è¨˜éŒ„
                value:
                  format: "csv"
                  dataType: "transactions"
                  dateRange:
                    startDate: "2025-01-01"
                    endDate: "2025-08-22"
                  filters:
                    transactionType: "all"
                  options:
                    includeAttachments: false
                    currency: "TWD"
                    locale: "zh-TW"
              json_export:
                summary: JSON æ ¼å¼å®Œæ•´åŒ¯å‡º
                value:
                  format: "json"
                  dataType: "all"
                  options:
                    includeAttachments: true
                    includeDeleted: false
      responses:
        '202':
          description: åŒ¯å‡ºè«‹æ±‚å·²æ¥å—ï¼Œé–‹å§‹è™•ç†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      exportId:
                        type: string
                        format: uuid
                        description: åŒ¯å‡ºä»»å‹™ID
                        example: "export_12345"
                      status:
                        type: string
                        enum: [queued, processing]
                        description: åŒ¯å‡ºç‹€æ…‹
                        example: "queued"
                      format:
                        type: string
                        description: åŒ¯å‡ºæ ¼å¼
                        example: "csv"
                      estimatedTime:
                        type: integer
                        description: é ä¼°å®Œæˆæ™‚é–“ï¼ˆç§’ï¼‰
                        example: 30
                      createdAt:
                        type: string
                        format: date-time
                        description: å»ºç«‹æ™‚é–“
                        example: "2025-08-22T11:15:00Z"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        description: å›æ‡‰æ™‚é–“æˆ³
                        example: "2025-08-22T11:15:00Z"
                      requestId:
                        type: string
                        format: uuid
                        description: è«‹æ±‚è¿½è¹¤ID
                        example: "req-uuid-export"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        description: ä½¿ç”¨è€…æ¨¡å¼
                        example: "Expert"

        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /data/import:
    post:
      tags:
        - data
      summary: åŒ¯å…¥è³‡æ–™
      description: |
        å¾å¤–éƒ¨æª”æ¡ˆåŒ¯å…¥è³‡æ–™åˆ°ç³»çµ±

        **å°æ‡‰ç•«é¢**: S-502 è³‡æ–™å‚™ä»½é 
        **User Story**: US-032

        **æ”¯æ´æ ¼å¼**:
        - CSV: å¾ Excel æˆ–å…¶ä»–ç³»çµ±åŒ¯å…¥
        - JSON: å¾å‚™ä»½æª”æ¡ˆæˆ–APIåŒ¯å…¥
        - XLSX: Excel æ ¼å¼

        **å››æ¨¡å¼å·®ç•°**:
        - **Expert**: è©³ç´°æ¬„ä½å°æ‡‰ã€éŒ¯èª¤è™•ç†é¸é …
        - **Inertial**: æ¨™æº–æ ¼å¼åŒ¯å…¥
        - **Cultivation**: å¼•å°å¼åŒ¯å…¥æµç¨‹
        - **Guiding**: è‡ªå‹•æ ¼å¼åµæ¸¬åŒ¯å…¥
      parameters:
        - name: X-User-Mode
          in: header
          description: ä½¿ç”¨è€…æ¨¡å¼
          required: false
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
            default: Inertial
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: è¦åŒ¯å…¥çš„æª”æ¡ˆ
                format:
                  type: string
                  enum: [csv, json, xlsx, auto]
                  description: æª”æ¡ˆæ ¼å¼ï¼ˆautoç‚ºè‡ªå‹•åµæ¸¬ï¼‰
                  default: auto
                dataType:
                  type: string
                  enum: [transactions, accounts, categories, budgets]
                  description: è³‡æ–™é¡å‹
                  example: "transactions"
                importOptions:
                  type: string
                  description: åŒ¯å…¥é¸é … (JSONæ ¼å¼)
                  example: '{"conflictResolution": "merge", "skipErrors": true}'
              required:
                - file
                - dataType
      responses:
        '202':
          description: åŒ¯å…¥è«‹æ±‚å·²æ¥å—ï¼Œé–‹å§‹è™•ç†
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      importId:
                        type: string
                        format: uuid
                        description: åŒ¯å…¥ä»»å‹™ID
                        example: "import_54321"
                      status:
                        type: string
                        enum: [validating, processing, completed, failed]
                        description: åŒ¯å…¥ç‹€æ…‹
                        example: "validating"
                      fileName:
                        type: string
                        description: æª”æ¡ˆåç¨±
                        example: "transactions_2025.csv"
                      fileSize:
                        type: integer
                        description: æª”æ¡ˆå¤§å°ï¼ˆä½å…ƒçµ„ï¼‰
                        example: 524288
                      detectedFormat:
                        type: string
                        description: åµæ¸¬åˆ°çš„æª”æ¡ˆæ ¼å¼
                        example: "csv"
                      estimatedRecords:
                        type: integer
                        description: é ä¼°è¨˜éŒ„æ•¸
                        example: 1250
                      estimatedTime:
                        type: integer
                        description: é ä¼°å®Œæˆæ™‚é–“ï¼ˆç§’ï¼‰
                        example: 60
                      createdAt:
                        type: string
                        format: date-time
                        description: å»ºç«‹æ™‚é–“
                        example: "2025-08-22T11:30:00Z"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        description: å›æ‡‰æ™‚é–“æˆ³
                        example: "2025-08-22T11:30:00Z"
                      requestId:
                        type: string
                        format: uuid
                        description: è«‹æ±‚è¿½è¹¤ID
                        example: "req-uuid-import"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        description: ä½¿ç”¨è€…æ¨¡å¼
                        example: "Expert"

        '400':
          description: æª”æ¡ˆæ ¼å¼éŒ¯èª¤æˆ–åƒæ•¸ç„¡æ•ˆ
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "INVALID_FILE_FORMAT"
                      message:
                        type: string
                        example: "ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼æˆ–æª”æ¡ˆå·²ææ¯€"
                      details:
                        type: object
                        properties:
                          supportedFormats:
                            type: array
                            items:
                              type: string
                            example: ["csv", "json", "xlsx"]
                          maxFileSize:
                            type: string
                            example: "10MB"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '413':
          description: æª”æ¡ˆéå¤§
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token for authentication

  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
              description: éŒ¯èª¤ä»£ç¢¼
              example: "VALIDATION_ERROR"
            message:
              type: string
              description: éŒ¯èª¤è¨Šæ¯
              example: "è«‹æ±‚åƒæ•¸æ ¼å¼éŒ¯èª¤"
            field:
              type: string
              description: éŒ¯èª¤æ¬„ä½
              example: "backupName"
            timestamp:
              type: string
              format: date-time
              description: éŒ¯èª¤ç™¼ç”Ÿæ™‚é–“
              example: "2025-08-22T12:00:00Z"
            requestId:
              type: string
              format: uuid
              description: è«‹æ±‚è¿½è¹¤ID
              example: "req_abc123"
            details:
              type: object
              description: è©³ç´°éŒ¯èª¤è³‡è¨Š
          required:
            - code
            - message
            - timestamp
            - requestId

  responses:
    BadRequest:
      description: è«‹æ±‚åƒæ•¸éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          examples:
            validation_error:
              summary: åƒæ•¸é©—è­‰éŒ¯èª¤
              value:
                success: false
                error:
                  code: "VALIDATION_ERROR"
                  message: "å‚™ä»½åç¨±ä¸èƒ½ç‚ºç©º"
                  field: "backupName"
                  timestamp: "2025-08-22T12:00:00Z"
                  requestId: "req_abc123"
                  details:
                    field: "backupName"
                    rejectedValue: ""

    Unauthorized:
      description: æœªæˆæ¬Šå­˜å–
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "UNAUTHORIZED"
              message: "å­˜å–ä»¤ç‰Œç„¡æ•ˆæˆ–å·²éæœŸ"
              timestamp: "2025-08-22T12:00:00Z"
              requestId: "req_abc123"

    TooManyRequests:
      description: è«‹æ±‚é »ç‡éé«˜
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "RATE_LIMIT_EXCEEDED"
              message: "å‚™ä»½è«‹æ±‚é »ç‡éé«˜ï¼Œè«‹ç¨å¾Œå†è©¦"
              details:
                retryAfter: 300
                limit: "æ¯å°æ™‚æœ€å¤š5æ¬¡å‚™ä»½"
              timestamp: "2025-08-22T12:00:00Z"
              requestId: "req_abc123"

    InternalServerError:
      description: å…§éƒ¨ä¼ºæœå™¨éŒ¯èª¤
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            success: false
            error:
              code: "INTERNAL_SERVER_ERROR"
              message: "ç³»çµ±æš«æ™‚ç„¡æ³•è™•ç†è«‹æ±‚ï¼Œè«‹ç¨å¾Œå†è©¦"
              timestamp: "2025-08-22T12:00:00Z"
              requestId: "req_abc123"