
openapi: 3.0.3
info:
  title: LCAS 2.0 - é ç®—ç®¡ç†æœå‹™ API è¦æ ¼
  version: 1.0.0
  description: |
    **LCAS 2.0 é ç®—ç®¡ç†æœå‹™ API è¦æ ¼**
    
    è² è²¬é ç®—çš„å®Œæ•´ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ŒåŒ…å«é ç®—è¨­å®šã€åŸ·è¡Œç›£æ§ã€è­¦ç¤ºé€šçŸ¥ç­‰åŠŸèƒ½ã€‚
    æ”¯æ´å¤šç¨®é ç®—é¡å‹èˆ‡é€±æœŸï¼Œæä¾›å››æ¨¡å¼å·®ç•°åŒ–é«”é©—èˆ‡æ™ºæ…§é ç®—å»ºè­°ã€‚
    
    ## ğŸ¯ æœå‹™ç¯„åœ
    - **é ç®— CRUD**ï¼šå»ºç«‹ã€æŸ¥è©¢ã€ä¿®æ”¹ã€åˆªé™¤é ç®—
    - **é ç®—é¡å‹ç®¡ç†**ï¼šç§‘ç›®é ç®—ã€å¸³æˆ¶é ç®—ã€æ¨™ç±¤é ç®—ã€ç¸½é ç®—
    - **é€±æœŸç®¡ç†**ï¼šæœˆåº¦ã€å­£åº¦ã€å¹´åº¦ã€è‡ªè¨‚é€±æœŸé ç®—
    - **åŸ·è¡Œç›£æ§**ï¼šé ç®—é”æˆç‡ã€è¶…æ”¯è­¦ç¤ºã€è¶¨å‹¢åˆ†æ
    - **æ™ºæ…§å»ºè­°**ï¼šåŸºæ–¼æ­·å²æ•¸æ“šçš„é ç®—å»ºè­°
    - **é ç®—æ¨¡æ¿**ï¼šå¸¸ç”¨é ç®—ç¯„æœ¬èˆ‡å¿«é€Ÿè¨­å®š
    
    ## ğŸ¨ å››æ¨¡å¼å·®ç•°åŒ–æ”¯æ´
    
    | æ¨¡å¼ | ç‰¹è‰²åŠŸèƒ½ |
    |------|----------|
    | **Expert** | è¤‡é›œé ç®—è¦å‰‡ã€å¤šç¶­åº¦åˆ†æã€ç²¾ç´°åŒ–æ§åˆ¶ã€é€²éšçµ±è¨ˆ |
    | **Inertial** | æ¨™æº–é ç®—ç®¡ç†ã€ç°¡æ½”è¨­å®šã€å›ºå®šé€±æœŸã€åŸºæœ¬ç›£æ§ |
    | **Cultivation** | é ç®—å¼•å°ã€ç¿’æ…£åŸ¹é¤Šã€ç›®æ¨™è¿½è¹¤ã€æ¿€å‹µæ©Ÿåˆ¶ |
    | **Guiding** | æ¥µç°¡é ç®—ã€è‡ªå‹•å»ºè­°ã€é è¨­è¨­å®šã€æœ€å°‘æ±ºç­– |
    
    ## ğŸ—‚ï¸ å°æ‡‰ç•«é¢
    - **S-307**ï¼šé ç®—ç®¡ç†ä¸»é 
    - **S-308**ï¼šå»ºç«‹é ç®—é 
    
    **ç‰ˆæœ¬**: 1.0.0  
    **å»ºç«‹æ—¥æœŸ**: 2025-08-22  
    **å°æ‡‰æ–‡ä»¶**: 0021. Screen list.md (S-307, S-308)

servers:
  - url: https://api.lcas.app/v1
    description: "Production server"
  - url: https://api-staging.lcas.app/v1
    description: "Staging server"

security:
  - BearerAuth: []

paths:
  /budgets:
    get:
      summary: "å–å¾—é ç®—åˆ—è¡¨"
      description: |
        å–å¾—ä½¿ç”¨è€…çš„é ç®—åˆ—è¡¨ï¼Œæ”¯æ´åˆ†é ã€ç¯©é¸å’Œæ’åºã€‚
        æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›ä¸åŒè©³ç´°ç¨‹åº¦çš„è³‡è¨Šã€‚
        
        **å°æ‡‰ç•«é¢**: S-307 é ç®—ç®¡ç†ä¸»é 
        **å››æ¨¡å¼å·®ç•°**: é¡¯ç¤ºè³‡è¨Šè©³ç´°ç¨‹åº¦èˆ‡æ¨è–¦é ç®—ä¸åŒ
      tags:
        - "é ç®—æŸ¥è©¢"
      parameters:
        - name: ledgerId
          in: query
          description: "æŒ‡å®šå¸³æœ¬ IDï¼ˆå¯é¸ï¼Œé è¨­ç‚ºæ‰€æœ‰å¸³æœ¬ï¼‰"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: type
          in: query
          description: "é ç®—é¡å‹ç¯©é¸"
          schema:
            type: string
            enum: [category, account, tag, total, all]
            default: all
        - name: period
          in: query
          description: "é ç®—é€±æœŸç¯©é¸"
          schema:
            type: string
            enum: [monthly, quarterly, yearly, custom]
        - name: status
          in: query
          description: "é ç®—ç‹€æ…‹ç¯©é¸"
          schema:
            type: string
            enum: [active, completed, paused, exceeded, all]
            default: active
        - name: includeCompleted
          in: query
          description: "æ˜¯å¦åŒ…å«å·²å®Œæˆçš„é ç®—"
          schema:
            type: boolean
            default: false
        - name: search
          in: query
          description: "æœå°‹é—œéµå­—ï¼ˆé ç®—åç¨±ã€æè¿°ï¼‰"
          schema:
            type: string
            example: "é£Ÿç‰©"
        - name: sortBy
          in: query
          description: "æ’åºæ¬„ä½"
          schema:
            type: string
            enum: [name, amount, usage_percentage, created_at, end_date, priority]
            default: usage_percentage
        - name: sortOrder
          in: query
          description: "æ’åºæ–¹å‘"
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          description: "é ç¢¼"
          schema:
            type: integer
            example: 1
            default: 1
        - name: limit
          in: query
          description: "æ¯é ç­†æ•¸"
          schema:
            type: integer
            example: 20
            default: 20
            maximum: 100
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—é ç®—åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      budgets:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "budget-uuid-001"
                            name:
                              type: string
                              example: "é£Ÿç‰©æœˆé ç®—"
                            type:
                              type: string
                              enum: [category, account, tag, total]
                              example: "category"
                            
                            # åŸºæœ¬è³‡è¨Š
                            description:
                              type: string
                              example: "æ§åˆ¶æ¯æœˆé£Ÿç‰©æ”¯å‡º"
                            amount:
                              type: number
                              example: 12000
                            currency:
                              type: string
                              example: "TWD"
                            
                            # é€±æœŸè³‡è¨Š
                            period:
                              type: object
                              properties:
                                type:
                                  type: string
                                  enum: [monthly, quarterly, yearly, custom]
                                  example: "monthly"
                                startDate:
                                  type: string
                                  format: date
                                  example: "2025-01-01"
                                endDate:
                                  type: string
                                  format: date
                                  example: "2025-01-31"
                                currentCycle:
                                  type: integer
                                  example: 1
                                  description: "ç•¶å‰é€±æœŸæ•¸"
                                totalCycles:
                                  type: integer
                                  example: 12
                                  description: "ç¸½é€±æœŸæ•¸ï¼ˆnull = ç„¡é™æœŸï¼‰"
                                  nullable: true
                            
                            # ç›®æ¨™è¨­å®š
                            target:
                              type: object
                              properties:
                                categoryId:
                                  type: string
                                  example: "category-uuid-food"
                                  description: "ç§‘ç›® IDï¼ˆcategory é¡å‹ï¼‰"
                                categoryName:
                                  type: string
                                  example: "é£Ÿç‰©"
                                accountId:
                                  type: string
                                  example: "account-uuid-001"
                                  description: "å¸³æˆ¶ IDï¼ˆaccount é¡å‹ï¼‰"
                                accountName:
                                  type: string
                                  example: "ä¿¡ç”¨å¡"
                                tags:
                                  type: array
                                  items:
                                    type: string
                                  example: ["å¤–é£Ÿ", "èšé¤"]
                                  description: "æ¨™ç±¤åˆ—è¡¨ï¼ˆtag é¡å‹ï¼‰"
                                includeSubcategories:
                                  type: boolean
                                  example: true
                                  description: "æ˜¯å¦åŒ…å«å­ç§‘ç›®"
                            
                            # åŸ·è¡Œç‹€æ³
                            execution:
                              type: object
                              properties:
                                usedAmount:
                                  type: number
                                  example: 8500
                                remainingAmount:
                                  type: number
                                  example: 3500
                                usagePercentage:
                                  type: number
                                  example: 70.83
                                status:
                                  type: string
                                  enum: [on_track, warning, exceeded, completed]
                                  example: "warning"
                                daysElapsed:
                                  type: integer
                                  example: 27
                                daysRemaining:
                                  type: integer
                                  example: 4
                                projectedAmount:
                                  type: number
                                  example: 10370
                                  description: "é è¨ˆç¸½æ”¯å‡º"
                                dailyBudget:
                                  type: number
                                  example: 387.10
                                  description: "æ—¥å‡å¯ç”¨é ç®—"
                                averageDaily:
                                  type: number
                                  example: 314.81
                                  description: "å¯¦éš›æ—¥å‡æ”¯å‡º"
                            
                            # Expert Mode: é€²éšçµ±è¨ˆ
                            analytics:
                              type: object
                              properties:
                                historicalPerformance:
                                  type: object
                                  properties:
                                    lastPeriodUsage:
                                      type: number
                                      example: 88.5
                                      description: "ä¸ŠæœŸä½¿ç”¨ç‡(%)"
                                    averageUsage:
                                      type: number
                                      example: 82.3
                                      description: "å¹³å‡ä½¿ç”¨ç‡(%)"
                                    bestPeriod:
                                      type: number
                                      example: 67.2
                                      description: "æœ€ä½³æ§åˆ¶ç‡(%)"
                                    trend:
                                      type: string
                                      enum: [improving, stable, worsening]
                                      example: "improving"
                                weeklyBreakdown:
                                  type: array
                                  description: "é€±åº¦åˆ†æ"
                                  items:
                                    type: object
                                    properties:
                                      week:
                                        type: integer
                                        example: 1
                                      amount:
                                        type: number
                                        example: 2800
                                      target:
                                        type: number
                                        example: 3000
                                      percentage:
                                        type: number
                                        example: 93.33
                                categoryBreakdown:
                                  type: array
                                  description: "å­ç§‘ç›®åˆ†æï¼ˆå¦‚é©ç”¨ï¼‰"
                                  items:
                                    type: object
                                    properties:
                                      categoryId:
                                        type: string
                                        example: "category-uuid-restaurant"
                                      categoryName:
                                        type: string
                                        example: "é¤å»³"
                                      amount:
                                        type: number
                                        example: 5200
                                      percentage:
                                        type: number
                                        example: 61.18
                            
                            # è­¦ç¤ºè¨­å®š
                            alerts:
                              type: object
                              properties:
                                enabled:
                                  type: boolean
                                  example: true
                                thresholds:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      percentage:
                                        type: number
                                        example: 80
                                      type:
                                        type: string
                                        enum: [warning, critical]
                                        example: "warning"
                                      notified:
                                        type: boolean
                                        example: false
                                lastAlert:
                                  type: string
                                  format: date-time
                                  example: "2025-01-25T10:30:00Z"
                                  nullable: true
                            
                            # è¨­å®šè³‡è¨Š
                            settings:
                              type: object
                              properties:
                                isActive:
                                  type: boolean
                                  example: true
                                priority:
                                  type: integer
                                  example: 1
                                  description: "å„ªå…ˆç´šï¼ˆ1=æœ€é«˜ï¼‰"
                                autoRenew:
                                  type: boolean
                                  example: true
                                  description: "æ˜¯å¦è‡ªå‹•çºŒæœŸ"
                                rollover:
                                  type: boolean
                                  example: false
                                  description: "æ˜¯å¦å…è¨±çµé¤˜è½‰å…¥ä¸‹æœŸ"
                                notificationEnabled:
                                  type: boolean
                                  example: true
                            
                            # å¯©è¨ˆè³‡è¨Š
                            audit:
                              type: object
                              properties:
                                createdAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-01T00:00:00Z"
                                updatedAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-20T15:30:00Z"
                                createdBy:
                                  type: string
                                  example: "user-uuid-12345"
                                lastCalculatedAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                      
                      # åˆ†é è³‡è¨Š
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          totalPages:
                            type: integer
                            example: 2
                          totalRecords:
                            type: integer
                            example: 15
                          hasNextPage:
                            type: boolean
                            example: true
                          hasPreviousPage:
                            type: boolean
                            example: false
                      
                      # ç¸½é«”çµ±è¨ˆ
                      summary:
                        type: object
                        properties:
                          totalBudgets:
                            type: integer
                            example: 15
                          activeBudgets:
                            type: integer
                            example: 12
                          totalBudgetAmount:
                            type: number
                            example: 45000
                          totalUsedAmount:
                            type: number
                            example: 28500
                          overallUsagePercentage:
                            type: number
                            example: 63.33
                          exceededBudgets:
                            type: integer
                            example: 2
                          warningBudgets:
                            type: integer
                            example: 4
                      
                      # Cultivation Mode: æˆå°±èˆ‡é€²åº¦
                      achievements:
                        type: object
                        properties:
                          budgetStreaks:
                            type: integer
                            example: 3
                            description: "é€£çºŒé”æˆé ç®—æœˆæ•¸"
                          bestControlRate:
                            type: number
                            example: 67.2
                            description: "æœ€ä½³æ§åˆ¶ç‡"
                          improvementTrend:
                            type: string
                            enum: [improving, stable, needs_attention]
                            example: "improving"
                          monthlyGoalProgress:
                            type: number
                            example: 85.5
                            description: "æœˆåº¦ç›®æ¨™é”æˆç‡"
                      
                      # å››æ¨¡å¼å·®ç•°åŒ–æ¨è–¦
                      recommendations:
                        type: array
                        description: "é ç®—å»ºè­°ï¼ˆCultivation/Expert æ¨¡å¼ï¼‰"
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              enum: [budget_adjustment, new_budget, category_split, alert_setting]
                              example: "budget_adjustment"
                            priority:
                              type: string
                              enum: [high, medium, low]
                              example: "medium"
                            title:
                              type: string
                              example: "èª¿æ•´é£Ÿç‰©é ç®—"
                            description:
                              type: string
                              example: "æ ¹æ“šè¿‘æœŸæ”¯å‡ºæ¨¡å¼ï¼Œå»ºè­°å°‡é£Ÿç‰©é ç®—èª¿æ•´ç‚º 13,500 å…ƒ"
                            action:
                              type: object
                              properties:
                                type:
                                  type: string
                                  example: "adjust_amount"
                                budgetId:
                                  type: string
                                  example: "budget-uuid-001"
                                suggestedAmount:
                                  type: number
                                  example: 13500
                            confidence:
                              type: number
                              example: 0.87
                              description: "å»ºè­°ä¿¡å¿ƒåº¦"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      summary: "å»ºç«‹é ç®—"
      description: |
        å»ºç«‹æ–°çš„é ç®—è¨­å®šï¼Œæ”¯æ´å¤šç¨®é¡å‹èˆ‡é€±æœŸè¨­å®šã€‚
        ä¸åŒæ¨¡å¼æä¾›ä¸åŒçš„å»ºç«‹é¸é …å’Œé è¨­å€¼ã€‚
        
        **å°æ‡‰ç•«é¢**: S-308 å»ºç«‹é ç®—é 
        **å››æ¨¡å¼å·®ç•°**: å¯è¨­å®šé¸é …èˆ‡é è¨­å€¼ä¸åŒ
      tags:
        - "é ç®—ç®¡ç†"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                # åŸºæœ¬è³‡è¨Šï¼ˆå¿…å¡«ï¼‰
                name:
                  type: string
                  example: "äº¤é€šè²»æœˆé ç®—"
                  maxLength: 100
                  minLength: 1
                type:
                  type: string
                  enum: [category, account, tag, total]
                  example: "category"
                amount:
                  type: number
                  example: 3000
                  minimum: 0.01
                ledgerId:
                  type: string
                  example: "ledger-uuid-001"
                  description: "æ‰€å±¬å¸³æœ¬ ID"
                
                # é¸å¡«è³‡è¨Š
                description:
                  type: string
                  example: "æ§åˆ¶æ¯æœˆäº¤é€šç›¸é—œæ”¯å‡º"
                  maxLength: 500
                
                # é€±æœŸè¨­å®š
                period:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: [monthly, quarterly, yearly, custom]
                      example: "monthly"
                      default: "monthly"
                    startDate:
                      type: string
                      format: date
                      example: "2025-02-01"
                      description: "é–‹å§‹æ—¥æœŸï¼ˆé è¨­ç‚ºä¸‹æœˆ1æ—¥ï¼‰"
                    endDate:
                      type: string
                      format: date
                      example: "2025-02-28"
                      description: "çµæŸæ—¥æœŸï¼ˆcustom é¡å‹æ™‚å¿…å¡«ï¼‰"
                    duration:
                      type: integer
                      example: 12
                      description: "æŒçºŒæœŸæ•¸ï¼ˆnull = ç„¡é™æœŸï¼‰"
                      nullable: true
                
                # ç›®æ¨™è¨­å®šï¼ˆæ ¹æ“š type ä¸åŒï¼‰
                target:
                  type: object
                  properties:
                    # category é¡å‹
                    categoryId:
                      type: string
                      example: "category-uuid-transport"
                      description: "ç§‘ç›® IDï¼ˆcategory é¡å‹æ™‚å¿…å¡«ï¼‰"
                    includeSubcategories:
                      type: boolean
                      example: true
                      default: true
                      description: "æ˜¯å¦åŒ…å«å­ç§‘ç›®"
                    
                    # account é¡å‹
                    accountId:
                      type: string
                      example: "account-uuid-001"
                      description: "å¸³æˆ¶ IDï¼ˆaccount é¡å‹æ™‚å¿…å¡«ï¼‰"
                    
                    # tag é¡å‹
                    tags:
                      type: array
                      items:
                        type: string
                      example: ["äº¤é€š", "é€šå‹¤"]
                      description: "æ¨™ç±¤åˆ—è¡¨ï¼ˆtag é¡å‹æ™‚å¿…å¡«ï¼‰"
                    
                    # total é¡å‹
                    includeCategories:
                      type: array
                      items:
                        type: string
                      example: ["category-uuid-food", "category-uuid-transport"]
                      description: "åŒ…å«ç§‘ç›®åˆ—è¡¨ï¼ˆtotal é¡å‹æ™‚å¯é¸ï¼‰"
                    excludeCategories:
                      type: array
                      items:
                        type: string
                      example: ["category-uuid-investment"]
                      description: "æ’é™¤ç§‘ç›®åˆ—è¡¨ï¼ˆtotal é¡å‹æ™‚å¯é¸ï¼‰"
                
                # Expert Mode: é€²éšè¨­å®š
                advanced:
                  type: object
                  properties:
                    priority:
                      type: integer
                      example: 2
                      minimum: 1
                      maximum: 5
                      default: 3
                      description: "å„ªå…ˆç´šï¼ˆ1=æœ€é«˜ï¼Œ5=æœ€ä½ï¼‰"
                    autoRenew:
                      type: boolean
                      example: true
                      default: true
                      description: "æ˜¯å¦è‡ªå‹•çºŒæœŸ"
                    rollover:
                      type: boolean
                      example: false
                      default: false
                      description: "æ˜¯å¦å…è¨±çµé¤˜è½‰å…¥ä¸‹æœŸ"
                    flexibility:
                      type: number
                      example: 10
                      minimum: 0
                      maximum: 50
                      default: 0
                      description: "å½ˆæ€§æ¯”ä¾‹ï¼ˆ%ï¼‰ï¼Œå…è¨±è¶…æ”¯çš„ç™¾åˆ†æ¯”"
                
                # è­¦ç¤ºè¨­å®š
                alerts:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                      example: true
                      default: true
                    thresholds:
                      type: array
                      items:
                        type: object
                        properties:
                          percentage:
                            type: number
                            example: 80
                            minimum: 1
                            maximum: 100
                          type:
                            type: string
                            enum: [warning, critical]
                            example: "warning"
                      example:
                        - percentage: 80
                          type: warning
                        - percentage: 100
                          type: critical
                      default:
                        - percentage: 80
                          type: warning
                        - percentage: 100
                          type: critical
                    notificationMethods:
                      type: array
                      items:
                        type: string
                        enum: [app, email, line]
                      example: ["app", "line"]
                      default: ["app"]
                
                # æ¨¡æ¿å¥—ç”¨
                template:
                  type: object
                  properties:
                    useTemplate:
                      type: boolean
                      example: false
                    templateId:
                      type: string
                      example: "template-monthly-basic"
                    customizeFromHistory:
                      type: boolean
                      example: true
                      description: "æ˜¯å¦æ ¹æ“šæ­·å²æ•¸æ“šè‡ªå‹•èª¿æ•´"
                    historyMonths:
                      type: integer
                      example: 3
                      minimum: 1
                      maximum: 12
                      default: 3
                      description: "åƒè€ƒæ­·å²æœˆæ•¸"
              required:
                - name
                - type
                - amount
                - ledgerId
      responses:
        '201':
          description: "é ç®—å»ºç«‹æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      budgetId:
                        type: string
                        example: "budget-uuid-002"
                      name:
                        type: string
                        example: "äº¤é€šè²»æœˆé ç®—"
                      type:
                        type: string
                        example: "category"
                      amount:
                        type: number
                        example: 3000
                      
                      # è¨ˆç®—çµæœ
                      calculations:
                        type: object
                        properties:
                          dailyBudget:
                            type: number
                            example: 107.14
                            description: "æ—¥å‡é ç®—"
                          weeklyBudget:
                            type: number
                            example: 750
                            description: "é€±å‡é ç®—"
                          projectedSavings:
                            type: number
                            example: 500
                            description: "é è¨ˆç¯€çœï¼ˆåŸºæ–¼æ­·å²æ•¸æ“šï¼‰"
                          recommendedAdjustment:
                            type: number
                            example: 3200
                            description: "å»ºè­°é‡‘é¡ï¼ˆåŸºæ–¼æ­·å²åˆ†æï¼‰"
                      
                      # è¨­å®šç¢ºèª
                      setup:
                        type: object
                        properties:
                          periodStart:
                            type: string
                            format: date
                            example: "2025-02-01"
                          periodEnd:
                            type: string
                            format: date
                            example: "2025-02-28"
                          alertsConfigured:
                            type: integer
                            example: 2
                          autoRenewEnabled:
                            type: boolean
                            example: true
                      
                      # å››æ¨¡å¼å·®ç•°åŒ–å»ºè­°
                      suggestions:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              enum: [related_budget, spending_tip, tracking_advice]
                              example: "related_budget"
                            title:
                              type: string
                              example: "è€ƒæ…®æ–°å¢åœè»Šè²»é ç®—"
                            description:
                              type: string
                              example: "æ ¹æ“šæ‚¨çš„äº¤é€šæ”¯å‡ºæ¨¡å¼ï¼Œå»ºè­°å–®ç¨è¨­å®šåœè»Šè²»é ç®—"
                            actionUrl:
                              type: string
                              example: "/budgets/create?categoryId=category-uuid-parking"
                      
                      createdAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:30:00Z"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          description: "é ç®—è¨­å®šè¡çª"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "RESOURCE_CONFLICT"
                      message:
                        type: string
                        example: "è©²ç§‘ç›®å·²æœ‰ç›¸åŒé€±æœŸçš„é ç®—è¨­å®š"
                      field:
                        type: string
                        example: "target.categoryId"
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      details:
                        type: object
                        properties:
                          conflictingBudgetId:
                            type: string
                            example: "budget-uuid-existing"
                          suggestions:
                            type: array
                            items:
                              type: string
                            example: ["ä¿®æ”¹ç¾æœ‰é ç®—", "é¸æ“‡ä¸åŒé€±æœŸ", "ä½¿ç”¨å­ç§‘ç›®é ç®—"]

  /budgets/{id}:
    get:
      summary: "å–å¾—é ç®—è©³æƒ…"
      description: |
        å–å¾—æŒ‡å®šé ç®—çš„è©³ç´°è³‡è¨Šï¼ŒåŒ…å«åŸ·è¡Œç‹€æ³ã€æ­·å²è¶¨å‹¢ç­‰ã€‚
        
        **å°æ‡‰ç•«é¢**: S-307 é ç®—ç®¡ç†ä¸»é è©³ç´°æª¢è¦–
        **æ¬Šé™æª¢æŸ¥**: ç¢ºèªç”¨æˆ¶å°è©²é ç®—æœ‰å­˜å–æ¬Šé™
      tags:
        - "é ç®—æŸ¥è©¢"
      parameters:
        - name: id
          in: path
          required: true
          description: "é ç®— ID"
          schema:
            type: string
            example: "budget-uuid-001"
        - name: includeTransactions
          in: query
          description: "æ˜¯å¦åŒ…å«ç›¸é—œäº¤æ˜“è¨˜éŒ„"
          schema:
            type: boolean
            default: false
        - name: transactionLimit
          in: query
          description: "äº¤æ˜“è¨˜éŒ„ç­†æ•¸"
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: includeHistory
          in: query
          description: "æ˜¯å¦åŒ…å«æ­·å²åŸ·è¡Œè¨˜éŒ„"
          schema:
            type: boolean
            default: true
        - name: historyPeriods
          in: query
          description: "æ­·å²æœŸæ•¸"
          schema:
            type: integer
            minimum: 1
            maximum: 24
            default: 6
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—é ç®—è©³æƒ…"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      # åŸºæœ¬è³‡è¨Š
                      id:
                        type: string
                        example: "budget-uuid-001"
                      name:
                        type: string
                        example: "é£Ÿç‰©æœˆé ç®—"
                      type:
                        type: string
                        example: "category"
                      description:
                        type: string
                        example: "æ§åˆ¶æ¯æœˆé£Ÿç‰©æ”¯å‡º"
                      amount:
                        type: number
                        example: 12000
                      currency:
                        type: string
                        example: "TWD"
                      
                      # ç›®æ¨™è©³æƒ…
                      target:
                        type: object
                        properties:
                          type:
                            type: string
                            example: "category"
                          category:
                            type: object
                            properties:
                              id:
                                type: string
                                example: "category-uuid-food"
                              name:
                                type: string
                                example: "é£Ÿç‰©"
                              icon:
                                type: string
                                example: "ğŸ”"
                              includeSubcategories:
                                type: boolean
                                example: true
                              subcategories:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    id:
                                      type: string
                                      example: "category-uuid-restaurant"
                                    name:
                                      type: string
                                      example: "é¤å»³"
                                    included:
                                      type: boolean
                                      example: true
                      
                      # ç•¶å‰é€±æœŸåŸ·è¡Œç‹€æ³
                      currentPeriod:
                        type: object
                        properties:
                          startDate:
                            type: string
                            format: date
                            example: "2025-01-01"
                          endDate:
                            type: string
                            format: date
                            example: "2025-01-31"
                          daysTotal:
                            type: integer
                            example: 31
                          daysElapsed:
                            type: integer
                            example: 27
                          daysRemaining:
                            type: integer
                            example: 4
                          
                          # é‡‘é¡åŸ·è¡Œ
                          execution:
                            type: object
                            properties:
                              budgetAmount:
                                type: number
                                example: 12000
                              usedAmount:
                                type: number
                                example: 8500
                              remainingAmount:
                                type: number
                                example: 3500
                              usagePercentage:
                                type: number
                                example: 70.83
                              projectedAmount:
                                type: number
                                example: 10370
                              projectedOverage:
                                type: number
                                example: -1630
                                description: "é è¨ˆè¶…æ”¯é‡‘é¡ï¼ˆè² æ•¸è¡¨ç¤ºé è¨ˆç¯€çœï¼‰"
                              status:
                                type: string
                                enum: [on_track, warning, exceeded, completed]
                                example: "warning"
                          
                          # é€Ÿåº¦åˆ†æ
                          pace:
                            type: object
                            properties:
                              expectedUsage:
                                type: number
                                example: 10451.61
                                description: "é æœŸä½¿ç”¨é‡‘é¡ï¼ˆæŒ‰æ™‚é–“æ¯”ä¾‹ï¼‰"
                              actualUsage:
                                type: number
                                example: 8500
                              paceRatio:
                                type: number
                                example: 0.81
                                description: "åŸ·è¡Œé€Ÿåº¦æ¯”ï¼ˆ<1=é ˜å…ˆï¼Œ>1=è½å¾Œï¼‰"
                              dailyTarget:
                                type: number
                                example: 387.10
                                description: "æ¯æ—¥ç›®æ¨™é‡‘é¡"
                              dailyActual:
                                type: number
                                example: 314.81
                                description: "å¯¦éš›æ—¥å‡æ”¯å‡º"
                              recommendedDaily:
                                type: number
                                example: 875
                                description: "å‰©é¤˜æœŸé–“å»ºè­°æ—¥å‡æ”¯å‡º"
                      
                      # Expert Mode: è©³ç´°åˆ†æ
                      analytics:
                        type: object
                        properties:
                          # é€±åº¦åˆ†æ
                          weeklyBreakdown:
                            type: array
                            items:
                              type: object
                              properties:
                                week:
                                  type: integer
                                  example: 1
                                startDate:
                                  type: string
                                  format: date
                                  example: "2025-01-01"
                                endDate:
                                  type: string
                                  format: date
                                  example: "2025-01-07"
                                budgetAmount:
                                  type: number
                                  example: 2790.32
                                actualAmount:
                                  type: number
                                  example: 2800
                                variance:
                                  type: number
                                  example: 9.68
                                variancePercentage:
                                  type: number
                                  example: 0.35
                                status:
                                  type: string
                                  enum: [under, on_track, over]
                                  example: "on_track"
                          
                          # ç§‘ç›®ç´°åˆ†ï¼ˆå¦‚é©ç”¨ï¼‰
                          categoryBreakdown:
                            type: array
                            items:
                              type: object
                              properties:
                                categoryId:
                                  type: string
                                  example: "category-uuid-restaurant"
                                categoryName:
                                  type: string
                                  example: "é¤å»³"
                                amount:
                                  type: number
                                  example: 5200
                                percentage:
                                  type: number
                                  example: 61.18
                                transactionCount:
                                  type: integer
                                  example: 18
                                averageAmount:
                                  type: number
                                  example: 288.89
                          
                          # æ™‚é–“æ¨¡å¼åˆ†æ
                          timePatterns:
                            type: object
                            properties:
                              peakDays:
                                type: array
                                items:
                                  type: string
                                  enum: [monday, tuesday, wednesday, thursday, friday, saturday, sunday]
                                example: ["friday", "saturday"]
                              peakHours:
                                type: array
                                items:
                                  type: integer
                                example: [12, 18, 19]
                              weekendVsWeekday:
                                type: object
                                properties:
                                  weekendPercentage:
                                    type: number
                                    example: 45.2
                                  weekdayPercentage:
                                    type: number
                                    example: 54.8
                          
                          # è¶¨å‹¢åˆ†æ
                          trends:
                            type: object
                            properties:
                              direction:
                                type: string
                                enum: [increasing, decreasing, stable]
                                example: "stable"
                              volatility:
                                type: string
                                enum: [low, medium, high]
                                example: "medium"
                              predictability:
                                type: number
                                example: 0.76
                                description: "å¯é æ¸¬æ€§æŒ‡æ•¸ï¼ˆ0-1ï¼‰"
                              anomalies:
                                type: array
                                items:
                                  type: object
                                  properties:
                                    date:
                                      type: string
                                      format: date
                                      example: "2025-01-15"
                                    amount:
                                      type: number
                                      example: 1200
                                    expected:
                                      type: number
                                      example: 400
                                    deviation:
                                      type: number
                                      example: 2.0
                                    description:
                                      type: string
                                      example: "ç•°å¸¸é«˜é¡æ”¯å‡º"
                      
                      # æ­·å²åŸ·è¡Œè¨˜éŒ„
                      history:
                        type: array
                        items:
                          type: object
                          properties:
                            period:
                              type: object
                              properties:
                                startDate:
                                  type: string
                                  format: date
                                  example: "2024-12-01"
                                endDate:
                                  type: string
                                  format: date
                                  example: "2024-12-31"
                                monthName:
                                  type: string
                                  example: "2024å¹´12æœˆ"
                            budgetAmount:
                              type: number
                              example: 12000
                            actualAmount:
                              type: number
                              example: 10800
                            usagePercentage:
                              type: number
                              example: 90.0
                            variance:
                              type: number
                              example: -1200
                            status:
                              type: string
                              example: "on_track"
                            grade:
                              type: string
                              enum: [A, B, C, D, F]
                              example: "A"
                              description: "åŸ·è¡Œè©•ç´š"
                      
                      # ç›¸é—œäº¤æ˜“ï¼ˆå¦‚è«‹æ±‚ï¼‰
                      recentTransactions:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "transaction-uuid-001"
                            amount:
                              type: number
                              example: 650
                            description:
                              type: string
                              example: "åˆé¤èšæœƒ"
                            categoryName:
                              type: string
                              example: "é¤å»³"
                            accountName:
                              type: string
                              example: "ä¿¡ç”¨å¡"
                            date:
                              type: string
                              format: date
                              example: "2025-01-27"
                            impactPercentage:
                              type: number
                              example: 5.42
                              description: "å°é ç®—çš„å½±éŸ¿ç™¾åˆ†æ¯”"
                      
                      # è­¦ç¤ºç‹€æ…‹
                      alerts:
                        type: object
                        properties:
                          activeAlerts:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "alert-uuid-001"
                                type:
                                  type: string
                                  enum: [warning, critical, projection]
                                  example: "warning"
                                threshold:
                                  type: number
                                  example: 80
                                triggeredAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-25T10:30:00Z"
                                message:
                                  type: string
                                  example: "é ç®—ä½¿ç”¨å·²é” 80%"
                                acknowledged:
                                  type: boolean
                                  example: false
                          nextThreshold:
                            type: object
                            properties:
                              percentage:
                                type: number
                                example: 100
                              type:
                                type: string
                                example: "critical"
                              estimatedDate:
                                type: string
                                format: date
                                example: "2025-01-30"
                                description: "é è¨ˆè§¸ç™¼æ—¥æœŸ"
                      
                      # Cultivation Mode: æ¿€å‹µè³‡è¨Š
                      motivation:
                        type: object
                        properties:
                          streak:
                            type: integer
                            example: 3
                            description: "é€£çºŒé”æ¨™æœˆæ•¸"
                          bestPeriod:
                            type: object
                            properties:
                              period:
                                type: string
                                example: "2024å¹´10æœˆ"
                              usagePercentage:
                                type: number
                                example: 67.2
                              savedAmount:
                                type: number
                                example: 3936
                          improvement:
                            type: object
                            properties:
                              compared_to_last_period:
                                type: number
                                example: 12.5
                                description: "ç›¸æ¯”ä¸ŠæœŸæ”¹å–„ç™¾åˆ†æ¯”"
                              compared_to_average:
                                type: number
                                example: 8.3
                                description: "ç›¸æ¯”å¹³å‡è¡¨ç¾æ”¹å–„ç™¾åˆ†æ¯”"
                          challenges:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "challenge-uuid-001"
                                title:
                                  type: string
                                  example: "æœ¬æœˆæ§åˆ¶åœ¨ 90% ä»¥å…§"
                                description:
                                  type: string
                                  example: "åœ¨æœˆåº•å‰å°‡é ç®—ä½¿ç”¨æ§åˆ¶åœ¨ 90% ä»¥å…§"
                                progress:
                                  type: number
                                  example: 78.7
                                target:
                                  type: number
                                  example: 90.0
                                reward:
                                  type: string
                                  example: "ç²å¾—ç¯€ç´„é”äººå¾½ç« "
                                status:
                                  type: string
                                  enum: [active, completed, failed]
                                  example: "active"
                      
                      # è¨­å®šè³‡è¨Š
                      settings:
                        type: object
                        properties:
                          isActive:
                            type: boolean
                            example: true
                          priority:
                            type: integer
                            example: 1
                          autoRenew:
                            type: boolean
                            example: true
                          rollover:
                            type: boolean
                            example: false
                          flexibility:
                            type: number
                            example: 10
                          alertThresholds:
                            type: array
                            items:
                              type: object
                              properties:
                                percentage:
                                  type: number
                                  example: 80
                                type:
                                  type: string
                                  example: "warning"
                          notificationMethods:
                            type: array
                            items:
                              type: string
                            example: ["app", "line"]
                      
                      # å¯©è¨ˆè³‡è¨Š
                      audit:
                        type: object
                        properties:
                          createdAt:
                            type: string
                            format: date-time
                            example: "2025-01-01T00:00:00Z"
                          updatedAt:
                            type: string
                            format: date-time
                            example: "2025-01-20T15:30:00Z"
                          createdBy:
                            type: string
                            example: "user-uuid-12345"
                          lastCalculatedAt:
                            type: string
                            format: date-time
                            example: "2025-01-27T12:30:00Z"
                          calculationVersion:
                            type: string
                            example: "v2.1.0"
                          totalPeriods:
                            type: integer
                            example: 4
                            description: "ç¸½åŸ·è¡ŒæœŸæ•¸"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    put:
      summary: "æ›´æ–°é ç®—"
      description: |
        æ›´æ–°é ç®—çš„è¨­å®šã€é‡‘é¡æˆ–è­¦ç¤ºæ¢ä»¶ã€‚
        
        **å°æ‡‰ç•«é¢**: S-307 é ç®—ç®¡ç†ä¸»é ç·¨è¼¯åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦å°è©²é ç®—æœ‰ç·¨è¼¯æ¬Šé™
      tags:
        - "é ç®—ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "é ç®— ID"
          schema:
            type: string
            example: "budget-uuid-001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                # åŸºæœ¬è³‡è¨Š
                name:
                  type: string
                  example: "é£Ÿç‰©èˆ‡é¤é£²æœˆé ç®—"
                  maxLength: 100
                description:
                  type: string
                  example: "åŒ…å«æ‰€æœ‰é£Ÿç‰©ç›¸é—œæ”¯å‡ºçš„æœˆåº¦é ç®—"
                  maxLength: 500
                amount:
                  type: number
                  example: 13500
                  minimum: 0.01
                
                # é€±æœŸèª¿æ•´ï¼ˆåƒ…é™ç•¶å‰é€±æœŸä¹‹å¾Œï¼‰
                period:
                  type: object
                  properties:
                    duration:
                      type: integer
                      example: 24
                      description: "èª¿æ•´ç¸½æœŸæ•¸"
                    autoRenew:
                      type: boolean
                      example: true
                
                # ç›®æ¨™èª¿æ•´
                target:
                  type: object
                  properties:
                    includeSubcategories:
                      type: boolean
                      example: true
                    # å…¶ä»–ç›®æ¨™è¨­å®šèˆ‡å»ºç«‹æ™‚ç›¸åŒ
                
                # è¨­å®šæ›´æ–°
                settings:
                  type: object
                  properties:
                    priority:
                      type: integer
                      example: 1
                      minimum: 1
                      maximum: 5
                    rollover:
                      type: boolean
                      example: true
                    flexibility:
                      type: number
                      example: 15
                      minimum: 0
                      maximum: 50
                    isActive:
                      type: boolean
                      example: true
                
                # è­¦ç¤ºæ›´æ–°
                alerts:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                      example: true
                    thresholds:
                      type: array
                      items:
                        type: object
                        properties:
                          percentage:
                            type: number
                            example: 75
                          type:
                            type: string
                            enum: [warning, critical]
                            example: "warning"
                    notificationMethods:
                      type: array
                      items:
                        type: string
                        enum: [app, email, line]
                      example: ["app", "email"]
      responses:
        '200':
          description: "é ç®—æ›´æ–°æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      budgetId:
                        type: string
                        example: "budget-uuid-001"
                      message:
                        type: string
                        example: "é ç®—æ›´æ–°æˆåŠŸ"
                      updatedFields:
                        type: array
                        items:
                          type: string
                        example: ["name", "amount", "alerts.thresholds"]
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      
                      # å½±éŸ¿åˆ†æ
                      impact:
                        type: object
                        properties:
                          amountChange:
                            type: number
                            example: 1500
                            description: "é‡‘é¡è®Šæ›´"
                          usagePercentageChange:
                            type: number
                            example: -11.85
                            description: "ä½¿ç”¨ç‡è®ŠåŒ–"
                          newDailyBudget:
                            type: number
                            example: 1125
                            description: "æ–°çš„æ¯æ—¥å‰©é¤˜é ç®—"
                          alertsTriggered:
                            type: array
                            items:
                              type: string
                            example: []
                            description: "å› æ›´æ–°è§¸ç™¼çš„æ–°è­¦ç¤º"
                          
                          # æ­·å²å½±éŸ¿
                          historicalImpact:
                            type: object
                            properties:
                              affectedPeriods:
                                type: integer
                                example: 0
                                description: "å½±éŸ¿çš„æ­·å²æœŸæ•¸"
                              recalculationNeeded:
                                type: boolean
                                example: false
                      
                      # å»ºè­°
                      recommendations:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              example: "adjustment_tip"
                            message:
                              type: string
                              example: "é ç®—å¢åŠ å¾Œï¼Œå»ºè­°é‡æ–°æª¢è¦–ç›¸é—œå­ç§‘ç›®çš„åˆ†é…"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      summary: "åˆªé™¤é ç®—"
      description: |
        åˆªé™¤æŒ‡å®šé ç®—ï¼Œä¿ç•™åŸ·è¡Œæ­·å²è¨˜éŒ„ä»¥ä¾›åˆ†æã€‚
        
        **å°æ‡‰ç•«é¢**: S-307 é ç®—ç®¡ç†ä¸»é åˆªé™¤åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦å°è©²é ç®—æœ‰åˆªé™¤æ¬Šé™
        **æ¥­å‹™é‚è¼¯**: è»Ÿåˆªé™¤ï¼Œä¿ç•™æ­·å²æ•¸æ“š
      tags:
        - "é ç®—ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "é ç®— ID"
          schema:
            type: string
            example: "budget-uuid-001"
        - name: deleteHistory
          in: query
          description: "æ˜¯å¦åŒæ™‚åˆªé™¤æ­·å²è¨˜éŒ„"
          schema:
            type: boolean
            default: false
        - name: reason
          in: query
          description: "åˆªé™¤åŸå› "
          schema:
            type: string
            enum: [no_longer_needed, replaced_by_other, wrong_setup, other]
            example: "no_longer_needed"
      responses:
        '200':
          description: "é ç®—åˆªé™¤æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      budgetId:
                        type: string
                        example: "budget-uuid-001"
                      message:
                        type: string
                        example: "é ç®—å·²åˆªé™¤"
                      deletedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      
                      # åˆªé™¤å½±éŸ¿
                      impact:
                        type: object
                        properties:
                          periodsExecuted:
                            type: integer
                            example: 4
                            description: "å·²åŸ·è¡ŒæœŸæ•¸"
                          historyPreserved:
                            type: boolean
                            example: true
                            description: "æ˜¯å¦ä¿ç•™æ­·å²è¨˜éŒ„"
                          alertsRemoved:
                            type: integer
                            example: 3
                            description: "ç§»é™¤çš„è­¦ç¤ºæ•¸é‡"
                          
                          # ç›¸é—œå½±éŸ¿
                          relatedBudgets:
                            type: array
                            items:
                              type: object
                              properties:
                                budgetId:
                                  type: string
                                  example: "budget-uuid-002"
                                budgetName:
                                  type: string
                                  example: "ç¸½æ”¯å‡ºé ç®—"
                                relationship:
                                  type: string
                                  example: "included_in_total"
                            description: "å—å½±éŸ¿çš„ç›¸é—œé ç®—"
                      
                      # çµ±è¨ˆæ‘˜è¦
                      summary:
                        type: object
                        properties:
                          totalPeriods:
                            type: integer
                            example: 4
                          averageUsageRate:
                            type: number
                            example: 82.5
                            description: "å¹³å‡ä½¿ç”¨ç‡"
                          bestPerformance:
                            type: number
                            example: 67.2
                            description: "æœ€ä½³è¡¨ç¾ç‡"
                          totalSavings:
                            type: number
                            example: 8400
                            description: "ç´¯è¨ˆç¯€çœé‡‘é¡"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '400':
          description: "ç„¡æ³•åˆªé™¤é ç®—"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "BUSINESS_LOGIC_ERROR"
                      message:
                        type: string
                        example: "é ç®—ç•¶å‰é€±æœŸå°šæœªçµæŸï¼Œç„¡æ³•åˆªé™¤"
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      details:
                        type: object
                        properties:
                          currentPeriodEnd:
                            type: string
                            format: date
                            example: "2025-01-31"
                          relatedBudgets:
                            type: integer
                            example: 2
                          suggestions:
                            type: array
                            items:
                              type: string
                            example: ["æš«åœé ç®—", "ç­‰åˆ°æœŸé–“çµæŸ", "ä¿®æ”¹è€Œéåˆªé™¤"]
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /budgets/status:
    get:
      summary: "å–å¾—é ç®—åŸ·è¡Œç‹€æ³"
      description: |
        å–å¾—æ‰€æœ‰é ç®—çš„å³æ™‚åŸ·è¡Œç‹€æ³æ‘˜è¦ï¼Œç”¨æ–¼ä¸»é å±•ç¤ºã€‚
        
        **å°æ‡‰ç•«é¢**: S-202 APP è¨˜å¸³ä¸»é é ç®—å€å¡Š
        **å››æ¨¡å¼å·®ç•°**: é¡¯ç¤ºè©³ç´°ç¨‹åº¦ä¸åŒ
      tags:
        - "é ç®—æŸ¥è©¢"
      parameters:
        - name: ledgerId
          in: query
          description: "æŒ‡å®šå¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: includeInactive
          in: query
          description: "æ˜¯å¦åŒ…å«éæ´»èºé ç®—"
          schema:
            type: boolean
            default: false
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—é ç®—ç‹€æ³"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      # ç¸½é«”ç‹€æ³
                      overview:
                        type: object
                        properties:
                          totalBudgets:
                            type: integer
                            example: 8
                          activeBudgets:
                            type: integer
                            example: 6
                          totalBudgetAmount:
                            type: number
                            example: 35000
                          totalUsedAmount:
                            type: number
                            example: 22500
                          overallUsagePercentage:
                            type: number
                            example: 64.29
                          overallStatus:
                            type: string
                            enum: [excellent, good, warning, critical]
                            example: "good"
                      
                      # ç‹€æ³åˆ†å¸ƒ
                      statusDistribution:
                        type: object
                        properties:
                          onTrack:
                            type: integer
                            example: 4
                          warning:
                            type: integer
                            example: 2
                          exceeded:
                            type: integer
                            example: 0
                          completed:
                            type: integer
                            example: 2
                      
                      # é ç®—åˆ—è¡¨ï¼ˆç°¡åŒ–ï¼‰
                      budgets:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "budget-uuid-001"
                            name:
                              type: string
                              example: "é£Ÿç‰©"
                            amount:
                              type: number
                              example: 12000
                            used:
                              type: number
                              example: 8500
                            percentage:
                              type: number
                              example: 70.83
                            status:
                              type: string
                              enum: [on_track, warning, exceeded, completed]
                              example: "warning"
                            daysRemaining:
                              type: integer
                              example: 4
                            # Expert Mode: è©³ç´°è³‡è¨Š
                            trend:
                              type: string
                              enum: [improving, stable, worsening]
                              example: "stable"
                            projectedOverage:
                              type: number
                              example: -1630
                              description: "é è¨ˆè¶…æ”¯é‡‘é¡"
                      
                      # è­¦ç¤ºæ‘˜è¦
                      alerts:
                        type: object
                        properties:
                          total:
                            type: integer
                            example: 3
                          byType:
                            type: object
                            properties:
                              warning:
                                type: integer
                                example: 2
                              critical:
                                type: integer
                                example: 1
                              projection:
                                type: integer
                                example: 0
                          recent:
                            type: array
                            items:
                              type: object
                              properties:
                                budgetId:
                                  type: string
                                  example: "budget-uuid-001"
                                budgetName:
                                  type: string
                                  example: "é£Ÿç‰©"
                                type:
                                  type: string
                                  example: "warning"
                                message:
                                  type: string
                                  example: "é ç®—ä½¿ç”¨å·²é” 80%"
                                triggeredAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-25T10:30:00Z"
                      
                      # Cultivation Mode: æˆå°±è³‡è¨Š
                      achievements:
                        type: object
                        properties:
                          monthlyGoalProgress:
                            type: number
                            example: 85.5
                            description: "æœˆåº¦ç›®æ¨™é”æˆç‡"
                          streakCount:
                            type: integer
                            example: 3
                            description: "é€£çºŒé”æ¨™æœˆæ•¸"
                          improvementTrend:
                            type: string
                            enum: [improving, stable, needs_attention]
                            example: "improving"
                          savingsThisMonth:
                            type: number
                            example: 2800
                            description: "æœ¬æœˆç¯€çœé‡‘é¡"
                      
                      # Expert Mode: è¶¨å‹¢åˆ†æ
                      trends:
                        type: object
                        properties:
                          overallTrend:
                            type: string
                            enum: [improving, stable, worsening]
                            example: "stable"
                          volatility:
                            type: string
                            enum: [low, medium, high]
                            example: "medium"
                          predictability:
                            type: number
                            example: 0.78
                            description: "å¯é æ¸¬æ€§æŒ‡æ•¸"
                          riskScore:
                            type: number
                            example: 0.35
                            description: "é¢¨éšªè©•åˆ†ï¼ˆ0-1ï¼Œè¶Šé«˜è¶Šå±éšªï¼‰"
                      
                      # å»ºè­°è¡Œå‹•
                      actionItems:
                        type: array
                        items:
                          type: object
                          properties:
                            priority:
                              type: string
                              enum: [high, medium, low]
                              example: "high"
                            type:
                              type: string
                              enum: [budget_adjustment, spending_review, alert_setup, category_analysis]
                              example: "spending_review"
                            title:
                              type: string
                              example: "æª¢è¦–é£Ÿç‰©æ”¯å‡ºæ¨¡å¼"
                            description:
                              type: string
                              example: "é£Ÿç‰©é ç®—ä½¿ç”¨ç‡è¼ƒé«˜ï¼Œå»ºè­°æª¢è¦–è¿‘æœŸæ”¯å‡ºæ˜ç´°"
                            budgetId:
                              type: string
                              example: "budget-uuid-001"
                            actionUrl:
                              type: string
                              example: "/budgets/budget-uuid-001/analysis"
                      
                      # æ›´æ–°æ™‚é–“
                      lastUpdated:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:30:00Z"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /budgets/templates:
    get:
      summary: "å–å¾—é ç®—æ¨¡æ¿åˆ—è¡¨"
      description: |
        å–å¾—ç³»çµ±æä¾›çš„é ç®—æ¨¡æ¿ï¼Œä¾¿æ–¼å¿«é€Ÿå»ºç«‹å¸¸ç”¨é ç®—ã€‚
        
        **å°æ‡‰ç•«é¢**: S-308 å»ºç«‹é ç®—é æ¨¡æ¿é¸æ“‡
        **å››æ¨¡å¼å·®ç•°**: æ¨è–¦æ¨¡æ¿èˆ‡è¤‡é›œåº¦ä¸åŒ
      tags:
        - "é ç®—è¨­å®š"
      parameters:
        - name: category
          in: query
          description: "æ¨¡æ¿åˆ†é¡"
          schema:
            type: string
            enum: [beginner, family, business, student, all]
            default: all
        - name: type
          in: query
          description: "é ç®—é¡å‹"
          schema:
            type: string
            enum: [category, account, tag, total]
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—é ç®—æ¨¡æ¿"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      # æ¨è–¦æ¨¡æ¿ï¼ˆåŸºæ–¼ç”¨æˆ¶æ¨¡å¼ï¼‰
                      recommended:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "template-monthly-basic"
                            name:
                              type: string
                              example: "åŸºç¤æœˆåº¦é ç®—"
                            description:
                              type: string
                              example: "é©åˆæ–°æ‰‹çš„ç°¡å–®æœˆåº¦é ç®—è¨­å®š"
                            category:
                              type: string
                              example: "beginner"
                            complexity:
                              type: string
                              enum: [simple, standard, advanced]
                              example: "simple"
                            estimatedSetupTime:
                              type: integer
                              example: 5
                              description: "é ä¼°è¨­å®šæ™‚é–“ï¼ˆåˆ†é˜ï¼‰"
                            popularity:
                              type: number
                              example: 4.8
                              description: "ä½¿ç”¨è€…è©•åˆ†"
                            usageCount:
                              type: integer
                              example: 1250
                              description: "ä½¿ç”¨æ¬¡æ•¸"
                      
                      # æ¨¡æ¿åˆ†é¡
                      categories:
                        type: object
                        properties:
                          beginner:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "template-beginner-food"
                                name:
                                  type: string
                                  example: "æ–°æ‰‹é£Ÿç‰©é ç®—"
                                suggestedAmount:
                                  type: number
                                  example: 8000
                                period:
                                  type: string
                                  example: "monthly"
                                features:
                                  type: array
                                  items:
                                    type: string
                                  example: ["ç°¡å–®è¨­å®š", "åŸºæœ¬è­¦ç¤º", "æœˆåº¦é€±æœŸ"]
                          family:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "template-family-comprehensive"
                                name:
                                  type: string
                                  example: "å®¶åº­ç¶œåˆé ç®—"
                                suggestedAmount:
                                  type: number
                                  example: 25000
                                period:
                                  type: string
                                  example: "monthly"
                                features:
                                  type: array
                                  items:
                                    type: string
                                  example: ["å¤šç§‘ç›®é ç®—", "å­é ç®—è¨­å®š", "å®¶åº­æˆå“¡åˆ†é…"]
                          business:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "template-business-expense"
                                name:
                                  type: string
                                  example: "å•†å‹™æ”¯å‡ºé ç®—"
                                suggestedAmount:
                                  type: number
                                  example: 15000
                                period:
                                  type: string
                                  example: "monthly"
                                features:
                                  type: array
                                  items:
                                    type: string
                                  example: ["å•†å‹™åˆ†é¡", "ç¨…å‹™è€ƒé‡", "å ±è¡¨æ•´åˆ"]
                      
                      # è‡ªè¨‚æ¨¡æ¿å»ºè­°
                      customSuggestions:
                        type: array
                        description: "åŸºæ–¼ç”¨æˆ¶æ­·å²æ•¸æ“šçš„å®¢è£½åŒ–å»ºè­°"
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              example: "category"
                            categoryName:
                              type: string
                              example: "äº¤é€š"
                            suggestedAmount:
                              type: number
                              example: 3200
                            basedOnData:
                              type: object
                              properties:
                                analysisMonths:
                                  type: integer
                                  example: 6
                                averageAmount:
                                  type: number
                                  example: 2980
                                maxAmount:
                                  type: number
                                  example: 4200
                                confidence:
                                  type: number
                                  example: 0.85
                            reasoning:
                              type: string
                              example: "æ ¹æ“šéå» 6 å€‹æœˆçš„äº¤é€šæ”¯å‡ºæ•¸æ“šåˆ†æ"
                      
                      # æ¨¡æ¿è©³æƒ…
                      templateDetails:
                        type: object
                        additionalProperties:
                          type: object
                          properties:
                            id:
                              type: string
                            name:
                              type: string
                            description:
                              type: string
                            configuration:
                              type: object
                              properties:
                                type:
                                  type: string
                                  enum: [category, account, tag, total]
                                period:
                                  type: string
                                  enum: [monthly, quarterly, yearly]
                                defaultAmount:
                                  type: number
                                alerts:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      percentage:
                                        type: number
                                      type:
                                        type: string
                                includedCategories:
                                  type: array
                                  items:
                                    type: string
                                settings:
                                  type: object
                                  properties:
                                    autoRenew:
                                      type: boolean
                                    rollover:
                                      type: boolean
                                    priority:
                                      type: integer
                            instructions:
                              type: array
                              items:
                                type: string
                              example: ["é¸æ“‡ä¸»è¦é£Ÿç‰©ç§‘ç›®", "è¨­å®šæœˆåº¦é‡‘é¡", "å•Ÿç”¨ 80% è­¦ç¤º"]
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /budgets/alert:
    post:
      summary: "è¨­å®šé ç®—è­¦ç¤º"
      description: |
        ç‚ºæŒ‡å®šé ç®—å»ºç«‹æˆ–æ›´æ–°è­¦ç¤ºè¨­å®šï¼Œæ”¯æ´å¤šç¨®è§¸ç™¼æ¢ä»¶ã€‚
        
        **ä½¿ç”¨å ´æ™¯**: æ‰¹æ¬¡è­¦ç¤ºè¨­å®šã€å‹•æ…‹è­¦ç¤ºèª¿æ•´
      tags:
        - "é ç®—ç®¡ç†"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                budgetId:
                  type: string
                  example: "budget-uuid-001"
                alerts:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                        enum: [percentage, amount, projection, time_based]
                        example: "percentage"
                      condition:
                        type: object
                        properties:
                          # percentage é¡å‹
                          percentage:
                            type: number
                            example: 90
                            minimum: 1
                            maximum: 200
                          # amount é¡å‹
                          amount:
                            type: number
                            example: 10000
                          # projection é¡å‹
                          projectedOverage:
                            type: number
                            example: 1000
                          # time_based é¡å‹
                          daysRemaining:
                            type: integer
                            example: 7
                      severity:
                        type: string
                        enum: [info, warning, critical]
                        example: "warning"
                      message:
                        type: string
                        example: "é ç®—ä½¿ç”¨å·²é” 90%ï¼Œè«‹æ³¨æ„æ§åˆ¶æ”¯å‡º"
                      enabled:
                        type: boolean
                        example: true
                      methods:
                        type: array
                        items:
                          type: string
                          enum: [app, email, line, sms]
                        example: ["app", "line"]
                      frequency:
                        type: string
                        enum: [once, daily, weekly]
                        example: "once"
                        description: "é€šçŸ¥é »ç‡"
              required:
                - budgetId
                - alerts
      responses:
        '201':
          description: "è­¦ç¤ºè¨­å®šæˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      budgetId:
                        type: string
                        example: "budget-uuid-001"
                      alertsCreated:
                        type: integer
                        example: 3
                      alertsUpdated:
                        type: integer
                        example: 1
                      alertIds:
                        type: array
                        items:
                          type: string
                        example: ["alert-uuid-001", "alert-uuid-002", "alert-uuid-003"]
                      message:
                        type: string
                        example: "é ç®—è­¦ç¤ºè¨­å®šå®Œæˆ"
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "req-uuid-123"
                      userMode:
                        type: string
                        example: "Expert"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Firebase Auth JWT Token"

  responses:
    UnauthorizedError:
      description: "æœªæˆæ¬Šå­˜å–"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "UNAUTHORIZED"
                  message:
                    type: string
                    example: "Token ç„¡æ•ˆæˆ–å·²éæœŸ"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"
                  requestId:
                    type: string
                    example: "req-uuid-123"

    ValidationError:
      description: "è«‹æ±‚åƒæ•¸é©—è­‰å¤±æ•—"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "VALIDATION_ERROR"
                  message:
                    type: string
                    example: "è«‹æ±‚åƒæ•¸ä¸æ­£ç¢º"
                  field:
                    type: string
                    example: "amount"
                  details:
                    type: string
                    example: "é ç®—é‡‘é¡å¿…é ˆå¤§æ–¼ 0"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"
                  requestId:
                    type: string
                    example: "req-uuid-123"

    NotFoundError:
      description: "è³‡æºä¸å­˜åœ¨"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "RESOURCE_NOT_FOUND"
                  message:
                    type: string
                    example: "æ‰¾ä¸åˆ°æŒ‡å®šçš„é ç®—"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"
                  requestId:
                    type: string
                    example: "req-uuid-123"

tags:
  - name: "é ç®—æŸ¥è©¢"
    description: "é ç®—è³‡è¨ŠæŸ¥è©¢ç›¸é—œåŠŸèƒ½"
  - name: "é ç®—ç®¡ç†"
    description: "é ç®—å»ºç«‹ã€ä¿®æ”¹ã€åˆªé™¤åŠŸèƒ½"
  - name: "é ç®—è¨­å®š"
    description: "é ç®—æ¨¡æ¿å’Œè¨­å®šç›¸é—œåŠŸèƒ½"
