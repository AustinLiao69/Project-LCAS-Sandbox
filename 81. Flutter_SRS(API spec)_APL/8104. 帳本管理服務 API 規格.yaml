
openapi: 3.0.3
info:
  title: LCAS 2.0 - å¸³æœ¬ç®¡ç†æœå‹™ API è¦æ ¼
  version: 1.0.0
  description: |
    **LCAS 2.0 å¸³æœ¬ç®¡ç†æœå‹™ API è¦æ ¼**
    
    è² è²¬å¸³æœ¬çš„å®Œæ•´ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ŒåŒ…å«å€‹äººå¸³æœ¬ã€å”ä½œå¸³æœ¬çš„å»ºç«‹ã€ç®¡ç†ã€æ¬Šé™æ§åˆ¶ç­‰åŠŸèƒ½ã€‚
    æ”¯æ´å¤šå¸³æœ¬æ¶æ§‹ï¼Œæä¾›å››æ¨¡å¼å·®ç•°åŒ–é«”é©—èˆ‡å”ä½œåŠŸèƒ½ã€‚
    
    **æœå‹™ç¯„åœ**:
    - å¸³æœ¬ CRUDï¼ˆå»ºç«‹ã€æŸ¥è©¢ã€ä¿®æ”¹ã€åˆªé™¤ï¼‰
    - å”ä½œå¸³æœ¬ç®¡ç†ï¼ˆé‚€è«‹ã€æ¬Šé™ã€æˆå“¡ç®¡ç†ï¼‰
    - å¸³æœ¬æ¬Šé™æ§åˆ¶ï¼ˆæª¢è¦–ã€ç·¨è¼¯ã€ç®¡ç†ã€åˆªé™¤æ¬Šé™ï¼‰
    - å”ä½œè¡çªæª¢æ¸¬èˆ‡è§£æ±ºæ©Ÿåˆ¶
    - æ“ä½œå¯©è¨ˆæ—¥èªŒèˆ‡è¿½è¹¤
    
    **å››æ¨¡å¼å·®ç•°åŒ–ç­–ç•¥**:
    - **Expert**: å®Œæ•´å¸³æœ¬ç®¡ç†å·¥å…·ã€ç´°ç²’åº¦æ¬Šé™æ§åˆ¶ã€é«˜ç´šå”ä½œåŠŸèƒ½
    - **Inertial**: æ¨™æº–å¸³æœ¬æ“ä½œã€ç°¡åŒ–æ¬Šé™è¨­å®šã€åŸºæœ¬å”ä½œ
    - **Cultivation**: å¼•å°å¼å¸³æœ¬å»ºç«‹ã€æ¨è–¦è¨­å®šã€æˆé•·è¿½è¹¤
    - **Guiding**: æ¥µç°¡å¸³æœ¬ç®¡ç†ã€é è¨­è¨­å®šã€æœ€å°‘æ±ºç­–
    
    **ç‰ˆæœ¬**: 1.0.0  
    **å»ºç«‹æ—¥æœŸ**: 2025-08-22  
    **å°æ‡‰æ–‡ä»¶**: 0021. Screen list.md (S-301~S-303)
    **æ¨™æº–ç«¯é»æ•¸**: 13å€‹

servers:
  - url: https://api.lcas.app/v1
    description: "Production server"
  - url: https://api-staging.lcas.app/v1
    description: "Staging server"

security:
  - BearerAuth: []

paths:
  /ledgers:
    get:
      summary: "å–å¾—å¸³æœ¬åˆ—è¡¨"
      description: |
        å–å¾—ç”¨æˆ¶æœ‰æ¬Šé™å­˜å–çš„æ‰€æœ‰å¸³æœ¬ï¼ŒåŒ…å«å€‹äººå¸³æœ¬èˆ‡å”ä½œå¸³æœ¬ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é 
        **å››æ¨¡å¼å·®ç•°**: é¡¯ç¤ºè³‡è¨Šè©³ç´°ç¨‹åº¦èˆ‡æ’åºæ–¹å¼ä¸åŒ
      tags:
        - "å¸³æœ¬æŸ¥è©¢"
      parameters:
        - name: type
          in: query
          description: "å¸³æœ¬é¡å‹ç¯©é¸"
          schema:
            type: string
            enum: [personal, collaboration, shared, all]
            default: all
        - name: role
          in: query
          description: "ç”¨æˆ¶è§’è‰²ç¯©é¸"
          schema:
            type: string
            enum: [owner, admin, editor, viewer]
        - name: status
          in: query
          description: "å¸³æœ¬ç‹€æ…‹ç¯©é¸"
          schema:
            type: string
            enum: [active, archived, deleted]
            default: active
        - name: search
          in: query
          description: "æœå°‹é—œéµå­—ï¼ˆå¸³æœ¬åç¨±ã€æè¿°ï¼‰"
          schema:
            type: string
            example: "å®¶åº­"
        - name: sortBy
          in: query
          description: "æ’åºæ¬„ä½"
          schema:
            type: string
            enum: [name, created_at, updated_at, last_used]
            default: updated_at
        - name: sortOrder
          in: query
          description: "æ’åºæ–¹å‘"
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          description: "é ç¢¼"
          schema:
            type: integer
            example: 1
            default: 1
        - name: limit
          in: query
          description: "æ¯é ç­†æ•¸"
          schema:
            type: integer
            example: 20
            default: 20
            maximum: 100
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å¸³æœ¬åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "ledger-uuid-001"
                            name:
                              type: string
                              example: "å€‹äººå¸³æœ¬"
                            description:
                              type: string
                              example: "å€‹äººæ—¥å¸¸è¨˜å¸³"
                            type:
                              type: string
                              enum: [personal, collaboration, shared]
                              example: "personal"
                            
                            # åŸºæœ¬è³‡è¨Šï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰
                            owner:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "user-uuid-12345"
                                name:
                                  type: string
                                  example: "å¼µå°æ˜"
                                avatar:
                                  type: string
                                  example: "https://api.lcas.app/avatars/user-001.jpg"
                            
                            userRole:
                              type: string
                              enum: [owner, admin, editor, viewer]
                              example: "owner"
                            
                            permissions:
                              type: object
                              properties:
                                canView:
                                  type: boolean
                                  example: true
                                canEdit:
                                  type: boolean
                                  example: true
                                canManage:
                                  type: boolean
                                  example: true
                                canDelete:
                                  type: boolean
                                  example: true
                                canInvite:
                                  type: boolean
                                  example: true
                            
                            # Expert Mode: è©³ç´°è³‡è¨Š
                            statistics:
                              type: object
                              properties:
                                transactionCount:
                                  type: integer
                                  example: 245
                                memberCount:
                                  type: integer
                                  example: 1
                                totalIncome:
                                  type: number
                                  example: 150000
                                totalExpense:
                                  type: number
                                  example: 89000
                                balance:
                                  type: number
                                  example: 61000
                                lastActivity:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                            
                            # è¨­å®šè³‡è¨Š
                            settings:
                              type: object
                              properties:
                                currency:
                                  type: string
                                  example: "TWD"
                                timezone:
                                  type: string
                                  example: "Asia/Taipei"
                                isDefault:
                                  type: boolean
                                  example: true
                                color:
                                  type: string
                                  example: "#4CAF50"
                                icon:
                                  type: string
                                  example: "ğŸ’°"
                            
                            # å¯©è¨ˆè³‡è¨Š
                            audit:
                              type: object
                              properties:
                                createdAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-01T00:00:00Z"
                                updatedAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                                status:
                                  type: string
                                  enum: [active, archived, deleted]
                                  example: "active"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      summary: "å»ºç«‹å¸³æœ¬"
      description: |
        å»ºç«‹æ–°çš„å€‹äººæˆ–å”ä½œå¸³æœ¬ï¼Œæ”¯æ´æ¨¡æ¿èˆ‡è‡ªè¨‚è¨­å®šã€‚
        
        **å°æ‡‰ç•«é¢**: S-302 å»ºç«‹å¸³æœ¬é 
        **å››æ¨¡å¼å·®ç•°**: å¯è¨­å®šé¸é …èˆ‡é è¨­å€¼ä¸åŒ
      tags:
        - "å¸³æœ¬ç®¡ç†"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "å®¶åº­æ”¯å‡ºå¸³æœ¬"
                  maxLength: 100
                  minLength: 1
                type:
                  type: string
                  enum: [personal, collaboration]
                  example: "collaboration"
                description:
                  type: string
                  example: "è¨˜éŒ„å®¶åº­æ—¥å¸¸é–‹æ”¯èˆ‡æ”¶å…¥"
                  maxLength: 500
                settings:
                  type: object
                  properties:
                    currency:
                      type: string
                      example: "TWD"
                      default: "TWD"
                    timezone:
                      type: string
                      example: "Asia/Taipei"
                      default: "Asia/Taipei"
                    isDefault:
                      type: boolean
                      example: false
                      default: false
                    color:
                      type: string
                      example: "#2196F3"
                      pattern: "^#[0-9A-Fa-f]{6}$"
                    icon:
                      type: string
                      example: "ğŸ "
                      maxLength: 2
              required:
                - name
                - type
      responses:
        '201':
          description: "å¸³æœ¬å»ºç«‹æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-002"
                      name:
                        type: string
                        example: "å®¶åº­æ”¯å‡ºå¸³æœ¬"
                      type:
                        type: string
                        example: "collaboration"
                      createdAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:30:00Z"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ledgers/{id}:
    get:
      summary: "å–å¾—å¸³æœ¬è©³æƒ…"
      description: |
        å–å¾—æŒ‡å®šå¸³æœ¬çš„å®Œæ•´è©³ç´°è³‡è¨Šï¼ŒåŒ…å«è¨­å®šã€çµ±è¨ˆã€æˆå“¡ç­‰ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é è©³ç´°æª¢è¦–
        **æ¬Šé™æª¢æŸ¥**: ç¢ºèªç”¨æˆ¶å°è©²å¸³æœ¬æœ‰å­˜å–æ¬Šé™
      tags:
        - "å¸³æœ¬æŸ¥è©¢"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å¸³æœ¬è©³æƒ…"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: "ledger-uuid-001"
                      name:
                        type: string
                        example: "å€‹äººå¸³æœ¬"
                      description:
                        type: string
                        example: "å€‹äººæ—¥å¸¸è¨˜å¸³"
                      type:
                        type: string
                        example: "personal"
                      owner:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "user-uuid-12345"
                          name:
                            type: string
                            example: "å¼µå°æ˜"
                      userRole:
                        type: string
                        example: "owner"
                      permissions:
                        type: object
                        properties:
                          canView:
                            type: boolean
                            example: true
                          canEdit:
                            type: boolean
                            example: true
                          canManage:
                            type: boolean
                            example: true
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™å­˜å–è©²å¸³æœ¬"

    put:
      summary: "æ›´æ–°å¸³æœ¬"
      description: |
        æ›´æ–°å¸³æœ¬çš„åŸºæœ¬è³‡è¨Šã€è¨­å®šæˆ–æ¬Šé™é…ç½®ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é ç·¨è¼¯åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ manage æ¬Šé™
      tags:
        - "å¸³æœ¬ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "å€‹äººç”Ÿæ´»å¸³æœ¬"
                  maxLength: 100
                description:
                  type: string
                  example: "è¨˜éŒ„å€‹äººæ—¥å¸¸ç”Ÿæ´»æ”¯å‡ºèˆ‡æ”¶å…¥"
                  maxLength: 500
                settings:
                  type: object
                  properties:
                    currency:
                      type: string
                      example: "TWD"
                    color:
                      type: string
                      example: "#2196F3"
                    icon:
                      type: string
                      example: "ğŸ’"
      responses:
        '200':
          description: "å¸³æœ¬æ›´æ–°æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      message:
                        type: string
                        example: "å¸³æœ¬æ›´æ–°æˆåŠŸ"
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™ä¿®æ”¹è©²å¸³æœ¬"

    delete:
      summary: "åˆªé™¤å¸³æœ¬"
      description: |
        åˆªé™¤æŒ‡å®šå¸³æœ¬ï¼ŒåŒ…å«æ‰€æœ‰ç›¸é—œè³‡æ–™çš„è™•ç†ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é åˆªé™¤åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: åƒ…å¸³æœ¬æ“æœ‰è€…å¯åˆªé™¤
        **æ¥­å‹™é‚è¼¯**: è»Ÿåˆªé™¤ï¼Œä¿ç•™ 30 å¤©æ¢å¾©æœŸ
      tags:
        - "å¸³æœ¬ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      responses:
        '200':
          description: "å¸³æœ¬åˆªé™¤æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      message:
                        type: string
                        example: "å¸³æœ¬å·²æ¨™è¨˜ç‚ºåˆªé™¤ï¼Œ30 å¤©å…§å¯æ¢å¾©"
                      deletedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™åˆªé™¤è©²å¸³æœ¬"

  /ledgers/{id}/collaborators:
    get:
      summary: "å–å¾—å”ä½œè€…"
      description: |
        å–å¾—æŒ‡å®šå¸³æœ¬çš„æ‰€æœ‰å”ä½œè€…è³‡è¨Šï¼ŒåŒ…å«æ¬Šé™èˆ‡çµ±è¨ˆã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é 
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ view æ¬Šé™
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: role
          in: query
          description: "è§’è‰²ç¯©é¸"
          schema:
            type: string
            enum: [owner, admin, editor, viewer]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å”ä½œè€…åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      collaborators:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "user-uuid-12345"
                            name:
                              type: string
                              example: "å¼µå°æ˜"
                            email:
                              type: string
                              example: "ming@example.com"
                            role:
                              type: string
                              enum: [owner, admin, editor, viewer]
                              example: "owner"
                            status:
                              type: string
                              enum: [active, inactive, suspended]
                              example: "active"
                            joinedAt:
                              type: string
                              format: date-time
                              example: "2025-01-01T00:00:00Z"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™æŸ¥çœ‹å”ä½œè€…è³‡è¨Š"

    post:
      summary: "é‚€è«‹å”ä½œè€…"
      description: |
        é‚€è«‹æ–°ç”¨æˆ¶åŠ å…¥å”ä½œå¸³æœ¬ï¼Œæ”¯æ´æ‰¹æ¬¡é‚€è«‹ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é é‚€è«‹åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ invite æ¬Šé™
        **æ¥­å‹™é‚è¼¯**: ç™¼é€é‚€è«‹éƒµä»¶ï¼Œè¨­å®š 7 å¤©éæœŸæ™‚é–“
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                invitations:
                  type: array
                  items:
                    type: object
                    properties:
                      email:
                        type: string
                        format: email
                        example: "newmember@example.com"
                      role:
                        type: string
                        enum: [admin, editor, viewer]
                        example: "editor"
                  minItems: 1
                  maxItems: 10
              required:
                - invitations
      responses:
        '200':
          description: "é‚€è«‹ç™¼é€å®Œæˆ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      results:
                        type: array
                        items:
                          type: object
                          properties:
                            email:
                              type: string
                              example: "newmember@example.com"
                            status:
                              type: string
                              enum: [sent, failed, skipped, duplicate]
                              example: "sent"
                            invitationId:
                              type: string
                              example: "invite-uuid-002"
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™é‚€è«‹å”ä½œè€…"

  /ledgers/{id}/collaborators/{userId}:
    put:
      summary: "æ›´æ–°å”ä½œè€…æ¬Šé™"
      description: |
        æ›´æ–°æŒ‡å®šå”ä½œè€…åœ¨å¸³æœ¬ä¸­çš„è§’è‰²èˆ‡æ¬Šé™ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é æ¬Šé™ç·¨è¼¯
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ manage æ¬Šé™ï¼Œä¸”ä¸èƒ½ä¿®æ”¹æ“æœ‰è€…æ¬Šé™
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: userId
          in: path
          required: true
          description: "å”ä½œè€… ID"
          schema:
            type: string
            example: "user-uuid-67890"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [admin, editor, viewer]
                  example: "admin"
                reason:
                  type: string
                  example: "æå‡æ¬Šé™ä»¥å”åŠ©ç®¡ç†å¸³æœ¬"
                  maxLength: 200
              required:
                - role
      responses:
        '200':
          description: "å”ä½œè€…æ¬Šé™æ›´æ–°æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      userId:
                        type: string
                        example: "user-uuid-67890"
                      message:
                        type: string
                        example: "å”ä½œè€…æ¬Šé™æ›´æ–°æˆåŠŸ"
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™ä¿®æ”¹å”ä½œè€…æ¬Šé™"

    delete:
      summary: "ç§»é™¤å”ä½œè€…"
      description: |
        å¾å¸³æœ¬ä¸­ç§»é™¤æŒ‡å®šå”ä½œè€…ï¼Œè™•ç†ç›¸é—œè³‡æ–™æ­¸å±¬ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é ç§»é™¤åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ manage æ¬Šé™ï¼Œæ“æœ‰è€…ç„¡æ³•è¢«ç§»é™¤
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: userId
          in: path
          required: true
          description: "å”ä½œè€… ID"
          schema:
            type: string
            example: "user-uuid-67890"
      responses:
        '200':
          description: "å”ä½œè€…ç§»é™¤æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      removedUserId:
                        type: string
                        example: "user-uuid-67890"
                      message:
                        type: string
                        example: "å”ä½œè€…å·²å¾å¸³æœ¬ä¸­ç§»é™¤"
                      removedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
        '400':
          description: "ç§»é™¤å”ä½œè€…å¤±æ•—"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™ç§»é™¤å”ä½œè€…"

  /ledgers/{id}/permissions:
    get:
      summary: "å–å¾—æ¬Šé™ç‹€æ…‹"
      description: |
        å–å¾—ç•¶å‰ç”¨æˆ¶åœ¨æŒ‡å®šå¸³æœ¬ä¸­çš„è©³ç´°æ¬Šé™ç‹€æ…‹ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é æ¬Šé™æª¢æŸ¥
        **ç”¨é€”**: å‰ç«¯æ¬Šé™æ§åˆ¶èˆ‡åŠŸèƒ½é¡¯ç¤º
      tags:
        - "æ¬Šé™ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      responses:
        '200':
          description: "æˆåŠŸå–å¾—æ¬Šé™ç‹€æ…‹"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      userId:
                        type: string
                        example: "user-uuid-12345"
                      role:
                        type: string
                        example: "owner"
                      permissions:
                        type: object
                        properties:
                          canView:
                            type: boolean
                            example: true
                          canEdit:
                            type: boolean
                            example: true
                          canManage:
                            type: boolean
                            example: true
                          canDelete:
                            type: boolean
                            example: true
                          canInvite:
                            type: boolean
                            example: true
                          canExport:
                            type: boolean
                            example: true
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™æŸ¥çœ‹è©²å¸³æœ¬"

  /ledgers/{id}/conflicts:
    get:
      summary: "æª¢æ¸¬å”ä½œè¡çª"
      description: |
        æª¢æ¸¬å¸³æœ¬ä¸­çš„å”ä½œè¡çªï¼ŒåŒ…å«åŒæ™‚ç·¨è¼¯ã€æ¬Šé™è¡çªç­‰ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é è¡çªæé†’
        **ç”¨é€”**: ç¢ºä¿å”ä½œæ•¸æ“šä¸€è‡´æ€§
      tags:
        - "å”ä½œè¡çª"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: checkType
          in: query
          description: "è¡çªæª¢æ¸¬é¡å‹"
          schema:
            type: string
            enum: [data, permission, concurrent]
            default: data
      responses:
        '200':
          description: "è¡çªæª¢æ¸¬å®Œæˆ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      hasConflicts:
                        type: boolean
                        example: false
                      conflictCount:
                        type: integer
                        example: 0
                      conflicts:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "conflict-uuid-001"
                            type:
                              type: string
                              enum: [data_conflict, permission_conflict, concurrent_edit]
                              example: "data_conflict"
                            description:
                              type: string
                              example: "äº¤æ˜“è¨˜éŒ„å­˜åœ¨ä¸ä¸€è‡´"
                            severity:
                              type: string
                              enum: [low, medium, high, critical]
                              example: "medium"
                            affectedUsers:
                              type: array
                              items:
                                type: string
                              example: ["user-uuid-12345", "user-uuid-67890"]
                            createdAt:
                              type: string
                              format: date-time
                              example: "2025-01-27T12:30:00Z"
                      lastCheckAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™æª¢æ¸¬è¡çª"

  /ledgers/{id}/resolve-conflict:
    post:
      summary: "è§£æ±ºå”ä½œè¡çª"
      description: |
        è§£æ±ºæŒ‡å®šçš„å”ä½œè¡çªï¼Œæä¾›å¤šç¨®è§£æ±ºæ–¹æ¡ˆã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é è¡çªè§£æ±º
        **ç”¨é€”**: æ¢å¾©æ•¸æ“šä¸€è‡´æ€§ï¼Œç¶­è­·å”ä½œç©©å®š
      tags:
        - "å”ä½œè¡çª"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                conflictId:
                  type: string
                  example: "conflict-uuid-001"
                  description: "è¡çª ID"
                resolution:
                  type: string
                  enum: [accept_local, accept_remote, merge, manual]
                  example: "merge"
                  description: "è§£æ±ºæ–¹æ¡ˆ"
                mergeStrategy:
                  type: string
                  enum: [latest_wins, user_priority, manual_merge]
                  example: "latest_wins"
                  description: "åˆä½µç­–ç•¥ï¼ˆç•¶ resolution ç‚º merge æ™‚ï¼‰"
                manualData:
                  type: object
                  description: "æ‰‹å‹•è§£æ±ºæ•¸æ“šï¼ˆç•¶ resolution ç‚º manual æ™‚ï¼‰"
              required:
                - conflictId
                - resolution
      responses:
        '200':
          description: "è¡çªè§£æ±ºæˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      conflictId:
                        type: string
                        example: "conflict-uuid-001"
                      resolution:
                        type: string
                        example: "merge"
                      message:
                        type: string
                        example: "è¡çªå·²æˆåŠŸè§£æ±º"
                      affectedRecords:
                        type: integer
                        example: 3
                      resolvedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:15:00Z"
                      resolvedBy:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "user-uuid-12345"
                          name:
                            type: string
                            example: "å¼µå°æ˜"
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™è§£æ±ºè¡çª"

  /ledgers/{id}/audit-log:
    get:
      summary: "å–å¾—æ“ä½œå¯©è¨ˆæ—¥èªŒ"
      description: |
        å–å¾—å¸³æœ¬çš„è©³ç´°æ“ä½œå¯©è¨ˆæ—¥èªŒï¼Œç”¨æ–¼è¿½è¹¤èˆ‡åˆè¦ã€‚
        
        **å°æ‡‰ç•«é¢**: Expert Mode å¸³æœ¬ç®¡ç†é€²éšåŠŸèƒ½
        **ç”¨é€”**: æ“ä½œè¿½è¹¤ã€å•é¡Œæ’æŸ¥ã€åˆè¦å¯©è¨ˆ
      tags:
        - "å¯©è¨ˆæ—¥èªŒ"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: startDate
          in: query
          description: "é–‹å§‹æ—¥æœŸ"
          schema:
            type: string
            format: date
            example: "2025-01-01"
        - name: endDate
          in: query
          description: "çµæŸæ—¥æœŸ"
          schema:
            type: string
            format: date
            example: "2025-01-31"
        - name: userId
          in: query
          description: "æ“ä½œç”¨æˆ¶ ID ç¯©é¸"
          schema:
            type: string
            example: "user-uuid-12345"
        - name: action
          in: query
          description: "æ“ä½œé¡å‹ç¯©é¸"
          schema:
            type: string
            enum: [create, update, delete, invite, join, leave]
        - name: page
          in: query
          description: "é ç¢¼"
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: "æ¯é ç­†æ•¸"
          schema:
            type: integer
            default: 50
            maximum: 200
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å¯©è¨ˆæ—¥èªŒ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      logs:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "log-uuid-001"
                            timestamp:
                              type: string
                              format: date-time
                              example: "2025-01-27T12:30:00Z"
                            userId:
                              type: string
                              example: "user-uuid-12345"
                            userName:
                              type: string
                              example: "å¼µå°æ˜"
                            action:
                              type: string
                              enum: [create, update, delete, invite, join, leave, permission_change]
                              example: "update"
                            resource:
                              type: string
                              example: "ledger_settings"
                            description:
                              type: string
                              example: "æ›´æ–°å¸³æœ¬é¡è‰²è¨­å®š"
                            details:
                              type: object
                              example: {
                                "field": "color",
                                "oldValue": "#4CAF50",
                                "newValue": "#2196F3"
                              }
                            ipAddress:
                              type: string
                              example: "192.168.1.100"
                            userAgent:
                              type: string
                              example: "Mozilla/5.0..."
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          totalPages:
                            type: integer
                            example: 5
                          totalRecords:
                            type: integer
                            example: 234
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™æŸ¥çœ‹å¯©è¨ˆæ—¥èªŒ"

  /ledgers/types:
    get:
      summary: "å–å¾—å¸³æœ¬é¡å‹"
      description: |
        å–å¾—å¯ç”¨çš„å¸³æœ¬é¡å‹åˆ—è¡¨ï¼Œç”¨æ–¼å»ºç«‹å¸³æœ¬æ™‚çš„é¡å‹é¸æ“‡ã€‚
        
        **å°æ‡‰ç•«é¢**: S-302 å»ºç«‹å¸³æœ¬é 
        **å››æ¨¡å¼å·®ç•°**: å¯é¸æ“‡çš„å¸³æœ¬é¡å‹èˆ‡èªªæ˜è©³ç´°ç¨‹åº¦ä¸åŒ
      tags:
        - "å¸³æœ¬æŸ¥è©¢"
      parameters:
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å¸³æœ¬é¡å‹åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      types:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "personal"
                            name:
                              type: string
                              example: "å€‹äººå¸³æœ¬"
                            description:
                              type: string
                              example: "é©åˆå€‹äººæ—¥å¸¸è¨˜å¸³ä½¿ç”¨"
                            icon:
                              type: string
                              example: "ğŸ‘¤"
                            isDefault:
                              type: boolean
                              example: true
                              description: "æ˜¯å¦ç‚ºé è¨­é¡å‹"
                            
                            # Expert Mode: è©³ç´°è³‡è¨Š
                            features:
                              type: array
                              items:
                                type: string
                              example: ["åŸºæœ¬è¨˜å¸³", "å ±è¡¨åˆ†æ", "é ç®—ç®¡ç†"]
                              description: "æ”¯æ´åŠŸèƒ½åˆ—è¡¨"
                            limitations:
                              type: object
                              properties:
                                maxTransactions:
                                  type: integer
                                  example: -1
                                  description: "æœ€å¤§äº¤æ˜“æ•¸é™åˆ¶ï¼ˆ-1è¡¨ç¤ºç„¡é™åˆ¶ï¼‰"
                                maxCollaborators:
                                  type: integer
                                  example: 0
                                  description: "æœ€å¤§å”ä½œè€…æ•¸é‡"
                            
                            # Cultivation Mode: ç›®æ¨™å°å‘èªªæ˜
                            suitableFor:
                              type: array
                              items:
                                type: string
                              example: ["åˆå­¸è€…", "å€‹äººä½¿ç”¨", "ç°¡å–®è¨˜å¸³"]
                              description: "é©åˆå°è±¡"
                            
                            # é€²éšè¨­å®šé¸é …
                            configOptions:
                              type: object
                              properties:
                                allowPublic:
                                  type: boolean
                                  example: false
                                  description: "æ˜¯å¦å…è¨±å…¬é–‹"
                                allowCollaboration:
                                  type: boolean
                                  example: false
                                  description: "æ˜¯å¦æ”¯æ´å”ä½œ"
                                allowExport:
                                  type: boolean
                                  example: true
                                  description: "æ˜¯å¦æ”¯æ´åŒ¯å‡º"
                      
                      # ä¸åŒæ¨¡å¼çš„æ¨è–¦
                      recommendations:
                        type: object
                        properties:
                          Expert:
                            type: string
                            example: "collaboration"
                            description: "å°ˆå®¶æ¨¡å¼æ¨è–¦é¡å‹"
                          Inertial:
                            type: string
                            example: "personal"
                            description: "æ…£æ€§æ¨¡å¼æ¨è–¦é¡å‹"
                          Cultivation:
                            type: string
                            example: "personal"
                            description: "é¤Šæˆæ¨¡å¼æ¨è–¦é¡å‹"
                          Guiding:
                            type: string
                            example: "personal"
                            description: "å¼•å°æ¨¡å¼æ¨è–¦é¡å‹"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Firebase Auth JWT Token"

  responses:
    UnauthorizedError:
      description: "æœªæˆæ¬Šå­˜å–"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "UNAUTHORIZED"
                  message:
                    type: string
                    example: "Token ç„¡æ•ˆæˆ–å·²éæœŸ"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

    ValidationError:
      description: "è«‹æ±‚åƒæ•¸é©—è­‰å¤±æ•—"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "VALIDATION_ERROR"
                  message:
                    type: string
                    example: "è«‹æ±‚åƒæ•¸ä¸æ­£ç¢º"
                  field:
                    type: string
                    example: "name"
                  details:
                    type: string
                    example: "å¸³æœ¬åç¨±ä¸èƒ½ç‚ºç©º"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

    NotFoundError:
      description: "è³‡æºä¸å­˜åœ¨"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "RESOURCE_NOT_FOUND"
                  message:
                    type: string
                    example: "å¸³æœ¬ä¸å­˜åœ¨"
                  resourceType:
                    type: string
                    example: "ledger"
                  resourceId:
                    type: string
                    example: "ledger-uuid-001"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

tags:
  - name: "å¸³æœ¬æŸ¥è©¢"
    description: "å¸³æœ¬åˆ—è¡¨æŸ¥è©¢èˆ‡è©³ç´°è³‡è¨Šå–å¾—"
  - name: "å¸³æœ¬ç®¡ç†"
    description: "å¸³æœ¬çš„ CRUD æ“ä½œèˆ‡è¨­å®šç®¡ç†"
  - name: "å”ä½œç®¡ç†"
    description: "å”ä½œå¸³æœ¬çš„å”ä½œè€…èˆ‡æ¬Šé™ç®¡ç†"
  - name: "æ¬Šé™ç®¡ç†"
    description: "å¸³æœ¬æ¬Šé™ç‹€æ…‹æŸ¥è©¢èˆ‡æ§åˆ¶"
  - name: "å”ä½œè¡çª"
    description: "å”ä½œè¡çªæª¢æ¸¬èˆ‡è§£æ±ºæ©Ÿåˆ¶"
  - name: "å¯©è¨ˆæ—¥èªŒ"
    description: "æ“ä½œå¯©è¨ˆæ—¥èªŒæŸ¥è©¢èˆ‡è¿½è¹¤"
