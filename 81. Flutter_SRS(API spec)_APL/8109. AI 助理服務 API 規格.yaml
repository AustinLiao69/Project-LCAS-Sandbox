openapi: 3.0.3
info:
  title: LCAS 2.0 - AI 助理服務 API 規格
  description: |
    **LCAS 2.0 AI 助理服務 API 規格**

    負責智慧記帳建議、自動分類、支出分析與個人化 AI 助理功能的完整 API 規格。
    提供基於機器學習的智慧功能，增強用戶記帳體驗與決策支援，支援四模式差異化體驗。

    **服務範圍**:
    - 智慧記帳建議（自動分類、金額預測、描述建議）
    - 支出行為分析（消費模式、異常檢測、趨勢預測）
    - 個人化建議（預算優化、理財建議、目標設定）
    - 自然語言處理（記帳對話、語音轉文字、語意理解）

    **四模式差異化策略**:
    - **Expert**: 進階 AI 分析、詳細洞察報告、自訂 AI 模型
    - **Inertial**: 標準 AI 建議、基本自動分類、固定建議
    - **Cultivation**: 習慣養成 AI、目標導向建議、激勵式 AI
    - **Guiding**: 簡化 AI 建議、智慧預設、溫和引導

    **更新記錄**:
    - v1.1.0 (2025-01-28): 補充缺失API端點，統一路徑參數命名規範，完善四模式支援

  version: 1.1.0
  contact:
    name: LCAS 開發團隊
    email: dev@lcas.com.tw

servers:
  - url: https://api.lcas.com.tw/v1
    description: 正式環境
  - url: https://staging-api.lcas.com.tw/v1
    description: 測試環境

security:
  - bearerAuth: []

paths:
  /ai/suggestions/transactions:
    post:
      tags:
        - Smart Suggestions
      summary: 記帳建議
      description: |
        根據用戶輸入或上下文提供智慧記帳建議。
        四模式差異：
        - Expert: 詳細建議分析、多重選項、準確度評分
        - Inertial: 標準建議清單、基本分類、簡化選擇
        - Cultivation: 習慣導向建議、目標關聯、激勵元素
        - Guiding: 最佳建議、智慧預設、一鍵採用
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionSuggestionRequest'
      responses:
        '200':
          description: 成功取得記帳建議
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionSuggestionResponse'

  /ai/categorize:
    post:
      tags:
        - Smart Suggestions
      summary: 自動分類
      description: |
        自動識別並分類交易記錄。
        四模式差異：
        - Expert: 多級分類、自訂規則、分類信心度
        - Inertial: 標準分類、預設規則、基本準確度
        - Cultivation: 學習導向分類、習慣建立、進度追蹤
        - Guiding: 簡化分類、智慧預設、自動採用
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CategorizationRequest'
      responses:
        '200':
          description: 成功完成自動分類
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CategorizationResponse'

  /ai/analysis/spending:
    post:
      tags:
        - Spending Analysis
      summary: 支出分析
      description: |
        分析用戶支出模式與行為。
        四模式差異：
        - Expert: 深度分析報告、統計模型、預測趨勢
        - Inertial: 標準分析、基本圖表、簡化洞察
        - Cultivation: 習慣分析、目標進度、改善建議
        - Guiding: 關鍵洞察、簡化報告、行動建議
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SpendingAnalysisRequest'
      responses:
        '200':
          description: 成功完成支出分析
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SpendingAnalysisResponse'

  /ai/recommendations/budget:
    get:
      tags:
        - Personal Recommendations
      summary: 預算建議
      description: |
        提供個人化預算設定建議。
        四模式差異：
        - Expert: 詳細預算分析、複雜策略、投資建議
        - Inertial: 標準預算建議、基本分配、固定比例
        - Cultivation: 目標導向預算、習慣養成、階段性建議
        - Guiding: 簡化預算、智慧預設、一鍵設定
      parameters:
        - name: analysisType
          in: query
          description: 分析類型
          schema:
            type: string
            enum: [monthly, quarterly, yearly, custom]
            default: monthly
        - name: includeGoals
          in: query
          description: 是否包含目標分析
          schema:
            type: boolean
            default: true
      responses:
        '200':
          description: 成功取得預算建議
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BudgetRecommendationResponse'

  /ai/chat:
    post:
      tags:
        - Natural Language
      summary: AI 對話
      description: |
        與 AI 助理進行自然語言對話。
        四模式差異：
        - Expert: 專業對話、技術分析、詳細解釋
        - Inertial: 標準對話、基本問答、實用回應
        - Cultivation: 鼓勵對話、習慣指導、目標討論
        - Guiding: 簡化對話、溫和引導、基礎協助
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: 成功取得 AI 回應
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'

  /ai/voice/transcribe:
    post:
      tags:
        - Natural Language
      summary: 語音轉文字
      description: |
        將語音記帳轉換為文字與結構化資料。
        四模式差異：
        - Expert: 高精度轉換、多語言支援、詳細標記
        - Inertial: 標準轉換、基本準確度、中文支援
        - Cultivation: 學習導向轉換、習慣建立、進度回饋
        - Guiding: 簡化轉換、智慧校正、自動確認
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                audio:
                  type: string
                  format: binary
                  description: 音檔
                language:
                  type: string
                  enum: [zh-TW, en-US, auto]
                  default: zh-TW
                  description: 語言設定
              required:
                - audio
      responses:
        '200':
          description: 語音轉換成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TranscriptionResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    TransactionSuggestionRequest:
      type: object
      required:
        - context
      properties:
        context:
          type: object
          properties:
            description:
              type: string
              description: 交易描述
            amount:
              type: number
              description: 金額
            location:
              type: string
              description: 地點
            time:
              type: string
              format: date-time
              description: 時間
        options:
          type: object
          properties:
            maxSuggestions:
              type: integer
              minimum: 1
              maximum: 10
              default: 5
            includeConfidence:
              type: boolean
              default: true
            userMode:
              type: string
              enum: [Expert, Inertial, Cultivation, Guiding]

    TransactionSuggestionResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            suggestions:
              type: array
              items:
                $ref: '#/components/schemas/TransactionSuggestion'
            metadata:
              type: object
              properties:
                processingTime:
                  type: number
                modelVersion:
                  type: string
                confidence:
                  type: number

    TransactionSuggestion:
      type: object
      properties:
        suggestionId:
          type: string
          format: uuid
        type:
          type: string
          enum: [category, amount, description, account]
        value:
          type: string
        confidence:
          type: number
          minimum: 0
          maximum: 1
        reasoning:
          type: string
          description: 建議理由
        metadata:
          type: object
          properties:
            categoryId:
              type: string
              format: uuid
            categoryName:
              type: string
            accountId:
              type: string
              format: uuid
            tags:
              type: array
              items:
                type: string

    CategorizationRequest:
      type: object
      required:
        - transactions
      properties:
        transactions:
          type: array
          items:
            type: object
            properties:
              transactionId:
                type: string
                format: uuid
              description:
                type: string
              amount:
                type: number
              vendor:
                type: string
              location:
                type: string
        options:
          type: object
          properties:
            autoApply:
              type: boolean
              default: false
            includeAlternatives:
              type: boolean
              default: true

    CategorizationResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            results:
              type: array
              items:
                $ref: '#/components/schemas/CategorizationResult'
            summary:
              type: object
              properties:
                totalProcessed:
                  type: integer
                successfullyClassified:
                  type: integer
                averageConfidence:
                  type: number

    CategorizationResult:
      type: object
      properties:
        transactionId:
          type: string
          format: uuid
        suggestedCategory:
          type: object
          properties:
            categoryId:
              type: string
              format: uuid
            categoryName:
              type: string
            confidence:
              type: number
        alternatives:
          type: array
          items:
            type: object
            properties:
              categoryId:
                type: string
                format: uuid
              categoryName:
                type: string
              confidence:
                type: number
        applied:
          type: boolean
          description: 是否已自動套用

    SpendingAnalysisRequest:
      type: object
      required:
        - dateRange
      properties:
        dateRange:
          type: object
          properties:
            startDate:
              type: string
              format: date
            endDate:
              type: string
              format: date
        filters:
          type: object
          properties:
            categoryIds:
              type: array
              items:
                type: string
                format: uuid
            accountIds:
              type: array
              items:
                type: string
                format: uuid
            minAmount:
              type: number
            maxAmount:
              type: number
        analysisTypes:
          type: array
          items:
            type: string
            enum: [patterns, anomalies, trends, forecasting, recommendations]
          default: [patterns, trends]

    SpendingAnalysisResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            analysis:
              type: object
              properties:
                patterns:
                  $ref: '#/components/schemas/SpendingPatterns'
                anomalies:
                  $ref: '#/components/schemas/SpendingAnomalies'
                trends:
                  $ref: '#/components/schemas/SpendingTrends'
                forecasting:
                  $ref: '#/components/schemas/SpendingForecast'
                recommendations:
                  type: array
                  items:
                    $ref: '#/components/schemas/AIRecommendation'
            metadata:
              type: object
              properties:
                analysisDate:
                  type: string
                  format: date-time
                dataPoints:
                  type: integer
                confidence:
                  type: number

    SpendingPatterns:
      type: object
      properties:
        weeklyPatterns:
          type: object
          properties:
            highestSpendingDay:
              type: string
            lowestSpendingDay:
              type: string
            averageDailySpending:
              type: number
        monthlyPatterns:
          type: object
          properties:
            peakSpendingPeriod:
              type: string
            spendingDistribution:
              type: array
              items:
                type: object
        categoryPatterns:
          type: array
          items:
            type: object
            properties:
              categoryId:
                type: string
                format: uuid
              categoryName:
                type: string
              percentage:
                type: number
              trend:
                type: string
                enum: [increasing, decreasing, stable]

    SpendingAnomalies:
      type: object
      properties:
        unusualTransactions:
          type: array
          items:
            type: object
            properties:
              transactionId:
                type: string
                format: uuid
              reason:
                type: string
              severity:
                type: string
                enum: [low, medium, high]
        categoryAnomalies:
          type: array
          items:
            type: object
            properties:
              categoryId:
                type: string
                format: uuid
              categoryName:
                type: string
              anomalyType:
                type: string
              description:
                type: string

    SpendingTrends:
      type: object
      properties:
        overallTrend:
          type: string
          enum: [increasing, decreasing, stable, volatile]
        monthlyGrowth:
          type: number
        categoryTrends:
          type: array
          items:
            type: object
            properties:
              categoryId:
                type: string
                format: uuid
              categoryName:
                type: string
              trendDirection:
                type: string
              changePercentage:
                type: number

    SpendingForecast:
      type: object
      properties:
        nextMonth:
          type: object
          properties:
            predictedTotal:
              type: number
            confidence:
              type: number
            byCategory:
              type: array
              items:
                type: object
        nextQuarter:
          type: object
          properties:
            predictedTotal:
              type: number
            confidence:
              type: number
        insights:
          type: array
          items:
            type: string

    BudgetRecommendationResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            recommendations:
              type: array
              items:
                $ref: '#/components/schemas/BudgetRecommendation'
            currentAnalysis:
              type: object
              properties:
                totalIncome:
                  type: number
                totalExpenses:
                  type: number
                savingsRate:
                  type: number
                budgetHealth:
                  type: string
                  enum: [excellent, good, fair, poor]
            optimizations:
              type: array
              items:
                type: object
                properties:
                  category:
                    type: string
                  currentAmount:
                    type: number
                  recommendedAmount:
                    type: number
                  potentialSavings:
                    type: number
                  reasoning:
                    type: string

    BudgetRecommendation:
      type: object
      properties:
        recommendationId:
          type: string
          format: uuid
        type:
          type: string
          enum: [budget_allocation, spending_limit, saving_goal, category_adjustment]
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [high, medium, low]
        expectedImpact:
          type: object
          properties:
            monthlySavings:
              type: number
            improvementScore:
              type: number
        actionItems:
          type: array
          items:
            type: string
        targetCategory:
          type: object
          nullable: true
          properties:
            categoryId:
              type: string
              format: uuid
            categoryName:
              type: string

    ChatRequest:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          maxLength: 1000
          description: 用戶訊息
        context:
          type: object
          properties:
            conversationId:
              type: string
              format: uuid
            previousMessages:
              type: array
              items:
                type: object
                properties:
                  role:
                    type: string
                    enum: [user, assistant]
                  content:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
        intent:
          type: string
          enum: [general, transaction_help, budget_advice, analysis_request]
          description: 對話意圖

    ChatResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            response:
              type: string
              description: AI 回應
            conversationId:
              type: string
              format: uuid
            intent:
              type: string
              description: 識別的意圖
            confidence:
              type: number
              description: 回應信心度
            actions:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                    enum: [create_transaction, set_budget, view_report]
                  parameters:
                    type: object
                  description:
                    type: string
            followUpSuggestions:
              type: array
              items:
                type: string
              description: 後續問題建議

    TranscriptionResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            transcription:
              type: string
              description: 轉換的文字
            confidence:
              type: number
              description: 轉換信心度
            language:
              type: string
              description: 識別的語言
            structuredData:
              type: object
              nullable: true
              properties:
                amount:
                  type: number
                description:
                  type: string
                category:
                  type: string
                type:
                  type: string
                  enum: [income, expense]
            alternatives:
              type: array
              items:
                type: object
                properties:
                  text:
                    type: string
                  confidence:
                    type: number

    AIRecommendation:
      type: object
      properties:
        recommendationId:
          type: string
          format: uuid
        type:
          type: string
          enum: [budget_adjustment, spending_pattern, saving_opportunity, category_optimization]
        title:
          type: string
        description:
          type: string
        priority:
          type: string
          enum: [high, medium, low]
        impact:
          type: object
          properties:
            financial:
              type: number
              description: 預期財務影響
            behavioral:
              type: string
              description: 行為改變描述
        actionRequired:
          type: boolean
          description: 是否需要用戶行動
        deadline:
          type: string
          format: date
          nullable: true
          description: 建議執行期限

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            timestamp:
              type: string
              format: date-time
            requestId:
              type: string
              format: uuid

tags:
  - name: Smart Suggestions
    description: 智慧建議相關 API
  - name: Spending Analysis
    description: 支出分析相關 API
  - name: Personal Recommendations
    description: 個人化建議相關 API
  - name: Natural Language
    description: 自然語言處理相關 API