openapi: 3.0.3
info:
  title: LCAS 2.0 - 激勵系統服務 API 規格
  description: |
    **LCAS 2.0 激勵系統服務 API 規格**

    負責遊戲化激勵機制、成就系統、挑戰任務與排行榜功能的完整 API 規格。
    提供個人化激勵體驗，增強用戶記帳動機與持續使用意願，特別針對 Cultivation 模式優化。

    **服務範圍**:
    - 成就系統管理（成就解鎖、進度追蹤、獎勵發放）
    - 挑戰任務系統（日常挑戰、週期性任務、個人化目標）
    - 積分與等級系統（經驗值累積、等級升級、排行榜）
    - 獎勵與徽章系統（虛擬獎勵、實體優惠、分享機制）

    **四模式差異化策略**:
    - **Expert**: 詳細統計分析、進階成就、複雜挑戰任務
    - **Inertial**: 簡化激勵顯示、基本成就、標準任務
    - **Cultivation**: 完整激勵體驗、豐富成就系統、多樣化挑戰
    - **Guiding**: 最小化激勵、簡單成就、引導式任務

  version: 1.1.0
  contact:
    name: LCAS 開發團隊
    email: dev@lcas.com.tw

servers:
  - url: https://api.lcas.com.tw/v1
    description: 正式環境
  - url: https://staging-api.lcas.com.tw/v1
    description: 測試環境

security:
  - bearerAuth: []

paths:
  /gamification/achievements:
    get:
      tags:
        - Achievements
      summary: 取得成就系統
      description: |
        取得用戶的成就狀態與進度。
        四模式差異：
        - Expert: 完整成就統計、詳細分析、進階成就
        - Inertial: 基本成就顯示、簡化統計
        - Cultivation: 豐富成就體驗、進度可視化、激勵元素
        - Guiding: 簡化成就展示、重點提示
      parameters:
        - name: category
          in: query
          description: 成就分類篩選
          schema:
            type: string
            enum: [recording, budgeting, social, special]
        - name: status
          in: query
          description: 成就狀態篩選
          schema:
            type: string
            enum: [unlocked, locked, in_progress]
        - name: page
          in: query
          description: 頁碼
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          description: 每頁筆數
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: 成功取得成就資訊
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AchievementsResponse'

  /gamification/challenges:
    get:
      tags:
        - Challenges
      summary: 取得挑戰列表
      description: |
        取得可用的挑戰任務列表。
        四模式差異：
        - Expert: 複雜挑戰任務、詳細條件、進階獎勵
        - Inertial: 標準挑戰、基本條件、固定獎勵
        - Cultivation: 個人化挑戰、豐富獎勵、激勵設計
        - Guiding: 簡化挑戰、清晰指引、基本獎勵
      parameters:
        - name: type
          in: query
          description: 挑戰類型篩選
          schema:
            type: string
            enum: [daily, weekly, monthly, special]
        - name: status
          in: query
          description: 挑戰狀態篩選
          schema:
            type: string
            enum: [available, active, completed, expired]
        - name: difficulty
          in: query
          description: 難度等級篩選
          schema:
            type: string
            enum: [easy, normal, hard, expert]
      responses:
        '200':
          description: 成功取得挑戰列表
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengesResponse'

    post:
      tags:
        - Challenges
      summary: 加入挑戰
      description: 參加指定的挑戰任務
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinChallengeRequest'
      responses:
        '201':
          description: 成功加入挑戰
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengeJoinResponse'

  /gamification/challenges/{challengeId}/progress:
    get:
      tags:
        - Challenges
      summary: 查詢挑戰進度
      description: 查詢指定挑戰的進度狀況
      parameters:
        - name: challengeId
          in: path
          required: true
          description: 挑戰ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: 成功取得挑戰進度
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChallengeProgressResponse'

  /gamification/claim-reward:
    post:
      tags:
        - Rewards
      summary: 領取獎勵
      description: 領取已達成的成就或挑戰獎勵
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaimRewardRequest'
      responses:
        '200':
          description: 獎勵領取成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClaimRewardResponse'

  /gamification/leaderboard:
    get:
      tags:
        - gamification
      summary: 取得排行榜
      description: 取得積分排行榜和成就排名
      operationId: getLeaderboard
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          required: false
          schema:
            type: string
            enum: [points, achievements, streak]
            default: points
          description: 排行榜類型
          example: "points"
        - name: period
          in: query
          required: false
          schema:
            type: string
            enum: [daily, weekly, monthly, all_time]
            default: monthly
          description: 時間週期
          example: "monthly"
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: 返回數量限制
          example: 20
        - name: includeMyRank
          in: query
          required: false
          schema:
            type: boolean
            default: true
          description: 是否包含用戶自己的排名
          example: true
      responses:
        '200':
          description: 成功取得排行榜
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      type:
                        type: string
                        example: "points"
                      period:
                        type: string
                        example: "monthly"
                      rankings:
                        type: array
                        items:
                          type: object
                          properties:
                            rank:
                              type: integer
                              example: 1
                            userId:
                              type: string
                              example: "uuid"
                            displayName:
                              type: string
                              example: "記帳達人"
                            avatar:
                              type: string
                              nullable: true
                              example: "https://example.com/avatar.jpg"
                            score:
                              type: integer
                              description: 積分或成就數量
                              example: 1250
                            isCurrentUser:
                              type: boolean
                              example: false
                            badge:
                              type: string
                              nullable: true
                              description: 特殊徽章
                              example: "月度冠軍"
                      myRank:
                        type: object
                        nullable: true
                        properties:
                          rank:
                            type: integer
                            example: 15
                          score:
                            type: integer
                            example: 850
                          percentile:
                            type: number
                            format: float
                            description: 百分位數
                            example: 75.5
                      statistics:
                        type: object
                        properties:
                          totalParticipants:
                            type: integer
                            example: 1000
                          averageScore:
                            type: number
                            format: float
                            example: 650.5
                          topScore:
                            type: integer
                            example: 1250
                  metadata:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:00:00Z"
                      requestId:
                        type: string
                        example: "uuid"
                      userMode:
                        type: string
                        enum: [Expert, Inertial, Cultivation, Guiding]
                        example: "Cultivation"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gamification/progress:
    get:
      tags:
        - Progress
      summary: 個人進度總覽
      description: 取得用戶在激勵系統中的整體進度
      responses:
        '200':
          description: 成功取得進度資訊
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProgressResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AchievementsResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            currentLevel:
              type: integer
              example: 5
            totalPoints:
              type: integer
              example: 1250
            nextLevelPoints:
              type: integer
              example: 1500
            achievements:
              type: array
              items:
                $ref: '#/components/schemas/Achievement'
            recentUnlocks:
              type: array
              items:
                $ref: '#/components/schemas/Achievement'
            statistics:
              type: object
              properties:
                totalAchievements:
                  type: integer
                unlockedAchievements:
                  type: integer
                completionRate:
                  type: number

    Achievement:
      type: object
      properties:
        achievementId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        category:
          type: string
          enum: [recording, budgeting, social, special]
        icon:
          type: string
        rarity:
          type: string
          enum: [common, rare, epic, legendary]
        points:
          type: integer
        requirements:
          type: object
          properties:
            type:
              type: string
            target:
              type: integer
            current:
              type: integer
        status:
          type: string
          enum: [locked, in_progress, unlocked]
        unlockedAt:
          type: string
          format: date-time
          nullable: true
        progress:
          type: number
          minimum: 0
          maximum: 100

    ChallengesResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            dailyChallenges:
              type: array
              items:
                $ref: '#/components/schemas/Challenge'
            weeklyChallenges:
              type: array
              items:
                $ref: '#/components/schemas/Challenge'
            specialChallenges:
              type: array
              items:
                $ref: '#/components/schemas/Challenge'
            activeChallenges:
              type: array
              items:
                $ref: '#/components/schemas/Challenge'

    Challenge:
      type: object
      properties:
        challengeId:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [daily, weekly, monthly, special]
        difficulty:
          type: string
          enum: [easy, normal, hard, expert]
        requirements:
          type: object
          properties:
            type:
              type: string
            target:
              type: integer
            timeLimit:
              type: integer
              description: 時間限制（小時）
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/Reward'
        status:
          type: string
          enum: [available, active, completed, expired]
        progress:
          type: number
          minimum: 0
          maximum: 100
        startDate:
          type: string
          format: date-time
        endDate:
          type: string
          format: date-time
        participantCount:
          type: integer

    Reward:
      type: object
      properties:
        rewardId:
          type: string
          format: uuid
        type:
          type: string
          enum: [points, badge, item, coupon]
        name:
          type: string
        description:
          type: string
        value:
          type: integer
        icon:
          type: string
        rarity:
          type: string
          enum: [common, rare, epic, legendary]

    JoinChallengeRequest:
      type: object
      required:
        - challengeId
      properties:
        challengeId:
          type: string
          format: uuid

    ChallengeJoinResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            challengeId:
              type: string
              format: uuid
            status:
              type: string
              example: "active"
            joinedAt:
              type: string
              format: date-time
            expiresAt:
              type: string
              format: date-time

    ChallengeProgressResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            challengeId:
              type: string
              format: uuid
            title:
              type: string
            progress:
              type: number
              minimum: 0
              maximum: 100
            currentValue:
              type: integer
            targetValue:
              type: integer
            status:
              type: string
              enum: [active, completed, expired]
            timeRemaining:
              type: integer
              description: 剩餘時間（小時）
            milestones:
              type: array
              items:
                type: object
                properties:
                  threshold:
                    type: integer
                  reward:
                    $ref: '#/components/schemas/Reward'
                  achieved:
                    type: boolean

    ClaimRewardRequest:
      type: object
      required:
        - rewardId
        - source
      properties:
        rewardId:
          type: string
          format: uuid
        source:
          type: string
          enum: [achievement, challenge, daily_login, special_event]
        sourceId:
          type: string
          format: uuid

    ClaimRewardResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            reward:
              $ref: '#/components/schemas/Reward'
            claimedAt:
              type: string
              format: date-time
            newTotalPoints:
              type: integer
            levelUp:
              type: boolean
            newLevel:
              type: integer
              nullable: true

    LeaderboardResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            leaderboard:
              type: array
              items:
                $ref: '#/components/schemas/LeaderboardEntry'
            userRank:
              type: object
              properties:
                rank:
                  type: integer
                points:
                  type: integer
                isInTopList:
                  type: boolean
            statistics:
              type: object
              properties:
                totalParticipants:
                  type: integer
                averageScore:
                  type: number
                topScore:
                  type: integer

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
        userId:
          type: string
          format: uuid
        displayName:
          type: string
        avatar:
          type: string
        points:
          type: integer
        level:
          type: integer
        badges:
          type: array
          items:
            type: string

    ProgressResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
          properties:
            overview:
              type: object
              properties:
                currentLevel:
                  type: integer
                totalPoints:
                  type: integer
                streak:
                  type: integer
                  description: 連續記帳天數
                rank:
                  type: integer
            achievements:
              type: object
              properties:
                total:
                  type: integer
                unlocked:
                  type: integer
                inProgress:
                  type: integer
                completionRate:
                  type: number
            challenges:
              type: object
              properties:
                active:
                  type: integer
                completed:
                  type: integer
                successRate:
                  type: number
            recentActivity:
              type: array
              items:
                type: object
                properties:
                  type:
                    type: string
                    enum: [achievement_unlock, challenge_complete, level_up, reward_claim]
                  title:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
            timestamp:
              type: string
              format: date-time
            requestId:
              type: string
              format: uuid

tags:
  - name: Achievements
    description: 成就系統相關 API
  - name: Challenges
    description: 挑戰任務相關 API
  - name: Rewards
    description: 獎勵系統相關 API
  - name: Social
    description: 社交功能相關 API
  - name: Progress
    description: 進度追蹤相關 API
info:
  title: LCAS 2.0 - 激勵系統服務 API 規格
  version: 1.0.0
  description: |
    **LCAS 2.0 激勵系統服務 API 規格**

    負責遊戲化元素、成就系統、挑戰任務、積分獎勵與使用者激勵的完整 API 規格。
    透過遊戲化機制提升用戶記帳習慣養成與持續使用動機，支援四模式差異化體驗。

    **服務範圍**:
    - 成就系統（記帳里程碑、連續記帳、金額達成、習慣養成）
    - 挑戰任務（每日/週/月挑戰、自訂目標、團體挑戰）
    - 積分獎勵（記帳積分、成就積分、邀請獎勵、活躍度獎勵）
    - 等級系統（用戶等級、技能樹、專業認證）
    - 社交激勵（排行榜、好友競賽、團隊協作）
    -個人化激勵（習慣分析、動機提醒、進度追蹤）

    **四模式差異化策略**:
    - **Expert**: 專業成就系統、深度分析獎勵、高級認證
    - **Inertial**: 基本成就與積分、簡化激勵機制
    - **Cultivation**: 豐富習慣養成激勵、目標導向挑戰、社交競賽
    - **Guiding**: 簡化成就、基礎鼓勵、溫和提醒

  contact:
    name: LCAS 開發團隊
    email: dev@lcas.com.tw
  license:
    name: LCAS License
    url: https://lcas.com.tw/license

servers:
  - url: https://api.lcas.com.tw/v1
    description: 正式環境
  - url: https://staging-api.lcas.com.tw/v1
    description: 測試環境

security:
  - bearerAuth: []

paths:
  /gamification/achievements:
    get:
      tags:
        - 成就系統
      summary: 取得用戶成就列表
      description: |
        取得用戶的成就進度與已解鎖成就列表。
        四模式差異：
        - Expert: 專業成就、技術指標、深度分析成就
        - Inertial: 基本記帳成就、簡化進度顯示
        - Cultivation: 豐富習慣養成成就、目標達成獎勵
        - Guiding: 基礎鼓勵成就、溫和里程碑
      parameters:
        - name: status
          in: query
          description: 成就狀態篩選
          schema:
            type: string
            enum: [unlocked, locked, in_progress, all]
            default: all
        - name: category
          in: query
          description: 成就分類
          schema:
            type: string
            enum: [bookkeeping, saving, budgeting, analysis, collaboration, habit]
        - name: difficulty
          in: query
          description: 成就難度
          schema:
            type: string
            enum: [beginner, intermediate, advanced, expert]
      responses:
        '200':
          description: 成功取得成就列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/AchievementsList'



  /gamification/challenges:
    get:
      tags:
        - 挑戰任務
      summary: 取得挑戰任務列表
      description: |
        取得用戶可參與的挑戰任務與進度。
        四模式差異：
        - Expert: 複雜分析挑戰、專業目標設定
        - Inertial: 固定週期挑戰、簡化任務
        - Cultivation: 習慣養成挑戰、目標導向任務
        - Guiding: 基礎挑戰、溫和目標
      parameters:
        - name: type
          in: query
          description: 挑戰類型
          schema:
            type: string
            enum: [daily, weekly, monthly, custom, group]
        - name: status
          in: query
          description: 挑戰狀態
          schema:
            type: string
            enum: [active, completed, expired, available]
            default: active
      responses:
        '200':
          description: 成功取得挑戰列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ChallengesList'



  /gamification/challenges/{challengeId}/join:
    post:
      tags:
        - 挑戰任務
      summary: 參加挑戰
      description: |
        參加指定的挑戰任務，開始任務進度追蹤。
        支援個人挑戰與團體挑戰參與。
      parameters:
        - name: challengeId
          in: path
          required: true
          description: 挑戰 ID
          schema:
            type: string
      responses:
        '200':
          description: 成功參加挑戰
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/JoinChallengeResponse'



  /gamification/points:
    get:
      tags:
        - 積分系統
      summary: 取得用戶積分資訊
      description: |
        取得用戶當前積分、積分歷史與獲得來源。
        四模式差異：
        - Expert: 詳細積分分析、專業獎勵
        - Inertial: 基本積分顯示、簡化統計
        - Cultivation: 豐富積分來源、習慣獎勵
        - Guiding: 簡化積分、鼓勵性回饋
      parameters:
        - name: period
          in: query
          description: 查詢期間
          schema:
            type: string
            enum: [today, week, month, quarter, year, all]
            default: all
        - name: source
          in: query
          description: 積分來源篩選
          schema:
            type: string
            enum: [bookkeeping, achievement, challenge, referral, bonus]
      responses:
        '200':
          description: 成功取得積分資訊
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/PointsInfo'





  /gamification/leaderboard:
    get:
      tags:
        - 社交激勵
      summary: 排行榜
      description: |
        取得各種類型的排行榜資訊。
        四模式差異：
        - Expert: 專業分析排行、技術指標競賽
        - Inertial: 基本積分排行、簡化顯示
        - Cultivation: 習慣養成排行、目標達成競賽
        - Guiding: 友善排行、鼓勵性競賽
      parameters:
        - name: type
          in: query
          description: 排行榜類型
          schema:
            type: string
            enum: [points, achievements, streak, savings, consistency]
            default: points
        - name: scope
          in: query
          description: 排行範圍
          schema:
            type: string
            enum: [global, friends, ledger]
            default: global
        - name: period
          in: query
          description: 排行期間
          schema:
            type: string
            enum: [daily, weekly, monthly, quarterly, yearly, all_time]
            default: monthly
        - name: limit
          in: query
          description: 排行數量限制
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: 成功取得排行榜
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Leaderboard'





components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    AchievementsList:
      type: object
      properties:
        totalAchievements:
          type: integer
          description: 總成就數量
        unlockedCount:
          type: integer
          description: 已解鎖成就數量
        achievements:
          type: array
          items:
            $ref: '#/components/schemas/Achievement'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/AchievementCategory'
        recentUnlocks:
          type: array
          items:
            $ref: '#/components/schemas/RecentAchievement'

    Achievement:
      type: object
      properties:
        id:
          type: string
          description: 成就 ID
        name:
          type: string
          description: 成就名稱
        description:
          type: string
          description: 成就描述
        category:
          type: string
          enum: [bookkeeping, saving, budgeting, analysis, collaboration, habit]
          description: 成就分類
        difficulty:
          type: string
          enum: [beginner, intermediate, advanced, expert]
          description: 成就難度
        points:
          type: integer
          description: 獎勵積分
        icon:
          type: string
          description: 成就圖標 URL
        status:
          type: string
          enum: [unlocked, locked, in_progress]
          description: 成就狀態
        progress:
          $ref: '#/components/schemas/AchievementProgress'
        unlockedAt:
          type: string
          format: date-time
          description: 解鎖時間
        requirements:
          type: array
          items:
            $ref: '#/components/schemas/AchievementRequirement'
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/AchievementReward'

    AchievementProgress:
      type: object
      properties:
        current:
          type: integer
          description: 當前進度
        target:
          type: integer
          description: 目標進度
        percentage:
          type: number
          minimum: 0
          maximum: 100
          description: 完成百分比

    AchievementRequirement:
      type: object
      properties:
        type:
          type: string
          description: 要求類型
        description:
          type: string
          description: 要求描述
        value:
          type: integer
          description: 要求數值
        unit:
          type: string
          description: 數值單位

    AchievementReward:
      type: object
      properties:
        type:
          type: string
          enum: [points, badge, feature, discount]
          description: 獎勵類型
        value:
          type: integer
          description: 獎勵數值
        description:
          type: string
          description: 獎勵描述

    AchievementCategory:
      type: object
      properties:
        category:
          type: string
          description: 分類名稱
        totalCount:
          type: integer
          description: 該分類總成就數
        unlockedCount:
          type: integer
          description: 該分類已解鎖數
        progress:
          type: number
          description: 分類完成度

    RecentAchievement:
      type: object
      properties:
        achievementId:
          type: string
          description: 成就 ID
        name:
          type: string
          description: 成就名稱
        unlockedAt:
          type: string
          format: date-time
          description: 解鎖時間
        points:
          type: integer
          description: 獲得積分

    UnlockAchievementRequest:
      type: object
      required:
        - trigger
      properties:
        trigger:
          type: string
          enum: [auto, manual, system]
          description: 觸發方式
        context:
          type: object
          description: 解鎖上下文資訊
        validateRequirements:
          type: boolean
          default: true
          description: 是否驗證解鎖要求

    UnlockAchievementResponse:
      type: object
      properties:
        achievement:
          $ref: '#/components/schemas/Achievement'
        pointsEarned:
          type: integer
          description: 獲得積分
        newLevel:
          type: integer
          description: 新等級（如有升級）
        bonusRewards:
          type: array
          items:
            $ref: '#/components/schemas/BonusReward'
        celebrationMessage:
          type: string
          description: 慶祝訊息

    BonusReward:
      type: object
      properties:
        type:
          type: string
          description: 獎勵類型
        name:
          type: string
          description: 獎勵名稱
        value:
          type: string
          description: 獎勵內容

    ChallengesList:
      type: object
      properties:
        activeChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeDetails'
        availableChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeDetails'
        completedChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeDetails'
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeRecommendation'

    ChallengeDetails:
      type: object
      properties:
        id:
          type: string
          description: 挑戰 ID
        title:
          type: string
          description: 挑戰標題
        description:
          type: string
          description: 挑戰描述
        type:
          type: string
          enum: [daily, weekly, monthly, custom, group]
          description: 挑戰類型
        difficulty:
          type: string
          enum: [easy, normal, hard, expert]
          description: 挑戰難度
        category:
          type: string
          description: 挑戰分類
        goal:
          $ref: '#/components/schemas/ChallengeGoal'
        duration:
          $ref: '#/components/schemas/ChallengeDuration'
        participants:
          type: integer
          description: 參與人數
        maxParticipants:
          type: integer
          description: 最大參與人數
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeReward'
        status:
          type: string
          enum: [active, completed, expired, available, joined]
          description: 挑戰狀態
        progress:
          $ref: '#/components/schemas/ChallengeProgress'
        createdBy:
          type: string
          description: 建立者 ID
        createdAt:
          type: string
          format: date-time
          description: 建立時間

    ChallengeGoal:
      type: object
      properties:
        type:
          type: string
          enum: [count, amount, streak, completion]
          description: 目標類型
        target:
          type: number
          description: 目標數值
        unit:
          type: string
          description: 數值單位
        description:
          type: string
          description: 目標描述

    ChallengeDuration:
      type: object
      properties:
        startDate:
          type: string
          format: date-time
          description: 開始時間
        endDate:
          type: string
          format: date-time
          description: 結束時間
        durationDays:
          type: integer
          description: 持續天數

    ChallengeReward:
      type: object
      properties:
        type:
          type: string
          enum: [points, badge, achievement, feature]
          description: 獎勵類型
        value:
          type: integer
          description: 獎勵數值
        description:
          type: string
          description: 獎勵描述
        condition:
          type: string
          enum: [completion, ranking, participation]
          description: 獲得條件

    ChallengeProgress:
      type: object
      properties:
        current:
          type: number
          description: 當前進度
        target:
          type: number
          description: 目標進度
        percentage:
          type: number
          minimum: 0
          maximum: 100
          description: 完成百分比
        rank:
          type: integer
          description: 當前排名
        lastUpdate:
          type: string
          format: date-time
          description: 最後更新時間

    ChallengeRecommendation:
      type: object
      properties:
        challenge:
          $ref: '#/components/schemas/ChallengeDetails'
        reason:
          type: string
          description: 推薦原因
        priority:
          type: string
          enum: [high, medium, low]
          description: 推薦優先級

    CreateChallengeRequest:
      type: object
      required:
        - title
        - type
        - goal
        - duration
      properties:
        title:
          type: string
          description: 挑戰標題
          maxLength: 100
        description:
          type: string
          description: 挑戰描述
          maxLength: 500
        type:
          type: string
          enum: [custom, group]
          description: 挑戰類型
        category:
          type: string
          description: 挑戰分類
        goal:
          $ref: '#/components/schemas/ChallengeGoal'
        duration:
          $ref: '#/components/schemas/ChallengeDuration'
        isPublic:
          type: boolean
          default: false
          description: 是否公開
        maxParticipants:
          type: integer
          description: 最大參與人數
        invitedUsers:
          type: array
          items:
            type: string
          description: 邀請的用戶 ID 列表

    JoinChallengeResponse:
      type: object
      properties:
        challengeId:
          type: string
          description: 挑戰 ID
        joinedAt:
          type: string
          format: date-time
          description: 參加時間
        currentParticipants:
          type: integer
          description: 目前參與人數
        personalGoal:
          $ref: '#/components/schemas/ChallengeGoal'
        welcomeMessage:
          type: string
          description: 歡迎訊息

    UpdateProgressRequest:
      type: object
      required:
        - progressValue
      properties:
        progressValue:
          type: number
          description: 進度數值
        action:
          type: string
          description: 觸發動作
        context:
          type: object
          description: 上下文資訊
        timestamp:
          type: string
          format: date-time
          description: 進度時間

    PointsInfo:
      type: object
      properties:
        totalPoints:
          type: integer
          description: 總積分
        availablePoints:
          type: integer
          description: 可用積分
        lifetimeEarned:
          type: integer
          description: 累積獲得積分
        lifetimeSpent:
          type: integer
          description: 累積消費積分
        currentLevel:
          type: integer
          description: 當前等級
        pointsToNextLevel:
          type: integer
          description: 升級所需積分
        recentActivity:
          type: array
          items:
            $ref: '#/components/schemas/PointsActivity'
        breakdown:
          $ref: '#/components/schemas/PointsBreakdown'

    PointsActivity:
      type: object
      properties:
        id:
          type: string
          description: 活動 ID
        type:
          type: string
          enum: [earned, spent, bonus, penalty]
          description: 積分類型
        amount:
          type: integer
          description: 積分數量
        source:
          type: string
          description: 積分來源
        description:
          type: string
          description: 活動描述
        timestamp:
          type: string
          format: date-time
          description: 活動時間

    PointsBreakdown:
      type: object
      properties:
        bookkeeping:
          type: integer
          description: 記帳獲得積分
        achievements:
          type: integer
          description: 成就獲得積分
        challenges:
          type: integer
          description: 挑戰獲得積分
        referrals:
          type: integer
          description: 推薦獲得積分
        bonuses:
          type: integer
          description: 獎勵積分
        social:
          type: integer
          description: 社交獲得積分

    EarnPointsRequest:
      type: object
      required:
        - source
        - amount
      properties:
        source:
          type: string
          enum: [bookkeeping, achievement, challenge, referral, bonus, social]
          description: 積分來源
        amount:
          type: integer
          minimum: 1
          description: 積分數量
        description:
          type: string
          description: 獲得描述
        multiplier:
          type: number
          default: 1.0
          description: 積分倍數
        context:
          type: object
          description: 上下文資訊

    EarnPointsResponse:
      type: object
      properties:
        pointsEarned:
          type: integer
          description: 實際獲得積分
        totalPoints:
          type: integer
          description: 總積分
        levelUp:
          type: boolean
          description: 是否升級
        newLevel:
          type: integer
          description: 新等級
        bonusMultiplier:
          type: number
          description: 獎勵倍數
        message:
          type: string
          description: 獲得訊息

    LevelInfo:
      type: object
      properties:
        currentLevel:
          type: integer
          description: 當前等級
        currentExp:
          type: integer
          description: 當前經驗值
        expToNextLevel:
          type: integer
          description: 升級所需經驗值
        totalExp:
          type: integer
          description: 總經驗值
        levelProgress:
          type: number
          minimum: 0
          maximum: 100
          description: 等級進度百分比
        levelName:
          type: string
          description: 等級名稱
        levelDescription:
          type: string
          description: 等級描述
        perks:
          type: array
          items:
            $ref: '#/components/schemas/LevelPerk'
        nextLevelPerks:
          type: array
          items:
            $ref: '#/components/schemas/LevelPerk'
        skillTree:
          $ref: '#/components/schemas/SkillTree'

    LevelPerk:
      type: object
      properties:
        name:
          type: string
          description: 特權名稱
        description:
          type: string
          description: 特權描述
        type:
          type: string
          enum: [feature, discount, bonus, access]
          description: 特權類型
        value:
          type: string
          description: 特權內容

    SkillTree:
      type: object
      properties:
        categories:
          type: array
          items:
            $ref: '#/components/schemas/SkillCategory'
        unlockedSkills:
          type: integer
          description: 已解鎖技能數
        totalSkills:
          type: integer
          description: 總技能數

    SkillCategory:
      type: object
      properties:
        name:
          type: string
          description: 技能分類名稱
        skills:
          type: array
          items:
            $ref: '#/components/schemas/Skill'

    Skill:
      type: object
      properties:
        id:
          type: string
          description: 技能 ID
        name:
          type: string
          description: 技能名稱
        description:
          type: string
          description: 技能描述
        level:
          type: integer
          description: 技能等級
        maxLevel:
          type: integer
          description: 最大等級
        unlocked:
          type: boolean
          description: 是否已解鎖
        requiredLevel:
          type: integer
          description: 解鎖所需等級

    Leaderboard:
      type: object
      properties:
        type:
          type: string
          description: 排行榜類型
        scope:
          type: string
          description: 排行範圍
        period:
          type: string
          description: 排行期間
        userRank:
          type: integer
          description: 用戶排名
        userScore:
          type: number
          description: 用戶分數
        rankings:
          type: array
          items:
            $ref: '#/components/schemas/LeaderboardEntry'
        totalParticipants:
          type: integer
          description: 總參與人數
        lastUpdated:
          type: string
          format: date-time
          description: 最後更新時間

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
          description: 排名
        userId:
          type: string
          description: 用戶 ID
        username:
          type: string
          description: 用戶名稱
        avatar:
          type: string
          description: 頭像 URL
        score:
          type: number
          description: 分數
        level:
          type: integer
          description: 等級
        badge:
          type: string
          description: 徽章
        changeFromPrevious:
          type: integer
          description: 與前期排名變化

    StreakInfo:
      type: object
      properties:
        currentStreak:
          type: integer
          description: 當前連續天數
        longestStreak:
          type: integer
          description: 最長連續天數
        streakType:
          type: string
          description: 連續記錄類型
        lastActivity:
          type: string
          format: date
          description: 最後活動日期
        streakStart:
          type: string
          format: date
          description: 連續開始日期
        milestones:
          type: array
          items:
            $ref: '#/components/schemas/StreakMilestone'
        riskyDays:
          type: array
          items:
            type: string
            format: date
          description: 可能中斷的日期
        encouragement:
          type: string
          description: 鼓勵訊息

    StreakMilestone:
      type: object
      properties:
        days:
          type: integer
          description: 里程碑天數
        name:
          type: string
          description: 里程碑名稱
        achieved:
          type: boolean
          description: 是否已達成
        achievedAt:
          type: string
          format: date
          description: 達成日期
        reward:
          type: string
          description: 獎勵內容

    RewardsList:
      type: object
      properties:
        availableRewards:
          type: array
          items:
            $ref: '#/components/schemas/Reward'
        redeemedRewards:
          type: array
          items:
            $ref: '#/components/schemas/RedeemedReward'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/RewardCategory'
        userPoints:
          type: integer
          description: 用戶可用積分

    Reward:
      type: object
      properties:
        id:
          type: string
          description: 獎勵 ID
        name:
          type: string
          description: 獎勵名稱
        description:
          type: string
          description: 獎勵描述
        category:
          type: string
          description: 獎勵分類
        cost:
          type: integer
          description: 所需積分
        type:
          type: string
          enum: [premium_feature, customization, badge, tool, discount]
          description: 獎勵類型
        icon:
          type: string
          description: 獎勵圖標 URL
        availability:
          $ref: '#/components/schemas/RewardAvailability'
        requirements:
          type: array
          items:
            $ref: '#/components/schemas/RewardRequirement'

    RewardAvailability:
      type: object
      properties:
        available:
          type: boolean
          description: 是否可兌換
        stock:
          type: integer
          description: 剩餘數量
        startDate:
          type: string
          format: date-time
          description: 開始時間
        endDate:
          type: string
          format: date-time
          description: 結束時間

    RewardRequirement:
      type: object
      properties:
        type:
          type: string
          description: 要求類型
        description:
          type: string
          description: 要求描述
        met:
          type: boolean
          description: 是否滿足

    RedeemedReward:
      type: object
      properties:
        rewardId:
          type: string
          description: 獎勵 ID
        name:
          type: string
          description: 獎勵名稱
        redeemedAt:
          type: string
          format: date-time
          description: 兌換時間
        pointsSpent:
          type: integer
          description: 消費積分
        status:
          type: string
          enum: [active, expired, used]
          description: 獎勵狀態

    RewardCategory:
      type: object
      properties:
        name:
          type: string
          description: 分類名稱
        description:
          type: string
          description: 分類描述
        rewardCount:
          type: integer
          description: 獎勵數量

    RedeemRewardRequest:
      type: object
      required:
        - rewardId
      properties:
        rewardId:
          type: string
          description: 獎勵 ID
        quantity:
          type: integer
          default: 1
          description: 兌換數量

    RedeemRewardResponse:
      type: object
      properties:
        reward:
          $ref: '#/components/schemas/Reward'
        pointsSpent:
          type: integer
          description: 消費積分
        remainingPoints:
          type: integer
          description: 剩餘積分
        redemptionId:
          type: string
          description: 兌換記錄 ID
        activationInstructions:
          type: string
          description: 啟用說明
        message:
          type: string
          description: 兌換訊息

    Error:
      type: object
      properties:
        code:
          type: string
          description: 錯誤代碼
        message:
          type: string
          description: 錯誤訊息
        details:
          type: object
          description: 錯誤詳細資訊

  responses:
    BadRequest:
      description: 請求參數錯誤
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    Unauthorized:
      description: 未授權存取
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    Forbidden:
      description: 禁止存取
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    NotFound:
      description: 資源不存在
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    InternalServerError:
      description: 內部伺服器錯誤
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

tags:
  - name: 成就系統
    description: 用戶成就解鎖與進度管理
  - name: 挑戰任務
    description: 個人與團體挑戰任務
  - name: 積分系統
    description: 積分獲得與管理
  - name: 等級系統
    description: 用戶等級與技能樹
  - name: 社交激勵
    description: 排行榜與社交競賽
  - name: 習慣追蹤
    description: 連續記錄與習慣統計
  - name: 獎勵系統
    description: 積分兌換與獎勵管理