
openapi: 3.0.3
info:
  title: LCAS 2.0 - 激勵系統服務 API 規格
  version: 1.0.0
  description: |
    **LCAS 2.0 激勵系統服務 API 規格**
    
    負責遊戲化元素、成就系統、挑戰任務、積分獎勵與使用者激勵的完整 API 規格。
    透過遊戲化機制提升用戶記帳習慣養成與持續使用動機，支援四模式差異化體驗。
    
    **服務範圍**:
    - 成就系統（記帳里程碑、連續記帳、金額達成、習慣養成）
    - 挑戰任務（每日/週/月挑戰、自訂目標、團體挑戰）
    - 積分獎勵（記帳積分、成就積分、邀請獎勵、活躍度獎勵）
    - 等級系統（用戶等級、技能樹、專業認證）
    - 社交激勵（排行榜、好友競賽、團隊協作）
    - 個人化激勵（習慣分析、動機提醒、進度追蹤）
    
    **四模式差異化策略**:
    - **Expert**: 專業成就系統、深度分析獎勵、高級認證
    - **Inertial**: 基本成就與積分、簡化激勵機制
    - **Cultivation**: 豐富習慣養成激勵、目標導向挑戰、社交競賽
    - **Guiding**: 簡化成就、基礎鼓勵、溫和提醒

  contact:
    name: LCAS 開發團隊
    email: dev@lcas.com.tw
  license:
    name: LCAS License
    url: https://lcas.com.tw/license

servers:
  - url: https://api.lcas.com.tw/v1
    description: 正式環境
  - url: https://staging-api.lcas.com.tw/v1
    description: 測試環境

security:
  - bearerAuth: []

paths:
  /gamification/achievements:
    get:
      tags:
        - 成就系統
      summary: 取得用戶成就列表
      description: |
        取得用戶的成就進度與已解鎖成就列表。
        四模式差異：
        - Expert: 專業成就、技術指標、深度分析成就
        - Inertial: 基本記帳成就、簡化進度顯示
        - Cultivation: 豐富習慣養成成就、目標達成獎勵
        - Guiding: 基礎鼓勵成就、溫和里程碑
      parameters:
        - name: status
          in: query
          description: 成就狀態篩選
          schema:
            type: string
            enum: [unlocked, locked, in_progress, all]
            default: all
        - name: category
          in: query
          description: 成就分類
          schema:
            type: string
            enum: [bookkeeping, saving, budgeting, analysis, collaboration, habit]
        - name: difficulty
          in: query
          description: 成就難度
          schema:
            type: string
            enum: [beginner, intermediate, advanced, expert]
      responses:
        '200':
          description: 成功取得成就列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/AchievementsList'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gamification/challenges:
    get:
      tags:
        - 挑戰任務
      summary: 取得挑戰任務列表
      description: |
        取得用戶可參與的挑戰任務與進度。
        四模式差異：
        - Expert: 複雜分析挑戰、專業目標設定
        - Inertial: 固定週期挑戰、簡化任務
        - Cultivation: 習慣養成挑戰、目標導向任務
        - Guiding: 基礎挑戰、溫和目標
      parameters:
        - name: type
          in: query
          description: 挑戰類型
          schema:
            type: string
            enum: [daily, weekly, monthly, custom, group]
        - name: status
          in: query
          description: 挑戰狀態
          schema:
            type: string
            enum: [active, completed, expired, available]
            default: active
      responses:
        '200':
          description: 成功取得挑戰列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ChallengesList'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gamification/claim-reward:
    post:
      tags:
        - 獎勵系統
      summary: 領取獎勵
      description: |
        領取用戶已獲得的獎勵，包含成就獎勵、挑戰獎勵等。
        支援批次領取與單一獎勵領取。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaimRewardRequest'
      responses:
        '200':
          description: 成功領取獎勵
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ClaimRewardResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gamification/leaderboard:
    get:
      tags:
        - 社交激勵
      summary: 取得排行榜
      description: |
        取得各種類型的排行榜資訊。
        四模式差異：
        - Expert: 專業分析排行、技術指標競賽
        - Inertial: 基本積分排行、簡化顯示
        - Cultivation: 習慣養成排行、目標達成競賽
        - Guiding: 友善排行、鼓勵性競賽
      parameters:
        - name: type
          in: query
          description: 排行榜類型
          schema:
            type: string
            enum: [points, achievements, streak, savings, consistency]
            default: points
        - name: scope
          in: query
          description: 排行範圍
          schema:
            type: string
            enum: [global, friends, ledger]
            default: global
        - name: period
          in: query
          description: 排行期間
          schema:
            type: string
            enum: [daily, weekly, monthly, quarterly, yearly, all_time]
            default: monthly
        - name: limit
          in: query
          description: 排行數量限制
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: 成功取得排行榜
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Leaderboard'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gamification/join-challenge:
    post:
      tags:
        - 挑戰任務
      summary: 參加挑戰
      description: |
        參加指定的挑戰任務，開始任務進度追蹤。
        支援個人挑戰與團體挑戰參與。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinChallengeRequest'
      responses:
        '200':
          description: 成功參加挑戰
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/JoinChallengeResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /gamification/progress:
    get:
      tags:
        - 挑戰任務
      summary: 取得挑戰進度
      description: |
        查詢用戶參與挑戰的詳細進度資訊。
        包含個人進度、團隊進度、排名等資訊。
      parameters:
        - name: challengeId
          in: query
          description: 挑戰 ID（可選，不填則返回所有活躍挑戰進度）
          schema:
            type: string
        - name: type
          in: query
          description: 挑戰類型篩選
          schema:
            type: string
            enum: [daily, weekly, monthly, custom, group]
        - name: status
          in: query
          description: 挑戰狀態篩選
          schema:
            type: string
            enum: [active, completed, expired]
            default: active
      responses:
        '200':
          description: 成功取得挑戰進度
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/ChallengeProgressList'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ResponseMetadata:
      type: object
      required:
        - timestamp
        - requestId
        - userMode
      properties:
        timestamp:
          type: string
          format: date-time
          description: 回應時間戳
          example: "2025-01-27T12:00:00Z"
        requestId:
          type: string
          description: 請求 ID
          example: "req-uuid-123"
        userMode:
          type: string
          enum: [Expert, Inertial, Cultivation, Guiding]
          description: 用戶模式
          example: "Expert"

    AchievementsList:
      type: object
      properties:
        totalAchievements:
          type: integer
          description: 總成就數量
        unlockedCount:
          type: integer
          description: 已解鎖成就數量
        achievements:
          type: array
          items:
            $ref: '#/components/schemas/Achievement'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/AchievementCategory'
        recentUnlocks:
          type: array
          items:
            $ref: '#/components/schemas/RecentAchievement'

    Achievement:
      type: object
      properties:
        id:
          type: string
          description: 成就 ID
        name:
          type: string
          description: 成就名稱
        description:
          type: string
          description: 成就描述
        category:
          type: string
          enum: [bookkeeping, saving, budgeting, analysis, collaboration, habit]
          description: 成就分類
        difficulty:
          type: string
          enum: [beginner, intermediate, advanced, expert]
          description: 成就難度
        points:
          type: integer
          description: 獎勵積分
        icon:
          type: string
          description: 成就圖標 URL
        status:
          type: string
          enum: [unlocked, locked, in_progress]
          description: 成就狀態
        progress:
          $ref: '#/components/schemas/AchievementProgress'
        unlockedAt:
          type: string
          format: date-time
          description: 解鎖時間
        requirements:
          type: array
          items:
            $ref: '#/components/schemas/AchievementRequirement'
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/AchievementReward'

    AchievementProgress:
      type: object
      properties:
        current:
          type: integer
          description: 當前進度
        target:
          type: integer
          description: 目標進度
        percentage:
          type: number
          minimum: 0
          maximum: 100
          description: 完成百分比

    AchievementRequirement:
      type: object
      properties:
        type:
          type: string
          description: 要求類型
        description:
          type: string
          description: 要求描述
        value:
          type: integer
          description: 要求數值
        unit:
          type: string
          description: 數值單位

    AchievementReward:
      type: object
      properties:
        type:
          type: string
          enum: [points, badge, feature, discount]
          description: 獎勵類型
        value:
          type: integer
          description: 獎勵數值
        description:
          type: string
          description: 獎勵描述

    AchievementCategory:
      type: object
      properties:
        category:
          type: string
          description: 分類名稱
        totalCount:
          type: integer
          description: 該分類總成就數
        unlockedCount:
          type: integer
          description: 該分類已解鎖數
        progress:
          type: number
          description: 分類完成度

    RecentAchievement:
      type: object
      properties:
        achievementId:
          type: string
          description: 成就 ID
        name:
          type: string
          description: 成就名稱
        unlockedAt:
          type: string
          format: date-time
          description: 解鎖時間
        points:
          type: integer
          description: 獲得積分

    ChallengesList:
      type: object
      properties:
        activeChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeDetails'
        availableChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeDetails'
        completedChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeDetails'
        recommendations:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeRecommendation'

    ChallengeDetails:
      type: object
      properties:
        id:
          type: string
          description: 挑戰 ID
        title:
          type: string
          description: 挑戰標題
        description:
          type: string
          description: 挑戰描述
        type:
          type: string
          enum: [daily, weekly, monthly, custom, group]
          description: 挑戰類型
        difficulty:
          type: string
          enum: [easy, normal, hard, expert]
          description: 挑戰難度
        category:
          type: string
          description: 挑戰分類
        goal:
          $ref: '#/components/schemas/ChallengeGoal'
        duration:
          $ref: '#/components/schemas/ChallengeDuration'
        participants:
          type: integer
          description: 參與人數
        maxParticipants:
          type: integer
          description: 最大參與人數
        rewards:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeReward'
        status:
          type: string
          enum: [active, completed, expired, available, joined]
          description: 挑戰狀態
        progress:
          $ref: '#/components/schemas/ChallengeProgress'
        createdBy:
          type: string
          description: 建立者 ID
        createdAt:
          type: string
          format: date-time
          description: 建立時間

    ChallengeGoal:
      type: object
      properties:
        type:
          type: string
          enum: [count, amount, streak, completion]
          description: 目標類型
        target:
          type: number
          description: 目標數值
        unit:
          type: string
          description: 數值單位
        description:
          type: string
          description: 目標描述

    ChallengeDuration:
      type: object
      properties:
        startDate:
          type: string
          format: date-time
          description: 開始時間
        endDate:
          type: string
          format: date-time
          description: 結束時間
        durationDays:
          type: integer
          description: 持續天數

    ChallengeReward:
      type: object
      properties:
        type:
          type: string
          enum: [points, badge, achievement, feature]
          description: 獎勵類型
        value:
          type: integer
          description: 獎勵數值
        description:
          type: string
          description: 獎勵描述
        condition:
          type: string
          enum: [completion, ranking, participation]
          description: 獲得條件

    ChallengeProgress:
      type: object
      properties:
        current:
          type: number
          description: 當前進度
        target:
          type: number
          description: 目標進度
        percentage:
          type: number
          minimum: 0
          maximum: 100
          description: 完成百分比
        rank:
          type: integer
          description: 當前排名
        lastUpdate:
          type: string
          format: date-time
          description: 最後更新時間

    ChallengeRecommendation:
      type: object
      properties:
        challenge:
          $ref: '#/components/schemas/ChallengeDetails'
        reason:
          type: string
          description: 推薦原因
        priority:
          type: string
          enum: [high, medium, low]
          description: 推薦優先級

    JoinChallengeRequest:
      type: object
      required:
        - challengeId
      properties:
        challengeId:
          type: string
          description: 挑戰 ID
        customGoal:
          $ref: '#/components/schemas/ChallengeGoal'
          description: 自定義目標（可選）

    JoinChallengeResponse:
      type: object
      properties:
        challengeId:
          type: string
          description: 挑戰 ID
        joinedAt:
          type: string
          format: date-time
          description: 參加時間
        currentParticipants:
          type: integer
          description: 目前參與人數
        personalGoal:
          $ref: '#/components/schemas/ChallengeGoal'
        welcomeMessage:
          type: string
          description: 歡迎訊息

    ChallengeProgressList:
      type: object
      properties:
        activeChallenges:
          type: array
          items:
            $ref: '#/components/schemas/ChallengeProgressDetail'
        totalActive:
          type: integer
          description: 總活躍挑戰數
        completionRate:
          type: number
          description: 整體完成率

    ChallengeProgressDetail:
      type: object
      properties:
        challengeId:
          type: string
          description: 挑戰 ID
        title:
          type: string
          description: 挑戰標題
        type:
          type: string
          description: 挑戰類型
        progress:
          $ref: '#/components/schemas/ChallengeProgress'
        timeRemaining:
          type: integer
          description: 剩餘時間（小時）
        isOnTrack:
          type: boolean
          description: 是否按進度完成
        nextMilestone:
          type: object
          properties:
            target:
              type: number
              description: 下一個里程碑目標
            reward:
              type: string
              description: 里程碑獎勵

    ClaimRewardRequest:
      type: object
      required:
        - rewardIds
      properties:
        rewardIds:
          type: array
          items:
            type: string
          description: 要領取的獎勵 ID 列表
        claimAll:
          type: boolean
          default: false
          description: 是否領取所有可用獎勵

    ClaimRewardResponse:
      type: object
      properties:
        claimedRewards:
          type: array
          items:
            $ref: '#/components/schemas/ClaimedReward'
        totalPointsEarned:
          type: integer
          description: 總獲得積分
        newLevel:
          type: integer
          description: 新等級（如有升級）
        message:
          type: string
          description: 領取訊息

    ClaimedReward:
      type: object
      properties:
        rewardId:
          type: string
          description: 獎勵 ID
        type:
          type: string
          description: 獎勵類型
        name:
          type: string
          description: 獎勵名稱
        points:
          type: integer
          description: 獲得積分
        claimedAt:
          type: string
          format: date-time
          description: 領取時間

    Leaderboard:
      type: object
      properties:
        type:
          type: string
          description: 排行榜類型
        scope:
          type: string
          description: 排行範圍
        period:
          type: string
          description: 排行期間
        userRank:
          type: integer
          description: 用戶排名
        userScore:
          type: number
          description: 用戶分數
        rankings:
          type: array
          items:
            $ref: '#/components/schemas/LeaderboardEntry'
        totalParticipants:
          type: integer
          description: 總參與人數
        lastUpdated:
          type: string
          format: date-time
          description: 最後更新時間

    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
          description: 排名
        userId:
          type: string
          description: 用戶 ID
        username:
          type: string
          description: 用戶名稱
        avatar:
          type: string
          description: 頭像 URL
        score:
          type: number
          description: 分數
        level:
          type: integer
          description: 等級
        badge:
          type: string
          description: 徽章
        changeFromPrevious:
          type: integer
          description: 與前期排名變化

    Error:
      type: object
      required:
        - code
        - message
        - timestamp
        - requestId
      properties:
        code:
          type: string
          description: 錯誤代碼
          example: "VALIDATION_ERROR"
        message:
          type: string
          description: 錯誤訊息
          example: "參數驗證失敗"
        field:
          type: string
          description: 錯誤欄位（可選）
          example: "challengeId"
        timestamp:
          type: string
          format: date-time
          description: 錯誤時間戳
          example: "2025-01-27T12:00:00Z"
        requestId:
          type: string
          description: 請求 ID
          example: "req-uuid-123"
        details:
          type: object
          description: 錯誤詳細資訊

  responses:
    BadRequest:
      description: 請求參數錯誤
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    Unauthorized:
      description: 未授權存取
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    Forbidden:
      description: 禁止存取
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    NotFound:
      description: 資源不存在
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    Conflict:
      description: 資源衝突
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

    InternalServerError:
      description: 內部伺服器錯誤
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                $ref: '#/components/schemas/Error'

tags:
  - name: 成就系統
    description: 用戶成就解鎖與進度管理
  - name: 挑戰任務
    description: 個人與團體挑戰任務
  - name: 積分系統
    description: 積分獲得與管理
  - name: 等級系統
    description: 用戶等級與技能樹
  - name: 社交激勵
    description: 排行榜與社交競賽
  - name: 習慣追蹤
    description: 連續記錄與習慣統計
  - name: 獎勵系統
    description: 積分兌換與獎勵管理
