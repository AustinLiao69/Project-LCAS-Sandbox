# 1213. CM_å”ä½œç®¡ç†æ¨¡çµ„

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: CM å”ä½œç®¡ç†æ¨¡çµ„æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v2.0
- **å‰µå»ºæ—¥æœŸ**: 2025-07-07 14:19:46 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: AustinLiao69
- **æœ€å¾Œæ›´æ–°**: 2025-08-02 10:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: 1013. CM_å”ä½œç®¡ç†æ¨¡çµ„.md
- **æ¨¡çµ„ä»£ç¢¼**: CM (Collaboration Management)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. æŠ€è¡“æ¶æ§‹æ¦‚è¿°
   - 1.1 æ¨¡çµ„å®šä½
   - 1.2 æŠ€è¡“å †ç–Š
   - 1.3 æ¨¡çµ„æ¶æ§‹

2. æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ
   - 2.1 æˆå“¡ç®¡ç†å‡½æ•¸
   - 2.2 æ¬Šé™ç®¡ç†å‡½æ•¸
   - 2.3 å³æ™‚åŒæ­¥å‡½æ•¸
   - 2.4 å”ä½œé€šçŸ¥å‡½æ•¸
   - 2.5 è®Šæ›´ç´€éŒ„å‡½æ•¸
   - 2.6 éŒ¯èª¤è™•ç†èˆ‡ç›£æ§å‡½æ•¸

3. æ¨¡çµ„é–“äº’å‹•æ¶æ§‹
   - 3.1 æ ¸å¿ƒä¾è³´é—œä¿‚
   - 3.2 è³‡æ–™æµå‘è¨­è¨ˆ

4. è³‡æ–™åº«æ¶æ§‹è¨­è¨ˆ
   - 4.1 Firestore é›†åˆçµæ§‹
   - 4.2 æ¬Šé™ç­‰ç´šè¨­è¨ˆ

5. API ä»‹é¢è¦æ ¼
   - 5.1 REST API ç«¯é»
   - 5.2 WebSocket äº‹ä»¶

6. æ•ˆèƒ½èˆ‡æ“´å±•æ€§è€ƒé‡
   - 6.1 å¿«å–ç­–ç•¥
   - 6.2 å³æ™‚åŒæ­¥å„ªåŒ–

7. æ–‡ä»¶ç¶­è­·è¨˜éŒ„

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
CM å”ä½œç®¡ç†æ¨¡çµ„ä½œç‚º LCAS 2.0 çš„æ ¸å¿ƒæ”¯æŸ±æ¨¡çµ„ï¼Œè² è²¬å¸³æœ¬å¤šç”¨æˆ¶å”ä½œåŠŸèƒ½ï¼ŒåŒ…æ‹¬æˆå“¡ç®¡ç†ã€æ¬Šé™åˆ†ç´šã€å³æ™‚åŒæ­¥èˆ‡è®Šæ›´è¿½è¹¤ï¼Œæ˜¯å¤šå¸³æœ¬ç³»çµ±å”ä½œçš„æ ¸å¿ƒå¼•æ“ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å¾Œç«¯æ¡†æ¶**: Node.js/Express
- **è³‡æ–™åº«**: Firestore
- **å³æ™‚é€šè¨Š**: WebSocket (Socket.io)
- **æ—¥èªŒç³»çµ±**: DL æ¨¡çµ„
- **é€šçŸ¥ç³»çµ±**: LINE OAæ¨¡çµ„

### 1.3 æ¨¡çµ„æ¶æ§‹
```javascript
/**
 * CM_å”ä½œç®¡ç†æ¨¡çµ„_1.0.0
 * @module CMæ¨¡çµ„ 
 * @description å”ä½œç®¡ç†ç³»çµ± - æ”¯æ´å¤šç”¨æˆ¶æ¬Šé™ç®¡ç†ã€å³æ™‚åŒæ­¥èˆ‡å”ä½œé€šçŸ¥
 * @update 2025-07-07: åˆç‰ˆå»ºç«‹ï¼Œå¯¦ç¾å®Œæ•´å”ä½œç”Ÿæ…‹ç³»çµ±
 */
```

---

## 2.0 æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ

### 2.1 æˆå“¡ç®¡ç†å‡½æ•¸

```javascript
/**
 * 01. é‚€è«‹æˆå“¡åŠ å…¥å¸³æœ¬
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description é‚€è«‹æ–°æˆå“¡åŠ å…¥æŒ‡å®šå¸³æœ¬ä¸¦è¨­å®šåˆå§‹æ¬Šé™
 */
function CM_inviteMember(ledgerId, inviterId, inviteeInfo, initialPermission)
```
- **åŠŸèƒ½**: æˆå“¡é‚€è«‹æ©Ÿåˆ¶ï¼Œæ”¯æ´å¤šç¨®é‚€è«‹æ–¹å¼ï¼ˆemailã€LINEã€ç”¨æˆ¶åï¼‰
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **MLSæ¨¡çµ„** - é©—è­‰å¸³æœ¬å­˜å–æ¬Šé™
  - **AMæ¨¡çµ„** `userProfileManager.js` - é©—è­‰è¢«é‚€è«‹ç”¨æˆ¶
  - **LINE OAæ¨¡çµ„** - ç™¼é€é‚€è«‹é€šçŸ¥
- **å›å‚³å€¼**: `{success: boolean, invitationId: string, message: string}`

```javascript
/**
 * 02. è™•ç†æˆå“¡åŠ å…¥è«‹æ±‚
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description è™•ç†ç”¨æˆ¶æ¥å—é‚€è«‹æˆ–ç”³è«‹åŠ å…¥å¸³æœ¬
 */
function CM_processMemberJoin(invitationId, userId, responseType)
```
- **åŠŸèƒ½**: è™•ç†é‚€è«‹å›æ‡‰ï¼Œè‡ªå‹•è¨­å®šæˆå“¡æ¬Šé™
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `CM_setMemberPermission()` - è¨­å®šæˆå“¡æ¬Šé™
  - `DL_log()` - è¨˜éŒ„åŠ å…¥æ“ä½œ
  - **DDæ¨¡çµ„** - åˆ†ç™¼æˆå“¡è®Šæ›´è³‡è¨Š
- **å›å‚³å€¼**: `{success: boolean, memberId: string, permissions: object}`

```javascript
/**
 * 03. ç§»é™¤å”ä½œæˆå“¡
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description å¾å¸³æœ¬ç§»é™¤æŒ‡å®šæˆå“¡ï¼ˆå«é€€å‡ºå’Œè¢«ç§»é™¤ï¼‰
 */
function CM_removeMember(ledgerId, targetUserId, operatorId, removeType)
```
- **åŠŸèƒ½**: å®‰å…¨çš„æˆå“¡ç§»é™¤æ©Ÿåˆ¶ï¼Œæ”¯æ´ä¸»å‹•é€€å‡ºå’Œè¢«å‹•ç§»é™¤
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `CM_validatePermission()` - é©—è­‰ç§»é™¤æ¬Šé™
  - **å‚™ä»½æœå‹™æ¨¡çµ„** - å‚™ä»½æˆå“¡æ­·å²è³‡æ–™
  - `DL_warning()` - è¨˜éŒ„ç§»é™¤æ“ä½œ
- **å›å‚³å€¼**: `{success: boolean, removedUser: string, newMemberCount: number}`

```javascript
/**
 * 04. å–å¾—å¸³æœ¬æˆå“¡æ¸…å–®
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description æŸ¥è©¢æŒ‡å®šå¸³æœ¬çš„æ‰€æœ‰æˆå“¡åŠå…¶æ¬Šé™ç‹€æ…‹
 */
function CM_getMemberList(ledgerId, requesterId, includePermissions)
```
- **åŠŸèƒ½**: å®Œæ•´çš„æˆå“¡è³‡è¨ŠæŸ¥è©¢ï¼Œæ”¯æ´æ¬Šé™éæ¿¾
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **AMæ¨¡çµ„** - å–å¾—ç”¨æˆ¶åŸºæœ¬è³‡è¨Š
  - `CM_validatePermission()` - é©—è­‰æŸ¥è©¢æ¬Šé™
- **å›å‚³å€¼**: `{members: array, totalCount: number, permissions: object}`

### 2.2 æ¬Šé™ç®¡ç†å‡½æ•¸

```javascript
/**
 * 05. è¨­å®šæˆå“¡æ¬Šé™
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description è¨­å®šæˆ–ä¿®æ”¹æŒ‡å®šæˆå“¡çš„å¸³æœ¬æ¬Šé™ç­‰ç´š
 */
function CM_setMemberPermission(ledgerId, targetUserId, newPermission, operatorId)
```
- **åŠŸèƒ½**: å‹•æ…‹æ¬Šé™ç®¡ç†ï¼Œæ”¯æ´å››ç´šæ¬Šé™é«”ç³»
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `CM_validatePermissionChange()` - é©—è­‰æ¬Šé™è®Šæ›´åˆæ³•æ€§
  - **DDæ¨¡çµ„** - å³æ™‚åŒæ­¥æ¬Šé™è®Šæ›´
  - `DL_log()` - è¨˜éŒ„æ¬Šé™è®Šæ›´æ—¥èªŒ
- **å›å‚³å€¼**: `{success: boolean, oldPermission: string, newPermission: string}`

```javascript
/**
 * 06. é©—è­‰ç”¨æˆ¶æ“ä½œæ¬Šé™
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æœ‰æ¬Šé™åŸ·è¡Œç‰¹å®šæ“ä½œ
 */
function CM_validatePermission(ledgerId, userId, operationType)
```
- **åŠŸèƒ½**: çµ±ä¸€çš„æ¬Šé™é©—è­‰æ©Ÿåˆ¶ï¼Œæ”¯æ´ç´°ç²’åº¦æ“ä½œæ¬Šé™
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Firestore - æŸ¥è©¢ç”¨æˆ¶æ¬Šé™é…ç½®
  - `DL_warning()` - è¨˜éŒ„æ¬Šé™æ‹’çµ•äº‹ä»¶
- **å›å‚³å€¼**: `{hasPermission: boolean, currentLevel: string, requiredLevel: string}`

```javascript
/**
 * 07. å–å¾—æ¬Šé™çŸ©é™£
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description å–å¾—å®Œæ•´çš„æ¬Šé™é…ç½®çŸ©é™£å’Œæ“ä½œè¦å‰‡
 */
function CM_getPermissionMatrix(ledgerId, userId)
```
- **åŠŸèƒ½**: å‹•æ…‹æ¬Šé™çŸ©é™£ç”Ÿæˆï¼Œæ”¯æ´è‡ªè¨‚æ¬Šé™è¦å‰‡
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **MLSæ¨¡çµ„** - å–å¾—å¸³æœ¬é¡å‹ç›¸é—œæ¬Šé™
  - **BMæ¨¡çµ„** - æ•´åˆé ç®—ç®¡ç†æ¬Šé™
- **å›å‚³å€¼**: `{permissionMatrix: object, allowedOperations: array}`

### 2.3 å³æ™‚åŒæ­¥å‡½æ•¸

```javascript
/**
 * 08. åˆå§‹åŒ–å”ä½œåŒæ­¥
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description ç‚ºå¸³æœ¬å»ºç«‹å³æ™‚å”ä½œåŒæ­¥é€£ç·š
 */
function CM_initializeSync(ledgerId, userId, clientInfo)
```
- **åŠŸèƒ½**: WebSocket é€£ç·šå»ºç«‹ï¼Œåˆå§‹åŒ–å”ä½œç’°å¢ƒ
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - WebSocket Server - å»ºç«‹å³æ™‚é€£ç·š
  - `CM_validatePermission()` - é©—è­‰åŒæ­¥æ¬Šé™
  - `DL_info()` - è¨˜éŒ„åŒæ­¥é€£ç·š
- **å›å‚³å€¼**: `{syncId: string, channelId: string, connectedUsers: array}`

```javascript
/**
 * 09. è™•ç†è³‡æ–™åŒæ­¥è¡çª
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description åµæ¸¬ä¸¦è§£æ±ºå¤šç”¨æˆ¶åŒæ™‚ç·¨è¼¯çš„è³‡æ–™è¡çª
 */
function CM_resolveDataConflict(conflictData, resolutionStrategy)
```
- **åŠŸèƒ½**: æ™ºæ…§è¡çªè§£æ±ºï¼Œæ”¯æ´å¤šç¨®åˆä½µç­–ç•¥
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **BKæ¨¡çµ„** - è™•ç†è¨˜å¸³è³‡æ–™è¡çª
  - **å‚™ä»½æœå‹™æ¨¡çµ„** - å»ºç«‹è¡çªå‰ç‹€æ…‹å‚™ä»½
  - `DL_warning()` - è¨˜éŒ„è¡çªè§£æ±ºéç¨‹
- **å›å‚³å€¼**: `{resolved: boolean, finalData: object, conflictLog: array}`

```javascript
/**
 * 10. å»£æ’­å”ä½œäº‹ä»¶
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description å‘æ‰€æœ‰å”ä½œæˆå“¡å»£æ’­é‡è¦äº‹ä»¶è®Šæ›´
 */
function CM_broadcastEvent(ledgerId, eventType, eventData, excludeUsers)
```
- **åŠŸèƒ½**: å³æ™‚äº‹ä»¶å»£æ’­ï¼Œç¢ºä¿æ‰€æœ‰æˆå“¡åŒæ­¥
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - WebSocket Server - å³æ™‚æ¶ˆæ¯æ¨é€
  - **LINE OAæ¨¡çµ„** - é›¢ç·šç”¨æˆ¶é€šçŸ¥
- **å›å‚³å€¼**: `{broadcasted: boolean, deliveredCount: number, eventId: string}`

### 2.4 å”ä½œé€šçŸ¥å‡½æ•¸

```javascript
/**
 * 11. ç™¼é€å”ä½œé€šçŸ¥
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description å‘ç›¸é—œæˆå“¡ç™¼é€å”ä½œäº‹ä»¶é€šçŸ¥
 */
function CM_sendCollaborationNotification(notificationType, recipientList, notificationData)
```
- **åŠŸèƒ½**: å¤šç®¡é“å”ä½œé€šçŸ¥ç³»çµ±
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **LINE OAæ¨¡çµ„** - LINE é€šçŸ¥ç™¼é€
  - **AMæ¨¡çµ„** - å–å¾—ç”¨æˆ¶é€šçŸ¥åå¥½
  - `DL_info()` - è¨˜éŒ„é€šçŸ¥ç™¼é€ç‹€æ…‹
- **å›å‚³å€¼**: `{sent: boolean, deliveredChannels: array, notificationId: string}`

```javascript
/**
 * 12. è¨­å®šé€šçŸ¥åå¥½
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description è®“ç”¨æˆ¶è‡ªè¨‚å”ä½œäº‹ä»¶çš„é€šçŸ¥è¨­å®š
 */
function CM_setNotificationPreferences(userId, ledgerId, preferences)
```
- **åŠŸèƒ½**: å€‹äººåŒ–é€šçŸ¥è¨­å®šç®¡ç†
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **AMæ¨¡çµ„** - æ•´åˆç”¨æˆ¶åå¥½è¨­å®š
  - **DDæ¨¡çµ„** - åŒæ­¥åå¥½è¨­å®šè®Šæ›´
- **å›å‚³å€¼**: `{updated: boolean, preferences: object, message: string}`

### 2.5 è®Šæ›´ç´€éŒ„å‡½æ•¸

```javascript
/**
 * 13. è¨˜éŒ„å”ä½œæ“ä½œ
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description è©³ç´°è¨˜éŒ„æ‰€æœ‰å”ä½œç›¸é—œçš„æ“ä½œæ—¥èªŒ
 */
function CM_logCollaborationAction(ledgerId, userId, actionType, actionData)
```
- **åŠŸèƒ½**: å®Œæ•´çš„å”ä½œæ“ä½œå¯©è¨ˆè¿½è¹¤
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `DL_log()` - æ•´åˆç³»çµ±æ—¥èªŒ
  - Firestore - å„²å­˜è©³ç´°æ“ä½œè¨˜éŒ„
- **å›å‚³å€¼**: `{logged: boolean, logId: string, timestamp: string}`

```javascript
/**
 * 14. æŸ¥è©¢å”ä½œæ­·å²
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description æŸ¥è©¢æŒ‡å®šå¸³æœ¬çš„å”ä½œæ“ä½œæ­·å²è¨˜éŒ„
 */
function CM_getCollaborationHistory(ledgerId, userId, filterOptions)
```
- **åŠŸèƒ½**: å”ä½œæ­·å²æŸ¥è©¢èˆ‡åˆ†æ
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `CM_validatePermission()` - é©—è­‰æ­·å²æŸ¥è©¢æ¬Šé™
  - **MRAæ¨¡çµ„** - ç”Ÿæˆå”ä½œåˆ†æå ±è¡¨
- **å›å‚³å€¼**: `{history: array, totalCount: number, statistics: object}`

### 2.6 éŒ¯èª¤è™•ç†èˆ‡ç›£æ§å‡½æ•¸

```javascript
/**
 * 15. è™•ç†å”ä½œéŒ¯èª¤
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description çµ±ä¸€è™•ç†å”ä½œéç¨‹ä¸­çš„å„ç¨®éŒ¯èª¤æƒ…æ³
 */
function CM_handleCollaborationError(errorType, errorData, context)
```
- **åŠŸèƒ½**: æ¨™æº–åŒ–å”ä½œéŒ¯èª¤è™•ç†èˆ‡æ¢å¾©
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `DL_error()` - è¨˜éŒ„éŒ¯èª¤è©³æƒ…
  - **LINE OAæ¨¡çµ„** - ç™¼é€éŒ¯èª¤é€šçŸ¥
  - **å‚™ä»½æœå‹™æ¨¡çµ„** - éŒ¯èª¤ç‹€æ…‹æ¢å¾©
- **å›å‚³å€¼**: `{handled: boolean, errorCode: string, recoveryAction: string}`

```javascript
/**
 * 16. ç›£æ§å”ä½œç‹€æ…‹
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:19:46
 * @description å³æ™‚ç›£æ§å”ä½œç³»çµ±çš„å¥åº·ç‹€æ…‹
 */
function CM_monitorCollaborationHealth(ledgerId)
```
- **åŠŸèƒ½**: å”ä½œç³»çµ±å¥åº·ç‹€æ…‹ç›£æ§èˆ‡é è­¦
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - WebSocket Server - æª¢æŸ¥é€£ç·šç‹€æ…‹
  - **MRAæ¨¡çµ„** - ç”Ÿæˆå”ä½œæ•ˆèƒ½å ±è¡¨
- **å›å‚³å€¼**: `{healthy: boolean, activeUsers: number, performance: object}`

---

## 3.0 æ¨¡çµ„é–“äº’å‹•æ¶æ§‹

### 3.1 æ ¸å¿ƒä¾è³´é—œä¿‚
```
CM å”ä½œç®¡ç†æ¨¡çµ„
â”œâ”€â”€ MLSæ¨¡çµ„ (Multi-Ledger System)
â”‚   â”œâ”€â”€ MLS_validateLedgerAccess() - å¸³æœ¬æ¬Šé™é©—è­‰
â”‚   â””â”€â”€ MLS_getLedgerInfo() - å¸³æœ¬åŸºæœ¬è³‡è¨Š
â”œâ”€â”€ AMæ¨¡çµ„ (Account Management)
â”‚   â”œâ”€â”€ userProfileManager.js - ç”¨æˆ¶è³‡è¨Šç®¡ç†
â”‚   â””â”€â”€ ç”¨æˆ¶åå¥½è¨­å®šæ•´åˆ
â”œâ”€â”€ DLæ¨¡çµ„ (Data Logging)
â”‚   â”œâ”€â”€ DL_log() - ä¸€èˆ¬æ“ä½œæ—¥èªŒ
â”‚   â”œâ”€â”€ DL_error() - éŒ¯èª¤æ—¥èªŒ
â”‚   â””â”€â”€ DL_warning() - è­¦å‘Šæ—¥èªŒ
â”œâ”€â”€ DDæ¨¡çµ„ (Data Distribution)
â”‚   â””â”€â”€ DD_distributeData() - å”ä½œè³‡æ–™åˆ†ç™¼
â”œâ”€â”€ BKæ¨¡çµ„ (Bookkeeping)
â”‚   â””â”€â”€ è¨˜å¸³è³‡æ–™è¡çªè™•ç†
â”œâ”€â”€ LINE OAæ¨¡çµ„
â”‚   â””â”€â”€ å”ä½œé€šçŸ¥ç™¼é€
â”œâ”€â”€ WebSocketæœå‹™
â”‚   â”œâ”€â”€ å³æ™‚é€£ç·šç®¡ç†
â”‚   â””â”€â”€ äº‹ä»¶å»£æ’­
â””â”€â”€ å‚™ä»½æœå‹™æ¨¡çµ„ (Backup Service)
    â””â”€â”€ å”ä½œç‹€æ…‹å‚™ä»½èˆ‡æ¢å¾©
```

### 3.2 è³‡æ–™æµå‘è¨­è¨ˆ
```
å”ä½œè«‹æ±‚ â†’ CMæ¬Šé™é©—è­‰ â†’ æ“ä½œåŸ·è¡Œ â†’ å³æ™‚åŒæ­¥ â†’ 
é€šçŸ¥ç™¼é€ â†’ æ—¥èªŒè¨˜éŒ„ â†’ ç‹€æ…‹å»£æ’­ â†’ å›æ‡‰ç”¨æˆ¶
```

---

## 4.0 è³‡æ–™åº«æ¶æ§‹è¨­è¨ˆ

### 4.1 Firestore é›†åˆçµæ§‹
```
collaborations/
â”œâ”€â”€ {ledger_id}/
â”‚   â”œâ”€â”€ members: array
â”‚   â”œâ”€â”€ permissions: object
â”‚   â”œâ”€â”€ sync_settings: object
â”‚   â”œâ”€â”€ notification_rules: object
â”‚   â”œâ”€â”€ created_at: timestamp
â”‚   â””â”€â”€ updated_at: timestamp

collaboration_logs/
â”œâ”€â”€ {log_id}/
â”‚   â”œâ”€â”€ ledger_id: string
â”‚   â”œâ”€â”€ user_id: string
â”‚   â”œâ”€â”€ action_type: string
â”‚   â”œâ”€â”€ action_data: object
â”‚   â”œâ”€â”€ timestamp: timestamp
â”‚   â””â”€â”€ ip_address: string

member_invitations/
â”œâ”€â”€ {invitation_id}/
â”‚   â”œâ”€â”€ ledger_id: string
â”‚   â”œâ”€â”€ inviter_id: string
â”‚   â”œâ”€â”€ invitee_info: object
â”‚   â”œâ”€â”€ permission_level: string
â”‚   â”œâ”€â”€ status: "pending" | "accepted" | "declined" | "expired"
â”‚   â”œâ”€â”€ created_at: timestamp
â”‚   â””â”€â”€ expires_at: timestamp
```

### 4.2 æ¬Šé™ç­‰ç´šè¨­è¨ˆ
```javascript
permissions: {
  owner: {
    level: 4,
    actions: ["all"]
  },
  admin: {
    level: 3,
    actions: ["invite", "remove", "edit", "view", "manage_permissions"]
  },
  member: {
    level: 2,
    actions: ["edit", "view", "invite_limited"]
  },
  viewer: {
    level: 1,
    actions: ["view"]
  }
}
```

---

## 5.0 API ä»‹é¢è¦æ ¼

### 5.1 REST API ç«¯é»
```
POST   /api/v2/collaboration/invite           - é‚€è«‹æˆå“¡
PUT    /api/v2/collaboration/join/{id}        - è™•ç†åŠ å…¥è«‹æ±‚
DELETE /api/v2/collaboration/remove           - ç§»é™¤æˆå“¡
GET    /api/v2/collaboration/members/{id}     - å–å¾—æˆå“¡æ¸…å–®
PUT    /api/v2/collaboration/permissions      - è¨­å®šæ¬Šé™
GET    /api/v2/collaboration/permissions/{id} - æŸ¥è©¢æ¬Šé™
POST   /api/v2/collaboration/sync/init        - åˆå§‹åŒ–åŒæ­¥
GET    /api/v2/collaboration/history/{id}     - æŸ¥è©¢å”ä½œæ­·å²
```

### 5.2 WebSocket äº‹ä»¶
```javascript
// å³æ™‚å”ä½œäº‹ä»¶
'collaboration:member_joined'     - æˆå“¡åŠ å…¥
'collaboration:member_left'       - æˆå“¡é›¢é–‹
'collaboration:permission_changed' - æ¬Šé™è®Šæ›´
'collaboration:data_updated'      - è³‡æ–™æ›´æ–°
'collaboration:conflict_detected' - è¡çªåµæ¸¬
'collaboration:sync_required'     - éœ€è¦åŒæ­¥
'collaboration:notification'      - å”ä½œé€šçŸ¥
```

---

## 6.0 æ•ˆèƒ½èˆ‡æ“´å±•æ€§è€ƒé‡

### 6.1 å¿«å–ç­–ç•¥
- æˆå“¡æ¬Šé™å¿«å– (15åˆ†é˜)
- å”ä½œç‹€æ…‹å¿«å– (5åˆ†é˜)
- é€šçŸ¥åå¥½å¿«å– (30åˆ†é˜)

### 6.2 å³æ™‚åŒæ­¥å„ªåŒ–
- WebSocket é€£ç·šæ± ç®¡ç†
- äº‹ä»¶å»é‡èˆ‡åˆä½µ
- åˆ†å±¤å»£æ’­ç­–ç•¥
- é›¢ç·šç”¨æˆ¶è™•ç†

---

## 7.0 æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| v1.0 | 2025-07-07 14:19:46 +08:00 | AustinLiao69 | åˆç‰ˆå»ºç«‹ï¼Œå®Œæ•´æŠ€è¡“è¨­è¨ˆ |
| v2.0 | 2025-08-02 10:00:00 +08:00 | LCAS SA Team | æ·»åŠ å®Œæ•´ç›®æ¬¡çµæ§‹ï¼Œå„ªåŒ–æ–‡ä»¶çµæ§‹ |

---

**æ–‡ä»¶çµæŸ**
*æ­¤æ–‡ä»¶ç‚º LCAS 2.0 CM å”ä½œç®¡ç†æ¨¡çµ„çš„å®Œæ•´æŠ€è¡“è¨­è¨ˆè¦æ ¼ï¼Œæ‰€æœ‰å‡½æ•¸è¨­è¨ˆå‡åŸºæ–¼å”ä½œéœ€æ±‚ä¸¦æ•´åˆå¤šå¸³æœ¬ç³»çµ±æ¶æ§‹ã€‚*