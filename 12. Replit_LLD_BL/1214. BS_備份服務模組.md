# 5014. TDD_BS_å‚™ä»½æœå‹™æ¨¡çµ„_v2.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: BS å‚™ä»½æœå‹™æ¨¡çµ„æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v2.0
- **å‰µå»ºæ—¥æœŸ**: 2025-07-07 14:23:11 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: AustinLiao69
- **æœ€å¾Œæ›´æ–°**: 2025-08-02 10:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: 1014. BS_å‚™ä»½æœå‹™æ¨¡çµ„.md
- **æ¨¡çµ„ä»£ç¢¼**: BS (Backup Service)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. æŠ€è¡“æ¶æ§‹æ¦‚è¿°
   - 1.1 æ¨¡çµ„å®šä½
   - 1.2 æŠ€è¡“å †ç–Š
   - 1.3 æ¨¡çµ„æ¶æ§‹

2. æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ
   - 2.1 å‚™ä»½å»ºç«‹å‡½æ•¸
   - 2.2 é›²ç«¯å„²å­˜æ•´åˆå‡½æ•¸
   - 2.3 å‚™ä»½ç‰ˆæœ¬ç®¡ç†å‡½æ•¸
   - 2.4 è³‡æ–™é‚„åŸå‡½æ•¸
   - 2.5 å‚™ä»½åŠ å¯†èˆ‡å®‰å…¨å‡½æ•¸
   - 2.6 éŒ¯èª¤è™•ç†èˆ‡ç›£æ§å‡½æ•¸

3. æ¨¡çµ„é–“äº’å‹•æ¶æ§‹
   - 3.1 æ ¸å¿ƒä¾è³´é—œä¿‚
   - 3.2 è³‡æ–™æµå‘è¨­è¨ˆ

4. è³‡æ–™åº«æ¶æ§‹è¨­è¨ˆ
   - 4.1 Firestore é›†åˆçµæ§‹
   - 4.2 å‚™ä»½æª”æ¡ˆçµæ§‹è¨­è¨ˆ

5. API ä»‹é¢è¦æ ¼
   - 5.1 REST API ç«¯é»
   - 5.2 WebSocket äº‹ä»¶

6. æ•ˆèƒ½èˆ‡æ“´å±•æ€§è€ƒé‡
   - 6.1 å‚™ä»½å„ªåŒ–ç­–ç•¥
   - 6.2 å„²å­˜ç®¡ç†

7. æ–‡ä»¶ç¶­è­·è¨˜éŒ„

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
BS å‚™ä»½æœå‹™æ¨¡çµ„ä½œç‚º LCAS 2.0 çš„æ ¸å¿ƒå®‰å…¨ä¿éšœæ¨¡çµ„ï¼Œè² è²¬å®šæœŸè‡ªå‹•å‚™ä»½ç”¨æˆ¶è³‡æ–™ã€æ”¯æ´å¤šé›²ç«¯å„²å­˜æ•´åˆï¼Œä¸¦æä¾›å®Œæ•´çš„å‚™ä»½ç‰ˆæœ¬ç®¡ç†èˆ‡ä¸€éµé‚„åŸåŠŸèƒ½ï¼Œç¢ºä¿è³‡æ–™å®‰å…¨èˆ‡å¯ç”¨æ€§ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å¾Œç«¯æ¡†æ¶**: Node.js/Express
- **è³‡æ–™åº«**: Firestore
- **é›²ç«¯æ•´åˆ**: Google Drive API, OneDrive API
- **åŠ å¯†æœå‹™**: Node.js Crypto
- **æ’ç¨‹ç³»çµ±**: Node-cron
- **å£“ç¸®æœå‹™**: Node.js Zlib

### 1.3 æ¨¡çµ„æ¶æ§‹
```javascript
/**
 * BS_å‚™ä»½æœå‹™æ¨¡çµ„_1.0.0
 * @module BSæ¨¡çµ„ 
 * @description å‚™ä»½æœå‹™ç³»çµ± - æ”¯æ´è‡ªå‹•å‚™ä»½ã€å¤šé›²ç«¯å„²å­˜ã€ç‰ˆæœ¬ç®¡ç†èˆ‡ä¸€éµé‚„åŸ
 * @update 2025-07-07: åˆç‰ˆå»ºç«‹ï¼Œå¯¦ç¾å®Œæ•´å‚™ä»½ç”Ÿæ…‹ç³»çµ±
 */
```

---

## 2.0 æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ

### 2.1 å‚™ä»½å»ºç«‹å‡½æ•¸

```javascript
/**
 * 01. å»ºç«‹æ‰‹å‹•å‚™ä»½
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description ç«‹å³å»ºç«‹æŒ‡å®šç¯„åœçš„è³‡æ–™å‚™ä»½
 */
function BS_createManualBackup(userId, backupScope, backupOptions)
```
- **åŠŸèƒ½**: å³æ™‚æ‰‹å‹•å‚™ä»½ï¼Œæ”¯æ´å…¨é‡æˆ–å¢é‡å‚™ä»½
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **MLSæ¨¡çµ„** - å–å¾—å¸³æœ¬è³‡æ–™
  - **BKæ¨¡çµ„** - å‚™ä»½è¨˜å¸³è³‡æ–™
  - **CMæ¨¡çµ„** - å‚™ä»½å”ä½œè¨­å®š
  - `DL_log()` - è¨˜éŒ„å‚™ä»½æ“ä½œæ—¥èªŒ
- **å›å‚³å€¼**: `{success: boolean, backupId: string, fileSize: number, message: string}`

```javascript
/**
 * 02. è¨­å®šè‡ªå‹•å‚™ä»½æ’ç¨‹
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description è¨­å®šå®šæœŸè‡ªå‹•å‚™ä»½çš„é »ç‡å’Œç¯„åœ
 */
function BS_setupBackupSchedule(userId, scheduleConfig)
```
- **åŠŸèƒ½**: éˆæ´»çš„å‚™ä»½æ’ç¨‹è¨­å®šï¼Œæ”¯æ´å¤šç¨®é »ç‡
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Node-cron - å»ºç«‹æ’ç¨‹ä»»å‹™
  - **AMæ¨¡çµ„** - é©—è­‰ç”¨æˆ¶æ¬Šé™
  - Firestore - å„²å­˜æ’ç¨‹é…ç½®
- **å›å‚³å€¼**: `{success: boolean, scheduleId: string, nextBackupTime: timestamp}`

```javascript
/**
 * 03. åŸ·è¡Œæ’ç¨‹å‚™ä»½
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description åŸ·è¡Œè‡ªå‹•æ’ç¨‹çš„å‚™ä»½ä»»å‹™
 */
function BS_executeScheduledBackup(scheduleId, executionContext)
```
- **åŠŸèƒ½**: è‡ªå‹•åŒ–å‚™ä»½åŸ·è¡Œå¼•æ“
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `BS_createBackupArchive()` - å»ºç«‹å‚™ä»½æª”æ¡ˆ
  - `BS_uploadToCloud()` - ä¸Šå‚³è‡³é›²ç«¯
  - **LINE OAæ¨¡çµ„** - ç™¼é€å‚™ä»½å®Œæˆé€šçŸ¥
- **å›å‚³å€¼**: `{executed: boolean, backupId: string, uploadResults: array}`

### 2.2 é›²ç«¯å„²å­˜æ•´åˆå‡½æ•¸

```javascript
/**
 * 04. è¨­å®šé›²ç«¯å„²å­˜èªè­‰
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description è¨­å®šå’Œé©—è­‰é›²ç«¯å„²å­˜æœå‹™çš„èªè­‰è³‡è¨Š
 */
function BS_setupCloudAuth(userId, cloudProvider, authCredentials)
```
- **åŠŸèƒ½**: å¤šé›²ç«¯å¹³å°èªè­‰ç®¡ç†
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Google Drive API - Google é›²ç«¯æˆæ¬Š
  - OneDrive API - Microsoft é›²ç«¯æˆæ¬Š
  - `DL_info()` - è¨˜éŒ„èªè­‰è¨­å®š
- **å›å‚³å€¼**: `{authenticated: boolean, provider: string, expiresAt: timestamp}`

```javascript
/**
 * 05. ä¸Šå‚³å‚™ä»½è‡³é›²ç«¯
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description å°‡å‚™ä»½æª”æ¡ˆä¸Šå‚³è‡³æŒ‡å®šçš„é›²ç«¯å„²å­˜æœå‹™
 */
function BS_uploadToCloud(backupId, cloudProvider, uploadOptions)
```
- **åŠŸèƒ½**: å¤šé›²ç«¯ä¸¦è¡Œä¸Šå‚³ï¼Œæ”¯æ´æ–·é»çºŒå‚³
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Cloud APIs - æª”æ¡ˆä¸Šå‚³æ“ä½œ
  - `BS_encryptBackupData()` - å‚™ä»½æª”æ¡ˆåŠ å¯†
  - `DL_log()` - è¨˜éŒ„ä¸Šå‚³é€²åº¦
- **å›å‚³å€¼**: `{uploaded: boolean, cloudFileId: string, uploadTime: number}`

```javascript
/**
 * 06. å¾é›²ç«¯ä¸‹è¼‰å‚™ä»½
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description å¾é›²ç«¯å„²å­˜ä¸‹è¼‰æŒ‡å®šçš„å‚™ä»½æª”æ¡ˆ
 */
function BS_downloadFromCloud(backupId, cloudProvider, downloadPath)
```
- **åŠŸèƒ½**: é›²ç«¯å‚™ä»½æª”æ¡ˆä¸‹è¼‰èˆ‡è§£å¯†
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Cloud APIs - æª”æ¡ˆä¸‹è¼‰æ“ä½œ
  - `BS_decryptBackupData()` - å‚™ä»½æª”æ¡ˆè§£å¯†
  - `DL_log()` - è¨˜éŒ„ä¸‹è¼‰é€²åº¦
- **å›å‚³å€¼**: `{downloaded: boolean, localPath: string, fileSize: number}`

### 2.3 å‚™ä»½ç‰ˆæœ¬ç®¡ç†å‡½æ•¸

```javascript
/**
 * 07. æŸ¥è©¢å‚™ä»½ç‰ˆæœ¬æ­·å²
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description æŸ¥è©¢ç”¨æˆ¶çš„æ‰€æœ‰å‚™ä»½ç‰ˆæœ¬å’Œè©³ç´°è³‡è¨Š
 */
function BS_getBackupHistory(userId, filterOptions, sortOrder)
```
- **åŠŸèƒ½**: å®Œæ•´çš„å‚™ä»½ç‰ˆæœ¬æŸ¥è©¢èˆ‡ç¯©é¸
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Firestore - æŸ¥è©¢å‚™ä»½è¨˜éŒ„
  - **AMæ¨¡çµ„** - é©—è­‰æŸ¥è©¢æ¬Šé™
  - Cloud APIs - å–å¾—é›²ç«¯æª”æ¡ˆç‹€æ…‹
- **å›å‚³å€¼**: `{backups: array, totalCount: number, storageUsed: number}`

```javascript
/**
 * 08. åˆªé™¤å‚™ä»½ç‰ˆæœ¬
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description åˆªé™¤æŒ‡å®šçš„å‚™ä»½ç‰ˆæœ¬ï¼ˆå«é›²ç«¯æª”æ¡ˆæ¸…ç†ï¼‰
 */
function BS_deleteBackupVersion(backupId, userId, confirmationToken)
```
- **åŠŸèƒ½**: å®‰å…¨çš„å‚™ä»½ç‰ˆæœ¬åˆªé™¤ï¼Œå«äºŒæ¬¡ç¢ºèª
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Cloud APIs - åˆªé™¤é›²ç«¯æª”æ¡ˆ
  - Firestore - åˆªé™¤å‚™ä»½è¨˜éŒ„
  - `DL_warning()` - è¨˜éŒ„åˆªé™¤æ“ä½œ
- **å›å‚³å€¼**: `{deleted: boolean, freedSpace: number, remainingVersions: number}`

```javascript
/**
 * 09. å‚™ä»½ç‰ˆæœ¬æ¯”è¼ƒ
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description æ¯”è¼ƒä¸åŒå‚™ä»½ç‰ˆæœ¬é–“çš„å·®ç•°
 */
function BS_compareBackupVersions(backupId1, backupId2, comparisonType)
```
- **åŠŸèƒ½**: æ™ºæ…§å‚™ä»½ç‰ˆæœ¬å·®ç•°åˆ†æ
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `BS_downloadFromCloud()` - ä¸‹è¼‰æ¯”è¼ƒæª”æ¡ˆ
  - **MRAæ¨¡çµ„** - ç”Ÿæˆå·®ç•°åˆ†æå ±è¡¨
- **å›å‚³å€¼**: `{differences: array, changesSummary: object, recommendedAction: string}`

### 2.4 è³‡æ–™é‚„åŸå‡½æ•¸

```javascript
/**
 * 10. ä¸€éµè³‡æ–™é‚„åŸ
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description å¾æŒ‡å®šå‚™ä»½ç‰ˆæœ¬é‚„åŸç”¨æˆ¶è³‡æ–™
 */
function BS_restoreFromBackup(backupId, userId, restoreOptions)
```
- **åŠŸèƒ½**: å®Œæ•´çš„è³‡æ–™é‚„åŸæ©Ÿåˆ¶ï¼Œæ”¯æ´é¸æ“‡æ€§é‚„åŸ
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `BS_downloadFromCloud()` - ä¸‹è¼‰å‚™ä»½æª”æ¡ˆ
  - **MLSæ¨¡çµ„** - é‚„åŸå¸³æœ¬è³‡æ–™
  - **BKæ¨¡çµ„** - é‚„åŸè¨˜å¸³è³‡æ–™
  - **CMæ¨¡çµ„** - é‚„åŸå”ä½œè¨­å®š
- **å›å‚³å€¼**: `{restored: boolean, restoredItems: array, failedItems: array}`

```javascript
/**
 * 11. é©—è­‰é‚„åŸè³‡æ–™å®Œæ•´æ€§
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description é©—è­‰é‚„åŸå¾Œçš„è³‡æ–™å®Œæ•´æ€§å’Œä¸€è‡´æ€§
 */
function BS_validateRestoredData(userId, restoreId, validationLevel)
```
- **åŠŸèƒ½**: å¤šå±¤ç´šè³‡æ–™å®Œæ•´æ€§é©—è­‰
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - **MLSæ¨¡çµ„** - é©—è­‰å¸³æœ¬è³‡æ–™
  - **BKæ¨¡çµ„** - é©—è­‰è¨˜å¸³è³‡æ–™
  - `DL_info()` - è¨˜éŒ„é©—è­‰çµæœ
- **å›å‚³å€¼**: `{valid: boolean, validationReport: object, issues: array}`

### 2.5 å‚™ä»½åŠ å¯†èˆ‡å®‰å…¨å‡½æ•¸

```javascript
/**
 * 12. åŠ å¯†å‚™ä»½è³‡æ–™
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description ä½¿ç”¨AES-256åŠ å¯†å‚™ä»½æª”æ¡ˆ
 */
function BS_encryptBackupData(backupData, userId, encryptionKey)
```
- **åŠŸèƒ½**: è»è¦ç´šå‚™ä»½æª”æ¡ˆåŠ å¯†
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Node.js Crypto - è³‡æ–™åŠ å¯†
  - **AMæ¨¡çµ„** - å–å¾—ç”¨æˆ¶åŠ å¯†é‡‘é‘°
  - `DL_info()` - è¨˜éŒ„åŠ å¯†æ“ä½œ
- **å›å‚³å€¼**: `{encrypted: boolean, encryptedSize: number, encryptionMethod: string}`

```javascript
/**
 * 13. è§£å¯†å‚™ä»½è³‡æ–™
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description è§£å¯†ä¸‹è¼‰çš„å‚™ä»½æª”æ¡ˆ
 */
function BS_decryptBackupData(encryptedData, userId, decryptionKey)
```
- **åŠŸèƒ½**: å‚™ä»½æª”æ¡ˆè§£å¯†èˆ‡é©—è­‰
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Node.js Crypto - è³‡æ–™è§£å¯†
  - **AMæ¨¡çµ„** - é©—è­‰è§£å¯†æ¬Šé™
  - `DL_warning()` - è¨˜éŒ„è§£å¯†å¤±æ•—
- **å›å‚³å€¼**: `{decrypted: boolean, originalSize: number, integrity: boolean}`

### 2.6 éŒ¯èª¤è™•ç†èˆ‡ç›£æ§å‡½æ•¸

```javascript
/**
 * 14. è™•ç†å‚™ä»½ç•°å¸¸
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description çµ±ä¸€è™•ç†å‚™ä»½éç¨‹ä¸­çš„å„ç¨®ç•°å¸¸æƒ…æ³
 */
function BS_handleBackupError(errorType, errorData, operationContext)
```
- **åŠŸèƒ½**: æ¨™æº–åŒ–å‚™ä»½éŒ¯èª¤è™•ç†èˆ‡æ¢å¾©
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `DL_error()` - è¨˜éŒ„è©³ç´°éŒ¯èª¤è³‡è¨Š
  - **LINE OAæ¨¡çµ„** - ç™¼é€éŒ¯èª¤é€šçŸ¥
  - `BS_retryFailedOperation()` - è‡ªå‹•é‡è©¦æ©Ÿåˆ¶
- **å›å‚³å€¼**: `{handled: boolean, errorCode: string, retryAction: string}`

```javascript
/**
 * 15. ç›£æ§å‚™ä»½æœå‹™ç‹€æ…‹
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description å³æ™‚ç›£æ§å‚™ä»½æœå‹™çš„é‹è¡Œç‹€æ…‹å’Œæ•ˆèƒ½
 */
function BS_monitorBackupService()
```
- **åŠŸèƒ½**: å‚™ä»½æœå‹™å¥åº·ç‹€æ…‹ç›£æ§èˆ‡é è­¦
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - Cloud APIs - æª¢æŸ¥é›²ç«¯æœå‹™ç‹€æ…‹
  - **MRAæ¨¡çµ„** - ç”Ÿæˆç›£æ§å ±è¡¨
  - `DL_info()` - è¨˜éŒ„ç›£æ§æ•¸æ“š
- **å›å‚³å€¼**: `{healthy: boolean, activeBackups: number, storageUsage: object}`

```javascript
/**
 * 16. æ¸…ç†éæœŸå‚™ä»½
 * @version 2025-07-07-V1.0.0
 * @date 2025-07-07 14:23:11
 * @description è‡ªå‹•æ¸…ç†è¶…éä¿ç•™æœŸé™çš„å‚™ä»½æª”æ¡ˆ
 */
function BS_cleanupExpiredBackups(retentionPolicy)
```
- **åŠŸèƒ½**: æ™ºæ…§å‚™ä»½ç”Ÿå‘½é€±æœŸç®¡ç†
- **èˆ‡å…¶ä»–æ¨¡çµ„äº’å‹•**:
  - `BS_deleteBackupVersion()` - åˆªé™¤éæœŸå‚™ä»½
  - Cloud APIs - æ¸…ç†é›²ç«¯æª”æ¡ˆ
  - `DL_log()` - è¨˜éŒ„æ¸…ç†æ“ä½œ
- **å›å‚³å€¼**: `{cleaned: boolean, deletedCount: number, freedSpace: number}`

---

## 3.0 æ¨¡çµ„é–“äº’å‹•æ¶æ§‹

### 3.1 æ ¸å¿ƒä¾è³´é—œä¿‚
```
BS å‚™ä»½æœå‹™æ¨¡çµ„
â”œâ”€â”€ MLSæ¨¡çµ„ (Multi-Ledger System)
â”‚   â”œâ”€â”€ MLS_getLedgerData() - å–å¾—å¸³æœ¬è³‡æ–™
â”‚   â””â”€â”€ MLS_restoreLedgerData() - é‚„åŸå¸³æœ¬è³‡æ–™
â”œâ”€â”€ BKæ¨¡çµ„ (Bookkeeping)
â”‚   â”œâ”€â”€ BK_exportBookkeepingData() - åŒ¯å‡ºè¨˜å¸³è³‡æ–™
â”‚   â””â”€â”€ BK_importBookkeepingData() - åŒ¯å…¥è¨˜å¸³è³‡æ–™
â”œâ”€â”€ CMæ¨¡çµ„ (Collaboration Management)
â”‚   â”œâ”€â”€ CM_exportCollaborationSettings() - åŒ¯å‡ºå”ä½œè¨­å®š
â”‚   â””â”€â”€ CM_restoreCollaborationSettings() - é‚„åŸå”ä½œè¨­å®š
â”œâ”€â”€ AMæ¨¡çµ„ (Account Management)
â”‚   â”œâ”€â”€ userProfileManager.js - ç”¨æˆ¶æ¬Šé™é©—è­‰
â”‚   â””â”€â”€ encryptionKeyManager.js - åŠ å¯†é‡‘é‘°ç®¡ç†
â”œâ”€â”€ DLæ¨¡çµ„ (Data Logging)
â”‚   â”œâ”€â”€ DL_log() - ä¸€èˆ¬æ“ä½œæ—¥èªŒ
â”‚   â”œâ”€â”€ DL_error() - éŒ¯èª¤æ—¥èªŒ
â”‚   â””â”€â”€ DL_warning() - è­¦å‘Šæ—¥èªŒ
â”œâ”€â”€ MRAæ¨¡çµ„ (Multi-platform Report & Analytics)
â”‚   â””â”€â”€ reportGenerator.js - å‚™ä»½åˆ†æå ±è¡¨
â”œâ”€â”€ LINE OAæ¨¡çµ„
â”‚   â””â”€â”€ å‚™ä»½ç‹€æ…‹é€šçŸ¥
â””â”€â”€ é›²ç«¯æœå‹™ APIs
    â”œâ”€â”€ Google Drive API - Google é›²ç«¯æ•´åˆ
    â””â”€â”€ OneDrive API - Microsoft é›²ç«¯æ•´åˆ
```

### 3.2 è³‡æ–™æµå‘è¨­è¨ˆ
```
å‚™ä»½è«‹æ±‚ â†’ è³‡æ–™æ”¶é›† â†’ åŠ å¯†å£“ç¸® â†’ é›²ç«¯ä¸Šå‚³ â†’ 
è¨˜éŒ„å»ºç«‹ â†’ é€šçŸ¥ç™¼é€ â†’ ç‹€æ…‹æ›´æ–° â†’ å›æ‡‰ç”¨æˆ¶
```

---

## 4.0 è³‡æ–™åº«æ¶æ§‹è¨­è¨ˆ

### 4.1 Firestore é›†åˆçµæ§‹
```
backups/
â”œâ”€â”€ {backup_id}/
â”‚   â”œâ”€â”€ user_id: string
â”‚   â”œâ”€â”€ backup_type: "manual" | "scheduled" | "auto"
â”‚   â”œâ”€â”€ backup_scope: array
â”‚   â”œâ”€â”€ file_name: string
â”‚   â”œâ”€â”€ file_size: number
â”‚   â”œâ”€â”€ encrypted: boolean
â”‚   â”œâ”€â”€ cloud_providers: array
â”‚   â”œâ”€â”€ cloud_file_ids: object
â”‚   â”œâ”€â”€ created_at: timestamp
â”‚   â”œâ”€â”€ expires_at: timestamp
â”‚   â””â”€â”€ status: "creating" | "completed" | "failed" | "expired"

backup_schedules/
â”œâ”€â”€ {schedule_id}/
â”‚   â”œâ”€â”€ user_id: string
â”‚   â”œâ”€â”€ frequency: "daily" | "weekly" | "monthly"
â”‚   â”œâ”€â”€ backup_scope: array
â”‚   â”œâ”€â”€ cloud_providers: array
â”‚   â”œâ”€â”€ next_execution: timestamp
â”‚   â”œâ”€â”€ last_execution: timestamp
â”‚   â”œâ”€â”€ active: boolean
â”‚   â””â”€â”€ created_at: timestamp

cloud_credentials/
â”œâ”€â”€ {user_id}/
â”‚   â”œâ”€â”€ google_drive: object
â”‚   â”œâ”€â”€ onedrive: object
â”‚   â”œâ”€â”€ encryption_key_hash: string
â”‚   â””â”€â”€ updated_at: timestamp
```

### 4.2 å‚™ä»½æª”æ¡ˆçµæ§‹è¨­è¨ˆ
```javascript
backupArchive: {
  metadata: {
    version: "1.0",
    created_at: timestamp,
    user_id: string,
    backup_id: string,
    compression: "gzip",
    encryption: "AES-256"
  },
  data: {
    ledgers: array,
    bookkeeping: array,
    collaboration: object,
    user_settings: object
  },
  checksum: string
}
```

---

## 5.0 API ä»‹é¢è¦æ ¼

### 5.1 REST API ç«¯é»
```
POST   /api/v2/backup/create               - å»ºç«‹æ‰‹å‹•å‚™ä»½
POST   /api/v2/backup/schedule             - è¨­å®šå‚™ä»½æ’ç¨‹
GET    /api/v2/backup/history              - æŸ¥è©¢å‚™ä»½æ­·å²
DELETE /api/v2/backup/{id}/delete          - åˆªé™¤å‚™ä»½ç‰ˆæœ¬
POST   /api/v2/backup/{id}/restore         - ä¸€éµè³‡æ–™é‚„åŸ
POST   /api/v2/backup/cloud/auth           - è¨­å®šé›²ç«¯èªè­‰
GET    /api/v2/backup/cloud/status         - æŸ¥è©¢é›²ç«¯ç‹€æ…‹
POST   /api/v2/backup/{id}/download        - ä¸‹è¼‰å‚™ä»½æª”æ¡ˆ
```

### 5.2 WebSocket äº‹ä»¶
```javascript
// å³æ™‚å‚™ä»½äº‹ä»¶
'backup:started'        - å‚™ä»½é–‹å§‹
'backup:progress'       - å‚™ä»½é€²åº¦
'backup:completed'      - å‚™ä»½å®Œæˆ
'backup:failed'         - å‚™ä»½å¤±æ•—
'restore:started'       - é‚„åŸé–‹å§‹
'restore:completed'     - é‚„åŸå®Œæˆ
'cloud:upload_progress' - é›²ç«¯ä¸Šå‚³é€²åº¦
```

---

## 6.0 æ•ˆèƒ½èˆ‡æ“´å±•æ€§è€ƒé‡

### 6.1 å‚™ä»½å„ªåŒ–ç­–ç•¥
- å¢é‡å‚™ä»½æ©Ÿåˆ¶
- è³‡æ–™å£“ç¸®æ¼”ç®—æ³•
- ä¸¦è¡Œé›²ç«¯ä¸Šå‚³
- å‚™ä»½æª”æ¡ˆåˆ†ç‰‡è™•ç†

### 6.2 å„²å­˜ç®¡ç†
- è‡ªå‹•éæœŸæ¸…ç†
- é›²ç«¯ç©ºé–“ç›£æ§
- é‡è¤‡è³‡æ–™æ’é™¤
- å‚™ä»½æª”æ¡ˆç´¢å¼•

---

## 7.0 æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| v1.0 | 2025-07-07 14:23:11 +08:00 | AustinLiao69 | åˆç‰ˆå»ºç«‹ï¼Œå®Œæ•´æŠ€è¡“è¨­è¨ˆ |
| v2.0 | 2025-08-02 10:00:00 +08:00 | LCAS SA Team | æ·»åŠ å®Œæ•´ç›®æ¬¡çµæ§‹ï¼Œå„ªåŒ–æ–‡ä»¶çµæ§‹ |

---

**æ–‡ä»¶çµæŸ**
*æ­¤æ–‡ä»¶ç‚º LCAS 2.0 BS å‚™ä»½æœå‹™æ¨¡çµ„çš„å®Œæ•´æŠ€è¡“è¨­è¨ˆè¦æ ¼ï¼Œæ‰€æœ‰å‡½æ•¸è¨­è¨ˆå‡åŸºæ–¼å‚™ä»½éœ€æ±‚ä¸¦æ•´åˆå¤šé›²ç«¯å„²å­˜æ¶æ§‹ã€‚*