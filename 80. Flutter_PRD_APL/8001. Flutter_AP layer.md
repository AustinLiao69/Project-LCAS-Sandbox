
# PRD_Flutter_AP_Layer

**文件編號**: 8001  
**版本**: v1.0.0  
**建立日期**: 2025-09-09  
**建立者**: LCAS PM Team  
**最後更新**: 2025-09-09  

---

## 目次
1. [模組概述](#10-模組概述module-overview)
2. [功能需求](#20-功能需求functional-requirements)
3. [架構設計](#30-架構設計architecture-design)
4. [模組群詳細規格](#40-模組群詳細規格module-groups-specification)
5. [RESTful API 介面](#50-restful-api-介面restful-api-interface)
6. [資料流設計](#60-資料流設計data-flow-design)

---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
Flutter AP layer（應用邏輯層）是 LCAS 2.0 系統的中介層，位於 Presentation Layer 與 Business Layer 之間，負責提供標準化的 RESTful API 介面。作為 Flutter APP 與後端商業邏輯的橋樑，確保前後端分離架構的穩定性與擴展性。

### 1.2 核心價值主張
- **統一介面標準**：提供一致性的 RESTful API 規格
- **四模式支援**：支援 Expert、Inertial、Cultivation、Guiding 四種使用者模式
- **前後端分離**：清晰的職責分工與解耦設計
- **擴展性架構**：支援未來功能擴展與版本升級

### 1.3 目標使用者
- **Flutter APP 開發者**：透過標準化 API 呼叫後端服務
- **Business Layer**：接收 AP layer 請求並處理商業邏輯
- **系統整合人員**：負責 AP layer 與各層級的整合與維護

### 1.4 技術定位
AP layer 採用 RESTful 架構原則，基於 HTTP 協議提供標準化的 API 端點，支援：
- JSON 格式的資料交換
- 統一的錯誤處理機制
- JWT 認證與授權
- 四模式差異化回應

---

## 2.0 功能需求（Functional Requirements）

### 2.1 認證與用戶管理功能
基於8020文件定義的22個端點（認證11個+用戶管理11個），提供：
- **使用者註冊與登入**：Email註冊、Google登入、密碼重設
- **跨平台綁定**：LINE OA與APP帳號綁定
- **模式評估管理**：四模式評估問卷與切換機制
- **個人化設定**：用戶偏好、安全設定、行為追蹤

### 2.2 記帳核心功能
基於8019 User Flow的記帳流程，整合28個API端點：
- **交易管理**：記帳CRUD操作、批次處理、快速記帳
- **帳戶管理**：帳戶建立、餘額查詢、轉帳功能
- **統計分析**：儀表板數據、圖表生成、最近交易
- **附件處理**：圖片上傳、附件管理

### 2.3 協作與管理功能
結合8021 Screen list的管理畫面需求：
- **帳本管理**：個人帳本、協作帳本、權限控制（14個端點）
- **科目管理**：分類樹狀結構、自定義科目（6個端點）
- **預算管理**：預算設定、執行監控、警示（8個端點）
- **協作功能**：多人協作、邀請機制、衝突解決

### 2.4 分析與報表功能
支援四模式差異化的分析需求：
- **報表生成**：動態報表、模板管理、多格式輸出（15個端點）
- **AI助理**：智慧分類、預算建議、異常檢測（6個端點）
- **激勵系統**：成就系統、挑戰機制（6個端點）
- **深度分析**：趨勢分析、洞察報告

### 2.5 系統服務功能
整合系統層級的13個服務端點：
- **系統狀態**：健康檢查、維護狀態、配置管理
- **備份服務**：資料備份、還原、匯出入（6個端點）
- **通知管理**：提醒設定、通知列表（8個端點）
- **幫助支援**：幫助文章、客服聯繫、問題回報

---

## 3.0 架構設計（Architecture Design）

### 3.1 整體架構
Flutter AP layer 採用分層式架構設計，基於8025 API-BL mapping關係：

```
LCAS 2.0 Application Logic Layer Architecture
├── Flutter APP (Presentation Layer)
│   └── HTTP Requests (RESTful API Calls)
├── AP Layer (Application Logic Layer)
│   ├── 認證服務層 (Authentication Services)
│   ├── 核心功能層 (Core Function Services)  
│   ├── 管理服務層 (Management Services)
│   ├── 分析服務層 (Analytics Services)
│   └── 系統服務層 (System Services)
├── Business Layer (Replit Backend)
│   └── 16個Business Logic模組
└── Data Layer (Firebase Firestore)
```

### 3.2 API架構原則
嚴格遵循8088 API設計規範：

#### 3.2.1 RESTful設計標準
- **統一URL格式**：`https://api.lcas.app/v1/{service}/{resource}/{id?}/{action?}`
- **HTTP方法標準**：GET（查詢）、POST（建立）、PUT（更新）、DELETE（刪除）
- **狀態碼規範**：2xx成功、4xx客戶端錯誤、5xx伺服器錯誤

#### 3.2.2 資料格式標準
- **請求格式**：application/json; charset=utf-8
- **回應格式**：統一的success/error結構
- **時間格式**：ISO 8601 UTC時間格式
- **ID命名**：一致性的ID欄位命名規範

#### 3.2.3 四模式支援機制
- **Header識別**：X-User-Mode: Expert|Inertial|Cultivation|Guiding
- **差異化回應**：根據模式調整資料深度與複雜度
- **功能過濾**：進階功能僅在適當模式提供

### 3.3 服務分層設計

#### 3.3.1 認證服務層（Authentication Layer）
- **職責範圍**：用戶認證、授權、跨平台綁定
- **對應BL模組**：AM.js（帳號管理模組）
- **API端點**：22個（/auth/*, /users/*）

#### 3.3.2 核心功能層（Core Function Layer）
- **職責範圍**：記帳交易、帳戶管理、基礎功能
- **對應BL模組**：BK.js、LBK.js
- **API端點**：28個（/transactions/*, /accounts/*）

#### 3.3.3 管理服務層（Management Layer）
- **職責範圍**：帳本、科目、預算、協作管理
- **對應BL模組**：MLS.js、CM.js、BM.js、DD1.js
- **API端點**：28個（/ledgers/*, /categories/*, /budgets/*）

#### 3.3.4 分析服務層（Analytics Layer）
- **職責範圍**：報表生成、AI助理、激勵系統
- **對應BL模組**：MRA.js、DD2.js
- **API端點**：27個（/reports/*, /ai/*, /gamification/*）

#### 3.3.5 系統服務層（System Layer）
- **職責範圍**：系統管理、備份、通知、幫助
- **對應BL模組**：DL.js、FS.js、BS.js、SR.js、GR.js
- **API端點**：27個（/system/*, /backup/*, /notifications/*）

---

**📊 第一階段交付成果**：
✅ 完整文件框架建立  
✅ 模組概述章節完成  
✅ 功能需求整體架構確立  
✅ 基礎架構設計完成  
✅ 132個API端點分層規劃  
✅ 四模式支援機制設計  

**🔄 第一階段狀態**：已完成，等待您的確認後進行第二階段
