
# 9820. 自動化LLD-APL一致性檢查

## 使用方式
請執行以下指令，AI將自動進行完整的一致性檢查：

```
請使用9820檢查工具，對{7201}進行完整的APL一致性檢查
```
---

## 自動化檢查流程

### 階段1：文件結構分析
```
1. 自動讀取目標LLD文件({7201})
2. 提取所有函數定義和參數列表
3. 識別對應的APL服務編號
4. 載入相關的API規格yaml文件
```

### 階段2：API端點對照
```
根據以下映射表自動檢查：
- 7201 ↔ 8101(認證服務), 8102(用戶管理), 8111(系統服務)
- 7202 ↔ 8103(記帳交易), 8106(科目管理), 8105(帳戶管理)
- 7203 ↔ 8104(帳本管理)
- 7204 ↔ 8107(預算管理)
- 7205 ↔ 8108(報表分析), 8109(AI助理)
- 7206 ↔ 8110(激勵系統), 8111(系統服務), 8112(備份管理), 8113(通知管理)

自動執行：
1. 提取LLD中每個函數的參數結構
2. 對照對應APL規格中的RequestBody
3. 逐一比對每個欄位的：
   - 名稱是否一致
   - 資料型別是否匹配
   - 必填屬性是否相符
   - 預設值設定是否對應
```

### 階段3：回應格式檢查
```
自動比對：
1. Response類別定義是否涵蓋APL規格的所有回應欄位
2. 四模式差異化處理是否完整
3. 嵌套物件結構是否正確對應
4. 陣列型別處理是否適當

檢查重點：
- Expert模式：完整資料結構
- Inertial模式：標準資料結構
- Cultivation模式：包含引導資訊
- Guiding模式：簡化資料結構
```

### 階段4：錯誤處理對照
```
根據8088規範自動檢查：
1. 是否涵蓋所有HTTP狀態碼(400,401,403,404,409,422,500)
2. 錯誤回應格式是否符合標準：
   {
     "success": false,
     "error": {
       "code": "ERROR_CODE",
       "message": "錯誤訊息",
       "field": "欄位名稱",
       "timestamp": "ISO時間",
       "requestId": "請求ID"
     }
   }
3. 錯誤碼分類是否正確(VALIDATION_ERROR, BUSINESS_LOGIC_ERROR等)
```

### 階段5：資料型別驗證
```
自動檢查：
1. Dart型別 ↔ YAML型別對應
   - String ↔ string
   - int ↔ integer
   - double ↔ number
   - bool ↔ boolean
   - DateTime ↔ string(format: date-time)
   - List<T> ↔ array
   
2. 必填欄位標記一致性
3. 預設值設定合理性
4. 驗證規則對應性
```

### 階段6：生成檢查報告
```
自動生成報告包含：
1. ✅ 一致性檢查通過項目
2. ❌ 發現的不一致問題
3. ⚠️  潛在風險提醒
4. 📝 建議修正方案

報告格式：
## 檢查結果摘要
- 總檢查項目: XX項
- 通過項目: XX項  
- 失敗項目: XX項
- 警告項目: XX項

## 詳細問題清單
### API參數不一致
1. 函數registerWithEmail()
   - 問題: 缺少confirmPassword參數
   - APL要求: 8101規格POST /auth/register需要confirmPassword
   - 建議: 在RegisterRequest中新增confirmPassword欄位

### 回應格式缺漏
2. 函數loginWithEmail()
   - 問題: LoginResponse未處理四模式差異
   - APL要求: 根據X-User-Mode提供不同資料深度
   - 建議: 新增模式判斷邏輯

### 錯誤處理不完整
3. 全域錯誤處理
   - 問題: 未處理409 Conflict狀態碼
   - APL要求: 8101規格定義需處理帳號重複註冊
   - 建議: 新增DUPLICATE_ACCOUNT錯誤處理
```

### 階段7：自動修正建議
```
AI將提供具體的修正代碼：

例如發現問題：registerWithEmail()缺少confirmPassword參數
AI自動提供修正方案：

class RegisterRequest {
  final String email;
  final String password;
+ final String confirmPassword;  // 新增：與APL規格對應
  final String nickname;
  
  RegisterRequest({
    required this.email, 
    required this.password,
+   required this.confirmPassword,  // 新增：必填參數
    required this.nickname
  });
}
```

---

## 執行範例

**輸入指令**：
```
請使用9820檢查工具，對7201進行完整的APL一致性檢查
```

**AI將自動執行**：
1. 分析72. Flutter_LLD_PL/7201. 系統進入功能群_LLD.md
2. 對照81. Flutter_SRS(API spec)_APL/8101,8102,8111.yaml
3. 逐一檢查40個函數的參數對應性
4. 驗證資料模型一致性
5. 檢查錯誤處理完整性
6. 生成完整檢查報告
7. 提供具體修正建議

**無需你手動比對任何參數或編寫程式！**

---

## 支援的檢查範圍

- ✅ 7201~7206 所有LLD文件
- ✅ 對應的APL規格yaml文件
- ✅ 函數參數結構檢查
- ✅ 資料模型一致性驗證
- ✅ 四模式適配檢查
- ✅ 錯誤處理完整性
- ✅ HTTP狀態碼覆蓋度
- ✅ 資料型別對應檢查
- ✅ 自動修正建議生成

這個工具讓你可以完全不懂程式，只要下一個指令，AI就會自動幫你做完所有細節檢查！
