------------------------------------------
20251027. 執行7571

不要寫code，請根據我的回覆更新提案。現在是MVP階段，提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。
=>我不懂耶，你底下講的7571直接調用PL層，不就是正確的資料流嗎?
7598 → 7571 → PL層 → APL → ASL → BL → Firebase



作為資深SA，我將重新檢查更新後的7571.SIT_P2.dart模組與0098文件規範的合規性。
🔍 最新問題分析與洞察
📋 核心問題清單（更新後檢查）
經過檢查v2.3.0版本的7571模組，發現以下違反0098文件規範的問題：
1. 資料流架構違反（最嚴重）
•	✅ 已修正：移除了直接引入PL層7303、7304模組
•	❌ 仍有問題：在純粹調用測試中仍直接調用PL層函數，未透過APL層



2. 隔層呼叫問題（嚴重）
•	❌ 違反第7條：在_executeBudgetPureCall和_executeCollaborationPureCall中直接調用：
// 直接調用PL層，跳過APL層
plResult = await BudgetManagementFeatureGroup.processBudgetCRUD(...)
plResult = await LedgerCollaborationManager.createLedger(...)
•	正確流向應為：7571 → APL → ASL → BL → Firebase
3. Mock業務邏輯問題（已改善但仍存在）
•	✅ 部分改善：移除了大部分業務邏輯判斷
•	❌ 仍有問題：在P2TestResult.passed getter中仍有業務邏輯判斷
•	❌ 違反第4條：判斷success欄位、檢查error欄位等邏輯應由BL層處理
4. Hard coding問題（大幅改善）
•	✅ 已大幅改善：所有測試資料改從7598.Data warehouse.json載入
•	✅ 符合第3條：移除了固定的測試ID和配置值
💡 Core Insight（更新）
根本問題分析：
雖然v2.3.0版本有顯著改善，但核心架構問題仍然存在：
1.	"純粹調用"的概念誤解：認為直接調用PL層就是純粹調用，但實際上破壞了分層架構
2.	測試策略錯誤：SIT測試應該測試完整的API鏈路，而非繞過API層
3.	0098規範理解偏差：禁止隔層呼叫的規定被忽視
架構風險（持續存在）：
•	SIT P2測試無法驗證APL→ASL→BL的完整鏈路
•	測試通過不代表API端點正常運作
•	違背了SIT測試的根本目的
📋 更新的三階段解決方案
🚀 階段一：修正隔層呼叫違規（緊急修正）
目標： 完全移除違反0098規範的隔層呼叫
版次升級： v2.3.0 → v2.4.0
修正範圍：
1.	移除直接PL層調用
•	將所有BudgetManagementFeatureGroup.xxx改為透過APL.dart調用
•	將所有LedgerCollaborationManager.xxx改為透過APL.dart調用
2.	建立正確的API調用機制
•	使用APL.instance.budget.xxx和APL.instance.ledger.xxx
•	確保資料流向：7571 → APL → ASL → BL → Firebase
3.	移除剩餘的業務邏輯
•	簡化P2TestResult.passed getter邏輯
•	改為純粹檢查API回應狀態
🔧 階段二：完善測試架構（中優先級）
目標： 建立完整的API鏈路測試
版次升級： v2.4.0 → v2.5.0
修正範圍：
1.	統一API測試格式
•	所有測試改為HTTP API調用模式
•	驗證完整的API端點功能
2.	完全依賴7598資料
•	確保100%從7598.Data warehouse.json載入
•	移除任何預設值或備用邏輯
🎯 階段三：驗證合規性（低優先級）
目標： 確保完全合規
版次升級： v2.5.0 → v3.0.0
🎯 修正優先級建議（更新）
立即處理（Critical）：
•	✅ Hard coding清除 - 已完成
•	❌ 隔層呼叫違反 - 仍需立即修正
•	❌ 資料流向違反 - 仍需立即修正
次要處理（High）：
•	❌ 剩餘業務邏輯模擬 - 需要處理
•	✅ 資料依賴 - 已大幅改善
📊 預期成果（更新）
修正前： P2測試成功率40%，仍違反0098文件核心規範（第6、7條）
修正後： P2測試成功率90%+，完全符合0098文件所有規範
關鍵成功指標：
•	❌ 完全移除PL層直接調用 - 仍需處理
•	❌ 建立正確的API測試架構 - 仍需處理
•	✅ 100%依賴7598測試資料 - 已完成
•	❌ 零業務邏輯模擬 - 仍有少量殘留
•	✅ 符合MVP階段簡化原則 - 已改善
________________________________________
總結：雖然v2.3.0版本有顯著改善，特別是在Hard coding和資料依賴方面，但最核心的架構問題（隔層呼叫）仍然存在。建議立即執行階段一修正，確保7571完全符合0098文件規範要求。
