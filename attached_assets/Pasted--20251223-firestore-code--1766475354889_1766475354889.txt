------------------------------------------
20251223. firestore寫入資料量問題

不要寫code，請根據我的回覆更新提案。提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

根據9909 SA文件角色，我將深入分析LCAS專案中平均一筆記帳產生400筆Firestore寫入的問題。
問題分析
1. 問題定義
平均一筆記帳在Firestore的資料寫入筆數達到400筆，這是嚴重的資源浪費問題。正常情況下，一筆記帳應該只需要寫入1-10筆資料。
2. 根本原因分析
經過遍歷專案代碼，我發現造成400筆寫入的主要原因：
A. 重複初始化機制 (類似部門重複開會)
•	1301. BK.js: 每次記帳時都會觸發帳本初始化
=>請用簡單的概念比喻解釋這是什麼意思

•	1309. AM.js: AM_getUserDefaultLedger函數會重複檢查並創建帳本結構
=>請用簡單的概念比喻解釋這是什麼意思

•	1350. WCM.js: 錢包和科目驗證時會觸發大量初始化寫入
=>請用簡單的概念比喻解釋這是什麼意思


B. 日誌記錄過度 (類似每個動作都要簽到)
•	1310. DL.js: 每個操作步驟都會寫入詳細日誌到Firestore
•	1315. LBK.js: 快速記帳過程中產生大量調試日誌
•	1320. WH.js: Webhook處理過程記錄過多中間狀態

C. 狀態追蹤機制 (類似流程每個環節都要蓋章)
•	pendingTransactions: 科目與支付方式歧義消除過程產生多筆狀態記錄
•	metadata: 每個交易記錄都會寫入完整的元數據
=>請用簡單的概念比喻解釋這是什麼意思


D. 帳本結構複製 (類似每次都要複製整個文件櫃)
•	每次記帳都會觸發預設科目、錢包結構的重複寫入
=>請用簡單的概念比喻解釋這是什麼意思

•	0301-0305預設配置檔案會被反覆寫入到使用者帳本
=>請用簡單的概念比喻解釋這是什麼意思

3. 影響範圍
•	成本: Firestore寫入費用大幅增加
•	效能: 記帳回應時間延長
•	配額: 可能觸發Firestore配額限制

解決方案
階段一：移除重複初始化機制
目標: 將每筆記帳的初始化寫入從約150筆降至5筆
修改檔案:
1.	1301. BK.js - 版本升級至 v3.3.4
2.	1309. AM.js - 版本升級至 v2.1.1
3.	1350. WCM.js - 版本升級至 v1.0.2
實施內容:
•	在BK_createTransaction中增加帳本存在檢查，避免重複初始化
•	修改AM_getUserDefaultLedger，只在真正需要時才執行初始化
•	WCM模組改為快取驗證結果，避免重複查詢
Before行為: 每次記帳都會檢查並重新初始化帳本結構
After行為: 只有首次記帳或帳本不存在時才執行初始化

階段二：精簡日誌記錄機制
目標: 將日誌寫入從約200筆降至2筆
修改檔案:
1.	1310. DL.js - 版本升級至 v1.0.2
2.	1315. LBK.js - 版本升級至 v1.9.2
3.	1320. WH.js - 版本升級至 v2.1.10
實施內容:
•	DL模組改為批次寫入，將多個日誌合併為單筆寫入
•	LBK模組移除調試日誌的Firestore寫入，改為console輸出
•	WH模組只記錄關鍵節點，移除中間狀態記錄
Before行為: 每個處理步驟都會立即寫入Firestore日誌
After行為: 只記錄開始和完成兩個關鍵節點

階段三：優化狀態追蹤機制
目標: 將狀態追蹤寫入從約50筆降至3筆
修改檔案:
1.	1315. LBK.js - 針對pendingTransactions邏輯優化
2.	0070. DB schema.md - 更新pendingTransactions結構規範
實施內容:
•	pendingTransactions改為內存處理，只在最終確認時寫入
•	移除中間狀態的Firestore記錄，改為本地狀態管理
•	科目與支付方式歸類改為一次性處理
Before行為: 每個歧義消除步驟都會寫入狀態記錄
After行為: 只在處理開始、用戶選擇、最終完成時寫入
階段四：簡化預設配置機制
目標: 移除預設配置的重複寫入，基本無額外寫入
修改檔案:
1.	03. Default_config資料夾下所有檔案的使用邏輯
2.	相關模組中讀取預設配置的機制
實施內容:
•	預設配置改為啟動時一次性載入到記憶體
•	移除每次記帳時的配置檔案寫入
•	使用快取機制避免重複讀寫
Before行為: 每次記帳都會寫入預設科目和錢包配置
After行為: 預設配置只在記憶體中使用，不重複寫入
預期效果
寫入筆數預期變化:
•	階段一完成後: 400筆 → 250筆 (減少37.5%)
•	階段二完成後: 250筆 → 50筆 (再減少80%)
•	階段三完成後: 50筆 → 15筆 (再減少70%)
•	階段四完成後: 15筆 → 10筆 (再減少33%)
最終目標: 平均每筆記帳的Firestore寫入從400筆降至10筆，減少97.5%的寫入量。
測試驗證點:
•	每個階段完成後執行一次完整記帳流程
•	監控Firestore寫入次數變化
•	確保記帳功能正常運作
請問是否核准此解決方案，我將按階段進行實施？