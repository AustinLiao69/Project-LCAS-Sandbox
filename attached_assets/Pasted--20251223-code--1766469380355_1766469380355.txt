------------------------------------------
20251223.科目與支付方式歸類邏輯一次性互動方案

不要寫code，請根據我的回覆更新提案。提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

根據日誌分析和代碼檢查，我以資深SQA身份提供以下結構化Debug分析報告：
A. 快速摘要（≤3句）
• 支付方式預設值問題：LBK模組在用戶未輸入支付方式時，錯誤使用「刷卡」作為預設值，而非動態查詢用戶輸入的「現金」
• 預設帳戶同義詞缺失：WCM模組建立預設帳戶時，未將對應的同義詞寫入wallets子集合，導致用戶輸入明確支付方式仍觸發歧義消除
=>我已在0302文件的synonyms的三個錢包分別加入了現金、轉帳、信用卡。故此項可以刪除

• 支付方式解析失敗：當用戶明確輸入支付方式時，系統仍觸發歧義消除流程，違反業務邏輯預期
________________________________________
B. Root causes（最多 6 條）
1. Hard coding預設支付方式為「刷卡」
證據：
階段一：解析結果: 科目="洗車", 金額=5555, 支付方式="未指定"
檢測到未知支付方式「刷卡」，請問這屬於何種支付方式
發生機率：100%
根本原因：LBK_parseInputFormat函數中存在Hard coding「刷卡」作為預設值的邏輯，當用戶輸入「洗車5555現金」時，系統錯誤識別為「未指定」，然後使用「刷卡」作為預設值。
簡單概念解釋：就像公司的「訂單系統」在客戶沒有選擇付款方式時，自動設定為「信用卡」，但實際上客戶已經說要用「現金」付款，系統卻沒有正確識別。
解決方案：修正LBK_parseInputFormat函數的支付方式識別邏輯，確保正確提取用戶輸入的「現金」，並移除Hard coding的「刷卡」預設值。
________________________________________
2. 預設帳戶synonyms欄位為空
=>我已在0302文件的synonyms的三個錢包分別加入了現金、轉帳、信用卡。故此項可以刪除

證據：
從WCM模組的預設帳戶建立邏輯和0302配置檔案可見，建立的預設帳戶synonyms欄位為空字串。
發生機率：100%
根本原因：WCM_createWallet函數在建立預設帳戶時，使用0302配置檔案中的synonyms欄位值（為空字串），未預先寫入對應的中文同義詞。
簡單概念解釋：就像公司的「產品目錄系統」建立新產品時，沒有預先設定產品的別名或搜尋關鍵字，導致客戶搜尋時找不到產品。
解決方案：修改WCM_createWallet函數或0302配置檔案，確保預設帳戶建立時自動填入對應的中文同義詞（cash→現金、debit→轉帳、credit→信用卡）。
________________________________________
3. 支付方式解析與驗證邏輯不一致
證據：
階段二：統一錯誤處理解析支付方式: "洗車5555現金"
階段二：使用簡化預設邏輯，返回信用卡
發生機率：75%
根本原因：LBK_parsePaymentMethod和LBK_parseInputFormat函數對於相同輸入有不同的解析結果，造成邏輯不一致。
簡單概念解釋：就像公司有兩個部門「訂單處理部」和「付款處理部」對同一筆訂單的付款方式理解不同，造成處理混亂。
解決方案：統一支付方式解析邏輯，確保所有相關函數對相同輸入有一致的解析結果。

=>請解釋LBK_parsePaymentMethod和LBK_parseInputFormat的功能，這兩個函數是否具有相同功能？以及他們在data flow裡面的位置是什麼？

________________________________________
4. 錢包驗證過程中觸發不必要的歧義消除
證據：
檢測到需要Wallet確認流程: 刷卡，轉入PENDING_WALLET狀態
階段二：觸發Wallet歧義消除流程: 刷卡
發生機率：80%
根本原因：當LBK_validateWalletExists無法找到對應的錢包時，系統觸發歧義消除流程，但實際上是因為synonyms欄位缺失導致的匹配失敗。
簡單概念解釋：就像客戶說要用「現金」付款，但系統找不到「現金」這個選項（因為沒有設定別名），就問客戶「現金是什麼付款方式？」
解決方案：優先解決synonyms欄位問題，避免因為同義詞缺失而觸發不必要的歧義消除流程。
=>我已在0302文件的synonyms的三個錢包分別加入了現金、轉帳、信用卡。故此項可以刪除

________________________________________
5. 階段二統一錯誤處理邏輯問題
證據：
階段二：統一錯誤處理的支付方式解析 - 所有錯誤統一格式化
階段二：簡化邏輯，直接使用信用卡預設值
發生機率：90%
根本原因：階段二的錯誤處理邏輯過度簡化，當遇到解析問題時直接使用「信用卡」作為預設值，而不是正確處理用戶的實際輸入。
簡單概念解釋：就像客服系統遇到問題時，不管客戶說什麼都回答「預設方案」，而不是真正解決客戶的問題。
解決方案：修正階段二邏輯，確保在統一錯誤處理的同時，仍能正確識別和處理用戶的實際輸入。
=>請刪除此項

________________________________________
6. 0302配置檔案與實際需求不匹配
證據：
檢查0302. Default_wallet.json檔案，synonyms欄位均為空字串。
發生機率：100%
根本原因：0302配置檔案設計時未考慮中文使用者的實際需求，沒有預設對應的中文同義詞。
簡單概念解釋：就像公司的「標準作業程序」是用英文寫的，但員工都說中文，造成溝通障礙。
解決方案：修改0302配置檔案，為每個預設帳戶添加對應的中文同義詞，或在WCM模組中動態添加同義詞邏輯。

=>我已在0302文件的synonyms的三個錢包分別加入了現金、轉帳、信用卡。故此項可以刪除

________________________________________
C. 解決方案分階段實施計畫
階段一：修正支付方式解析邏輯
修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js
修改內容：
1.	修正LBK_parseInputFormat函數的支付方式識別邏輯
2.	移除Hard coding的「刷卡」預設值
3.	確保正確提取用戶輸入的支付方式名稱
影響範圍：支付方式解析和預設值設定邏輯
Before/After行為差異：
•	Before：輸入「洗車5555現金」被識別為支付方式「未指定」，預設使用「刷卡」
•	After：輸入「洗車5555現金」正確識別為支付方式「現金」

階段二：修正預設帳戶同義詞設定
修改檔案：
•	03. Default_config/0302. Default_wallet.json
•	13. Replit_Module code_BL/1350. WCM.js
修改內容：
1.	更新0302配置檔案，為預設帳戶添加中文同義詞
2.	或修改WCM_createWallet函數，動態添加同義詞邏輯
影響範圍：預設帳戶建立和同義詞匹配邏輯
Before/After行為差異：
•	Before：預設帳戶synonyms為空，無法匹配中文輸入
•	After：預設帳戶包含中文同義詞，可正確匹配用戶輸入

=>我已在0302文件的synonyms的三個錢包分別加入了現金、轉帳、信用卡。故此項可以刪除

階段三：統一支付方式處理邏輯
修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js
修改內容：
1.	統一LBK_parsePaymentMethod和相關函數的處理邏輯
2.	確保階段二錯誤處理不會覆蓋正確的解析結果
影響範圍：支付方式解析和驗證的整體流程
Before/After行為差異：
•	Before：不同函數對相同輸入可能有不同解析結果
•	After：所有相關函數對相同輸入有一致的解析結果
版本升級計畫：
•	LBK模組：1.9.1 → 1.9.2
•	WCM模組：1.2.0 → 1.2.1
•	0302配置檔案：1.0.1 → 1.0.2