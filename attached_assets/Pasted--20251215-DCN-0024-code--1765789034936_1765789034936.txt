------------------------------------------
20251215. 撰寫DCN-0024

不要寫code，請根據我的回覆更新提案。提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

根據DCN-0024 LINE訊息辨識新科目文件，我以資深SA的角度深入分析此需求並提出實施計畫。
問題分析
主要問題
當前LINE記帳模式缺乏新科目辨識與歸類機制。當使用者輸入系統未知的科目時（如「飯糰28」），LBK模組無法處理，導致記帳失敗。
簡單概念解釋
就像公司新來一個員工不知道該分配到哪個部門，HR需要提供部門選單讓主管選擇一樣。目前LINE記帳遇到新科目就像遇到不知道歸屬部門的新員工，系統直接拒絕，而不是提供科目選單讓使用者歸類。
技術層面問題
1.	LBK模組缺乏新科目處理邏輯：當LBK_identifySubject無法識別科目時，直接返回失敗
2.	缺乏使用者歸類介面：沒有提供10個主科目選項讓使用者選擇
3.	0099文件簡化策略未實作：需要移除複雜的子科目結構，專注主科目分類
解決方案
根據DCN-0024文件的三步驟辨識流程：輸入→識別→歸類，我提出以下階段性實施計畫：
階段一：LBK模組新增新科目辨識機制
目標：在LBK模組中新增當科目識別失敗時的處理邏輯
修改內容：
1.	修改LBK_identifySubject函數，當科目不存在時觸發新科目歸類流程
2.	新增LBK_handleNewSubjectClassification函數處理使用者歸類選擇
3.	新增主科目選單生成與使用者回應處理邏輯
修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js → v1.4.0
Before/After行為差異：
•	Before: 遇到未知科目直接回傳記帳失敗
•	After: 遇到未知科目時回覆科目選單，等待使用者歸類後完成記帳
影響範圍：僅影響LINE記帳流程，不影響其他記帳方式

階段二：WH模組整合新科目歸類流程
目標：修改WH模組以支援兩階段對話（科目歸類 + 記帳確認）
修改內容：
1.	修改WH_processEventAsync支援科目歸類回應處理
2.	新增狀態追蹤機制，記住使用者正在進行科目歸類
3.	整合LBK的新科目歸類結果處理
修改檔案：
•	13. Replit_Module code_BL/1320. WH.js → v2.5.0
Before/After行為差異：
•	Before: 單一輪次記帳對話
•	After: 支援多輪次對話，先歸類科目再確認記帳
影響範圍：影響LINE Webhook處理流程，但不影響已知科目的標準記帳
=>WH只是轉發窗口，科目歸類的功能需要放在1315模組，請更新此份提案，不要修改DCN-0024

階段三：科目資料結構簡化
目標：實施0099文件簡化策略，提供10個主科目選項
修改內容：
1.	在AM模組初始化時使用簡化的科目結構
2.	移除複雜的子科目和大量同義詞
3.	確保新歸類的科目正確儲存到使用者的categories集合
修改檔案：
•	13. Replit_Module code_BL/1309. AM.js → v2.8.0
•	更新科目初始化邏輯以使用簡化結構
Before/After行為差異：
•	Before: 複雜的科目結構，容易造成選擇困惑
•	After: 簡化為10個主科目，降低認知負擔
影響範圍：影響新使用者的科目初始化，不影響現有使用者資料
實施計畫詳細說明
階段一實施細節
1.	新增函數：
•	LBK_handleNewSubjectClassification(inputData, processId)
•	LBK_buildClassificationInterface()
•	LBK_processUserSelection(selection, originalInput, userId)
2.	修改現有函數：
•	LBK_identifySubject：當識別失敗時不直接返回錯誤，而是觸發歸類流程
•	LBK_processQuickBookkeeping：支援兩階段處理邏輯
階段二實施細節
1.	狀態管理：使用NodeCache暫存使用者正在進行的歸類操作
2.	訊息路由：判斷使用者輸入是科目歸類回應(101-107,201,301,000)還是一般記帳輸入
3.	整合點：在WH_processEventAsync中新增科目歸類分支邏輯
階段三實施細節
1.	科目初始化：修改AM模組的AM_initializeUserCategories函數
2.	資料格式：使用DCN-0024定義的簡化格式（categoryId=null, subCategoryName=null, synonyms=""）
3.	歸類儲存：新歸類的科目加入對應主科目的synonyms欄位
版本升級說明
•	LBK.js: v1.3.0 → v1.4.0
•	WH.js: v2.4.0 → v2.5.0
•	AM.js: v2.7.0 → v2.8.0
預期成果
完成後，LINE記帳將支援「飯糰28」→ 系統回覆科目選單 → 使用者選「104」→ 完成記帳並歸類的完整流程，符合DCN-0024文件的設計目標。
請確認此實施計畫是否符合需求，我將等待您的Approve後開始執行代碼修改。

