------------------------------------------
20251002

不要寫code，請根據我的回覆更新提案。現在是MVP階段，提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

根據你的回覆，我以資深PG的角度更新TC-SIT-003專門提案：
🔍 TC-SIT-003問題詳細分析
1. AM模組用戶註冊邏輯不完善的詳細解釋
問題根源：
•	AM_processAPIRegister函數在處理註冊時，可能在用戶ID生成、參數驗證或Firebase操作環節存在邏輯缺陷
•	函數內部的錯誤捕獲機制不夠精確，導致具體錯誤被包裝成通用的"未知錯誤"
•	MVP階段的簡化實作可能跳過了某些關鍵的邊界條件檢查
具體缺陷點：
•	用戶ID生成算法可能產生重複或無效的ID

=>AM需要生成用戶ID嗎？為何要做這個動作？是因為要做SIT嗎？若是如此則必須去調用0692的資料才對，AM是業務邏輯測試代碼

•	Email格式驗證邏輯可能存在漏洞
•	Firebase Auth API調用時的異常處理不完整
•	回應資料結構組裝時可能遺漏必要欄位
2. 回應格式比對分析
AM模組當前回應格式（來自1309. AM.js的AM_processAPIRegister）：
// 成功時
{
  success: true,
  data: userData,
  message: "註冊成功",
  error: null
}
// 失敗時  
{
  success: false,
  data: null,
  message: "系統錯誤，請稍後再試",
  error: {
    code: "SYSTEM_ERROR", 
    message: "系統錯誤，請稍後再試",
    details: { error: error.message }
  }
}
0603 SIT測試期望格式（來自testCase003函數）：
// 驗證邏輯要求
response.success === true &&
response.data?.success === true &&  // 雙層success檢查
response.data?.data?.userId &&      // 巢狀data結構
response.data?.data?.email === testUser.email &&
response.data?.data?.userMode === testUser.mode
DCN-0015標準格式：
{
  success: boolean,
  data: object | null,
  error: null | object,
  message: string,
  metadata: {
    timestamp: string,
    requestId: string, 
    userMode: string,
    apiVersion: string,
    processingTimeMs: number,
    modeFeatures: object
  }
}
不符合問題：
1.	AM模組缺少metadata欄位，不符合DCN-0015完整標準
2.	SIT測試期望雙層success和巢狀data結構，但AM模組只提供單層
3.	用戶模式（userMode）欄位命名可能不一致
3. 錯誤處理不夠詳細的解釋
當前問題：
•	所有異常都被包裝成通用的"系統錯誤，請稍後再試"
•	錯誤代碼統一為"SYSTEM_ERROR"，無法區分具體問題類型
•	缺少針對註冊流程特有錯誤的分類處理
具體改善需求：
•	區分參數驗證錯誤、重複註冊錯誤、Firebase連線錯誤等
•	提供具體的錯誤代碼如"INVALID_EMAIL_FORMAT"、"EMAIL_ALREADY_EXISTS"
•	在MVP階段至少要能識別用戶可操作的錯誤類型
🎯 更新後的二階段解決方案
階段一：修復AM_processAPIRegister函數 (15分鐘)
目標: 解決TC-SIT-003中的用戶註冊失敗問題
範圍: 1309. AM.js的註冊函數
具體修復:
1.	強化參數驗證：增加Email格式、密碼複雜度檢查
2.	修復用戶ID生成：使用更穩定的ID生成算法，避免衝突
3.	完整DCN-0015格式：補齊metadata欄位，確保回應結構100%符合標準
4.	細化錯誤分類：區分INVALID_EMAIL_FORMAT、EMAIL_ALREADY_EXISTS、SYSTEM_ERROR等具體錯誤類型
5.	升級模組版本：升級至v3.0.4並記錄修復內容
階段二：優化SIT測試驗證邏輯 (10分鐘)
目標: 提升TC-SIT-003的驗證準確性
範圍: 0603. SIT_TC_P1.js的testCase003函數
具體修復:
1.	調整驗證條件：修正雙層success檢查邏輯，適配AM模組實際回應格式
2.	改善錯誤捕獲：增加具體錯誤訊息顯示，避免"未知錯誤"
3.	強化回應驗證：檢查DCN-0015 metadata欄位完整性
4.	升級測試版本：升級至v2.5.1並更新測試邏輯
⚡ 預期效果
•	TC-SIT-003通過率：從66.7%提升至100%
•	錯誤訊息品質：從"未知錯誤"改善為具體可操作的錯誤提示
•	格式標準化：確保AM模組100%符合DCN-0015統一回應格式
•	MVP穩定性：專注解決當前問題，為後續開發奠定穩固基礎

