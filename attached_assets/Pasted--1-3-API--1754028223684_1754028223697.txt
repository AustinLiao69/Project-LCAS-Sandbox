
### 1.3 目標使用者
- **展示層開發者**: 透過標準化 API 存取業務功能
- **應用邏輯層**: 整合多個業務模組提供複合功能
- **系統維護人員**: 進行業務邏輯維護和效能優化
- **第三方整合**: 透過 API 介面整合外部系統
=>並沒有第三方整合


### 2.1 整體架構
Business Layer 採用模組化架構，包含核心模組群、共用模組群和支援模組群：

```
LCAS 2.0 Business Layer Architecture
├── 核心業務模組群 (Core Business Modules)
│   ├── BK.js v2.1.0 - 記帳核心模組
│   ├── AM.js v1.1.0 - 帳號管理模組
│   ├── MLS.js v2.1.0 - 多帳本管理模組
│   ├── BM.js v1.1.0 - 預算管理模組
│   └── CM.js v1.1.0 - 協作管理模組
├── 進階功能模組群 (Advanced Feature Modules)
│   ├── SR.js v2.1.0 - 排程提醒模組
│   ├── MRA.js v1.1.0 - 報表分析模組
│   ├── BS.js v1.1.0 - 備份服務模組
│   └── LBK.js v1.1.0 - 快速記帳模組
├── 介面處理模組群 (Interface Modules)
│   ├── WH.js v2.2.0 - Webhook處理模組
│   ├── DD1.js v2.1.0 - 核心協調模組
│   ├── DD2.js v2.1.0 - 智慧處理模組
│   └── DD3.js v1.1.0 - 資料服務模組
├── 系統支援模組群 (System Support Modules)
│   ├── FS.js v1.1.0 - Firestore操作模組
│   ├── DL.js v1.1.0 - 診斷日誌模組
│   ├── GR.js v1.1.0 - 通用工具模組
│   └── firebase-config.js v1.1.0 - Firebase配置模組
└── API 基礎設施模組群 (API Infrastructure Modules) - 新增
    ├── api-gateway.js v1.0.0 - API閘道模組
    ├── direct-router.js v1.0.0 - 直接路由模組
    ├── auth-middleware.js v1.0.0 - 認證中介軟體
    └── error-handler.js v1.0.0 - 錯誤處理模組

### 2.2 模組分層關係

#### 2.2.1 核心層 (Core Layer)
- **BK 記帳核心模組**: 所有記帳功能的基礎
- **AM 帳號管理模組**: 使用者身份和權限管理
- **FS Firestore模組**: 資料存取的統一介面

#### 2.2.2 業務層 (Business Layer)
- **MLS 多帳本管理**: 複雜帳本結構管理
- **BM 預算管理**: 預算設定和監控
- **CM 協作管理**: 多人協作和權限控制
- **SR 排程提醒**: 自動化任務和提醒

#### 2.2.3 介面層 (Interface Layer)
- **WH Webhook處理**: LINE OA 介面處理
- **DD 系列模組**: 智慧處理和資料協調
- **API 基礎設施**: RESTful API 支援

=>整體架構請參閱如下，請勿自創模組

3.4 商業邏輯層 (Business Logic Layer)：Replit 模組群
3.4.1 LINE OA模組群（LINE OA module group）
WH模組接收來自 LINE 平台的 Webhook 請求
分析使用者指令（如記帳、查帳、統計）
呼叫共用模組群進行 Firestore 資料處理
將結果回覆給 LINE 使用者
技術堆疊：Node.js + Express + Firebase Admin SDK
3.4.2 APP模組群（APP module group）
實作應用邏輯層定義的 RESTful API 端點
驗證 Firebase Token 或 JWT，確保身份安全
呼叫共用模組群讀寫 Firestore 資料
回傳標準化 JSON 結果給前端 App
技術堆疊：Node.js + Express + Firebase SDK
3.4.3 共用模組群（Shared module group）
負責管理 Firestore 資料邏輯與共用工具
包含資料模型（User、Ledger、GroupLedger、Notification 等）
提供日期處理、金額格式轉換、分類解析等工具方法
被 LINE OA模組群 和 APP模組群 引用與共用