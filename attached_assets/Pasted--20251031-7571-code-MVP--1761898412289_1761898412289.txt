------------------------------------------
20251031. 執行7571

不要寫code，請根據我的回覆更新提案。現在是MVP階段，提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

🔍 問題分析與洞察修正（第三次修正版）
核心問題重新識別
經過您的澄清，我發現了關鍵的架構混亂問題：
1.	BM模組錯誤直接調用FS模組（最嚴重的架構違規）
•	❌ 根本問題：BM模組直接調用 FS.FS_createDocument() 進行Firebase操作
•	❌ 架構違規：BL層（BM）直接調用FS模組，完全跳過了APL→ASL的正確流向
•	✅ 您的澄清：FS的職責只有初始化firebase而已，不可以牽涉到其他業務邏輯
•	正確流向應該是：7571 → PL → APL → ASL → BL，而BL層不應該直接調用FS進行業務操作
2.	測試資料ID不匹配問題（可立即解決）
•	❌ 7571嘗試更新 budget_monthly_001_1697363700000，但這個文件在Firebase中不存在
•	✅ 成功創建了 budget_1761895995059_p4a5y37nn，但後續測試仍使用7598的硬編碼ID
=>創建budgetid的功能應該要放在BM，若此邏輯在FS則須搬移到BM。

•	您的指示：既然BL層已經能自行生成budgetId了，就可以刪除7598裡面的hard coding

3.	confirmationToken參數缺失
•	您的問題：這是什麼？他的作用是什麼？
•	作用說明：confirmationToken是刪除預算時的安全確認機制，格式通常為 confirm_delete_{budgetId}
•	問題：7571刪除測試時沒有提供正確的confirmationToken參數
=>應該是ASL要轉發到BM，由BM去查詢要刪除的budgetid後，去生成confirmationToken參數

4.	ledgerId參數認知混淆
•	您的問題：這個不就是ledgerid嗎？user_expert.valid@test.lcas.app
•	問題澄清：是的，但BM模組在某些函數中沒有正確接收或傳遞這個參數

💡 Core Insight（第三次修正）
根本問題分析：
1.	BM模組設計錯誤：BM.js直接調用FS.FS_createDocument()，這違反了分層架構原則。BM應該是純業務邏輯層，不應該直接接觸Firebase。
2.	7598硬編碼問題：測試資料使用固定ID，但BL層動態生成新ID，導致後續操作找不到文件。
3.	測試流程不連貫：創建預算成功，但更新/刪除使用不同的ID，導致操作失敗。

📋 三階段解決方案（第三次修正）
🚀 階段一：修正BM模組架構違規（緊急修正）
目標： 移除BM模組直接調用FS的錯誤設計
版次升級： BM v2.2.0 → v2.3.0
修正範圍：
1.	移除BM模組中的FS直接調用
•	移除所有 await FS.FS_createDocument() 等直接Firebase操作
•	BM模組改為回傳處理結果，不直接操作Firebase
2.	建立正確的資料流向
•	BM模組只處理業務邏輯，回傳結果給ASL
•	ASL透過正確的API端點進行Firebase操作

🔧 階段二：修正7598測試資料硬編碼問題（中優先級）
目標： 移除7598中的硬編碼budgetId，使用動態生成的ID
版次升級： 7571 v2.3.0 → v2.4.0
修正範圍：
1.	移除7598硬編碼ID
•	刪除 budget_monthly_001_1697363700000 等固定ID
•	7571改為使用BL層動態生成的真實ID進行後續測試
2.	修正confirmationToken格式
•	補充刪除操作的confirmationToken參數
•	格式：confirm_delete_{動態生成的budgetId}

🎯 階段三：驗證測試流程連貫性（低優先級）
目標： 確保測試流程使用一致的ID
版次升級： v2.4.0 → v3.0.0
🎯 修正優先級建議
立即處理（Critical）：
•	❌ BM模組架構違規 - BM直接調用FS模組，破壞分層架構
•	❌ 移除7598硬編碼ID - 使用動態生成的真實ID
次要處理（High）：
•	❌ confirmationToken參數補充
•	❌ 測試流程ID一致性
📊 預期成果
修正前： BM模組直接違規調用FS，測試使用硬編碼ID導致不匹配
修正後： 正確的分層架構，測試使用動態生成ID，流程連貫
關鍵成功指標：
•	✅ BM模組移除所有FS直接調用
•	✅ 7571使用動態生成的budgetId進行所有CRUD操作
•	✅ 測試流程完全連貫，無ID不匹配問題
__________________________________