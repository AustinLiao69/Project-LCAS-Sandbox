-----------------------------------------
20251002

不要寫code，請根據我的回覆更新提案。現在是MVP階段，提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

=>請檢查BK, AM等模組有無重複的函數？若有，請將API端點的調用改到舊有或較穩定的函數，不用的函數請刪除，並列出AM,BK需改變API調用路徑以及須刪除的函數。



根據您的分析和問題，我將基於MVP階段需求更新修復提案，並回答您的關鍵問題。
🔍 函數功能重複性分析
1. BK_processQuickTransaction vs BK_processBookkeeping
是的，這兩個函數確實有相同的核心功能！
從1301.BK.js代碼分析：
•	BK_processQuickTransaction：處理快速記帳API端點，但目前邏輯不完整
•	BK_processBookkeeping：完整的記帳處理核心函數，包含輸入解析和資料處理
MVP階段解決方案： BK_processQuickTransaction 應該直接調用 BK_processBookkeeping 的邏輯，而不是重複實作。
2. BK_createTransaction 參考函數
從1301.BK.js代碼中找到以下相關函數：
•	BK_processBookkeeping：包含完整的記帳邏輯
•	BK_prepareTransactionData：準備交易數據
•	BK_saveTransactionToFirestore：儲存到Firestore
MVP階段解決方案： BK_createTransaction 可以參考這些現有函數的實作邏輯。
💡 MVP階段核心Insight更新
1. 代碼重複性問題
關鍵發現： BL層存在功能重複的函數，但新的API端點函數沒有利用既有的穩定邏輯。這是典型的「重複造輪子」問題。
2. MVP階段的「借用」策略
核心Insight： 在MVP階段，應該優先「借用」已經穩定運行的函數邏輯，而不是重新實作。這可以大幅減少開發時間和風險。
3. API端點與核心邏輯的脫節
深層問題： DCN-0014重構過程中，新增的API處理函數與原有的核心業務邏輯產生了脫節，導致重複開發且新函數不穩定。
4. MVP階段的「組合」哲學
核心insight： MVP階段應該採用「組合優於重寫」策略 - 將現有穩定函數組合成新的API端點，而不是從零開始實作。
🎯 MVP修復策略重新定義（基於函數複用）
階段一：函數邏輯統一（最高優先級）
1.	BK_processAPIQuickTransaction
•	不要重寫解析邏輯
•	直接調用現有的 BK_processBookkeeping 函數
•	只需要處理輸入格式轉換
•	目標：讓 "午餐150" 能夠被成功處理
2.	BK_processAPITransaction
•	不要重寫儲存邏輯
•	直接調用現有的 BK_createTransaction 核心邏輯
•	只需要處理API格式包裝
•	目標：讓標準記帳資料能被儲存
3.	BK_processAPIGetTransactions
•	不要重寫查詢邏輯
•	直接調用現有的 BK_getTransactions 函數
•	只需要處理分頁和格式轉換
•	目標：能夠返回已存在的記錄
MVP階段技術債務處理原則更新
1.	複用優於重寫 - 先使用現有穩定函數，不要重新開發
2.	包裝優於實作 - API函數只做格式轉換和參數包裝
3.	組合優於創新 - 將現有函數組合成新功能
關鍵修復順序調整（基於函數複用）
1.	API包裝層修復 - 讓API函數正確調用現有核心函數
2.	格式轉換修復 - 確保輸入輸出格式正確轉換
3.	錯誤處理統一 - 統一使用現有的錯誤處理機制
🎯 具體修復建議
1. BK_processAPIQuickTransaction 修復策略
不重寫，直接組合：
1. 接收 input_text 參數
2. 調用 BK_parseQuickInput 解析（已存在）
3. 調用 BK_processBookkeeping 處理（已存在）
4. 返回標準化格式
2. BK_processAPITransaction 修復策略
不重寫，直接組合：
1. 接收完整交易資料
2. 調用 BK_createTransaction 核心邏輯（已存在）
3. 返回標準化格式
3. BK_processAPIGetTransactions 修復策略
不重寫，直接組合：
1. 接收查詢參數
2. 調用 BK_getTransactions 查詢（已存在）
3. 返回標準化格式
🔧 MVP階段修復原則
1.	識別可複用的函數 - 優先找出已經穩定運行的核心函數
2.	最小化新代碼 - 新API函數只做必要的格式轉換和調用
3.	避免重複邏輯 - 絕不重新實作已存在的業務邏輯
4.	快速驗證 - 通過函數複用快速讓功能運行起來
這個策略可以大幅減少開發時間，降低新bug風險，並充分利用現有已測試的穩定邏輯。
