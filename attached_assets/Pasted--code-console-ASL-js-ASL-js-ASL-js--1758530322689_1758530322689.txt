ä¸è¦å¯«codeï¼Œè«‹æ ¹æ“šæˆ‘çš„å›è¦†æ›´æ–°ææ¡ˆ



æ ¹æ“šæ‚¨æä¾›çš„consoleè¼¸å‡ºå’ŒASL.jsä»£ç¢¼åˆ†æï¼Œæˆ‘ä¾†è©³ç´°è§£é‡‹ASL.jsè½‰ç™¼æ©Ÿåˆ¶çš„æŠ€è¡“å•é¡Œå’Œè§£æ±ºæ–¹æ¡ˆï¼š
ğŸ” ASL.jsè½‰ç™¼æ©Ÿåˆ¶å•é¡Œåˆ†æ
1. BLå±¤å‡½æ•¸èª¿ç”¨æ©Ÿåˆ¶å•é¡Œ
æ ¸å¿ƒå•é¡Œï¼š
å¾consoleè¼¸å‡ºå¯ä»¥çœ‹åˆ°ï¼ŒASL.jsèƒ½å¤ æˆåŠŸè½‰ç™¼APIè«‹æ±‚ï¼Œä½†BLå±¤å‡½æ•¸èª¿ç”¨å­˜åœ¨ä»¥ä¸‹å•é¡Œï¼š
1.1 AMæ¨¡çµ„å‡½æ•¸ç¼ºå¤±å•é¡Œ
âŒ éŒ¯èª¤ç¾è±¡ï¼š
AM_validateQueryPermission is not defined
ğŸ” æ ¹æœ¬åŸå› ï¼š
- AM.jsæ¨¡çµ„ä¸­ç¼ºå°‘ AM_validateQueryPermission å‡½æ•¸
- AM_processAPIGetProfile å‡½æ•¸å…§éƒ¨èª¿ç”¨äº†ä¸å­˜åœ¨çš„é©—è­‰å‡½æ•¸
=>æˆ‘æŸ¥äº†ä¸¦æ²’æœ‰ç¼ºå°‘AM_validateQueryPermissionï¼Œè«‹é‡æ–°æª¢æŸ¥1309ä»£ç¢¼




- å°è‡´ç”¨æˆ¶è³‡æ–™æŸ¥è©¢åŠŸèƒ½ç•°å¸¸
1.2 BKæ¨¡çµ„è·¯ç”±éŒ¯èª¤
âŒ éŒ¯èª¤ç¾è±¡ï¼š
GET /api/v1/transactions/dashboard è¢«è·¯ç”±åˆ° BK_processAPIGetTransactionDetail
ğŸ” æ ¹æœ¬åŸå› ï¼š
- ASL.jsè·¯ç”±é…ç½®éŒ¯èª¤ï¼Œdashboardç«¯é»æ‡‰è©²è·¯ç”±åˆ° BK_processAPIGetDashboard
- ç•¶å‰éŒ¯èª¤åœ°è·¯ç”±åˆ°äº¤æ˜“è©³æƒ…å‡½æ•¸
- é€ æˆAPIåŠŸèƒ½ä¸åŒ¹é…
2. APIç«¯é»è½‰ç™¼é‚è¼¯å•é¡Œ
è½‰ç™¼æµç¨‹åˆ†æï¼š
æ­£ç¢ºæµç¨‹ï¼š
Client Request â†’ ASL.js â†’ è·¯ç”±åŒ¹é… â†’ BLå‡½æ•¸èª¿ç”¨ â†’ å›æ‡‰
å¯¦éš›å•é¡Œï¼š
1. è·¯ç”±åŒ¹é…éŒ¯èª¤ï¼ˆdashboard â†’ detailå‡½æ•¸ï¼‰
2. å‡½æ•¸å­˜åœ¨æ€§æª¢æŸ¥å¤±æ•ˆ
3. éŒ¯èª¤è™•ç†ä¸å®Œå–„
2.1 è·¯ç”±é…ç½®éŒ¯èª¤
å¾ä»£ç¢¼å¯ä»¥çœ‹å‡ºï¼š
â€¢	/api/v1/transactions/dashboard æ‡‰è©²èª¿ç”¨ BK_processAPIGetDashboard
â€¢	ä½†å¯¦éš›è¢«è·¯ç”±åˆ° BK_processAPIGetTransactionDetail
â€¢	é€™æ˜¯å› ç‚ºè·¯ç”±é †åºå’ŒåŒ¹é…è¦å‰‡çš„å•é¡Œ
2.2 å‡½æ•¸å­˜åœ¨æ€§æª¢æŸ¥å¤±æ•ˆ
// ç•¶å‰æª¢æŸ¥é‚è¼¯å­˜åœ¨å•é¡Œ
if (!BK || typeof BK.BK_processAPIGetDashboard !== 'function') {
  return res.apiError('å‡½æ•¸ä¸å­˜åœ¨', 'FUNCTION_NOT_FOUND', 503);
}
3. çµ±ä¸€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ç¼ºå¤±
å•é¡Œç¾è±¡ï¼š
âŒ ä¸ä¸€è‡´çš„éŒ¯èª¤æ ¼å¼ï¼š
1. DL_logéŒ¯èª¤: ç¼ºå°‘å¿…è¦åƒæ•¸ message
2. AM_validateQueryPermission is not defined
3. éƒ¨åˆ†éŒ¯èª¤æœ‰å®Œæ•´å †ç–Šï¼Œéƒ¨åˆ†æ²’æœ‰
3.1 éŒ¯èª¤è™•ç†å±¤ç´šæ··äº‚
â€¢	ASLå±¤ï¼šä½¿ç”¨ res.apiError() æ ¼å¼
â€¢	BLå±¤ï¼šå„æ¨¡çµ„è‡ªå®šç¾©éŒ¯èª¤æ ¼å¼
â€¢	DLå±¤ï¼šæ—¥èªŒéŒ¯èª¤èˆ‡æ¥­å‹™éŒ¯èª¤æ··åˆ
3.2 éŒ¯èª¤è³‡è¨Šä¸å®Œæ•´
â€¢	ç¼ºä¹çµ±ä¸€çš„éŒ¯èª¤ä»£ç¢¼é«”ç³»
â€¢	éŒ¯èª¤è¿½è¹¤IDä¸ä¸€è‡´
â€¢	ç”¨æˆ¶å‹å–„è¨Šæ¯ç¼ºå¤±
ğŸ› ï¸ è§£æ±ºæ–¹æ¡ˆæ¶æ§‹
éšæ®µä¸€ï¼šè·¯ç”±ä¿®å¾©ï¼ˆç«‹å³ä¿®å¾©ï¼‰
1.1 ä¿®å¾©dashboardç«¯é»è·¯ç”±
å•é¡Œï¼š/api/v1/transactions/dashboard éŒ¯èª¤è·¯ç”±åˆ°è©³æƒ…å‡½æ•¸
è§£æ±ºï¼šèª¿æ•´ASL.jsä¸­çš„è·¯ç”±é †åºï¼Œç¢ºä¿dashboardè·¯ç”±åœ¨å‹•æ…‹è·¯ç”±ä¹‹å‰
1.2 è£œå……ç¼ºå¤±çš„AMæ¨¡çµ„å‡½æ•¸
å•é¡Œï¼šAM_validateQueryPermission å‡½æ•¸ä¸å­˜åœ¨
è§£æ±ºï¼šåœ¨AM.jsä¸­å¯¦ä½œç¼ºå¤±çš„æ¬Šé™é©—è­‰å‡½æ•¸
éšæ®µäºŒï¼šè½‰ç™¼æ©Ÿåˆ¶æ¨™æº–åŒ–
2.1 çµ±ä¸€å‡½æ•¸èª¿ç”¨æ¨¡å¼
// æ¨™æº–åŒ–çš„è½‰ç™¼æ¨¡å¼
async function callBLFunction(moduleName, functionName, requestData, res) {
  try {
    // 1. æ¨¡çµ„å­˜åœ¨æ€§æª¢æŸ¥
    if (!modules[moduleName]) {
      return handleModuleError(moduleName, res);
    }
    
    // 2. å‡½æ•¸å­˜åœ¨æ€§æª¢æŸ¥
    if (typeof modules[moduleName][functionName] !== 'function') {
      return handleFunctionError(moduleName, functionName, res);
    }
    
    // 3. åŸ·è¡Œå‡½æ•¸èª¿ç”¨
    const result = await modules[moduleName][functionName](requestData);
    
    // 4. çµ±ä¸€å›æ‡‰è™•ç†
    return handleBLResponse(result, res);
    
  } catch (error) {
    // 5. çµ±ä¸€éŒ¯èª¤è™•ç†
    return handleBLError(error, moduleName, functionName, res);
  }
}
2.2 å¼·åŒ–è·¯ç”±åŒ¹é…æ©Ÿåˆ¶
// è·¯ç”±å„ªå…ˆç´šç®¡ç†
const routePriorities = {
  exact: ['/api/v1/transactions/dashboard', '/api/v1/transactions/quick'],
  parameterized: ['/api/v1/transactions/:id'],
  wildcard: ['/api/v1/transactions/*']
};
éšæ®µä¸‰ï¼šçµ±ä¸€éŒ¯èª¤è™•ç†å¯¦ä½œ
3.1 å»ºç«‹éŒ¯èª¤ä»£ç¢¼é«”ç³»
const ERROR_CODES = {
  // æ¨¡çµ„éŒ¯èª¤
  MODULE_NOT_FOUND: 'MOD_001',
  FUNCTION_NOT_FOUND: 'MOD_002',
  
  // æ¥­å‹™é‚è¼¯éŒ¯èª¤
  VALIDATION_ERROR: 'BL_001',
  PERMISSION_DENIED: 'BL_002',
  
  // ç³»çµ±éŒ¯èª¤
  INTERNAL_ERROR: 'SYS_001',
  DATABASE_ERROR: 'SYS_002'
};
3.2 å¯¦ä½œçµ±ä¸€éŒ¯èª¤è™•ç†å™¨
function handleUnifiedError(error, context) {
  const errorResponse = {
    success: false,
    timestamp: new Date().toISOString(),
    requestId: context.requestId,
    errorCode: mapErrorCode(error),
    message: getUserFriendlyMessage(error),
    details: process.env.NODE_ENV === 'development' ? error.stack : null
  };
  
  // è¨˜éŒ„åˆ°DLç³»çµ±
  logToErrorSystem(error, context);
  
  return errorResponse;
}
ğŸ“Š ä¿®å¾©å„ªå…ˆç´šèˆ‡é æœŸæ•ˆæœ
é«˜å„ªå…ˆç´šä¿®å¾©ï¼ˆç«‹å³åŸ·è¡Œï¼‰
1.	dashboardè·¯ç”±ä¿®å¾© - è§£æ±ºAPIåŠŸèƒ½éŒ¯èª¤
2.	AMæ¬Šé™å‡½æ•¸è£œå…… - ä¿®å¾©ç”¨æˆ¶è³‡æ–™æŸ¥è©¢
3.	åŸºç¤éŒ¯èª¤è™•ç† - æå‡ç³»çµ±ç©©å®šæ€§
ä¸­å„ªå…ˆç´šä¿®å¾©ï¼ˆ1-2å¤©å…§ï¼‰
1.	å‡½æ•¸èª¿ç”¨æ¨™æº–åŒ– - çµ±ä¸€è½‰ç™¼æ©Ÿåˆ¶
2.	è·¯ç”±åŒ¹é…å„ªåŒ– - é¿å…è·¯ç”±è¡çª
3.	éŒ¯èª¤è¿½è¹¤å®Œå–„ - æå‡é™¤éŒ¯æ•ˆç‡
é æœŸä¿®å¾©æ•ˆæœ
â€¢	APIæˆåŠŸç‡ï¼šå¾ç•¶å‰çš„éƒ¨åˆ†å¤±æ•—æå‡è‡³95%+
â€¢	éŒ¯èª¤è¿½è¹¤ï¼šçµ±ä¸€çš„éŒ¯èª¤æ ¼å¼å’Œè¿½è¹¤ID
â€¢	ç¶­è­·æ•ˆç‡ï¼šæ¨™æº–åŒ–çš„è½‰ç™¼æ©Ÿåˆ¶ï¼Œä¾¿æ–¼å¾ŒçºŒç¶­è­·
â€¢	ç³»çµ±ç©©å®šæ€§ï¼šå®Œå–„çš„éŒ¯èª¤è™•ç†ï¼Œé¿å…ç³»çµ±å´©æ½°
é€™äº›ä¿®å¾©å°‡ç¢ºä¿ASL.jsçœŸæ­£ç™¼æ®ã€Œç´”è½‰ç™¼çª—å£ã€çš„ä½œç”¨ï¼Œå¯¦ç¾PLâ†’APLâ†’BLâ†’DLçš„å®Œæ•´å››å±¤æ¶æ§‹ä¸²æ¥ã€‚

 	
