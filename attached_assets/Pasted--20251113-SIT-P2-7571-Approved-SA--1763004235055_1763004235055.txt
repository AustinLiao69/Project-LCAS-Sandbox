------------------------------------------
20251113. é€šéSIT_P2(7571)_å”ä½œåŠŸèƒ½

Approvedè«‹é€²è¡Œéšæ®µä¸€


æ ¹æ“šæ‚¨çš„SAåˆ†æï¼Œæˆ‘ä¾†æª¢æŸ¥ä¸¦æ›´æ–°ææ¡ˆã€‚è®“æˆ‘å…ˆæª¢æŸ¥7598æ¸¬è©¦è³‡æ–™å’Œ7303æ¨¡çµ„çš„ç¾ç‹€ï¼š
ğŸ” éšæ®µäºŒï¼š7598æ¸¬è©¦è³‡æ–™æª¢æŸ¥çµæœ
æª¢æŸ¥7598. Data warehouse.jsonå¾Œç™¼ç¾ï¼š
âœ… å·²æœ‰collaboration.test@test.lcas.appï¼š
"collaboration_test_user": {
  "userId": "user_collaboration_test_1697363500000",
  "email": "collaboration.test@test.lcas.app",
  "displayName": "å”ä½œæ¸¬è©¦ç”¨æˆ¶"
}
âŒ ç¼ºå°‘æ¬Šé™è§’è‰²æ¸¬è©¦è³‡æ–™ï¼š
ç›®å‰7598æ²’æœ‰collaboration_test_roleså€å¡Šï¼Œéœ€è¦æ–°å¢ã€‚
ğŸ” 1311.FS.jsè³‡æ–™æ¬„ä½è¦ç¯„æª¢æŸ¥
æª¢æŸ¥1311. FS.jså¾Œï¼Œç¢ºèªæ¬Šé™è³‡æ–™çµæ§‹æ‡‰ç¬¦åˆFirebaseè¦ç¯„ï¼š
â€¢	æ¬Šé™è³‡æ–™æ‡‰ç‚ºbooleanæˆ–objectæ ¼å¼
â€¢	éœ€è¦åŒ…å«æ™‚é–“æˆ³è¨˜éŒ„
â€¢	ç¬¦åˆæ—¢æœ‰çš„PermissionDataçµæ§‹

ğŸ” 7303æ¨¡çµ„PLå±¤å›æ‡‰èƒ½åŠ›æª¢æŸ¥
æª¢æŸ¥7303. å¸³æœ¬å”ä½œåŠŸèƒ½ç¾¤.dartå¾Œç™¼ç¾ï¼š
TC-009~TC-020æ¸¬è©¦æ¡ˆä¾‹PLå±¤å›æ‡‰ç‹€æ³ï¼š
âœ… å¯ä»¥å›å‚³çµæœçš„æ–¹æ³•ï¼š
â€¢	createLedger() - å›å‚³LedgerDataç‰©ä»¶
â€¢	processLedgerList() - å›å‚³Mapæ ¼å¼çµæœ
â€¢	processCollaboratorList() - å›å‚³Mapæ ¼å¼çµæœ
â€¢	updateCollaboratorPermissions() - åŸ·è¡Œå®Œæˆï¼ˆç„¡å›å‚³å€¼ä½†å¯åŒ…è£ï¼‰
â€¢	removeCollaborator() - åŸ·è¡Œå®Œæˆ
â€¢	calculateUserPermissions() - å›å‚³PermissionDataç‰©ä»¶
â€¢	validateLedgerData() - å›å‚³ValidationResultç‰©ä»¶
â€¢	callAPI() - å›å‚³Mapæ ¼å¼çµæœ

âŒ ç¼ºå°‘çš„ç”¨æˆ¶ç‹€æ…‹ç®¡ç†æ–¹æ³•ï¼š
â€¢	getCurrentCollaborationUserId() - éœ€æ–°å¢
â€¢	getUserIdByEmail() - éœ€æ–°å¢

ğŸ¯ æ›´æ–°å¾Œçš„ä¿®æ­£æ–¹æ¡ˆ
éšæ®µä¸€ï¼š7303æ¨¡çµ„è£œå®Œï¼ˆé è¨ˆ1.5å°æ™‚ï¼‰
éœ€è¦æ–°å¢çš„æ–¹æ³•ï¼š
/// ç²å–ç•¶å‰å”ä½œç”¨æˆ¶ID - é€šéPLâ†’APLâ†’ASLâ†’BL(CM)â†’Firebaseè·¯å¾‘
static Future<String?> getCurrentCollaborationUserId() async {
  // èª¿ç”¨APL.instance.user.getCurrentUser()
  // ç¬¦åˆPLâ†’APLâ†’ASLâ†’BLâ†’Firebaseè³‡æ–™æµ
}
/// é€šéEmailæŸ¥è©¢ç”¨æˆ¶ID - é€šéCMæ¨¡çµ„æ­£ç¢ºè·¯å¾‘
static Future<String?> getUserIdByEmail(String email) async {
  // èª¿ç”¨APL.instance.user.getUserByEmail()
  // ç¢ºä¿é€šéCMæ¨¡çµ„æŸ¥è©¢è€Œéç›´æ¥FirebaseæŸ¥è©¢
}

éšæ®µäºŒï¼š7598æ¸¬è©¦è³‡æ–™è£œå®Œï¼ˆé è¨ˆ30åˆ†é˜ï¼‰
éœ€è¦æ–°å¢çš„æ¸¬è©¦è³‡æ–™ï¼ˆç¬¦åˆ1311.FS.jsè¦ç¯„ï¼‰ï¼š
"collaboration_test_roles": {
  "admin": {
    "canManage": true,
    "canInvite": true, 
    "canEdit": true,
    "canDelete": true,
    "createdAt": "2025-11-13T09:00:00+08:00",
    "level": "admin"
  },
  "member": {
    "canManage": false,
    "canInvite": false,
    "canEdit": true,
    "canDelete": false,
    "createdAt": "2025-11-13T09:00:00+08:00",
    "level": "member"
  },
  "viewer": {
    "canManage": false,
    "canInvite": false,
    "canEdit": false,
    "canDelete": false,
    "createdAt": "2025-11-13T09:00:00+08:00",
    "level": "viewer"
  }
}

éšæ®µä¸‰ï¼š7571ç´”ç²¹èª¿ç”¨æ”¹é€ ç¢ºèª
TC-009~TC-020 PLå±¤å›æ‡‰èƒ½åŠ›ç¢ºèªï¼š
âœ… å…¨éƒ¨æ¸¬è©¦æ¡ˆä¾‹éƒ½å¯ä»¥å›å‚³çµæœï¼š
â€¢	TC-009~TC-012ï¼šå¸³æœ¬CRUDæ“ä½œéƒ½æœ‰æ˜ç¢ºå›å‚³å€¼
â€¢	TC-013~TC-016ï¼šå”ä½œè€…ç®¡ç†éƒ½æœ‰å›å‚³Mapæˆ–åŸ·è¡Œçµæœ
â€¢	TC-017~TC-020ï¼šæ¬Šé™è¨ˆç®—å’ŒAPIèª¿ç”¨éƒ½æœ‰å›å‚³å€¼
7571æ”¹é€ åŸå‰‡ç¢ºèªå¯è¡Œï¼š
1.	âœ… ç§»é™¤if (response.success)åˆ¤æ–· - PLå±¤éƒ½æœ‰å›å‚³å€¼å¯ç›´æ¥å‚³é
2.	âœ… ç§»é™¤_dynamicCollaborationIdç‹€æ…‹ç®¡ç† - æ”¹ç”¨APLæœå‹™éˆæŸ¥è©¢
3.	âœ… ç´”ç²¹å¾7598è¼‰å…¥æ¸¬è©¦è³‡æ–™ - 7598å·²æœ‰å®Œæ•´æ¸¬è©¦è³‡æ–™çµæ§‹
4.	âœ… ç›´æ¥å›å‚³PLå±¤çµæœ - æ‰€æœ‰PLæ–¹æ³•éƒ½æœ‰å›å‚³å€¼

ğŸ’¡ é—œéµSA Insight
æ ¹æœ¬å•é¡Œç¢ºèªï¼š7571ç¢ºå¯¦é•å0098æ†²æ³•ï¼Œæ‰®æ¼”äº†ã€Œæ¥­å‹™é‚è¼¯è¨­è¨ˆå¸«ã€è€Œéã€ŒåŠŸèƒ½æ¸¬è©¦è€…ã€ã€‚
è§£æ±ºæ–¹æ¡ˆå¯è¡Œæ€§ï¼š
â€¢	7303å·²æœ‰è¶³å¤ çš„APIæ–¹æ³•æ”¯æ´æ¸¬è©¦
â€¢	åªéœ€è£œå®Œ2å€‹ç”¨æˆ¶ç‹€æ…‹ç®¡ç†æ–¹æ³•
â€¢	7598æ¸¬è©¦è³‡æ–™çµæ§‹å®Œæ•´ï¼Œåªéœ€æ–°å¢æ¬Šé™è§’è‰²è³‡æ–™
â€¢	æ‰€æœ‰TCéƒ½èƒ½æ”¹ç‚ºç´”ç²¹èª¿ç”¨æ¨¡å¼
MVPå„ªå…ˆé †åºæ­£ç¢ºï¼š
1.	å…ˆè£œå®Œ7303ç¼ºå¤±æ–¹æ³•ï¼ˆç”¨æˆ¶IDç®¡ç†ï¼‰
2.	è£œå®Œ7598æ¸¬è©¦è³‡æ–™ï¼ˆæ¬Šé™è§’è‰²ï¼‰
3.	æœ€å¾Œæ”¹é€ 7571ç‚ºç´”ç²¹èª¿ç”¨æ¨¡å¼
æ­¤æ–¹æ¡ˆç¢ºä¿7571å›æ­¸ç´”ç²¹æ¸¬è©¦è§’è‰²ï¼Œå®Œå…¨ç¬¦åˆ0098æ†²æ³•è¦ç¯„ã€‚
