------------------------------------------
20251222.科目與支付方式歸類邏輯一次性互動方案(Review中)

不要寫code，請根據我的回覆更新提案。提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

根據9909文件要求，我以資深SA的角度深入分析此科目與支付方式歸類邏輯問題。
問題分析
核心問題識別
1.	LBK_parseInputFormat函數存在硬編碼支付方式邏輯：第645行處理標準支付方式關鍵字的邏輯違反0098憲法第1.3條「禁止hard coding」規範
2.	預設支付方式機制不完整：當用戶未輸入支付方式時，缺乏從wallets子集合動態查詢"信用卡"的機制
3.	wallets子集合存在多餘的type欄位：違反0070 DB schema規範
業務邏輯概念解釋
這就像公司的採購部門處理供應商資訊：
•	現況問題：採購員使用固定的供應商清單（硬編碼），而非查詢公司最新的供應商資料庫
•	理想狀況：採購員應該動態查詢公司的供應商資料庫，並根據實際資料進行匹配

解決方案
階段一：移除LBK模組硬編碼支付方式邏輯
目標：移除第645行附近的硬編碼邏輯，實現動態查詢機制
修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js
修改內容：
1.	移除LBK_parseInputFormat函數中檢查標準支付方式關鍵字的邏輯
2.	實現當用戶未輸入支付方式時，動態查詢wallets子集合中的"信用卡"項目
3.	版本升級：LBK模組 v1.9.0 → v1.9.1
用途：符合0098憲法規範，移除硬編碼邏輯
影響範圍：所有LBK快速記帳的支付方式解析流程
Before/After行為差異：
•	Before：使用硬編碼的支付方式清單["現金", "刷卡", "行動支付", "轉帳"]
•	After：當用戶未指定支付方式時，動態查詢用戶wallets子集合中的credit項目的subWalletName

階段二：建立Pending Record機制
目標：實現一次性互動完成科目與支付方式歧義消除
=>LBK模組已經有相同功能函數了，請你盤點LBK後修改此階段提案，看是要刪除或是修改都可以

修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js
•	03. Default_config/0305. Default_pendingTransaction.json
修改內容：
1.	實現LBK_createPendingRecord函數，支援PENDING_SUBJECT/PENDING_WALLET/COMPLETED狀態機
2.	建立0305預設配置檔案，定義pendingTransaction的標準欄位
3.	修改LBK_getSubjectCode函數，當synonyms為空時觸發科目歧義消除並創建Pending Record
4.	版本升級：相關函數版次升級
用途：實現一次輸入多階段處理，避免用戶重複輸入
影響範圍：整個LBK快速記帳流程，新增狀態管理機制
Before/After行為差異：
•	Before：用戶需要為每個歧義分別重新輸入
•	After：一次輸入「便當100富邦」→科目選擇→支付方式選擇→完成記帳

階段三：實現同義詞學習機制
目標：科目和支付方式歧義消除後自動學習用戶選擇
=>LBK模組已經有相同功能函數了，請你盤點LBK後修改此階段提案，看是要刪除或是修改都可以

修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js
修改內容：
1.	實現科目歧義消除後將原始輸入加入對應categories的synonyms欄位
2.	實現支付方式歧義消除後將原始輸入加入對應wallets的synonyms欄位
3.	修改相關函數支援同義詞更新邏輯
用途：實現系統學習，減少後續相同輸入的歧義消除次數
影響範圍：categories和wallets子集合的synonyms欄位更新
Before/After行為差異：
•	Before：每次輸入相同內容都需要歧義消除
•	After：第二次輸入相同內容時直接識別，無需歧義消除

階段四：清理wallets子集合違規欄位
目標：移除wallets子集合中的type欄位，符合0070規範
修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js (相關函數調整)
•	13. Replit_Module code_BL/1350. WCM.js (WCM模組調整)
修改內容：
1.	移除所有創建或查詢wallets時對type欄位的引用
2.	調整相關驗證邏輯，不再依賴type欄位
3.	確保所有wallet相關操作符合0070 DB schema
用途：符合0070 DB schema規範，清理違規欄位
影響範圍：所有wallets子集合的CRUD操作
Before/After行為差異：
•	Before：wallets文檔包含未規範的type欄位
•	After：wallets文檔完全符合0070規範，移除type欄位

階段五：整合動態支付方式查詢機制
目標：完善用戶未輸入支付方式時的預設機制
=>我不確定LBK模組是否已有相同功能函數了，請你盤點LBK後修改此階段提案，看是要刪除或是修改都可以

修改檔案：
•	13. Replit_Module code_BL/1315. LBK.js
修改內容：
1.	實現LBK_getDefaultPaymentMethod函數，動態查詢用戶wallets中的credit項目
2.	修改解析邏輯，當未檢測到支付方式時調用此函數
3.	確保完全移除硬編碼邏輯
用途：實現完整的動態支付方式處理機制
影響範圍：所有未明確指定支付方式的記帳請求
Before/After行為差異：
•	Before：使用硬編碼的預設值
•	After：動態查詢用戶實際的wallets配置
核心洞察（Insight）
這個問題的根本原因在於配置驅動 vs 硬編碼驅動的架構設計衝突：
1.	系統架構層面：LBK模組應該完全依賴用戶的個人化配置（wallets/categories子集合），而非系統預設的硬編碼值
2.	用戶體驗層面：一次性互動的核心在於「狀態保持」，系統必須能記住用戶的原始輸入，並在多個歧義消除步驟間傳遞完整資訊
3.	資料一致性層面：同義詞學習機制是實現「漸進式智能化」的關鍵，系統應該隨著用戶使用而變得更加精準
4.	規範遵循層面：0098憲法和0070 DB schema的存在是為了確保系統架構的一致性和可維護性，任何違規都可能導致後續的技術債務
請確認是否Approve此提案，我將依序進行五個階段的修改。