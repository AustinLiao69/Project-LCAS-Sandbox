### ğŸ”¹ 4.7 LBKæ¨¡çµ„ - Pending Record æš«å­˜è¨˜å¸³

#### 4.7.1 Subcollection: ledgers/{ledgerId}/pendingTransactions
**Collection Path**: `ledgers/{ledgerId}/pendingTransactions`
**ç®¡ç†æ¨¡çµ„**: LBK (å¿«é€Ÿè¨˜å¸³æ¨¡çµ„)
**ç”¨é€”**: æš«å­˜å¤šéšæ®µè™•ç†çš„è¨˜å¸³è³‡æ–™ï¼Œæ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼æ­¸é¡é‚è¼¯
**é…ç½®ä¾†æº**: `0305. Default_pendingTransaction.json`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| pendingId | string | required | æš«å­˜è¨˜éŒ„å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key, Date.now().toString() |
| userId | string | required | ç”¨æˆ¶ID | must exist in users |
| ledgerId | string | required | å¸³æœ¬ID | must match parent ledger |
| originalInput | string | required | ç”¨æˆ¶åŸå§‹è¼¸å…¥ | max 200 chars, e.g. "ç«é‹66666æ–°å…‰" |
| parsedData | object | required | å·²è§£æçš„è³‡æ–™ | see below |
| processingStage | string | required | è™•ç†éšæ®µ | enum: PENDING_CATEGORY/PENDING_WALLET/COMPLETED/CANCELLED |
| stageData | object | optional | éšæ®µè³‡æ–™ | see below |
| ambiguityInfo | object | optional | æ­¸é¡é‚è¼¯è³‡è¨Š | see below |
| metadata | object | required | å…ƒæ•¸æ“š | see below |
| status | string | required | è¨˜éŒ„ç‹€æ…‹ | enum: active/completed/cancelled/expired |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| expiresAt | timestamp | required | éæœŸæ™‚é–“ | default: createdAt + 30 minutes |
| completedTransactionId | string | optional | å®Œæˆå¾Œçš„äº¤æ˜“ID | è½‰æ›ç‚ºæ­£å¼äº¤æ˜“å¾Œçš„ID |
| completedAt | timestamp | optional | å®Œæˆæ™‚é–“ | |

**Substructures**:
```javascript
parsedData: {
  amount: number,           // å·²è§£æçš„é‡‘é¡
  description: string,      // æè¿°è³‡è¨Š
  rawCategory: string,       // åŸå§‹ç§‘ç›®é—œéµå­—
  rawWallet: string         // åŸå§‹æ”¯ä»˜æ–¹å¼é—œéµå­—
}

stageData: {
  categorySelected: boolean,     // ç§‘ç›®æ˜¯å¦å·²é¸æ“‡
  walletSelected: boolean,      // éŒ¢åŒ…æ˜¯å¦å·²é¸æ“‡
  selectedCategory: {            // å·²é¸æ“‡çš„ç§‘ç›®è³‡è¨Š
    categoryId: string,          // ç§‘ç›®ID (ä¸»éµ)
    categoryName: string         // ç§‘ç›®åç¨±
  },
  selectedWallet: {             // å·²é¸æ“‡çš„éŒ¢åŒ…è³‡è¨Š
    walletId: string,           // éŒ¢åŒ…ID (å°æ‡‰wallets.walletId)
    walletName: string,         // éŒ¢åŒ…åç¨±
  }
}

ambiguityInfo: {
  currentAmbiguity: string,     // ç•¶å‰æ­¸é¡é¡å‹: category/wallet/none
  categoryOptions: array,        // ç§‘ç›®é¸é …åˆ—è¡¨
  walletOptions: array          // æ”¯ä»˜æ–¹å¼é¸é …åˆ—è¡¨
}

metadata: {
  source: string,               // ä¾†æºå¹³å° (default: LINE)
  module: string,               // è™•ç†æ¨¡çµ„ (default: LBK)
  version: string,              // æ¨¡çµ„ç‰ˆæœ¬
  processId: string,            // è™•ç†ID
  pendingId: string,            // Pending Record ID
  completionSource: string      // å®Œæˆä¾†æºæ¨™è­˜
}
```

**State Machine**:
```
PENDING_CATEGORY â†’ PENDING_WALLET â†’ COMPLETED
PENDING_CATEGORY â†’ COMPLETED (ç›´æ¥å®Œæˆ)
ä»»ä½•ç‹€æ…‹ â†’ CANCELLED (ç”¨æˆ¶å–æ¶ˆ)
```

**Business Rules**:
- è¨˜éŒ„é è¨­30åˆ†é˜å¾ŒéæœŸï¼Œæœ€å¤šå¯å»¶é•·è‡³120åˆ†é˜
- éæœŸè¨˜éŒ„è‡ªå‹•æ¸…ç†ï¼Œä¿ç•™7å¤©æ­·å²è¨˜éŒ„
- ç‹€æ…‹è½‰æ›å¿…é ˆç¬¦åˆå®šç¾©çš„è½‰æ›è¦å‰‡
- COMPLETED ç‹€æ…‹çš„è¨˜éŒ„å°‡è½‰æ›ç‚ºæ­£å¼äº¤æ˜“è¨˜éŒ„
- æ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼çš„æ­¸é¡é‚è¼¯
- èˆ‡ wallets å­é›†åˆå»ºç«‹ walletId å¤–éµé—œè¯
- èˆ‡ categories å­é›†åˆå»ºç«‹ categoryId å¤–éµé—œè¯

**Integration Points**:
- **Reference Collections**: `ledgers/{ledgerId}/categories` (ç§‘ç›®è§£æ), `ledgers/{ledgerId}/wallets` (æ”¯ä»˜æ–¹å¼è§£æ)
- **Target Collection**: `ledgers/{ledgerId}/transactions` (å®Œæˆå¾Œè½‰æ›ç›®æ¨™)
- **Event Triggers**: onCreate (è¨­å®šéæœŸæ™‚é–“), onUpdate (é©—è­‰ç‹€æ…‹è½‰æ›), onExpire (æ¸…ç†éæœŸè¨˜éŒ„)
- **Synonym Learning**: æ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼çš„åŒç¾©è©å­¸ç¿’æ©Ÿåˆ¶

________________________________________