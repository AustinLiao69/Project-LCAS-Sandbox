
# DCN-0010 PL與APL層邏輯重構

**版本**: v1.0.0  
**建立日期**: 2025-09-18  
**最後更新**: 2025-09-18  
**建立者**: AustinLiao69  

---

## 目次 (Table of Contents)

### 1. [需求說明](#1-需求說明)
### 2. [業務背景與價值主張](#2-業務背景與價值主張)
### 3. [須新增/修改內容](#3-須新增修改內容)
### 4. [技術架構設計](#4-技術架構設計)
### 5. [實作階段規劃](#5-實作階段規劃)
### 6. [驗收標準](#6-驗收標準)

---

## 1. 需求說明

本次變更目標為：將 APL 層（83號資料夾）的業務邏輯移動到 PL 層（73號資料夾），讓 APL 變成純粹的 API Gateway。

**核心問題**：
- 83號APL代碼包含大量業務邏輯（資料模型、驗證邏輯、錯誤處理等）
- 業務邏輯應該在 PL 層處理，APL 只負責 API 路由

**重構策略**：業務邏輯移至 PL 層，APL 純 API Gateway

---

## 2. 業務背景與價值主張

### 2.1 業務需求
- **職責單一化**：APL 專注於 API 路由，PL 處理業務邏輯
- **架構清晰化**：建立清晰的層級分離
- **維護效率提升**：減少代碼重複，降低維護成本

### 2.2 預期效益
- **架構完整性**：符合分層架構原則
- **開發效率提升**：清晰的職責分工
- **維護成本降低**：減少跨層複雜度

---

## 3. 須新增/修改內容

### 3.1 PL層業務邏輯增強（73號資料夾）

#### 3.1.1 移入業務邏輯處理
- `73. Flutter_Module code_PL/7301. 系統進入功能群.dart`
  - 從 8301 移入：使用者認證邏輯、表單驗證邏輯
  - 從 8301 移入：資料模型定義（RegisterRequest、LoginRequest等）

- `73. Flutter_Module code_PL/7302. 記帳核心功能群.dart`
  - 從 8303 移入：交易資料模型、驗證邏輯
  - 從 8303 移入：記帳表單處理邏輯

#### 3.1.2 資料模型整合
- 將 83號資料夾的資料模型類別移至 73號
- 將驗證邏輯移至 PL 層
- 建立 HTTP 客戶端調用 APL API

### 3.2 APL層簡化重構（83號資料夾）

#### 3.2.1 移除業務邏輯
- `83. Flutter_Module code(API route)_APL/8301. 認證服務.dart`
  - 移除：複雜的資料模型定義和驗證邏輯
  - 保留：HTTP路由定義、請求轉發

- `83. Flutter_Module code(API route)_APL/8302. 用戶管理服務.dart`
  - 移除：用戶資料處理邏輯
  - 保留：路由定義和請求轉發機制

- `83. Flutter_Module code(API route)_APL/8303. 記帳交易服務.dart`
  - 移除：交易業務邏輯和統計計算
  - 保留：API路由和請求轉發

#### 3.2.2 新增 HTTP 路由定義
- 實作純粹的 API Gateway 功能
- 定義 RESTful API 路由規則
- 建立統一的請求轉發機制

---

## 4. 技術架構設計

### 4.1 重構後架構圖
```
┌─────────────────────────────────────────┐
│               PL層 (73號)                │
│  ┌─────────────┐  ┌─────────────────────┐ │
│  │  UI邏輯     │  │  業務邏輯處理       │ │
│  │  表單驗證    │  │  資料模型          │ │
│  │  狀態管理    │  │  HTTP客戶端        │ │
│  └─────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────┘
                     │ HTTP 調用
                     ▼
┌─────────────────────────────────────────┐
│               APL層 (83號)               │
│  ┌─────────────────────────────────────┐ │
│  │         API Gateway                 │ │
│  │  - HTTP路由定義                     │ │
│  │  - 請求轉發                        │ │
│  └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
                     │ API 轉發
                     ▼
┌─────────────────────────────────────────┐
│               BL層 (13號)                │
│         後端業務邏輯                     │
└─────────────────────────────────────────┘
```

### 4.2 資料流重新設計
```
用戶操作 → PL層UI → PL層業務邏輯 → HTTP客戶端 → APL層API Gateway → BL層
```

---

## 5. 實作階段規劃

### Phase 1：業務邏輯遷移（Week 1）
- 將 83號資料夾的資料模型移至 73號資料夾
- 將驗證邏輯和業務處理移至 PL 層
- 在 73號資料夾建立 HTTP 客戶端

### Phase 2：APL層簡化（Week 2）
- 移除 83號資料夾的多餘業務邏輯
- 簡化 APL 層為純 API Gateway 功能
- 實作 HTTP 路由和請求轉發

### Phase 3：整合測試（Week 3）
- 執行完整的端到端測試驗證
- 確保功能正常運作

---

## 6. 驗收標準

### 6.1 架構驗收
- [ ] PL層包含所有業務邏輯
- [ ] APL層純粹為API Gateway功能
- [ ] 層級職責清晰分離

### 6.2 功能驗收
- [ ] 所有現有功能正常運作
- [ ] API調用流程順暢
- [ ] 錯誤處理機制完善

### 6.3 程式碼品質驗收
- [ ] 代碼重複度 < 5%
- [ ] 單元測試通過
- [ ] 符合架構設計原則

---

> **重要提醒**：此重構專注於業務邏輯遷移，將 APL 層的業務邏輯移至 PL 層，讓 APL 成為純粹的 API Gateway。
