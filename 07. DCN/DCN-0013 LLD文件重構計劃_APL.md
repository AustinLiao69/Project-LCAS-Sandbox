
# DCN-0013 LLD文件重構計劃_APL

**版本**: v1.0.0  
**建立日期**: 2025-09-20  
**最後更新**: 2025-09-20  
**建立者**: LCAS PM Team  

---

## 目次 (Table of Contents)

### 1. [需求說明](#1-需求說明)
### 2. [業務背景與價值主張](#2-業務背景與價值主張)
   - 2.1 [業務需求](#21-業務需求)
   - 2.2 [預期效益](#22-預期效益)
### 3. [須新增/修改內容](#3-須新增修改內容)
   - 3.1 [82號資料夾架構重新定義](#31-82號資料夾架構重新定義)
   - 3.2 [72號資料夾功能整合](#32-72號資料夾功能整合)
   - 3.3 [文件內容重構策略](#33-文件內容重構策略)
   - 3.4 [跨資料夾整合修改](#34-跨資料夾整合修改)
### 4. [技術架構設計](#4-技術架構設計)
   - 4.1 [架構層級重新定義](#41-架構層級重新定義)
   - 4.2 [API客戶端設計架構](#42-api客戶端設計架構)
   - 4.3 [純API Gateway職責](#43-純api-gateway職責)
### 5. [實作階段規劃](#5-實作階段規劃)
### 6. [文件重構清單](#6-文件重構清單)
### 10. [文件更新清單](#10-文件更新清單)
### 11. [版本紀錄](#11-版本紀錄)

---

## 1. 需求說明

本次變更目標為：執行82號資料夾（Flutter_LLD_APL）的LLD文件重構計劃，解決架構分層混亂問題。根據0015規範和0081技術架構v2備忘錄，82號資料夾應專注於純API Gateway設計，而實際的API客戶端邏輯應歸屬於72號資料夾（Flutter_LLD_PL）。

此變更將實現：
1. 82號資料夾轉換為純API Gateway設計規範
2. API客戶端相關LLD文件重構後整合至72號資料夾
3. 符合0015規範的架構清晰度要求
4. 建立更明確的PL-APL層級職責分離

---

## 2. 業務背景與價值主張

### 2.1 業務需求
- **架構清晰度**：解決82號資料夾中API客戶端與API Gateway混合的問題
- **職責分離**：明確APL層作為純轉發窗口，PL層負責API客戶端實作
- **0015規範遵循**：確保技術實作符合產品規格書的架構定義
- **技術債務清理**：消除架構設計與實際實作的偏離

### 2.2 預期效益
- **架構一致性**：實作與設計文件完全對齊
- **開發清晰度**：開發人員更容易理解各層職責
- **維護便利性**：減少架構混亂導致的維護困難
- **擴展性提升**：為未來v2架構遷移奠定基礎
- **文檔品質**：提升LLD文件的準確性和實用性

---

## 3. 須新增/修改內容

### 3.1 82號資料夾架構重新定義

#### 3.1.1 純API Gateway設計轉換
- **保留檔案**：所有13個LLD文件(8201-8213)維持原檔案結構
- **內容重構**：移除API客戶端實作邏輯，專注於API Gateway規範
- **新增職責**：
  - RESTful API端點定義
  - 統一回應格式規範
  - 錯誤處理標準
  - 認證授權機制

#### 3.1.2 API Gateway核心功能重新定義
```markdown
// 82號資料夾新架構重點
├── API端點路由定義
├── 請求/回應格式規範
├── 統一錯誤處理機制
├── JWT認證標準
├── CORS設定規範
└── API版本管理策略
```

#### 3.1.3 移除內容清單
- **API客戶端實作邏輯**：移至72號資料夾
- **UI互動相關設計**：移至72號資料夾
- **本地資料處理邏輯**：移至72號資料夾
- **Flutter特定實作細節**：移至72號資料夾

### 3.2 72號資料夾功能整合

#### 3.2.1 APL介面規格整合策略
- **目標檔案**：將82號資料夾的APL介面規格整合至現有2個LLD文件
- **整合方式**：
  - 7201. 系統進入功能群_LLD.md：整合認證、用戶管理相關APL介面規格
  - 7202. 記帳核心功能群_LLD.md：整合記帳、帳本、報表相關APL介面規格

#### 3.2.2 新增章節架構
```markdown
// 72號資料夾擴充內容
└── APL介面規格設計
    ├── RESTful API呼叫規範
    ├── API介面標準化
    ├── 錯誤處理機制
    ├── 資料格式轉換
    └── 離線資料處理
```

#### 3.2.3 PL層職責強化
- **UI組件與APL介面整合**
- **本地資料快取管理**
- **離線功能支援設計**
- **四模式差異化介面呼叫邏輯**

### 3.3 文件內容重構策略

#### 3.3.1 內容分類原則
**保留於82號資料夾（APL層）**：
- API端點定義與規範
- RESTful API標準
- 統一回應格式
- 認證授權機制
- API Gateway轉發邏輯

**遷移至72號資料夾（PL層）**：
- APL介面規格定義
- API呼叫規範
- 資料格式轉換規範
- UI互動相關設計
- 本地資料處理邏輯

#### 3.3.2 重構執行方式
- **階段式重構**：逐個服務進行內容重新分配
- **版本控制**：每個文件重構後版本升級
- **交叉引用更新**：確保文件間引用關係正確
- **架構圖更新**：修正技術架構圖以反映新職責分工

### 3.4 跨資料夾整合修改

#### 3.4.1 83號資料夾同步更新
- **Module code對應關係**：更新代碼實作以符合新LLD設計
- **API Gateway純轉發**：確保代碼實作純轉發功能
- **移除業務邏輯**：將業務邏輯移至PL層實作

#### 3.4.2 相關文件同步
- **84號資料夾測試計劃**：更新測試重點以符合新架構
- **0026 mapping matrix**：更新PL-APL-BL對應關係
- **API規格文件**：確認與新LLD設計一致性

---

## 4. 技術架構設計

### 4.1 架構層級重新定義

#### 4.1.1 重構後架構清晰度
```
重構前（混亂）:
PL → APL(API客戶端+Gateway混合) → BL → DL

重構後（清晰）:
PL(包含API客戶端) → APL(純Gateway) → BL → DL
```

#### 4.1.2 職責邊界明確化
| 層級 | 重構前職責 | 重構後職責 |
|------|------------|------------|
| **PL層** | UI組件、基本互動 | UI組件 + API客戶端 + 本地邏輯 |
| **APL層** | API客戶端 + Gateway | 純API Gateway轉發 |
| **BL層** | 商業邏輯處理 | 商業邏輯處理（不變） |
| **DL層** | 資料存取 | 資料存取（不變） |

### 4.2 APL介面規格設計架構

#### 4.2.1 PL層APL介面規格標準
```dart
// APL介面規格標準（移至72號資料夾設計）
class APLInterface {
  // RESTful API規格定義
  // 統一錯誤處理
  // 認證token規範
  // 請求/回應格式規範
  // 離線資料處理規範
}
```

#### 4.2.2 本地資料處理設計
- **快取策略**：本地資料快取機制設計
- **同步邏輯**：離線與線上資料同步
- **衝突解決**：資料衝突解決策略
- **效能最佳化**：減少不必要的API呼叫

### 4.3 純API Gateway職責

#### 4.3.1 APL層標準化設計
```yaml
# API Gateway規範（保留於82號資料夾）
API端點定義:
  - 路由規則定義
  - 參數驗證規範
  - 回應格式標準
  
轉發機制:
  - BL層函數對應
  - 錯誤碼轉換
  - 日誌記錄標準
```

#### 4.3.2 統一介面規範
- **RESTful標準**：嚴格遵循REST設計原則
- **版本管理**：API版本控制機制
- **文檔化**：API文檔自動生成
- **測試標準**：API測試覆蓋要求

---

## 5. 實作階段規劃

### Phase 1：架構分析與重構規劃（2-3天）
**目標**：完成文件內容分析，制定詳細重構計劃

#### 階段1行動項目：
1. **文件內容深度分析**
   - 逐一分析82號資料夾13個LLD文件內容
   - 識別哪些內容屬於API Gateway，哪些屬於API客戶端
   - 建立詳細的內容分類清單

2. **72號資料夾整合策略制定**
   - 評估現有2個LLD文件的容量與結構
   - 設計API客戶端內容的整合方式
   - 規劃新章節架構與組織方式

3. **依賴關係影響評估**
   - 分析83號資料夾代碼的對應調整需求
   - 評估84號資料夾測試計劃的更新範圍
   - 確認其他相關文件的同步需求

### Phase 2：82號資料夾內容重構（4-5天）
**目標**：執行82號資料夾的純API Gateway轉換

#### 階段2行動項目：
1. **API Gateway內容重構**
   - 重寫13個LLD文件，專注於API Gateway職責
   - 統一API端點定義格式
   - 建立標準化的轉發機制設計

2. **移除非Gateway內容**
   - 系統性移除API客戶端實作邏輯
   - 移除UI互動相關設計
   - 移除本地資料處理邏輯

3. **版本控制與文檔更新**
   - 所有重構文件版本升級
   - 更新修改記錄與變更說明
   - 建立重構前後對照文檔

### Phase 3：72號資料夾整合與驗證（3-4天）
**目標**：完成API客戶端內容整合，驗證架構一致性

#### 階段3行動項目：
1. **API客戶端內容整合**
   - 將82號資料夾移除的API客戶端邏輯整合至72號資料夾
   - 重新組織7201、7202文件結構
   - 新增API客戶端設計章節

2. **跨文件整合優化**
   - 更新83號資料夾代碼對應關係
   - 同步84號資料夾測試計劃
   - 修正0026 mapping matrix

3. **架構一致性驗證**
   - 驗證重構後的架構符合0015規範
   - 檢查PL-APL層級職責分離正確性
   - 確認技術債務清理完成度

---

## 6. 文件重構清單

### 6.1 82號資料夾重構項目（13個）
```javascript
// 重構為純API Gateway設計
8201. 認證服務.md          → API Gateway規範
8202. 用戶管理服務.md       → API Gateway規範
8203. 記帳交易服務.md       → API Gateway規範
8204. 帳本管理服務.md       → API Gateway規範
8205. 帳戶管理服務.md       → API Gateway規範
8206. 科目管理服務.md       → API Gateway規範
8207. 預算管理服務.md       → API Gateway規範
8208. 報表分析服務.md       → API Gateway規範
8209. AI助理服務.md         → API Gateway規範
8210. 激勵系統服務.md       → API Gateway規範
8211. 系統服務.md          → API Gateway規範
8212. 備份與資料管理服務.md  → API Gateway規範
8213. 通知管理服務.md       → API Gateway規範
```

### 6.2 72號資料夾整合項目（2個）
```javascript
// 整合API客戶端設計
7201. 系統進入功能群_LLD.md  ← 整合認證、用戶管理API客戶端
7202. 記帳核心功能群_LLD.md  ← 整合記帳、帳本、報表API客戶端
```

### 6.3 內容分配策略
**7201整合範圍**（系統進入功能群）：
- 認證服務APL介面規格（8201內容）
- 用戶管理服務APL介面規格（8202內容）
- 系統服務APL介面規格（8211內容）

**7202整合範圍**（記帳核心功能群）：
- 記帳交易服務APL介面規格（8203內容）
- 帳本管理服務APL介面規格（8204內容）
- 帳戶管理服務APL介面規格（8205內容）
- 科目管理服務APL介面規格（8206內容）
- 預算管理服務APL介面規格（8207內容）
- 報表分析服務APL介面規格（8208內容）
- AI助理服務APL介面規格（8209內容）
- 激勵系統服務APL介面規格（8210內容）
- 備份與資料管理服務APL介面規格（8212內容）
- 通知管理服務APL介面規格（8213內容）

---

## 10. 文件更新清單

### 10.1 核心架構文件（3個）
- `00. Master_Project document/0015. Product_SPEC_LCAS_2.0.md`
  - 確認技術架構圖與重構結果一致
  - 驗證APL層職責定義準確性
  - 更新架構說明文字

- `00. Master_Project document/0026. PL-APL-BL mapping matrix.md`
  - 更新PL層包含API客戶端的對應關係
  - 修正APL層純Gateway職責映射
  - 確保三層對應關係正確

- `00. Master_Project document/0081. 技術架構v2備忘錄.md`
  - 驗證重構結果符合v2架構理念
  - 確認簡化架構目標達成
  - 更新遷移路徑規劃

### 10.2 實作代碼文件（13個）
- `83. Flutter_Module code(API route)_APL/` - 所有代碼文件需同步更新
  - 8301-8304及未來8305-8313代碼
  - 轉換為純API Gateway轉發功能
  - 移除業務邏輯至PL層

### 10.3 測試計劃文件（13個）
- `84. Flutter_Test plan_APL/` - 所有測試計劃需更新測試重點
  - 8401-8413測試計劃文件
  - 更新測試範圍專注於API Gateway功能
  - 新增PL層API客戶端測試要求

### 10.4 相關規格文件（3個）
- `80. Flutter_PRD_APL/8020. API list.md` - 確認API清單與新架構一致
- `80. Flutter_PRD_APL/8025. API-BL mapping list.md` - 更新映射關係
- `81. Flutter_SRS(API spec)_APL/` - 驗證API規格與Gateway設計一致

**總計：32 個文件需要更新**

---

## 11. 版本紀錄

| 版本 | 日期 | 修改內容 | 修改者 |
|------|------|----------|--------|
| v1.0.0 | 2025-09-20 | 初版建立，定義LLD文件重構計劃 | LCAS PM Team |

---

> **重要提醒**：此重構計劃將對LCAS 2.0的技術文檔架構產生重大影響，涉及架構層級重新定義、文件內容重新分配、跨資料夾整合等多個面向。所有開發人員請嚴格遵循實作階段規劃，確保重構過程中的架構一致性，並在完成後進行充分的文檔驗證。此重構將為未來的v2架構遷移奠定堅實基礎。
