# LCAS 2.0 產品規格書 (Product Specification)
**版本**: 1.1  
**建立日期**: 2025-07-04  
**建立者**: AustinLiao69  
**最後更新**: 2025-07-11 13:50:00 UTC+8  

---

##  1. 產品概述 (Product Overview)

### 1.1 產品定位
LCAS 2.0 是一個多平台記帳解決方案，提供 LINE OA 基礎服務與 APP 進階功能，滿足多種的記帳需求。

### 1.2 核心價值主張
- **便利性**: LINE OA 即開即用，零學習成本
- **專業性**: APP 提供進階記帳功能
- **擴展性**: 從個人記帳到團隊協作的完整解決方案
- **智能化**: 自動分類、預算管理、報表分析

### 1.3 目標使用者
- **基礎用戶**: 個人記帳需求，使用 LINE OA
- **進階用戶**: 專案記帳需求，使用 APP
- **團隊用戶**: 多人協作記帳需求

---

##  2. 功能架構 (Feature Architecture)

### 2.1 雙平台策略

```
LCAS 2.0 生態系統
├── LINE OA 平台 (基礎版)
│   ├── 基本記帳功能
│   ├── 簡易查詢
│   └── 自動資料庫初始化
│
└── APP 平台 (專業版)
    ├── 基礎功能 (與 LINE OA 同步)
    ├── 進階功能
    │   ├── 專案帳戶管理
    │   ├── 分類帳戶管理
    │   ├── 預算管理系統
    │   └── 共享帳本協作
    └── 專業功能
        ├── 報表產出引擎
        ├── 數據分析工具
        └── 定期備份服務
```

### 2.2 功能對比表

| 功能類別 | LINE OA | APP |
|---------|---------|-----|
| **基礎記帳** | ✅ | ✅ |
| **查詢記錄** | ✅ (簡易) | ✅ (進階) |
| **資料同步** | ✅ | ✅ |
| **專案帳戶** | ❌ | ✅ |
| **分類帳戶** | ❌ | ✅ |
| **預算管理** | ❌ | ✅ |
| **共享帳本** | ❌ | ✅ |
| **報表產出** | ❌ | ✅ |
| **數據分析** | ❌ | ✅ |
| **自動備份** | ❌ | ✅ |

---

##  3. 技術架構 (Technical Architecture)

### 3.1 整體架構

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   LINE OA       │    │   Rich Menu     │    │   Mobile APP    │
│   (文字記帳)    │    │   (功能選單)    │    │   (專業版)      │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          │ 簡化路徑             │ 標準路徑             │ 標準路徑
          │                      │                      │
          ▼                      ▼                      ▼
┌─────────────────┐    ┌─────────────────────────────────────────┐
│  WH → BK 2.0    │    │         WH → DD → BK                    │
│  (直連簡化)     │    │         (標準處理)                      │
└─────────┬───────┘    └─────────────────┬───────────────────────┘
          │                              │
          └──────────────┬───────────────┘
                         │
              ┌─────────────────────┐
              │  Firestore Database │
              │   (統一資料源)      │
              └─────────────────────┘
```

### 3.1.1 Data Flow 分層設計

#### A. LINE OA 文字記帳 (簡化路徑)
```
使用者文字輸入 → WH 模組 → BK 2.0 模組 → Firestore
```
- **特點**: 去除 DD 中間層，降低 Reply Token 60 秒限制風險
- **適用**: 簡單收支記錄 (如：午餐-100)
- **處理時間**: < 2 秒

#### B. Rich Menu & APP 端 (標準路徑)
```
Rich Menu/APP 操作 → WH 模組 → DD 模組 → BK 模組 → Firestore
```
- **特點**: 保持完整的數據處理與驗證
- **適用**: 複雜功能 (帳本管理、報表產出、預算設定)
- **處理時間**: < 5 秒

### 3.1.2 模組職責重新分配

#### WH 模組 (Webhook 處理)
- **LINE 文字記帳**: 直接解析並調用 BK 2.0
- **Rich Menu/APP**: 轉發至 DD 模組處理
- **路由判斷**: 根據訊息類型選擇處理路徑

#### BK 2.0 模組 (記帳核心升級版)
- **整合功能**: 原 BK 模組 + DD 模組的文字解析功能
- **包含能力**:
  - 文字解析 (DD_processUserMessage)
  - 科目匹配 (DD_getSubjectCode)
  - 模糊匹配邏輯
  - 記帳處理 (BK_processBookkeeping)

#### DD 模組 (數據分發，專門處理複雜來源)
- **專責範圍**: Rich Menu、APP 端的複雜操作
- **保持功能**: 完整的數據驗證與格式轉換

### 3.2 資料庫架構設計原則

#### 3.2.1 使用者分層結構
```
Firestore Database
├── users/                           # 使用者基本資料
├── user_profiles/                   # 使用者進階設定 (APP專用)
├── ledgers/                         # 帳本集合
│   ├── {user_basic_ledger}/         # 基礎帳本 (LINE OA)
│   ├── {project_ledger}/            # 專案帳本 (APP)
│   └── {shared_ledger}/             # 共享帳本 (APP)
├── budgets/                         # 預算管理 (APP專用)
├── reports/                         # 報表資料 (APP專用)
└── _system/                         # 系統管理
```

#### 3.2.2 帳本類型分類
- **Basic Ledger**: LINE OA 使用者的基礎帳本
- **Project Ledger**: APP 使用者的專案別帳本
- **Category Ledger**: APP 使用者的分類別帳本
- **Shared Ledger**: 多人協作的共享帳本

---

##  4. LINE OA 平台規格

### 4.1 核心功能

#### 4.1.1 自動資料庫初始化
```javascript
// 使用者加入 LINE OA 時觸發
follow_event → checkUserExists() → initBasicUserDatabase()
```

**流程**:
1. 使用者加 LINE OA 為好友
2. 系統檢查 Firestore 中是否已有該用戶
3. 新用戶：自動建立基礎資料庫結構
4. 既有用戶：歡迎回來訊息

#### 4.1.2 基礎記帳功能
- 收支記錄 (文字輸入)
- 自動科目分類
- 即時回饋確認
- 簡易查詢 (當日/當週/當月)

#### 4.1.3 使用者體驗
- 零設定即可開始記帳
- 自然語言輸入
- 即時回應與確認
- 錯誤記錄可修正

### 4.2 資料結構 (LINE OA)

```
users/{LINE_UID}/
├── platform: "line_oa"
├── user_type: "basic"
├── created_at: Timestamp
├── basic_ledger_id: "{LINE_UID}_basic"
└── settings: { timezone, notifications }

ledgers/{LINE_UID}_basic/
├── type: "basic_ledger"
├── platform: "line_oa"
├── entries/          # 記帳項目
├── subjects/         # 科目代碼
└── log/             # 操作日誌
```

---

##  5. APP 平台規格

### 5.1 進階功能模組

#### 5.1.1 專案帳戶管理
- **多專案並行**: 一個使用者可建立多個專案帳本
- **專案分類**: 工作專案、個人專案、投資專案等
- **專案預算**: 每個專案獨立的預算管理
- **專案報表**: 獨立的專案收支分析

#### 5.1.2 分類帳戶管理
- **多維度分類**: 依時間、類別、標籤分類
- **自定義分類**: 使用者可建立專屬分類規則
- **交叉分析**: 跨分類的數據分析
- **分類預算**: 每個分類的預算控制

#### 5.1.3 預算管理系統
- **月度預算**: 每月預算設定與追蹤
- **分類預算**: 各支出類別的預算限制
- **專案預算**: 專案別的預算管理
- **預算警示**: 超支預警與通知

#### 5.1.4 共享帳本協作
- **多人協作**: 團隊成員共同記帳
- **權限管理**: 不同角色的操作權限
- **即時同步**: 多人操作的即時同步
- **協作日誌**: 完整的操作歷史記錄

### 5.2 專業功能模組

#### 5.2.1 報表產出引擎
- **標準報表**: 損益表、現金流量表、資產負債表
- **自定義報表**: 使用者自定義報表格式
- **多格式輸出**: PDF、Excel、CSV 格式
- **定期報表**: 自動產生週/月/季/年報表

#### 5.2.2 數據分析工具
- **趨勢分析**: 收支趨勢、分類趨勢分析
- **比較分析**: 不同期間、專案、分類的比較
- **預測模型**: 基於歷史數據的支出預測
- **視覺化圖表**: 多種圖表類型的數據視覺化

#### 5.2.3 定期備份服務
- **自動備份**: 每日自動備份至雲端
- **手動備份**: 使用者主動備份功能
- **備份還原**: 從備份還原資料功能
- **多雲備份**: 支援多個雲端服務商

### 5.3 APP 資料結構

```
user_profiles/{USER_ID}/
├── platform: "mobile_app"
├── subscription_type: "free/premium/enterprise"
├── projects: []                    # 專案清單
├── budgets: {}                     # 預算設定
└── preferences: {}                 # 個人偏好設定

projects/{PROJECT_ID}/
├── project_name: ""
├── project_type: "work/personal/investment"
├── owner_id: USER_ID
├── members: []                     # 專案成員
├── budget_settings: {}             # 專案預算
└── ledger_id: ""                   # 對應的帳本ID

budgets/{BUDGET_ID}/
├── budget_type: "monthly/category/project"
├── target_amount: Number
├── spent_amount: Number
├── period: {}                      # 預算期間
└── alerts: {}                      # 警示設定

reports/{REPORT_ID}/
├── report_type: "standard/custom"
├── data_source: []                 # 資料來源
├── generated_at: Timestamp
├── format: "pdf/excel/csv"
└── file_url: ""                    # 報表檔案位置
```

---

##  6. 平台間整合

### 6.1 資料同步機制
- **即時同步**: Firestore 即時同步兩平台數據
- **衝突解決**: 時間戳記優先的衝突解決機制
- **離線支援**: APP 支援離線記帳，上線後同步

### 6.2 使用者升級流程
```
LINE OA 使用者 → 下載 APP → 帳號綁定 → 數據遷移 → 功能升級
```

### 6.3 跨平台功能
- **帳號統一**: 統一的 USER_ID 系統
- **數據共享**: 基礎記帳數據跨平台共享
- **功能互補**: LINE OA 快速記帳 + APP 深度分析

---

##  7. 開發里程碑

### Phase 1: 基礎架構 (2025 Q3)
- [ ] Firestore 資料庫架構完成
- [ ] LINE OA 基礎功能開發
- [ ] 自動使用者初始化機制

### Phase 2: APP 核心功能 (2025 Q4)
- [ ] Mobile APP 基礎框架
- [ ] 專案帳戶管理
- [ ] 分類帳戶管理
- [ ] 預算管理系統

### Phase 3: 進階功能 (2026 Q1)
- [ ] 共享帳本協作
- [ ] 報表產出引擎
- [ ] 數據分析工具

### Phase 4: 專業功能 (2026 Q2)
- [ ] 定期備份服務
- [ ] 進階報表功能


---

##  8. 成功指標 (KPIs)

### 8.1 使用者指標
- LINE OA 活躍使用者數
- APP 下載與註冊轉換率
- 使用者留存率 (7天/30天)
- 平台間轉換率

### 8.2 功能指標
- 記帳頻率與準確度
- 報表產出使用率
- 共享帳本參與度
- 預算管理使用率

### 8.3 技術指標
- 系統回應時間 < 2秒
- 資料同步成功率 > 99%
- 系統可用性 > 99.9%
- 資料備份成功率 100%

---

##  9. 安全與隱私

### 9.1 資料安全
- Firebase 加密傳輸與儲存
- 使用者資料隔離
- 定期安全稽核
- 備份資料加密

### 9.2 隱私保護
- 最小資料收集原則
- 使用者資料控制權
- GDPR 合規設計
- 透明的隱私政策

---

##  10. 風險管控

### 10.1 技術風險
- **Firestore 成本控制**: 優化查詢與資料結構
- **擴展性問題**: 分散式架構設計
- **API 限制**: LINE API 使用量管控

### 10.2 產品風險
- **功能複雜度**: 分階段推出功能
- **使用者接受度**: 持續使用者回饋收集
- **競爭者威脅**: 差異化功能開發

---

**備註**: 本產品規格書為第一版，將根據開發進度與使用者回饋持續更新。所有功能開發請以此規格書為準，重大變更需經過 PM 審核。

**下一步行動**:
1. 技術團隊審核可行性
2. UI/UX 團隊設計原型
3. 開發時程規劃
4. 資料庫詳細設計