# PRD_Flutter_Presentation_Layer

**文件編號**: 6001  
**版本**: v1.0.4  
**建立日期**: 2025-09-09  
**建立者**: LCAS PM Team  
**最後更新**: 2025-09-10  

---

## 目次
1. [模組概述](#10-模組概述module-overview)
2. [功能需求](#20-功能需求functional-requirements)
3. [架構設計](#30-架構設計architecture-design)
4. [模組群詳細規格](#40-模組群詳細規格module-groups-specification)
5. [UI/UX介面設計](#50-uiux介面設計uiux-interface-design)
6. [資料流設計](#60-資料流設計data-flow-design)

---

## 1.0 模組概述（Module Overview）

### 1.1 產品定位
展示層(Presentation Layer, PL)是 LCAS 2.0 系統的前端用戶介面層，負責提供跨平台（iOS/Android）的原生體驗。作為用戶與系統互動的主要介面，確保四模式差異化體驗的完整實現，並透過標準化的 RESTful API 與應用邏輯層(AP layer, APL)進行資料交換。

### 1.2 核心價值主張
- **四模式個人化體驗**：支援 Expert、Inertial、Cultivation、Guiding 四種使用者模式的差異化設計
- **跨平台一致性**：Flutter 框架確保 iOS 和 Android 平台的一致使用體驗
- **響應式設計**：支援手機、平板等多種螢幕尺寸的自適應佈局
- **離線優先架構**：支援離線記帳與數據同步機制

### 1.3 目標使用者
- **Expert模式使用者**：需要完整功能、深度分析、專業控制的進階用戶
- **Inertial模式使用者**：習慣固定流程、簡潔介面、一致體驗的穩定用戶
- **Cultivation模式使用者**：需要習慣養成、激勵機制、進度追蹤的成長用戶
- **Guiding模式使用者**：需要極簡介面、被動引導、最少決策的入門用戶

### 1.4 主要職責與技術定位

主要職責： PL 的主要負責領域為：UI渲染邏輯、互動邏輯、狀態管理邏輯、API整合邏輯。

技術定位： PL 採用 Flutter 跨平台框架，基於 Dart 語言開發，支援：
- Material Design 和 Cupertino 設計語言
- 狀態管理（Provider/Bloc）
- 本地資料存儲（SQLite/Hive）
- RESTful API 整合
- 多語言國際化（i18n）

---

## 2.0 功能需求（Functional Requirements）

基於6021 Screen list文件的40個畫面規格，Presentation Layer 提供完整的用戶介面功能：

### 2.1 進入階段功能群（Epic 1）
基於6021文件 S-101 至 S-108 畫面規格：

#### 2.1.1 APP 啟動與註冊功能
- **APP 啟動頁（S-102）**：品牌展示、版本資訊、載入進度
- **APP 註冊頁（S-103）**：Email 輸入、密碼設定、驗證流程
- **APP 登入頁（S-104）**：帳號密碼、Google 登入、忘記密碼
- **忘記密碼頁（S-105）**：Email 輸入、重設說明、返回登入

#### 2.1.2 模式評估與綁定功能
- **模式評估問卷頁（S-106）**：5 題評估問卷、模式說明、設定確認
- **跨平台綁定頁（S-107）**：LINE OA 介紹、QR Code、綁定確認

### 2.2 記帳功能群（Epic 2）
基於6021文件 S-201 至 S-211 畫面規格：

#### 2.2.1 核心記帳功能
- **APP 記帳主頁（S-202）**：快速記帳按鈕、最近記錄、統計摘要
- **APP 記帳表單頁（S-203）**：金額、科目、帳戶、帳本、備註、重複設定
- **科目選擇頁（S-204）**：收支切換、科目樹狀結構、快速搜尋
- **帳戶選擇頁（S-205）**：帳戶列表、餘額顯示、快速切換

#### 2.2.2 進階記帳功能
- **帳本選擇頁（S-206）**：個人/協作帳本、權限狀態、新增按鈕
- **圖片附加頁（S-207）**：拍照、相冊選擇、圖片預覽、壓縮設定
- **重複設定頁（S-208）**：頻率選擇、結束條件、預覽排程
- **記錄管理頁（S-209）**：記錄列表、篩選搜尋、編輯刪除

#### 2.2.3 記錄管理與統計
- **記錄編輯頁（S-210）**：完整記錄編輯、歷史記錄、刪除確認
- **統計圖表頁（S-211）**：圓餅圖、長條圖、折線圖、時間篩選

### 2.3 管理功能群（Epic 3-6）
基於6021文件 S-301 至 S-308 畫面規格：

#### 2.3.1 帳本管理功能
- **帳本管理主頁（S-301）**：帳本列表、新增按鈕、權限標示
- **建立帳本頁（S-302）**：帳本類型、名稱描述、權限設定
- **協作管理頁（S-303）**：協作者列表、權限管理、邀請功能

#### 2.3.2 帳戶與科目管理
- **帳戶管理主頁（S-304）**：帳戶列表、餘額統計、新增刪除
- **建立帳戶頁（S-305）**：帳戶類型、初始餘額、幣值圖標
- **科目管理主頁（S-306）**：科目樹狀結構、新增編輯、使用統計

#### 2.3.3 預算管理功能
- **預算管理主頁（S-307）**：預算列表、執行狀況、新增按鈕
- **建立預算頁（S-308）**：預算範圍、金額時間、監控設定

### 2.4 分析功能群（Epic 7-9）
基於6021文件 S-401 至 S-406 畫面規格：

#### 2.4.1 報表分析功能
- **報表分析主頁（S-401）**：報表類型、快速生成、模板管理
- **報表設定頁（S-402）**：時間範圍、資料篩選、圖表選擇
- **圖表展示頁（S-403）**：動態圖表、數據鑽取、匯出分享
- **報表下載頁（S-404）**：格式選擇、自訂範圍、分享設定

#### 2.4.2 AI 智慧分析
- **深度分析頁（S-405）**：趨勢分析、異常檢測、AI 建議
- **AI 助理頁（S-406）**：智慧分類、預算建議、異常提醒

### 2.5 系統功能群（Epic 10-15）
基於6021文件 S-501 至 S-507 畫面規格：

#### 2.5.1 激勵與備份功能
- **激勵系統頁（S-501）**：挑戰進度、成就徽章、獎勵記錄
- **資料備份頁（S-502）**：備份設定、恢復選項、同步狀態

#### 2.5.2 系統設定功能
- **安全設定頁（S-503）**：應用鎖、隱私模式、驗證設定
- **通知設定頁（S-504）**：提醒類型、時間設定、頻率管理
- **個人設定頁（S-505）**：個人資料、主題語言、偏好設定

#### 2.5.3 幫助與回報功能
- **幫助中心頁（S-506）**：操作教學、FAQ、客服聯繫
- **社群回報頁（S-507）**：錯誤回報、功能建議、系統狀態

---

## 3.0 架構設計（Architecture Design）

### 3.1 整體架構
Presentation layer 採用分層架構設計，確保清晰的職責分離與高度可維護性：

```
LCAS 2.0 Presentation layer Architecture
├── 展示層 (Presentation Layer)
│   ├── 頁面層 (Pages Layer)
│   │   ├── 進入階段頁面群 (Entry Pages Group)
│   │   ├── 記帳功能頁面群 (Bookkeeping Pages Group)
│   │   ├── 管理功能頁面群 (Management Pages Group)
│   │   ├── 分析功能頁面群 (Analytics Pages Group)
│   │   └── 系統功能頁面群 (System Pages Group)
│   ├── 組件層 (Components Layer)
│   │   ├── 四模式差異化組件 (Mode-specific Components)
│   │   ├── 共用UI組件 (Shared UI Components)
│   │   └── 業務邏輯組件 (Business Logic Components)
│   └── 主題層 (Theme Layer)
│       ├── Expert模式主題 (Expert Mode Theme)
│       ├── Inertial模式主題 (Inertial Mode Theme)
│       ├── Cultivation模式主題 (Cultivation Mode Theme)
│       └── Guiding模式主題 (Guiding Mode Theme)
├── 業務邏輯層 (Business Logic Layer)
│   ├── 狀態管理 (State Management)
│   │   ├── 認證狀態管理 (Auth State Management)
│   │   ├── 記帳狀態管理 (Bookkeeping State Management)
│   │   ├── 模式狀態管理 (Mode State Management)
│   │   └── 系統狀態管理 (System State Management)
│   └── 服務層 (Services Layer)
│       ├── API服務 (API Services)
│       ├── 本地儲存服務 (Local Storage Services)
│       ├── 通知服務 (Notification Services)
│       └── 同步服務 (Sync Services)
├── 資料層 (Data Layer)
│   ├── 遠端資料源 (Remote Data Source)
│   │   └── RESTful API Client
│   ├── 本地資料源 (Local Data Source)
│   │   ├── SQLite Database
│   │   └── SharedPreferences
│   └── 快取層 (Cache Layer)
│       ├── 記憶體快取 (Memory Cache)
│       └── 持久快取 (Persistent Cache)
└── 核心層 (Core Layer)
    ├── 配置管理 (Configuration Management)
    ├── 錯誤處理 (Error Handling)
    ├── 網路管理 (Network Management)
    └── 工具類 (Utilities)
```

### 3.2 四模式架構設計

#### 3.2.1 模式識別機制
```dart
// 模式識別與切換架構
enum UserMode {
  expert,     // 專家模式
  inertial,   // 慣性模式
  cultivation, // 養成模式
  guiding     // 引導模式
}

class ModeController {
  UserMode currentMode;
  void switchMode(UserMode newMode);
  Widget buildModeSpecificUI(UserMode mode);
}
```

#### 3.2.2 差異化組件架構
- **條件渲染組件**：根據用戶模式動態顯示不同UI元素
- **模式適配器**：自動調整功能複雜度與介面佈局
- **主題切換器**：四模式專屬的視覺風格與色彩配置

### 3.3 頁面路由架構

#### 3.3.1 路由結構設計
```dart
// 基於6021 Screen list的路由架構
const String ROUTE_APP_START = '/start';           // S-102
const String ROUTE_REGISTER = '/register';         // S-103
const String ROUTE_LOGIN = '/login';              // S-104
const String ROUTE_FORGOT_PASSWORD = '/forgot';    // S-105
const String ROUTE_MODE_ASSESSMENT = '/assessment'; // S-106
const String ROUTE_BINDING = '/binding';          // S-107
const String ROUTE_BOOKKEEPING_HOME = '/home';    // S-202
const String ROUTE_BOOKKEEPING_FORM = '/form';    // S-203
// ... 其他40個畫面路由
```

#### 3.3.2 導航控制邏輯
- **模式基礎導航**：根據用戶模式調整導航流程
- **權限控制導航**：基於用戶權限的頁面存取控制
- **深層連結支援**：支援外部應用的深層連結導航

### 3.4 狀態管理架構

#### 3.4.1 Provider 模式架構
```dart
// 主要狀態提供者
class AuthProvider extends ChangeNotifier {
  // 認證狀態管理
}

class BookkeepingProvider extends ChangeNotifier {
  // 記帳狀態管理
}

class ModeProvider extends ChangeNotifier {
  // 四模式狀態管理
}
```

#### 3.4.2 本地狀態與全域狀態分離
- **全域狀態**：用戶認證、模式設定、系統配置
- **頁面狀態**：表單輸入、載入狀態、錯誤處理
- **組件狀態**：UI互動、動畫效果、臨時資料

---

## 4.0 頁面群詳細規格（Page Groups Specification）

基於6021 Screen list的40個畫面，將Presentation Layer分為5大頁面群，每個頁面群對應特定的功能範圍與畫面群組：

### 4.1 進入階段頁面群（Entry Page Group）

#### 4.1.1 頁面群職責範圍
**對應畫面**：S-101至S-108（Epic 1: 進入階段畫面群）
**核心功能**：APP啟動、使用者認證、模式評估、跨平台整合

#### 4.1.2 子頁面架構
```dart
// 進入階段頁面群架構
entry_page_group/
├── app_startup/          // APP啟動頁面
│   ├── splash_screen.dart        // S-102 APP啟動頁
│   └── startup_controller.dart   // 啟動控制邏輯
├── authentication/       // 認證頁面
│   ├── register_screen.dart      // S-103 APP註冊頁
│   ├── login_screen.dart         // S-104 APP登入頁
│   ├── forgot_password_screen.dart // S-105 忘記密碼頁
│   └── auth_service.dart         // 認證API客戶端服務（消費8001 API）
├── user_assessment/      // 模式評估頁面
│   ├── assessment_screen.dart    // S-106 模式評估問卷頁
│   └── assessment_controller.dart // 評估邏輯控制
└── platform_binding/     // 跨平台綁定頁面
    ├── line_binding_screen.dart  // S-107 跨平台綁定頁
    └── promotion_screen.dart     // S-108 APP下載推廣頁
```

**重要說明**：
- **auth_service.dart** 等服務檔案是**API消費者**，呼叫8001 AP Layer定義的132個API端點
- **不會定義新的API**，而是封裝對8001 API的呼叫邏輯
- **專注於UI狀態管理**、**頁面導航**、**使用者互動處理**

#### 4.1.3 四模式差異化實現
```dart
// 模式差異化認證介面
class AuthenticationWidget extends StatelessWidget {
  final UserMode userMode;

  @override
  Widget build(BuildContext context) {
    switch (userMode) {
      case UserMode.expert:
        return ExpertAuthUI(
          showAdvancedOptions: true,
          enableSecurityFeatures: true,
        );
      case UserMode.inertial:
        return InertialAuthUI(
          fixedLayout: true,
          consistentFlow: true,
        );
      case UserMode.cultivation:
        return CultivationAuthUI(
          showMotivationText: true,
          progressIndicator: true,
        );
      case UserMode.guiding:
        return GuidingAuthUI(
          minimalForm: true,
          autoFillSuggestions: true,
        );
    }
  }
}
```

### 4.2 記帳核心頁面群（Bookkeeping Core Page Group）

#### 4.2.1 頁面群職責範圍
**對應畫面**：S-201至S-211（Epic 2: 記帳功能畫面群）
**核心功能**：記帳交易UI、統計圖表展示、記錄管理頁面

#### 4.2.2 子頁面架構
```dart
// 記帳核心頁面群架構
bookkeeping_core_page_group/
├── transaction_entry/    // 交易記錄頁面
│   ├── bookkeeping_home_screen.dart     // S-202 APP記帳主頁
│   ├── transaction_form_screen.dart     // S-203 APP記帳表單頁
│   ├── quick_record_widget.dart         // 快速記帳組件
│   ├── transaction_controller.dart      // 記帳頁面控制器
│   └── transaction_service.dart         // 記帳API客戶端（消費8001 /transactions/* API）
├── selection_pages/      // 選擇器頁面
│   ├── category_selector_screen.dart    // S-204 科目選擇頁
│   ├── account_selector_screen.dart     // S-205 帳戶選擇頁
│   ├── ledger_selector_screen.dart      // S-206 帳本選擇頁
│   └── selection_service.dart           // 選擇相關API客戶端
├── advanced_features/    // 進階功能頁面
│   ├── attachment_screen.dart           // S-207 圖片附加頁
│   ├── recurring_setting_screen.dart    // S-208 重複設定頁
│   └── advanced_controller.dart         // 進階功能控制器
├── record_management/    // 記錄管理頁面
│   ├── record_list_screen.dart          // S-209 記錄管理頁
│   ├── record_edit_screen.dart          // S-210 記錄編輯頁
│   └── record_controller.dart           // 記錄管理控制器
└── statistics/          // 統計分析頁面
│   ├── chart_screen.dart                // S-211 統計圖表頁
│   ├── dashboard_widget.dart            // 儀表板組件
│   └── statistics_service.dart          // 統計API客戶端（消費8001 /transactions/statistics API）
```

#### 4.2.3 四模式記帳表單差異
```dart
// 記帳表單四模式適配
class TransactionFormScreen extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    final userMode = Provider.of<ModeProvider>(context).currentMode;

    return Scaffold(
      body: _buildFormByMode(userMode),
    );
  }

  Widget _buildFormByMode(UserMode mode) {
    switch (mode) {
      case UserMode.expert:
        return ExpertTransactionForm(
          showAllFields: true,
          enableBatchEntry: true,
          advancedValidation: true,
        );
      case UserMode.inertial:
        return InertialTransactionForm(
          stepByStepFlow: true,
          fixedFieldOrder: true,
          consistentLayout: true,
        );
      case UserMode.cultivation:
        return CultivationTransactionForm(
          showHints: true,
          progressTracking: true,
          motivationalMessages: true,
        );
      case UserMode.guiding:
        return GuidingTransactionForm(
          minimalFields: true,
          autoSuggestions: true,
          oneClickComplete: true,
        );
    }
  }
}
```

### 4.3 管理功能頁面群（Management Page Group）

#### 4.3.1 頁面群職責範圍
**對應畫面**：S-301至S-308（Epic 3-6: 管理功能畫面群）
**核心功能**：帳本管理頁面、帳戶管理頁面、科目管理頁面、預算管理頁面

#### 4.3.2 子頁面架構
```dart
// 管理功能頁面群架構
management_page_group/
├── ledger_management/    // 帳本管理頁面
│   ├── ledger_home_screen.dart          // S-301 帳本管理主頁
│   ├── create_ledger_screen.dart        // S-302 建立帳本頁
│   ├── collaboration_screen.dart        // S-303 協作管理頁
│   ├── ledger_controller.dart           // 帳本頁面控制器
│   └── ledger_service.dart              // 帳本API客戶端（消費8001 /ledgers/* API）
├── account_management/   // 帳戶管理頁面
│   ├── account_home_screen.dart         // S-304 帳戶管理主頁
│   ├── create_account_screen.dart       // S-305 建立帳戶頁
│   ├── account_controller.dart          // 帳戶頁面控制器
│   └── account_service.dart             // 帳戶API客戶端（消費8001 /accounts/* API）
├── category_management/  // 科目管理頁面
│   ├── category_home_screen.dart        // S-306 科目管理主頁
│   ├── category_tree_widget.dart        // 科目樹狀結構組件
│   ├── category_controller.dart         // 科目頁面控制器
│   └── category_service.dart            // 科目API客戶端（消費8001 /categories/* API）
└── budget_management/    // 預算管理頁面
│   ├── budget_home_screen.dart          // S-307 預算管理主頁
│   ├── create_budget_screen.dart        // S-308 建立預算頁
│   ├── budget_controller.dart           // 預算頁面控制器
│   └── budget_service.dart              // 預算API客戶端（消費8001 /budgets/* API）
```

#### 4.3.3 協作管理四模式差異
```dart
// 協作管理差異化UI
class CollaborationScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final userMode = context.watch<ModeProvider>().currentMode;

    return Scaffold(
      appBar: AppBar(title: Text('協作管理')),
      body: _buildCollaborationUI(userMode),
    );
  }

  Widget _buildCollaborationUI(UserMode mode) {
    switch (mode) {
      case UserMode.expert:
        return ExpertCollaborationUI(
          granularPermissions: true,
          advancedAuditLog: true,
          batchOperations: true,
        );
      case UserMode.inertial:
        return InertialCollaborationUI(
          simplePermissions: true,
          standardLayout: true,
        );
      case UserMode.cultivation:
        return CultivationCollaborationUI(
          guidedInvitation: true,
          teamworkTips: true,
        );
      case UserMode.guiding:
        return GuidingCollaborationUI(
          basicPermissions: true,
          oneClickInvite: true,
        );
    }
  }
}
```

### 4.4 分析智慧頁面群（Analytics Intelligence Page Group）

#### 4.4.1 頁面群職責範圍
**對應畫面**：S-401至S-406（Epic 7-9: 分析功能畫面群）
**核心功能**：報表分析頁面、深度分析頁面、AI助理頁面

#### 4.4.2 子頁面架構
```dart
// 分析智慧頁面群架構
analytics_intelligence_page_group/
├── report_analytics/     // 報表分析頁面
│   ├── report_home_screen.dart          // S-401 報表分析主頁
│   ├── report_config_screen.dart        // S-402 報表設定頁
│   ├── chart_display_screen.dart        // S-403 圖表展示頁
│   ├── report_download_screen.dart      // S-404 報表下載頁
│   ├── report_controller.dart           // 報表頁面控制器
│   └── report_service.dart              // 報表API客戶端（消費8001 /reports/* API）
├── deep_analytics/       // 深度分析頁面
│   ├── insights_screen.dart             // S-405 深度分析頁
│   ├── trend_analysis_widget.dart       // 趨勢分析組件
│   ├── analytics_controller.dart        // 分析頁面控制器
│   └── analytics_service.dart           // 分析API客戶端（消費8001 /analytics/* API）
└── ai_assistant/         // AI助理頁面
│   ├── ai_assistant_screen.dart         // S-406 AI助理頁
│   ├── smart_categorization.dart        // 智慧分類組件
│   ├── budget_advisor.dart              // 預算建議組件
│   ├── ai_controller.dart               // AI頁面控制器
│   └── ai_service.dart                  // AI API客戶端（消費8001 /ai/* API）
```

#### 4.4.3 報表分析四模式適配
```dart
// 報表分析模式適配
class ReportHomeScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final userMode = context.watch<ModeProvider>().currentMode;

    return Scaffold(
      body: _buildReportInterface(userMode),
    );
  }

  Widget _buildReportInterface(UserMode mode) {
    switch (mode) {
      case UserMode.expert:
        return ExpertReportUI(
          customQueryBuilder: true,
          advancedFilters: true,
          exportFormats: ['PDF', 'Excel', 'CSV', 'JSON'],
        );
      case UserMode.inertial:
        return InertialReportUI(
          predefinedTemplates: true,
          standardCharts: true,
          exportFormats: ['PDF', 'Excel'],
        );
      case UserMode.cultivation:
        return CultivationReportUI(
          progressReports: true,
          goalTracking: true,
          motivationalInsights: true,
        );
      case UserMode.guiding:
        return GuidingReportUI(
          simpleCharts: true,
          autoGenerated: true,
          basicInsights: true,
        );
    }
  }
}
```

### 4.5 系統功能頁面群（System Function Page Group）

#### 4.5.1 頁面群職責範圍
**對應畫面**：S-501至S-507（Epic 10-15: 系統功能畫面群）
**核心功能**：激勵系統頁面、資料管理頁面、系統設定頁面、幫助支援頁面

#### 4.5.2 子頁面架構
```dart
// 系統功能頁面群架構
system_function_page_group/
├── gamification/         // 激勵系統頁面
│   ├── gamification_screen.dart         // S-501 激勵系統頁
│   ├── achievement_widget.dart          // 成就組件
│   ├── challenge_widget.dart            // 挑戰組件
│   ├── gamification_controller.dart     // 激勵頁面控制器
│   └── gamification_service.dart        // 激勵API客戶端（消費8001 /gamification/* API）
├── data_management/      // 資料管理頁面
│   ├── backup_screen.dart               // S-502 資料備份頁
│   ├── data_controller.dart             // 資料管理控制器
│   └── backup_service.dart              // 備份API客戶端（消費8001 /backup/* API）
├── system_settings/      // 系統設定頁面
│   ├── security_screen.dart             // S-503 安全設定頁
│   ├── notification_screen.dart         // S-504 通知設定頁
│   ├── profile_screen.dart              // S-505 個人設定頁
│   ├── settings_controller.dart         // 設定頁面控制器
│   ├── user_service.dart                // 用戶API客戶端（消費8001 /users/* API）
│   └── notification_service.dart        // 通知API客戶端（消費8001 /notifications/* API）
└── help_support/         // 幫助支援頁面
│   ├── help_center_screen.dart          // S-506 幫助中心頁
│   ├── feedback_screen.dart             // S-507 社群回報頁
│   ├── support_controller.dart          // 支援頁面控制器
│   └── system_service.dart              // 系統API客戶端（消費8001 /system/*, /help/* API）
```

#### 4.5.3 激勵系統四模式實現
```dart
// 激勵系統模式差異化
class GamificationScreen extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    final userMode = context.watch<ModeProvider>().currentMode;

    return Scaffold(
      appBar: AppBar(title: Text('激勵系統')),
      body: _buildGamificationUI(userMode),
    );
  }

  Widget _buildGamificationUI(UserMode mode) {
    switch (mode) {
      case UserMode.expert:
        return ExpertGamificationUI(
          detailedStats: true,
          customChallenges: true,
          advancedAnalytics: true,
        );
      case UserMode.inertial:
        return InertialGamificationUI(
          simpleAchievements: true,
          consistentRewards: true,
        );
      case UserMode.cultivation:
        return CultivationGamificationUI(
          habitTracking: true,
          progressVisualization: true,
          motivationalContent: true,
          socialFeatures: true,
        );
      case UserMode.guiding:
        return GuidingGamificationUI(
          basicAchievements: true,
          autoRewards: true,
          simpleProgress: true,
        );
    }
  }
}
```

### 4.6 頁面群協調機制

#### 4.6.1 API客戶端統一架構
**重要原則**：所有API客戶端**僅消費8020文件定義的132個API端點**，絕對不自創API

```dart
// 統一的API客戶端基類（嚴格遵循8020文件）
abstract class BaseApiService {
  final ApiClient apiClient;

  BaseApiService(this.apiClient);

  // 所有API呼叫必須對應8020文件第7章API總覽清單的132個端點
  // 展示層職責：UI狀態管理、頁面導航、使用者互動
}

// 認證API客戶端（消費8020文件第7.1節認證服務11個端點）
class AuthApiService extends BaseApiService {
  Future<AuthResponse> register(RegisterRequest request) async {
    return await apiClient.post('/auth/register', request);
  }

  Future<AuthResponse> login(LoginRequest request) async {
    return await apiClient.post('/auth/login', request);
  }
  // ... 其他9個認證端點
}

// 記帳API客戶端（消費8020文件第7.3節記帳交易20個端點）
class TransactionApiService extends BaseApiService {
  Future<List<Transaction>> getTransactions(TransactionQuery query) async {
    return await apiClient.get('/transactions', queryParams: query.toMap());
  }

  Future<Transaction> createTransaction(TransactionData data) async {
    return await apiClient.post('/transactions', data);
  }
  // ... 其他18個記帳端點
}
```

#### 4.6.2 頁面狀態管理架構
```dart
// 全域狀態管理架構
class AppStateManagement {
  // 核心狀態提供者（對應5大頁面群）
  static final providers = [
    ChangeNotifierProvider<ModeProvider>(create: (_) => ModeProvider()),
    ChangeNotifierProvider<AuthProvider>(create: (_) => AuthProvider()),
    ChangeNotifierProvider<BookkeepingProvider>(create: (_) => BookkeepingProvider()),
    ChangeNotifierProvider<ManagementProvider>(create: (_) => ManagementProvider()),
    ChangeNotifierProvider<AnalyticsProvider>(create: (_) => AnalyticsProvider()),
    ChangeNotifierProvider<SystemProvider>(create: (_) => SystemProvider()),
  ];
}
```

#### 4.6.3 四模式全域協調
```dart
// 四模式全域協調器
class ModeCoordinator {
  static Widget adaptWidget(Widget child, UserMode mode) {
    return ModeWrapper(
      mode: mode,
      child: child,
    );
  }

  static ThemeData getThemeByMode(UserMode mode) {
    switch (mode) {
      case UserMode.expert:
        return ExpertTheme.data;
      case UserMode.inertial:
        return InertialTheme.data;
      case UserMode.cultivation:
        return CultivationTheme.data;
      case UserMode.guiding:
        return GuidingTheme.data;
    }
  }
}
```

#### 4.6.4 API呼叫規範
**展示層API呼叫原則**：
1. **嚴格遵循8020文件**：僅使用132個已定義的API端點
2. **不自創任何API**：所有API呼叫必須對應8020文件第3章畫面功能對應
3. **封裝HTTP邏輯**：提供型別安全的API客戶端封裝
4. **專注UI職責**：處理使用者互動、頁面導航、狀態管理