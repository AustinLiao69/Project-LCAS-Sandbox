# 8213. 通知管理服務 - Low Level Design (LLD)

**版本**: 2.2.0  
**建立日期**: 2025-09-05  
**最後更新**: 2025-09-05  
**建立者**: SA  
**來源文件**: 8020. API list.md, 8088. API設計規範.md, 8113. 通知管理服務 API 規格.yaml

---

## 目次 (Table of Contents)

### 1. [簡介](#1-簡介)
### 2. [架構設計](#2-架構設計)
### 3. [模組與類別設計](#3-模組與類別設計)
### 4. [API 設計規格](#4-api-設計規格)
### 5. [資料模型設計](#5-資料模型設計)
### 6. [安全與驗證設計](#6-安全與驗證設計)
### 7. [錯誤處理設計](#7-錯誤處理設計)
### 8. [四模式支援設計](#8-四模式支援設計)
### 9. [測試設計策略](#9-測試設計策略)

---

## 1. 簡介

### 1.1 設計目的與範圍
通知管理服務提供 LCAS 2.0 系統的完整通知與提醒功能，採用 **Dart** 語言實作客戶端 API 介面。本文件定義系統架構、類別設計、方法規格及互動關係，專注於Low Level Design規格。

### 1.2 核心功能模組
- **通知管理模組**：建立、發送、狀態管理、歷史查詢
- **提醒系統模組**：定時提醒、週期性提醒、智慧提醒
- **推播服務模組**：即時推播、離線推播、批量發送
- **個人化設定模組**：偏好設定、免打擾模式、自訂規則
- **通道管理模組**：多通道支援、通道優先級、失敗轉移

### 1.3 設計遵循規範
- **完全遵循 8088. API設計規範**：統一回應格式、錯誤處理、四模式支援
- **對應 8113. 通知管理服務 API 規格**：確保端點定義一致
- **符合 8020. API list 映射關係**：支援所有對應畫面功能

---

## 2. 架構設計

### 2.1 系統分層架構
```
┌─────────────────────────────────────────┐
│            Controller Layer             │
│      (NotificationController)           │
├─────────────────────────────────────────┤
│            Service Layer                │
│  ┌─────────────┬─────────────┬────────┐ │
│  │NotifySvc    │ReminderSvc  │ PushSvc│ │
│  └─────────────┴─────────────┴────────┘ │
├─────────────────────────────────────────┤
│            Utility Layer                │
│  ┌─────────────┬─────────────────────┐  │
│  │ChannelMgr   │ TemplateEngine      │  │
│  └─────────────┴─────────────────────┘  │
├─────────────────────────────────────────┤
│            Data Access Layer            │
│         (Repository Pattern)            │
└─────────────────────────────────────────┘
```

### 2.2 類別關係圖
```
NotificationController
    ├─ depends on ──→ NotificationService
    ├─ depends on ──→ ReminderService
    ├─ depends on ──→ PushService
    ├─ depends on ──→ UserModeAdapter
    └─ depends on ──→ ErrorHandler

NotificationService
    ├─ depends on ──→ NotificationRepository
    ├─ depends on ──→ ChannelManager
    └─ depends on ──→ TemplateEngine
```

---

## 3. 模組與類別設計

### 3.1 NotificationController 類別設計

#### 3.1.1 類別職責
- 處理所有通知相關的HTTP請求
- 協調Service層處理業務邏輯
- 確保四模式差異化回應
- 統一錯誤處理與回應格式

#### 3.1.2 方法簽名規格

**通知管理方法**
```dart
/**
 * 01. 取得通知列表
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<NotificationListResponse>> getNotificationList(NotificationListRequest request);

/**
 * 02. 標記通知已讀
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<MarkNotificationReadResponse>> markNotificationRead(String notificationId);

/**
 * 03. 批量標記已讀
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<BatchMarkReadResponse>> batchMarkRead(BatchMarkReadRequest request);

/**
 * 04. 刪除通知
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<DeleteNotificationResponse>> deleteNotification(String notificationId);
```

**提醒管理方法**
```dart
/**
 * 05. 建立提醒
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<CreateReminderResponse>> createReminder(CreateReminderRequest request);

/**
 * 06. 取得提醒列表
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<ReminderListResponse>> getReminderList(ReminderListRequest request);

/**
 * 07. 更新提醒
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<UpdateReminderResponse>> updateReminder(String reminderId, UpdateReminderRequest request);

/**
 * 08. 刪除提醒
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<DeleteReminderResponse>> deleteReminder(String reminderId);
```

**設定管理方法**
```dart
/**
 * 09. 取得通知設定
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<NotificationSettingsResponse>> getNotificationSettings();

/**
 * 10. 更新通知設定
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ApiResponse<UpdateNotificationSettingsResponse>> updateNotificationSettings(UpdateNotificationSettingsRequest request);
```

### 3.2 NotificationService 類別設計

#### 3.2.1 類別職責
- 管理通知業務邏輯
- 處理通知發送流程
- 管理通知狀態變更
- 協調多通道通知

#### 3.2.2 方法簽名規格

**核心業務方法**
```dart
/**
 * 11. 建立通知
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<NotificationEntity> createNotification(CreateNotificationRequest request);

/**
 * 12. 發送通知
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<SendNotificationResult> sendNotification(String notificationId);

/**
 * 13. 更新通知狀態
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<void> updateNotificationStatus(String notificationId, NotificationStatus status);
```

**通知查詢方法**
```dart
/**
 * 14. 查詢使用者通知
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<List<NotificationEntity>> getUserNotifications(String userId, NotificationFilter filter);

/**
 * 15. 統計通知數量
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<NotificationCount> getNotificationCount(String userId);
```

### 3.3 ReminderService 類別設計

#### 3.3.1 類別職責
- 管理提醒系統邏輯
- 處理週期性提醒
- 執行智慧提醒算法
- 監控提醒觸發

#### 3.3.2 方法簽名規格

**提醒管理方法**
```dart
/**
 * 16. 處理提醒建立
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ReminderEntity> processReminderCreation(CreateReminderRequest request);

/**
 * 17. 調度提醒執行
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<void> scheduleReminder(ReminderEntity reminder);

/**
 * 18. 執行提醒觸發
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ReminderExecutionResult> executeReminder(String reminderId);
```

**智慧提醒方法**
```dart
/**
 * 19. 分析提醒模式
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ReminderPatternAnalysis> analyzeReminderPatterns(String userId);

/**
 * 20. 生成智慧提醒
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<List<SmartReminderSuggestion>> generateSmartReminders(String userId);
```

### 3.4 PushService 類別設計

#### 3.4.1 類別職責
- 管理推播通知
- 處理即時訊息傳送
- 支援離線推播
- 管理推播設備

#### 3.4.2 方法簽名規格

**推播方法**
```dart
/**
 * 21. 發送推播通知
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<PushResult> sendPushNotification(PushNotification notification);

/**
 * 22. 批量推播
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<BatchPushResult> sendBatchPushNotifications(List<PushNotification> notifications);

/**
 * 23. 註冊推播設備
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<DeviceRegistrationResult> registerPushDevice(DeviceRegistrationRequest request);
```

### 3.5 ChannelManager 類別設計

#### 3.5.1 類別職責
- 管理通知通道
- 處理通道優先級
- 執行失敗轉移
- 監控通道健康

#### 3.5.2 方法簽名規格

**通道管理方法**
```dart
/**
 * 24. 選擇通知通道
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<NotificationChannel> selectOptimalChannel(NotificationPreference preference, NotificationType type);

/**
 * 25. 檢查通道狀態
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<ChannelHealthStatus> checkChannelHealth(NotificationChannel channel);

/**
 * 26. 執行失敗轉移
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
Future<FailoverResult> performChannelFailover(NotificationChannel failedChannel, NotificationEntity notification);
```

---

## 4. 統一回應格式

### 4.1 成功回應格式

所有API端點遵循8088規範的統一回應格式：

```javascript
{
  "success": true,
  "data": {
    // 具體回應數據
  },
  "metadata": {
    "timestamp": "2025-09-19T10:00:00Z",
    "requestId": "req_unique_id",
    "userMode": "Expert|Inertial|Cultivation|Guiding",
    "apiVersion": "v1.0.0",
    "processingTimeMs": 150
  }
}
```

### 4.2 HTTP狀態碼使用規範

| 狀態碼 | 使用場景 | 說明 |
|--------|----------|------|
| 200 | 查詢成功 | 成功取得通知資料 |
| 201 | 建立成功 | 成功建立通知 |
| 204 | 刪除成功 | 成功刪除通知，無回應內容 |
| 400 | 請求錯誤 | 參數驗證失敗 |
| 401 | 未授權 | JWT token無效 |
| 403 | 權限不足 | 無權限存取通知功能 |
| 404 | 找不到資源 | 通知不存在 |
| 422 | 業務邏輯錯誤 | 通知邏輯驗證失敗 |
| 500 | 系統錯誤 | 伺服器內部錯誤 |

---

## 5. API 設計規格

### 4.1 標準回應格式

**ApiResponse 泛型類別**
```dart
/**
 * 27. API回應基礎類別
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
class ApiResponse<T> {
  final bool success;
  final T? data;
  final ApiMetadata metadata;
  final ApiError? error;

  // 建構子定義
  ApiResponse.success({required T data, required ApiMetadata metadata});
  ApiResponse.error({required ApiError error, required ApiMetadata metadata});

  // 工廠方法
  static ApiResponse<T> createSuccess<T>(T data, ApiMetadata metadata);
  static ApiResponse<T> createError<T>(ApiError error, ApiMetadata metadata);

  // JSON 轉換方法
  Map<String, dynamic> toJson();
  static ApiResponse<T> fromJson<T>(Map<String, dynamic> json, T Function(Map<String, dynamic>) fromJsonT);
}
```

### 4.2 API 端點映射規格

遵循 **8113. 通知管理服務 API 規格.yaml** 的定義：

| 端點 | HTTP 方法 | Controller 方法 | 對應畫面 |
|------|----------|----------------|----------|
| `/notifications` | GET | `getNotificationList(NotificationListRequest)` | S-601 |
| `/notifications/{id}/read` | PUT | `markNotificationRead(String)` | S-601 |
| `/notifications/batch-read` | PUT | `batchMarkRead(BatchMarkReadRequest)` | S-601 |
| `/notifications/{id}` | DELETE | `deleteNotification(String)` | S-601 |
| `/reminders` | POST | `createReminder(CreateReminderRequest)` | S-601 |
| `/reminders` | GET | `getReminderList(ReminderListRequest)` | S-601 |
| `/reminders/{id}` | PUT | `updateReminder(String, UpdateReminderRequest)` | S-601 |
| `/reminders/{id}` | DELETE | `deleteReminder(String)` | S-601 |
| `/notifications/settings` | GET | `getNotificationSettings()` | S-601 |
| `/notifications/settings` | PUT | `updateNotificationSettings(UpdateNotificationSettingsRequest)` | S-601 |

---

## 5. 資料模型設計

### 5.1 請求資料模型

#### 5.1.1 NotificationListRequest 類別規格

```dart
/**
 * 28. 通知列表請求
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
class NotificationListRequest {
  final NotificationStatus? status;
  final NotificationType? type;
  final DateTime? startDate;
  final DateTime? endDate;
  final int limit;
  final int offset;
  final SortBy sortBy;
  final SortOrder sortOrder;

  // 建構子
  NotificationListRequest({required limit, required offset, ...});

  // 驗證方法
  List<ValidationError> validate();

  // 轉換方法
  Map<String, dynamic> toJson();
  static NotificationListRequest fromJson(Map<String, dynamic> json);
}
```

#### 5.1.2 CreateReminderRequest 類別規格

```dart
/**
 * 29. 建立提醒請求
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
class CreateReminderRequest {
  final String title;
  final String? description;
  final DateTime reminderTime;
  final ReminderType type;
  final RepeatPattern? repeatPattern;
  final ReminderPriority priority;
  final Map<String, dynamic>? metadata;

  // 方法定義
  CreateReminderRequest({required title, required reminderTime, required type, ...});
  List<ValidationError> validate();
  Map<String, dynamic> toJson();
  static CreateReminderRequest fromJson(Map<String, dynamic> json);
}
```

### 5.2 回應資料模型

#### 5.2.1 NotificationListResponse 類別規格

```dart
/**
 * 30. 通知列表回應
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
class NotificationListResponse {
  final List<NotificationSummary> notifications;
  final NotificationCount count;
  final Pagination pagination;
  final List<NotificationCategory> categories;
  final DateTime? lastUpdateTime;

  // 方法定義
  NotificationListResponse({required notifications, required count, ...});
  Map<String, dynamic> toJson();
  static NotificationListResponse fromJson(Map<String, dynamic> json);
}
```

#### 5.2.2 NotificationSettingsResponse 類別規格

```dart
/**
 * 31. 通知設定回應
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
class NotificationSettingsResponse {
  final Map<NotificationType, bool> enabledTypes;
  final Map<NotificationChannel, ChannelSettings> channelSettings;
  final QuietHours? quietHours;
  final NotificationFrequency frequency;
  final bool smartNotificationsEnabled;

  // 方法定義
  NotificationSettingsResponse({required enabledTypes, required channelSettings, ...});
  Map<String, dynamic> toJson();
  static NotificationSettingsResponse fromJson(Map<String, dynamic> json);
}
```

### 5.3 資料存取層設計

#### 5.3.1 NotificationRepository 介面規格

```dart
/**
 * 32. 通知資料存取介面
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationRepository {
  Future<List<NotificationEntity>> getUserNotifications(String userId, NotificationFilter filter);
  Future<NotificationEntity?> getNotification(String notificationId);
  Future<NotificationEntity> createNotification(NotificationEntity notification);
  Future<NotificationEntity> updateNotification(NotificationEntity notification);
  Future<void> deleteNotification(String notificationId);
  Future<List<ReminderEntity>> getUserReminders(String userId);
  Future<ReminderEntity> createReminder(ReminderEntity reminder);
  Future<ReminderEntity> updateReminder(ReminderEntity reminder);
  Future<void> deleteReminder(String reminderId);
}
```

#### 5.3.2 NotificationEntity 類別規格

```dart
/**
 * 33. 通知實體類別
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
class NotificationEntity {
  final String id;
  final String userId;
  final String title;
  final String content;
  final NotificationType type;
  final NotificationStatus status;
  final NotificationPriority priority;
  final DateTime createdAt;
  final DateTime? readAt;
  final DateTime? scheduledAt;
  final Map<String, dynamic>? metadata;
  final NotificationChannel channel;

  // 方法定義
  NotificationEntity({required id, ...});
  Map<String, dynamic> toFirestore();
  static NotificationEntity fromFirestore(Map<String, dynamic> data, String id);
  bool isRead();
  bool isExpired();
  Duration getAge();
}
```

---

## 6. 安全與驗證設計

### 6.1 驗證服務設計

#### 6.1.1 NotificationValidationService 類別規格

```dart
/**
 * 34. 通知驗證服務
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationValidationService {
  Future<ValidationResult> validateNotificationAccess(String userId, String notificationId);
  Future<ValidationResult> validateReminderCreation(CreateReminderRequest request);
  bool validateNotificationContent(String content);
  bool validateReminderTime(DateTime reminderTime);
}
```

### 6.2 安全檢查設計

#### 6.2.1 NotificationSecurityService 類別規格

```dart
/**
 * 35. 通知安全服務
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationSecurityService {
  Future<bool> canAccessNotification(String userId, String notificationId);
  Future<bool> canCreateReminder(String userId);
  Future<bool> canSendNotification(String senderId, String recipientId);
  Future<RateLimitStatus> checkNotificationRateLimit(String userId);
}
```

---

## 7. 錯誤處理設計

### 7.1 錯誤碼定義

#### 7.1.1 NotificationErrorCode 枚舉

```dart
/**
 * 36. 通知錯誤碼枚舉
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
enum NotificationErrorCode {
  NOTIFICATION_NOT_FOUND,
  REMINDER_NOT_FOUND,
  INVALID_REMINDER_TIME,
  NOTIFICATION_SEND_FAILED,
  CHANNEL_UNAVAILABLE,
  RATE_LIMIT_EXCEEDED,
  INVALID_SETTINGS,
  PERMISSION_DENIED
}
```

### 7.2 錯誤處理服務

#### 7.2.1 NotificationErrorHandler 類別規格

```dart
/**
 * 37. 通知錯誤處理器
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationErrorHandler {
  ApiResponse<T> handleException<T>(Exception exception, UserMode userMode);
  ApiError createValidationError(List<ValidationError> errors, UserMode userMode);
  ApiError createBusinessLogicError(NotificationErrorCode code, String message, UserMode userMode);
  String getLocalizedErrorMessage(NotificationErrorCode code, UserMode userMode);
}
```

---

## 8. 四模式支援設計

### 8.1 模式差異化策略

嚴格遵循 **8088. API設計規範** 的四模式支援規範：

#### 8.1.1 NotificationModeConfig 類別規格

```dart
/**
 * 38. 通知模式配置服務
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationModeConfig {
  NotificationModeSettings getConfigForMode(UserMode mode);
  List<String> getAvailableFeatures(UserMode mode);
  NotificationSettings getDefaultSettings(UserMode mode);
  bool isFeatureEnabled(UserMode mode, String feature);
}
```

#### 8.1.2 NotificationResponseFilter 類別規格

```dart
/**
 * 39. 通知回應過濾器
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationResponseFilter {
  Map<String, dynamic> filterForExpert(Map<String, dynamic> data);
  Map<String, dynamic> filterForInertial(Map<String, dynamic> data);
  Map<String, dynamic> filterForCultivation(Map<String, dynamic> data);
  Map<String, dynamic> filterForGuiding(Map<String, dynamic> data);
}
```

### 8.2 模式特定回應策略

#### 8.2.1 Expert Mode 回應特性
- 包含詳細的通知統計和分析資料
- 提供進階通知設定和客製化選項
- 顯示完整的通知歷史和追蹤資訊

#### 8.2.2 Cultivation Mode 回應特性
- 強調學習型通知和教育提醒
- 包含個人成長相關的智慧建議
- 提供習慣養成的鼓勵性通知

#### 8.2.3 Guiding Mode 回應特性
- 極簡化的通知展示和管理
- 隱藏複雜的設定選項
- 提供清晰直接的重要通知

---

## 9. 測試設計策略

### 9.1 測試分層策略

#### 9.1.1 單元測試設計

**NotificationController 測試規格**
```dart
/**
 * 40. 通知控制器測試
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationControllerTest {
  void testGetNotificationListWithValidRequest();
  void testMarkNotificationReadWithValidId();
  void testCreateReminderWithValidData();
  void testUpdateNotificationSettingsWithValidData();
}
```

**NotificationService 測試規格**
```dart
/**
 * 41. 通知服務測試
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationServiceTest {
  void testNotificationCreation();
  void testNotificationSending();
  void testReminderScheduling();
  void testChannelFailover();
}
```

#### 9.1.2 整合測試設計

**Notification API 整合測試規格**
```dart
/**
 * 42. 通知API整合測試
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationAPIIntegrationTest {
  void testCompleteNotificationFlow();
  void testReminderManagement();
  void testPushNotificationDelivery();
  void testNotificationModeFiltering();
}
```

### 9.2 四模式測試設計

#### 9.2.1 模式差異化測試規格

```dart
/**
 * 43. 通知模式測試
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationModeTest {
  void testExpertModeResponse();
  void testInertialModeResponse();
  void testCultivationModeResponse();
  void testGuidingModeResponse();
  void testModeResponseConsistency();
  void testNotificationFiltering();
}
```

---

## 附錄

### A. 資料類型定義

#### A.1 枚舉類型定義

```dart
enum NotificationStatus { pending, sent, delivered, read, failed }
enum NotificationType { system, reminder, achievement, budget_alert, promotion }
enum NotificationPriority { low, normal, high, urgent }
enum NotificationChannel { push, email, sms, in_app }
enum ReminderType { one_time, recurring, smart }
enum RepeatPattern { daily, weekly, monthly, yearly, custom }
enum SortBy { created_date, read_date, priority, type }
enum SortOrder { asc, desc }
enum UserMode { expert, inertial, cultivation, guiding }
```

### B. 介面契約定義

#### B.1 Notification Delivery 基礎介面

```dart
/**
 * 44. 通知傳送基礎介面
 * @version 2025-09-05-V1.0.0
 * @date 2025-09-05 12:00:00
 * @update: 初始版本
 */
abstract class NotificationDeliveryProvider {
  Future<DeliveryResult> sendNotification(NotificationPayload payload);
  Future<bool> isChannelAvailable();
  Future<DeliveryStatus> getDeliveryStatus(String notificationId);
  Future<void> handleDeliveryFailure(String notificationId, FailureReason reason);
}
```

---

**文件完成日期**: 2025-09-05  
**版本**: 2.2.0  
**維護者**: LCAS SA Team  
**規範遵循**: 完全遵循 8020、8088、8113 文件規範，移除所有程式碼實作，專注於 Low Level Design 架構設計