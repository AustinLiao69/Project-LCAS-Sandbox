
# 7202. è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤_LLD.md

**æ–‡ä»¶ç·¨è™Ÿ**: 7202  
**ç‰ˆæœ¬**: v1.0.0  
**å»ºç«‹æ—¥æœŸ**: 2025-09-11  
**å»ºç«‹è€…**: LCAS SA Team  
**æœ€å¾Œæ›´æ–°**: 2025-09-11  

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æ¶æ§‹è¨­è¨ˆ (Architecture Design)](#10-æ¶æ§‹è¨­è¨ˆarchitecture-design)
2. [Widgetçµæ§‹è¨­è¨ˆ (Widget Structure Design)](#20-widgetçµæ§‹è¨­è¨ˆwidget-structure-design)
3. [ç‹€æ…‹ç®¡ç†è¨­è¨ˆ (State Management Design)](#30-ç‹€æ…‹ç®¡ç†è¨­è¨ˆstate-management-design)
4. [å°èˆªæµç¨‹è¨­è¨ˆ (Navigation Flow Design)](#40-å°èˆªæµç¨‹è¨­è¨ˆnavigation-flow-design)
5. [APIé›†æˆè¨­è¨ˆ (API Integration Design)](#50-apié›†æˆè¨­è¨ˆapi-integration-design)
6. [å››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆ (Four Mode Design)](#60-å››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆfour-mode-design)
7. [å‡½æ•¸ä»‹é¢è¦æ ¼ (Function Interface Specifications)](#70-å‡½æ•¸ä»‹é¢è¦æ ¼function-interface-specifications)

---

## 1.0 æ¶æ§‹è¨­è¨ˆï¼ˆArchitecture Designï¼‰

### 1.1 æ¨¡çµ„æ¶æ§‹ç¸½è¦½

æœ¬åŠŸèƒ½ç¾¤æ¡ç”¨**Provider + Repository**æ¨¡å¼çš„åˆ†å±¤æ¶æ§‹ï¼Œç¢ºä¿ä»£ç¢¼å¯ç¶­è­·æ€§èˆ‡å¯æ¸¬è©¦æ€§ï¼š

```
è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤æ¶æ§‹
â”œâ”€â”€ Presentation Layer (UI)
â”‚   â”œâ”€â”€ Screens (ç•«é¢çµ„ä»¶)
â”‚   â”œâ”€â”€ Widgets (å¯å¾©ç”¨çµ„ä»¶)
â”‚   â””â”€â”€ Four Mode Adapters (å››æ¨¡å¼é©é…å™¨)
â”œâ”€â”€ State Management (ç‹€æ…‹ç®¡ç†)
â”‚   â”œâ”€â”€ Providers (ç‹€æ…‹æä¾›è€…)
â”‚   â”œâ”€â”€ Models (è³‡æ–™æ¨¡å‹)
â”‚   â””â”€â”€ Notifiers (è®Šæ›´é€šçŸ¥)
â”œâ”€â”€ Business Logic (æ¥­å‹™é‚è¼¯)
â”‚   â”œâ”€â”€ Services (æœå‹™å±¤)
â”‚   â”œâ”€â”€ Repositories (è³‡æ–™å€‰åº«)
â”‚   â””â”€â”€ Use Cases (ç”¨ä¾‹å±¤)
â””â”€â”€ Data Access (è³‡æ–™å­˜å–)
    â”œâ”€â”€ API Clients (APIå®¢æˆ¶ç«¯)
    â”œâ”€â”€ Local Storage (æœ¬åœ°å„²å­˜)
    â””â”€â”€ Cache Management (å¿«å–ç®¡ç†)
```

### 1.2 ä¾è³´æ³¨å…¥è¨­è¨ˆ

/**
 * 01. ä¾è³´æ³¨å…¥å®¹å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class DependencyContainer {
  static void registerAccountingDependencies();
  static T get<T>();
  static void dispose();
}

### 1.3 æ¶æ§‹å±¤ç´šå®šç¾©

/**
 * 02. æ¶æ§‹å±¤ç´šæšèˆ‰
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
enum ArchitectureLayer {
  presentation,
  stateManagement, 
  businessLogic,
  dataAccess
}

---

## 2.0 Widgetçµæ§‹è¨­è¨ˆï¼ˆWidget Structure Designï¼‰

### 2.1 æ ¸å¿ƒç•«é¢Widgetçµæ§‹

#### 2.1.1 LINE OAè¨˜å¸³å°è©±é  (S-201)

/**
 * 03. LINE OAè¨˜å¸³å°è©±è™•ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class LineOADialogHandler extends StatefulWidget {
  Future<void> handleQuickAccounting(String input);
  Future<void> handleInquiry(String query);
  Future<void> handleStatistics(String period);
}

#### 2.1.2 APPè¨˜å¸³ä¸»é  (S-202)

/**
 * 04. è¨˜å¸³ä¸»é Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingHomePage extends StatefulWidget {
  Widget buildDashboard();
  Widget buildQuickActions();
  Widget buildRecentTransactions();
  Widget buildStatisticsSummary();
}

/**
 * 05. å„€è¡¨æ¿çµ„ä»¶
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class DashboardWidget extends StatelessWidget {
  Widget buildBalanceCard();
  Widget buildMonthlyOverview();
  Widget buildBudgetProgress();
  Widget buildQuickStats();
}

#### 2.1.3 APPè¨˜å¸³è¡¨å–®é  (S-203)

/**
 * 06. è¨˜å¸³è¡¨å–®Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingFormPage extends StatefulWidget {
  Widget buildTransactionTypeSelector();
  Widget buildAmountInput();
  Widget buildCategorySelector();
  Widget buildAccountSelector();
  Widget buildDatePicker();
  Widget buildDescriptionInput();
  Widget buildAttachmentSection();
  Widget buildSubmitButton();
}

### 2.2 é¸æ“‡å™¨Widgetçµ„ä»¶

#### 2.2.1 ç§‘ç›®é¸æ“‡å™¨ (S-204)

/**
 * 07. ç§‘ç›®é¸æ“‡å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class CategorySelectorWidget extends StatefulWidget {
  Widget buildCategoryTree();
  Widget buildSearchBar();
  Widget buildFrequentCategories();
  Widget buildRecentCategories();
  Future<void> onCategorySelected(String categoryId);
}

#### 2.2.2 å¸³æˆ¶é¸æ“‡å™¨ (S-205)

/**
 * 08. å¸³æˆ¶é¸æ“‡å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountSelectorWidget extends StatefulWidget {
  Widget buildAccountList();
  Widget buildAccountTypeFilter();
  Widget buildBalanceDisplay();
  Future<void> onAccountSelected(String accountId);
}

#### 2.2.3 å¸³æœ¬é¸æ“‡å™¨ (S-206)

/**
 * 09. å¸³æœ¬é¸æ“‡å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class LedgerSelectorWidget extends StatefulWidget {
  Widget buildLedgerList();
  Widget buildLedgerTypeFilter();
  Widget buildCreateLedgerButton();
  Future<void> onLedgerSelected(String ledgerId);
}

### 2.3 é€²éšåŠŸèƒ½Widgetçµ„ä»¶

#### 2.3.1 åœ–ç‰‡é™„åŠ å™¨ (S-207)

/**
 * 10. åœ–ç‰‡é™„åŠ å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class ImageAttachmentWidget extends StatefulWidget {
  Widget buildImagePreview();
  Widget buildImageControls();
  Future<void> captureImage();
  Future<void> selectFromGallery();
  Future<void> uploadImages(List<File> images);
}

#### 2.3.2 é‡è¤‡è¨­å®šå™¨ (S-208)

/**
 * 11. é‡è¤‡è¨­å®šå™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class RecurringSetupWidget extends StatefulWidget {
  Widget buildFrequencySelector();
  Widget buildEndDatePicker();
  Widget buildPreview();
  Future<void> saveRecurringSettings(RecurringConfig config);
}

### 2.4 ç®¡ç†èˆ‡ç·¨è¼¯Widgetçµ„ä»¶

#### 2.4.1 è¨˜éŒ„ç®¡ç†å™¨ (S-209)

/**
 * 12. è¨˜éŒ„ç®¡ç†å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionManagerWidget extends StatefulWidget {
  Widget buildTransactionList();
  Widget buildFilterControls();
  Widget buildSearchBar();
  Widget buildBatchActions();
  Future<void> onTransactionEdit(String transactionId);
  Future<void> onTransactionDelete(String transactionId);
}

#### 2.4.2 è¨˜éŒ„ç·¨è¼¯å™¨ (S-210)

/**
 * 13. è¨˜éŒ„ç·¨è¼¯å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionEditorWidget extends StatefulWidget {
  Widget buildEditForm();
  Widget buildVersionHistory();
  Future<void> loadTransaction(String transactionId);
  Future<void> saveChanges(Transaction updatedTransaction);
}

#### 2.4.3 çµ±è¨ˆåœ–è¡¨å™¨ (S-211)

/**
 * 14. çµ±è¨ˆåœ–è¡¨å™¨Widget
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class StatisticsChartWidget extends StatefulWidget {
  Widget buildChartSelector();
  Widget buildPeriodSelector();
  Widget buildChart();
  Future<void> generateChart(ChartType type, DateRange period);
}

---

## 3.0 ç‹€æ…‹ç®¡ç†è¨­è¨ˆï¼ˆState Management Designï¼‰

### 3.1 Provideræ¶æ§‹è¨­è¨ˆ

è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤ä½¿ç”¨**Provider**æ¨¡å¼é€²è¡Œç‹€æ…‹ç®¡ç†ï¼Œæ¯å€‹æ¥­å‹™åŸŸè¨­ç½®ç¨ç«‹çš„Providerï¼š

#### 3.1.1 äº¤æ˜“ç‹€æ…‹ç®¡ç†

/**
 * 15. äº¤æ˜“ç‹€æ…‹ç®¡ç†Provider
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionStateProvider extends ChangeNotifier {
  List<Transaction> get transactions;
  Transaction? get currentTransaction;
  bool get isLoading;
  String? get errorMessage;
  
  Future<void> loadTransactions();
  Future<void> createTransaction(Transaction transaction);
  Future<void> updateTransaction(String id, Transaction transaction);
  Future<void> deleteTransaction(String id);
  void setCurrentTransaction(Transaction? transaction);
  void clearError();
}

#### 3.1.2 ç§‘ç›®ç‹€æ…‹ç®¡ç†

/**
 * 16. ç§‘ç›®ç‹€æ…‹ç®¡ç†Provider
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class CategoryStateProvider extends ChangeNotifier {
  List<Category> get categories;
  List<Category> get frequentCategories;
  List<Category> get recentCategories;
  Category? get selectedCategory;
  bool get isLoading;
  
  Future<void> loadCategories();
  Future<void> selectCategory(String categoryId);
  List<Category> searchCategories(String query);
  void clearSelection();
}

#### 3.1.3 å¸³æˆ¶ç‹€æ…‹ç®¡ç†

/**
 * 17. å¸³æˆ¶ç‹€æ…‹ç®¡ç†Provider
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountStateProvider extends ChangeNotifier {
  List<Account> get accounts;
  Account? get selectedAccount;
  Map<String, double> get balances;
  bool get isLoading;
  
  Future<void> loadAccounts();
  Future<void> selectAccount(String accountId);
  Future<void> refreshBalances();
  void clearSelection();
}

#### 3.1.4 å¸³æœ¬ç‹€æ…‹ç®¡ç†

/**
 * 18. å¸³æœ¬ç‹€æ…‹ç®¡ç†Provider
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class LedgerStateProvider extends ChangeNotifier {
  List<Ledger> get ledgers;
  Ledger? get currentLedger;
  bool get isLoading;
  
  Future<void> loadLedgers();
  Future<void> selectLedger(String ledgerId);
  Future<void> createLedger(Ledger ledger);
  void clearSelection();
}

#### 3.1.5 çµ±è¨ˆç‹€æ…‹ç®¡ç†

/**
 * 19. çµ±è¨ˆç‹€æ…‹ç®¡ç†Provider
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class StatisticsStateProvider extends ChangeNotifier {
  DashboardData? get dashboardData;
  List<ChartData> get chartData;
  DateRange get selectedPeriod;
  ChartType get selectedChartType;
  bool get isLoading;
  
  Future<void> loadDashboardData();
  Future<void> generateChart(ChartType type, DateRange period);
  void setPeriod(DateRange period);
  void setChartType(ChartType type);
}

#### 3.1.6 è¡¨å–®ç‹€æ…‹ç®¡ç†

/**
 * 20. è¡¨å–®ç‹€æ…‹ç®¡ç†Provider
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class FormStateProvider extends ChangeNotifier {
  Transaction get draftTransaction;
  bool get hasUnsavedChanges;
  Map<String, String> get validationErrors;
  bool get isSubmitting;
  
  void updateAmount(double amount);
  void updateCategory(String categoryId);
  void updateAccount(String accountId);
  void updateDescription(String description);
  void updateDate(DateTime date);
  Future<void> submitTransaction();
  Future<void> saveDraft();
  Future<void> loadDraft();
  void clearForm();
  bool validateForm();
}

### 3.2 ç‹€æ…‹åŒæ­¥æ©Ÿåˆ¶

/**
 * 21. ç‹€æ…‹åŒæ­¥ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class StateSyncManager {
  static Future<void> syncAllStates();
  static Future<void> syncTransactionState();
  static Future<void> syncDashboardState();
  static void registerSyncListener(VoidCallback callback);
  static void unregisterSyncListener(VoidCallback callback);
}

---

## 4.0 å°èˆªæµç¨‹è¨­è¨ˆï¼ˆNavigation Flow Designï¼‰

### 4.1 å°èˆªæ¶æ§‹

è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤æ¡ç”¨**Named Routes**é…åˆ**Custom Navigation Delegates**çš„æ–¹å¼ç®¡ç†å°èˆªï¼š

#### 4.1.1 è·¯ç”±å®šç¾©

/**
 * 22. è¨˜å¸³è·¯ç”±ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingRoutes {
  static const String home = '/accounting/home';
  static const String form = '/accounting/form';
  static const String categorySelector = '/accounting/category-selector';
  static const String accountSelector = '/accounting/account-selector';
  static const String ledgerSelector = '/accounting/ledger-selector';
  static const String imageAttachment = '/accounting/image-attachment';
  static const String recurringSetup = '/accounting/recurring-setup';
  static const String transactionManager = '/accounting/transaction-manager';
  static const String transactionEditor = '/accounting/transaction-editor';
  static const String statisticsChart = '/accounting/statistics-chart';
  
  static Map<String, WidgetBuilder> getRoutes();
  static Route<T>? generateRoute<T>(RouteSettings settings);
}

#### 4.1.2 å°èˆªæ§åˆ¶å™¨

/**
 * 23. è¨˜å¸³å°èˆªæ§åˆ¶å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingNavigationController {
  static Future<void> toAccountingHome();
  static Future<void> toAccountingForm({Transaction? initialData});
  static Future<Category?> toCategorySelector({String? selectedId});
  static Future<Account?> toAccountSelector({String? selectedId});
  static Future<Ledger?> toLedgerSelector({String? selectedId});
  static Future<List<File>?> toImageAttachment({List<File>? existingImages});
  static Future<RecurringConfig?> toRecurringSetup({RecurringConfig? config});
  static Future<void> toTransactionManager({Map<String, dynamic>? filters});
  static Future<Transaction?> toTransactionEditor(String transactionId);
  static Future<void> toStatisticsChart({ChartType? type, DateRange? period});
}

### 4.2 å°èˆªæµç¨‹å®šç¾©

#### 4.2.1 è¨˜å¸³æµç¨‹å°èˆª

/**
 * 24. è¨˜å¸³æµç¨‹å°èˆªç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingFlowNavigator {
  static Future<Transaction?> startQuickAccounting();
  static Future<Transaction?> startFullAccounting();
  static Future<void> continueFromDraft(Transaction draft);
  static Future<void> handleAccountingComplete(Transaction transaction);
}

#### 4.2.2 é¸æ“‡æµç¨‹å°èˆª

/**
 * 25. é¸æ“‡æµç¨‹å°èˆªç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class SelectionFlowNavigator {
  static Future<SelectionResult?> startCategorySelection();
  static Future<SelectionResult?> startAccountSelection();
  static Future<SelectionResult?> startLedgerSelection();
  static Future<void> handleSelectionComplete(SelectionResult result);
}

---

## 5.0 APIé›†æˆè¨­è¨ˆï¼ˆAPI Integration Designï¼‰

### 5.1 APIå®¢æˆ¶ç«¯è¨­è¨ˆ

è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤ä¸»è¦é›†æˆä¸‰å€‹APIæœå‹™ï¼š8103è¨˜å¸³äº¤æ˜“æœå‹™ã€8105å¸³æˆ¶ç®¡ç†æœå‹™ã€8106ç§‘ç›®ç®¡ç†æœå‹™ã€‚

#### 5.1.1 è¨˜å¸³äº¤æ˜“æœå‹™å®¢æˆ¶ç«¯

/**
 * 26. è¨˜å¸³äº¤æ˜“APIå®¢æˆ¶ç«¯
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionApiClient {
  Future<ApiResponse<Transaction>> createTransaction(CreateTransactionRequest request);
  Future<ApiResponse<List<Transaction>>> getTransactions(GetTransactionsRequest request);
  Future<ApiResponse<Transaction>> getTransaction(String transactionId);
  Future<ApiResponse<Transaction>> updateTransaction(String transactionId, UpdateTransactionRequest request);
  Future<ApiResponse<void>> deleteTransaction(String transactionId);
  Future<ApiResponse<DashboardData>> getDashboardData(GetDashboardRequest request);
  Future<ApiResponse<StatisticsData>> getStatistics(GetStatisticsRequest request);
  Future<ApiResponse<QuickAccountingResult>> quickAccounting(QuickAccountingRequest request);
  Future<ApiResponse<List<ChartData>>> getChartData(GetChartDataRequest request);
}

#### 5.1.2 å¸³æˆ¶ç®¡ç†æœå‹™å®¢æˆ¶ç«¯

/**
 * 27. å¸³æˆ¶ç®¡ç†APIå®¢æˆ¶ç«¯
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountApiClient {
  Future<ApiResponse<List<Account>>> getAccounts(GetAccountsRequest request);
  Future<ApiResponse<Account>> getAccount(String accountId);
  Future<ApiResponse<Map<String, double>>> getAccountBalances(List<String> accountIds);
  Future<ApiResponse<Account>> createAccount(CreateAccountRequest request);
  Future<ApiResponse<Account>> updateAccount(String accountId, UpdateAccountRequest request);
}

#### 5.1.3 ç§‘ç›®ç®¡ç†æœå‹™å®¢æˆ¶ç«¯

/**
 * 28. ç§‘ç›®ç®¡ç†APIå®¢æˆ¶ç«¯
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class CategoryApiClient {
  Future<ApiResponse<List<Category>>> getCategories(GetCategoriesRequest request);
  Future<ApiResponse<Category>> getCategory(String categoryId);
  Future<ApiResponse<List<Category>>> searchCategories(SearchCategoriesRequest request);
  Future<ApiResponse<List<Category>>> getFrequentCategories(String userId);
  Future<ApiResponse<List<Category>>> getRecentCategories(String userId);
  Future<ApiResponse<Category>> createCategory(CreateCategoryRequest request);
}

### 5.2 Repositoryæ¨¡å¼è¨­è¨ˆ

#### 5.2.1 äº¤æ˜“æ•¸æ“šå€‰åº«

/**
 * 29. äº¤æ˜“æ•¸æ“šå€‰åº«
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionRepository {
  Future<List<Transaction>> getTransactions({Map<String, dynamic>? filters});
  Future<Transaction?> getTransaction(String transactionId);
  Future<Transaction> createTransaction(Transaction transaction);
  Future<Transaction> updateTransaction(String transactionId, Transaction transaction);
  Future<void> deleteTransaction(String transactionId);
  Future<DashboardData> getDashboardData(String ledgerId);
  Future<List<ChartData>> getChartData(ChartType type, DateRange period);
  Future<void> cacheTransactions(List<Transaction> transactions);
  List<Transaction> getCachedTransactions();
}

#### 5.2.2 ç§‘ç›®æ•¸æ“šå€‰åº«

/**
 * 30. ç§‘ç›®æ•¸æ“šå€‰åº«
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class CategoryRepository {
  Future<List<Category>> getCategories();
  Future<Category?> getCategory(String categoryId);
  Future<List<Category>> searchCategories(String query);
  Future<List<Category>> getFrequentCategories();
  Future<List<Category>> getRecentCategories();
  Future<void> cacheCategories(List<Category> categories);
  List<Category> getCachedCategories();
}

#### 5.2.3 å¸³æˆ¶æ•¸æ“šå€‰åº«

/**
 * 31. å¸³æˆ¶æ•¸æ“šå€‰åº«
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountRepository {
  Future<List<Account>> getAccounts();
  Future<Account?> getAccount(String accountId);
  Future<Map<String, double>> getAccountBalances();
  Future<void> cacheAccounts(List<Account> accounts);
  List<Account> getCachedAccounts();
}

---

## 6.0 å››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆï¼ˆFour Mode Designï¼‰

### 6.1 æ¨¡å¼é©é…å™¨æ¶æ§‹

åŸºæ–¼0015æ–‡ä»¶çš„å››æ¨¡å¼ç†è«–ï¼Œå¯¦ç¾å·®ç•°åŒ–ä½¿ç”¨è€…é«”é©—ï¼š

#### 6.1.1 å››æ¨¡å¼é…ç½®ç®¡ç†å™¨

/**
 * 32. å››æ¨¡å¼é…ç½®ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class FourModeConfigManager {
  UserMode get currentMode;
  FourModeConfig get currentConfig;
  
  void setMode(UserMode mode);
  FourModeConfig getConfigForMode(UserMode mode);
  Widget adaptWidget(Widget widget, UserMode mode);
  TextStyle adaptTextStyle(TextStyle baseStyle, UserMode mode);
  Color adaptColor(Color baseColor, UserMode mode);
}

#### 6.1.2 Expertæ¨¡å¼é©é…å™¨

/**
 * 33. Expertæ¨¡å¼é©é…å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class ExpertModeAdapter extends ModeAdapter {
  Widget buildAdvancedDashboard();
  Widget buildDetailedTransactionForm();
  Widget buildComplexStatistics();
  Widget buildBatchOperations();
  Widget buildAdvancedFilters();
  List<String> getAvailableFields();
  bool showTechnicalDetails();
}

#### 6.1.3 Inertialæ¨¡å¼é©é…å™¨

/**
 * 34. Inertialæ¨¡å¼é©é…å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class InertialModeAdapter extends ModeAdapter {
  Widget buildStandardDashboard();
  Widget buildSimpleTransactionForm();
  Widget buildBasicStatistics();
  Widget buildRoutineOperations();
  List<String> getStandardFields();
  bool useFixedLayout();
}

#### 6.1.4 Cultivationæ¨¡å¼é©é…å™¨

/**
 * 35. Cultivationæ¨¡å¼é©é…å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class CultivationModeAdapter extends ModeAdapter {
  Widget buildMotivationalDashboard();
  Widget buildGuidedTransactionForm();
  Widget buildProgressStatistics();
  Widget buildHabitTracking();
  Widget buildAchievements();
  List<String> getGuidedFields();
  bool showMotivationalContent();
}

#### 6.1.5 Guidingæ¨¡å¼é©é…å™¨

/**
 * 36. Guidingæ¨¡å¼é©é…å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class GuidingModeAdapter extends ModeAdapter {
  Widget buildMinimalDashboard();
  Widget buildSimplestTransactionForm();
  Widget buildBasicOverview();
  Widget buildSmartSuggestions();
  List<String> getEssentialFields();
  bool useAutoFill();
}

### 6.2 å››æ¨¡å¼å·®ç•°åŒ–å¯¦ç¾

#### 6.2.1 è¦–è¦ºé¢¨æ ¼å·®ç•°åŒ–

/**
 * 37. å››æ¨¡å¼ä¸»é¡Œç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class FourModeThemeManager {
  static ThemeData getExpertTheme();
  static ThemeData getInertialTheme();
  static ThemeData getCultivationTheme();
  static ThemeData getGuidingTheme();
  
  static Color getPrimaryColor(UserMode mode);
  static Color getSecondaryColor(UserMode mode);
  static TextTheme getTextTheme(UserMode mode);
}

#### 6.2.2 äº’å‹•è¡Œç‚ºå·®ç•°åŒ–

/**
 * 38. å››æ¨¡å¼äº’å‹•ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class FourModeInteractionManager {
  static Duration getAnimationDuration(UserMode mode);
  static Curve getAnimationCurve(UserMode mode);
  static int getMaxFieldsPerScreen(UserMode mode);
  static bool shouldShowAdvancedOptions(UserMode mode);
  static bool shouldAutoSave(UserMode mode);
  static List<String> getQuickActions(UserMode mode);
}

---

## 7.0 å‡½æ•¸ä»‹é¢è¦æ ¼ï¼ˆFunction Interface Specificationsï¼‰

### 7.1 æ ¸å¿ƒæ¥­å‹™é‚è¼¯å‡½æ•¸

#### 7.1.1 å¿«é€Ÿè¨˜å¸³è™•ç†å‡½æ•¸

/**
 * 39. å¿«é€Ÿè¨˜å¸³è™•ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class QuickAccountingProcessor {
  static Future<QuickAccountingResult> processQuickInput(String input, String userId, String ledgerId);
}

/**
 * 40. æ™ºèƒ½æ–‡å­—è§£æå™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class SmartTextParser {
  static ParsedTransaction parseAccountingText(String input);
}

#### 7.1.2 è¨˜å¸³è¡¨å–®è™•ç†å‡½æ•¸

/**
 * 41. è¨˜å¸³è¡¨å–®é©—è­‰å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingFormValidator {
  static ValidationResult validateTransaction(Transaction transaction);
  static ValidationResult validateAmount(double amount);
  static ValidationResult validateCategory(String categoryId);
  static ValidationResult validateAccount(String accountId);
  static ValidationResult validateDate(DateTime date);
}

/**
 * 42. è¨˜å¸³è¡¨å–®è™•ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AccountingFormProcessor {
  static Future<Transaction> processFormSubmission(FormData formData);
  static Future<void> saveDraft(Transaction draft);
  static Future<Transaction?> loadDraft(String userId);
  static void clearDraft(String userId);
}

#### 7.1.3 çµ±è¨ˆè¨ˆç®—å‡½æ•¸

/**
 * 43. çµ±è¨ˆè¨ˆç®—å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class StatisticsCalculator {
  static DashboardData calculateDashboardData(List<Transaction> transactions);
  static double calculateBalance(List<Transaction> transactions);
  static Map<String, double> calculateCategoryTotals(List<Transaction> transactions);
  static List<ChartData> generateChartData(List<Transaction> transactions, ChartType type);
  static TrendData calculateTrend(List<Transaction> transactions, DateRange period);
}

### 7.2 è³‡æ–™è™•ç†å‡½æ•¸

#### 7.2.1 äº¤æ˜“è³‡æ–™è™•ç†å‡½æ•¸

/**
 * 44. äº¤æ˜“è³‡æ–™è™•ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionDataProcessor {
  static List<Transaction> filterTransactions(List<Transaction> transactions, FilterCriteria criteria);
  static List<Transaction> sortTransactions(List<Transaction> transactions, SortCriteria criteria);
  static List<Transaction> groupTransactions(List<Transaction> transactions, GroupCriteria criteria);
  static TransactionSummary summarizeTransactions(List<Transaction> transactions);
}

/**
 * 45. äº¤æ˜“æ ¼å¼è½‰æ›å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class TransactionFormatter {
  static String formatAmount(double amount, String currency);
  static String formatDate(DateTime date, DateFormat format);
  static String formatDescription(String description, int maxLength);
  static Map<String, dynamic> toJson(Transaction transaction);
  static Transaction fromJson(Map<String, dynamic> json);
}

#### 7.2.2 å¿«å–ç®¡ç†å‡½æ•¸

/**
 * 46. å¿«å–ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class CacheManager {
  static Future<void> cacheTransactions(String key, List<Transaction> transactions);
  static Future<List<Transaction>?> getCachedTransactions(String key);
  static Future<void> cacheCategories(String key, List<Category> categories);
  static Future<List<Category>?> getCachedCategories(String key);
  static Future<void> clearCache(String key);
  static Future<void> clearAllCaches();
  static bool isCacheValid(String key, Duration maxAge);
}

### 7.3 UIè¼”åŠ©å‡½æ•¸

#### 7.3.1 å››æ¨¡å¼UIé©é…å‡½æ•¸

/**
 * 47. å››æ¨¡å¼UIé©é…å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class FourModeUIAdapter {
  static Widget adaptWidget(Widget widget, UserMode mode);
  static List<Widget> adaptFormFields(List<Widget> fields, UserMode mode);
  static ButtonStyle adaptButtonStyle(ButtonStyle baseStyle, UserMode mode);
  static InputDecoration adaptInputDecoration(InputDecoration decoration, UserMode mode);
  static int getOptimalFieldCount(UserMode mode, ScreenSize screenSize);
}

#### 7.3.2 éŸ¿æ‡‰å¼å¸ƒå±€å‡½æ•¸

/**
 * 48. éŸ¿æ‡‰å¼å¸ƒå±€ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class ResponsiveLayoutManager {
  static Widget buildResponsiveLayout(Widget child, ScreenSize screenSize);
  static int getColumnsForScreen(ScreenSize screenSize, UserMode mode);
  static double getOptimalSpacing(ScreenSize screenSize);
  static EdgeInsets getOptimalPadding(ScreenSize screenSize);
}

### 7.4 å·¥å…·å‡½æ•¸

#### 7.4.1 æ—¥æœŸè™•ç†å‡½æ•¸

/**
 * 49. æ—¥æœŸå·¥å…·é¡
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class DateUtils {
  static DateTime getStartOfMonth(DateTime date);
  static DateTime getEndOfMonth(DateTime date);
  static DateRange getCurrentMonth();
  static DateRange getPreviousMonth();
  static DateRange getCurrentYear();
  static List<DateTime> generateDateRange(DateTime start, DateTime end, Duration interval);
  static bool isDateInRange(DateTime date, DateRange range);
}

#### 7.4.2 é‡‘é¡è™•ç†å‡½æ•¸

/**
 * 50. é‡‘é¡å·¥å…·é¡
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class AmountUtils {
  static double parseAmountString(String amountStr);
  static String formatCurrency(double amount, String currencyCode);
  static bool isValidAmount(double amount);
  static double roundToDecimalPlaces(double amount, int decimalPlaces);
  static AmountRange calculateAmountRange(List<Transaction> transactions);
}

#### 7.4.3 éŒ¯èª¤è™•ç†å‡½æ•¸

/**
 * 51. éŒ¯èª¤è™•ç†ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class ErrorHandler {
  static String getErrorMessage(Exception error, UserMode mode);
  static bool shouldRetryOperation(Exception error);
  static Future<void> logError(Exception error, StackTrace stackTrace);
  static void showErrorDialog(BuildContext context, Exception error);
  static ErrorSeverity getErrorSeverity(Exception error);
}

#### 7.4.4 æœ¬åœ°åŒ–å‡½æ•¸

/**
 * 52. æœ¬åœ°åŒ–ç®¡ç†å™¨
 * @version 2025-09-11-V1.0.0
 * @date 2025-09-11
 * @update: åˆç‰ˆå»ºç«‹
 */
abstract class LocalizationManager {
  static String getLocalizedText(String key, UserMode mode);
  static String formatLocalizedAmount(double amount, String locale);
  static String formatLocalizedDate(DateTime date, String locale);
  static List<String> getSupportedLocales();
  static String getCurrentLocale();
}
