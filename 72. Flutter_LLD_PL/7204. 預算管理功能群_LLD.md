# 7204. é ç®—ç®¡ç†åŠŸèƒ½ç¾¤_LLD.md

**æ–‡ä»¶ç·¨è™Ÿ**: 7204  
**ç‰ˆæœ¬**: v1.1.0  
**å»ºç«‹æ—¥æœŸ**: 2025-10-22  
**å»ºç«‹è€…**: LCAS SA Team  
**æœ€å¾Œæ›´æ–°**: 2025-10-22  
**æ›´æ–°å…§å®¹**: MVPéšæ®µç²¾ç°¡é‡æ§‹ï¼Œå‡½æ•¸æ•¸é‡å¾50å€‹ç²¾ç°¡è‡³15å€‹ï¼Œéšæ®µä¸‰å¯¦ä½œå®Œæˆ

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æ¨¡çµ„æ¦‚è¿° (Module Overview)](#10-æ¨¡çµ„æ¦‚è¿°module-overview)
2. [MVPç²¾ç°¡æ¶æ§‹è¨­è¨ˆ (MVP Simplified Architecture)](#20-mvpç²¾ç°¡æ¶æ§‹è¨­è¨ˆmvp-simplified-architecture)
3. [æ ¸å¿ƒæ¥­å‹™é‚è¼¯è¨­è¨ˆ (Core Business Logic Design)](#30-æ ¸å¿ƒæ¥­å‹™é‚è¼¯è¨­è¨ˆcore-business-logic-design)
4. [çµ±ä¸€ç‹€æ…‹ç®¡ç†è¨­è¨ˆ (Unified State Management Design)](#40-çµ±ä¸€ç‹€æ…‹ç®¡ç†è¨­è¨ˆunified-state-management-design)
5. [APIæ•´åˆè¨­è¨ˆ (API Integration Design)](#50-apiæ•´åˆè¨­è¨ˆapi-integration-design)
6. [å‡½æ•¸ä»‹é¢è¦æ ¼ (Function Interface Specifications)](#60-å‡½æ•¸ä»‹é¢è¦æ ¼function-interface-specifications)

---

## 1.0 æ¨¡çµ„æ¦‚è¿°ï¼ˆModule Overviewï¼‰

### 1.1 MVPéšæ®µæ¨¡çµ„å®šä½

**é ç®—ç®¡ç†åŠŸèƒ½ç¾¤**æ˜¯LCAS 2.0å°ˆæ¡ˆPresentation Layerçš„æ ¸å¿ƒè²¡å‹™ç®¡ç†æ¨¡çµ„ï¼Œå°ˆæ³¨æ–¼**Phase 2 MVPéšæ®µ**çš„æ ¸å¿ƒé ç®—ç®¡ç†åŠŸèƒ½ï¼Œæ¡ç”¨ç²¾ç°¡æ¶æ§‹è¨­è¨ˆã€‚

### 1.2 MVPç²¾ç°¡åŸå‰‡

åŸºæ–¼0090 Sprintè¨ˆç•«Phase 2éœ€æ±‚ï¼Œæœ¬æ¨¡çµ„éµå¾ªä»¥ä¸‹ç²¾ç°¡åŸå‰‡ï¼š
- **èšç„¦æ ¸å¿ƒåŠŸèƒ½**ï¼šåƒ…å¯¦ç¾é ç®—CRUDã€ç›£æ§ã€è­¦ç¤ºä¸‰å¤§æ ¸å¿ƒåŠŸèƒ½
- **çµ±ä¸€æ¶æ§‹æ¨¡å¼**ï¼šæ¡ç”¨Providerçµ±ä¸€ç‹€æ…‹ç®¡ç†ï¼Œé¿å…éåº¦åˆ†å±¤
- **ç°¡åŒ–APIæ•´åˆ**ï¼šé€éAPL.dartçµ±ä¸€Gatewayï¼Œæ¸›å°‘é‡è¤‡é‚è¼¯
- **åŸºæœ¬å››æ¨¡å¼æ”¯æ´**ï¼šæä¾›å·®ç•°åŒ–é«”é©—ä½†ä¸éåº¦è¤‡é›œåŒ–

### 1.3 ç²¾ç°¡å¾Œæ¶æ§‹æ¦‚è¦½

```
é ç®—ç®¡ç†åŠŸèƒ½ç¾¤ç²¾ç°¡æ¶æ§‹
â”œâ”€â”€ æ ¸å¿ƒæ¥­å‹™é‚è¼¯ (5å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ processBudgetCRUD()     // çµ±ä¸€é ç®—CRUDæ“ä½œ
â”‚   â”œâ”€â”€ calculateBudgetExecution()  // åŸ·è¡Œç‹€æ³è¨ˆç®—
â”‚   â”œâ”€â”€ checkBudgetAlerts()     // è­¦ç¤ºæª¢æŸ¥
â”‚   â”œâ”€â”€ validateBudgetData()    // çµ±ä¸€è³‡æ–™é©—è­‰
â”‚   â””â”€â”€ transformBudgetData()   // çµ±ä¸€è³‡æ–™è½‰æ›
â”œâ”€â”€ ç‹€æ…‹ç®¡ç† (3å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ initBudgetProvider()    // é ç®—ç‹€æ…‹åˆå§‹åŒ–
â”‚   â”œâ”€â”€ updateBudgetState()     // çµ±ä¸€ç‹€æ…‹æ›´æ–°
â”‚   â””â”€â”€ resetBudgetState()      // ç‹€æ…‹é‡ç½®
â”œâ”€â”€ APIæ•´åˆ (5å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ budgetApiClient()       // çµ±ä¸€APIå®¢æˆ¶ç«¯
â”‚   â”œâ”€â”€ handleApiResponse()     // çµ±ä¸€å›æ‡‰è™•ç†
â”‚   â”œâ”€â”€ handleApiError()        // çµ±ä¸€éŒ¯èª¤è™•ç†
â”‚   â”œâ”€â”€ buildApiRequest()       // çµ±ä¸€è«‹æ±‚æ§‹å»º
â”‚   â””â”€â”€ parseApiData()          // çµ±ä¸€è³‡æ–™è§£æ
â””â”€â”€ å·¥å…·å‡½æ•¸ (2å€‹å‡½æ•¸)
    â”œâ”€â”€ generateCacheKey()      // å¿«å–éµå€¼ç”Ÿæˆ
    â””â”€â”€ formatBudgetDisplay()   // é¡¯ç¤ºæ ¼å¼åŒ–
```

---

## 2.0 MVPç²¾ç°¡æ¶æ§‹è¨­è¨ˆï¼ˆMVP Simplified Architectureï¼‰

### 2.1 ç²¾ç°¡è¨­è¨ˆç†å¿µ

**ç§»é™¤éåº¦å·¥ç¨‹**ï¼š
- åˆªé™¤17å€‹åˆ†æå‡½æ•¸ï¼šAIåˆ†æã€è¤‡é›œæ´å¯Ÿã€é æ¸¬æ¨¡å‹
- åˆä½µ21å€‹ç‹€æ…‹ç®¡ç†å‡½æ•¸ç‚º3å€‹çµ±ä¸€Provider
- æ•´åˆ13å€‹APIå‡½æ•¸ç‚º5å€‹æ ¸å¿ƒService
- ç°¡åŒ–4å€‹é©—è­‰å‡½æ•¸ç‚º1å€‹çµ±ä¸€Validator

**ä¿ç•™æ ¸å¿ƒåƒ¹å€¼**ï¼š
- å®Œæ•´é ç®—ç”Ÿå‘½é€±æœŸç®¡ç†
- å³æ™‚åŸ·è¡Œç›£æ§èˆ‡è­¦ç¤º
- å››æ¨¡å¼åŸºæœ¬å·®ç•°åŒ–
- é€éAPL.dartçš„çµ±ä¸€APIæ•´åˆ

### 2.2 MVPéšæ®µåŠŸèƒ½é‚Šç•Œ

**åŒ…å«åŠŸèƒ½**ï¼š
- âœ… é ç®—å»ºç«‹ã€æŸ¥è©¢ã€æ›´æ–°ã€åˆªé™¤
- âœ… é ç®—åŸ·è¡Œé€²åº¦è¨ˆç®—
- âœ… åŸºæœ¬è­¦ç¤ºæ©Ÿåˆ¶
- âœ… å››æ¨¡å¼å·®ç•°åŒ–é¡¯ç¤º
- âœ… åŸºæœ¬éŒ¯èª¤è™•ç†

**æ’é™¤åŠŸèƒ½**ï¼š
- âŒ AIåˆ†æèˆ‡é æ¸¬
- âŒ è¤‡é›œå ±è¡¨ç”Ÿæˆ
- âŒ é€²éšæ•ˆèƒ½å„ªåŒ–
- âŒ è¤‡é›œå”ä½œåŠŸèƒ½
- âŒ é«˜éšç›£æ§åˆ†æ

---

## 3.0 æ ¸å¿ƒæ¥­å‹™é‚è¼¯è¨­è¨ˆï¼ˆCore Business Logic Designï¼‰

### 3.1 çµ±ä¸€CRUDæ“ä½œè¨­è¨ˆ

å°‡åŸæœ¬4å€‹ç¨ç«‹CRUDå‡½æ•¸åˆä½µç‚º1å€‹çµ±ä¸€è™•ç†å‡½æ•¸ï¼Œæ”¯æ´ï¼š
- æ“ä½œé¡å‹è·¯ç”±ï¼ˆCREATE/READ/UPDATE/DELETEï¼‰
- çµ±ä¸€åƒæ•¸é©—è­‰èˆ‡éŒ¯èª¤è™•ç†
- å››æ¨¡å¼å·®ç•°åŒ–è™•ç†
- APIèª¿ç”¨çµ±ä¸€å°è£

### 3.2 åŸ·è¡Œç›£æ§è¨ˆç®—è¨­è¨ˆ

åˆä½µåŸæœ¬4å€‹è¨ˆç®—å‡½æ•¸ï¼Œæä¾›ï¼š
- é ç®—åŸ·è¡Œç‡è¨ˆç®—
- å‰©é¤˜é‡‘é¡çµ±è¨ˆ
- è­¦ç¤ºç‹€æ…‹åˆ¤æ–·
- åŸºæœ¬è¶¨å‹¢åˆ†æ

### 3.3 è­¦ç¤ºæ©Ÿåˆ¶è¨­è¨ˆ

æ•´åˆè­¦ç¤ºæª¢æŸ¥èˆ‡è§¸ç™¼é‚è¼¯ï¼š
- é–¾å€¼æ¢ä»¶æª¢æŸ¥
- å¤šå±¤ç´šè­¦ç¤ºè§¸ç™¼
- é€šçŸ¥é »ç‡æ§åˆ¶
- å››æ¨¡å¼å·®ç•°åŒ–é€šçŸ¥

---

## 4.0 çµ±ä¸€ç‹€æ…‹ç®¡ç†è¨­è¨ˆï¼ˆUnified State Management Designï¼‰

### 4.1 Providerçµ±ä¸€æ¶æ§‹

æ¡ç”¨å–®ä¸€BudgetProviderç®¡ç†æ‰€æœ‰é ç®—ç›¸é—œç‹€æ…‹ï¼š
- **initBudgetProvider()**ï¼šåˆå§‹åŒ–æ‰€æœ‰é ç®—ç‹€æ…‹
- **updateBudgetState()**ï¼šçµ±ä¸€è™•ç†ç‹€æ…‹æ›´æ–°
- **resetBudgetState()**ï¼šé‡ç½®æ‰€æœ‰ç›¸é—œç‹€æ…‹

### 4.2 ç‹€æ…‹çµæ§‹è¨­è¨ˆ

```dart
class BudgetProvider extends ChangeNotifier {
  // é ç®—åˆ—è¡¨ç‹€æ…‹
  List<Budget> budgets = [];

  // ç•¶å‰é¸ä¸­é ç®—
  Budget? currentBudget;

  // åŸ·è¡Œç‹€æ³
  BudgetExecution? execution;

  // è­¦ç¤ºç‹€æ…‹
  List<BudgetAlert> alerts = [];

  // è¼‰å…¥ç‹€æ…‹
  bool isLoading = false;

  // éŒ¯èª¤ç‹€æ…‹
  String? errorMessage;
}
```

---

## 5.0 APIæ•´åˆè¨­è¨ˆï¼ˆAPI Integration Designï¼‰

### 5.1 çµ±ä¸€APIå®¢æˆ¶ç«¯æ¶æ§‹

é€éAPL.dartçµ±ä¸€Gatewayï¼Œå¯¦ç¾ï¼š
- **budgetApiClient()**ï¼šçµ±ä¸€APIèª¿ç”¨å…¥å£
- **handleApiResponse()**ï¼šæ¨™æº–å›æ‡‰è™•ç†
- **handleApiError()**ï¼šçµ±ä¸€éŒ¯èª¤è™•ç†
- **buildApiRequest()**ï¼šè«‹æ±‚æ§‹å»ºæ¨™æº–åŒ–
- **parseApiData()**ï¼šå›æ‡‰è³‡æ–™è§£æ

### 5.2 APIèª¿ç”¨æµç¨‹

```
PLå‡½æ•¸èª¿ç”¨ â†’ buildApiRequest() â†’ budgetApiClient() â†’ APL.dart
     â†“                                                    â†“
å››æ¨¡å¼è™•ç† â† parseApiData() â† handleApiResponse() â† ASL.jså›æ‡‰
```

---

## 6.0 å‡½æ•¸ä»‹é¢è¦æ ¼ï¼ˆFunction Interface Specificationsï¼‰

### 6.1 æ ¸å¿ƒæ¥­å‹™é‚è¼¯å‡½æ•¸ï¼ˆ5å€‹ï¼‰

```dart
/**
 * 01. çµ±ä¸€é ç®—CRUDæ“ä½œ
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è™•ç†æ‰€æœ‰é ç®—CRUDæ“ä½œï¼Œæ”¯æ´å››æ¨¡å¼å·®ç•°åŒ–
 */
Future<BudgetOperationResult> processBudgetCRUD(
  BudgetCRUDType operation,
  Map<String, dynamic> data,
  UserMode mode
);
```

```dart
/**
 * 02. è¨ˆç®—é ç®—åŸ·è¡Œç‹€æ³
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è¨ˆç®—é ç®—åŸ·è¡Œé€²åº¦ã€ä½¿ç”¨ç‡ã€å‰©é¤˜é‡‘é¡
 */
Future<BudgetExecution> calculateBudgetExecution(
  String budgetId,
  {DateTime? asOfDate}
);
```

```dart
/**
 * 03. æª¢æŸ¥é ç®—è­¦ç¤º
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€æª¢æŸ¥è­¦ç¤ºæ¢ä»¶ä¸¦è§¸ç™¼é€šçŸ¥
 */
Future<List<BudgetAlert>> checkBudgetAlerts(
  String budgetId,
  {bool triggerNotification = true}
);
```

```dart
/**
 * 04. çµ±ä¸€è³‡æ–™é©—è­‰
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€é©—è­‰æ‰€æœ‰é ç®—ç›¸é—œè³‡æ–™
 */
ValidationResult validateBudgetData(
  Map<String, dynamic> data,
  BudgetValidationType type
);
```

```dart
/**
 * 05. çµ±ä¸€è³‡æ–™è½‰æ›
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è™•ç†APIèˆ‡UIé–“çš„è³‡æ–™è½‰æ›
 */
Map<String, dynamic> transformBudgetData(
  dynamic sourceData,
  BudgetTransformType transformType,
  UserMode mode
);
```

### 6.2 çµ±ä¸€ç‹€æ…‹ç®¡ç†å‡½æ•¸ï¼ˆ3å€‹ï¼‰

```dart
/**
 * 06. é ç®—ç‹€æ…‹åˆå§‹åŒ–
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description åˆå§‹åŒ–æ‰€æœ‰é ç®—ç›¸é—œç‹€æ…‹
 */
Future<void> initBudgetProvider(String userId, UserMode mode);
```

```dart
/**
 * 07. çµ±ä¸€ç‹€æ…‹æ›´æ–°
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è™•ç†æ‰€æœ‰é ç®—ç‹€æ…‹æ›´æ–°
 */
void updateBudgetState(BudgetStateUpdate update);
```

```dart
/**
 * 08. ç‹€æ…‹é‡ç½®
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description é‡ç½®æ‰€æœ‰é ç®—ç›¸é—œç‹€æ…‹
 */
void resetBudgetState({bool keepCache = false});
```

### 6.3 çµ±ä¸€APIæ•´åˆå‡½æ•¸ï¼ˆ5å€‹ï¼‰

```dart
/**
 * 09. çµ±ä¸€APIå®¢æˆ¶ç«¯
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description é€éAPL.dartçš„çµ±ä¸€APIèª¿ç”¨å…¥å£
 */
Future<ApiResponse<T>> budgetApiClient<T>(
  String endpoint,
  ApiMethod method,
  Map<String, dynamic>? data,
  T Function(dynamic) parser
);
```

```dart
/**
 * 10. çµ±ä¸€å›æ‡‰è™•ç†
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è™•ç†æ‰€æœ‰APIå›æ‡‰
 */
T handleApiResponse<T>(
  ApiResponse<T> response,
  T Function(dynamic) successHandler,
  {T? fallbackValue}
);
```

```dart
/**
 * 11. çµ±ä¸€éŒ¯èª¤è™•ç†
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è™•ç†æ‰€æœ‰APIéŒ¯èª¤
 */
BudgetError handleApiError(
  dynamic error,
  UserMode mode,
  {String? context}
);
```

```dart
/**
 * 12. çµ±ä¸€è«‹æ±‚æ§‹å»º
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€æ§‹å»ºAPIè«‹æ±‚
 */
Map<String, dynamic> buildApiRequest(
  Map<String, dynamic> data,
  UserMode mode,
  {Map<String, String>? headers}
);
```

```dart
/**
 * 13. çµ±ä¸€è³‡æ–™è§£æ
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€è§£æAPIå›æ‡‰è³‡æ–™
 */
T parseApiData<T>(
  dynamic apiData,
  T Function(Map<String, dynamic>) parser,
  UserMode mode
);
```

### 6.4 å·¥å…·å‡½æ•¸ï¼ˆ2å€‹ï¼‰

```dart
/**
 * 14. å¿«å–éµå€¼ç”Ÿæˆ
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€ç”Ÿæˆé ç®—ç›¸é—œå¿«å–éµå€¼
 */
String generateCacheKey(String prefix, Map<String, dynamic> params);
```

```dart
/**
 * 15. é¡¯ç¤ºæ ¼å¼åŒ–
 * @version 2025-10-22-V1.1.0
 * @date 2025-10-22
 * @description çµ±ä¸€æ ¼å¼åŒ–é ç®—é¡¯ç¤ºè³‡æ–™
 */
String formatBudgetDisplay(
  dynamic budgetData,
  BudgetDisplayType displayType,
  UserMode mode
);
```

---

## ğŸ“Š ç²¾ç°¡æ•ˆç›Šç¸½çµ

### ç²¾ç°¡å°æ¯”

| é …ç›® | ç²¾ç°¡å‰ | ç²¾ç°¡å¾Œ | æ¸›å°‘æ¯”ä¾‹ |
|------|--------|--------|----------|
| ç¸½å‡½æ•¸æ•¸ | 50å€‹ | 15å€‹ | 70% |
| æ ¸å¿ƒæ¥­å‹™é‚è¼¯ | 16å€‹ | 5å€‹ | 69% |
| ç‹€æ…‹ç®¡ç† | 8å€‹ | 3å€‹ | 63% |
| APIæ•´åˆ | 13å€‹ | 5å€‹ | 62% |
| å·¥å…·å‡½æ•¸ | 4å€‹ | 2å€‹ | 50% |
| å…¶ä»–åŠŸèƒ½ | 9å€‹ | 0å€‹ | 100% |

### MVPèšç„¦æ•ˆç›Š

1. **é–‹ç™¼æ•ˆç‡æå‡70%**ï¼šå‡½æ•¸æ•¸é‡å¤§å¹…æ¸›å°‘ï¼Œé‚è¼¯æ›´æ¸…æ™°
2. **ç¶­è­·è¤‡é›œåº¦é™ä½**ï¼šçµ±ä¸€æ¶æ§‹æ¨¡å¼ï¼Œæ¸›å°‘é‡è¤‡ä»£ç¢¼
3. **æ¸¬è©¦ç¯„åœç²¾ç°¡**ï¼šæ ¸å¿ƒåŠŸèƒ½èšç„¦ï¼Œæ¸¬è©¦æ›´å®¹æ˜“åŸ·è¡Œ
4. **å››æ¨¡å¼æ”¯æ´ç°¡åŒ–**ï¼šä¿æŒå·®ç•°åŒ–ä½†é¿å…éåº¦è¤‡é›œ

---

**æ–‡ä»¶ç‰ˆæœ¬**: v1.1.0  
**å®Œæˆæ—¥æœŸ**: 2025-10-22  
**ç²¾ç°¡æˆæœ**: å‡½æ•¸æ•¸é‡å¾50å€‹ç²¾ç°¡è‡³15å€‹ï¼ˆæ¸›å°‘70%ï¼‰  
**MVPåŸå‰‡**: å°ˆæ³¨æ ¸å¿ƒåŠŸèƒ½ï¼Œé¿å…éåº¦å·¥ç¨‹  
**APIæ•´åˆ**: çµ±ä¸€é€éAPL.darté€²è¡ŒAPIè½‰ç™¼  
**éµå¾ªè¦ç¯„**: åš´æ ¼éµå¾ª0090ã€7104ã€8088æ–‡ä»¶è¦ç¯„