
# 8829. TDD_P029_é ç®—ç·¨è¼¯é é¢_v1.0.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: P029 é ç®—ç·¨è¼¯é é¢æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v1.0.0
- **å‰µå»ºæ—¥æœŸ**: 2025-01-26 22:00:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-01-26 22:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: P029_é ç®—ç·¨è¼¯é é¢_SRS.md
- **å°æ‡‰PRDæ–‡ä»¶**: 9005. Flutter_Presentation layer.md
- **é é¢ä»£ç¢¼**: P029 (Budget Edit Page)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æŠ€è¡“æ¶æ§‹æ¦‚è¿°](#10-æŠ€è¡“æ¶æ§‹æ¦‚è¿°)
2. [Widgetæ¸…å–®](#20-widgetæ¸…å–®)
3. [æ ¸å¿ƒWidgetè¨­è¨ˆ](#30-æ ¸å¿ƒwidgetè¨­è¨ˆ)
4. [ç‹€æ…‹ç®¡ç†æ¶æ§‹](#40-ç‹€æ…‹ç®¡ç†æ¶æ§‹)
5. [APIæ•´åˆè¨­è¨ˆ](#50-apiæ•´åˆè¨­è¨ˆ)
6. [å°èˆªè·¯ç”±è¨­è¨ˆ](#60-å°èˆªè·¯ç”±è¨­è¨ˆ)
7. [éŸ¿æ‡‰å¼è¨­è¨ˆ](#70-éŸ¿æ‡‰å¼è¨­è¨ˆ)
8. [ç„¡éšœç¤™åŠŸèƒ½](#80-ç„¡éšœç¤™åŠŸèƒ½)
9. [æ•ˆèƒ½æœ€ä½³åŒ–](#90-æ•ˆèƒ½æœ€ä½³åŒ–)
10. [éŒ¯èª¤è™•ç†æ©Ÿåˆ¶](#100-éŒ¯èª¤è™•ç†æ©Ÿåˆ¶)

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
P029é ç®—ç·¨è¼¯é é¢ä½œç‚ºLCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„é ç®—ç®¡ç†æ ¸å¿ƒç·¨è¼¯åŠŸèƒ½ï¼Œè² è²¬é ç®—è³‡æ–™ä¿®æ”¹ã€è¡¨å–®é©—è­‰ã€è¡çªè§£æ±ºã€å”ä½œç·¨è¼¯åŠå››æ¨¡å¼å·®ç•°åŒ–ç·¨è¼¯é«”é©—ã€‚æœ¬é é¢æ¡ç”¨Clean Architectureè¨­è¨ˆï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§èˆ‡ç·¨è¼¯å®‰å…¨æ€§ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**: Flutter 3.x
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **è·¯ç”±ç®¡ç†**: GoRouter
- **HTTPå®¢æˆ¶ç«¯**: Dio
- **æœ¬åœ°å„²å­˜**: SharedPreferences + FlutterSecureStorage
- **è¡¨å–®ç®¡ç†**: FormBuilder
- **è¡¨å–®é©—è­‰**: FormBuilderValidators
- **æ—¥æœŸé¸æ“‡**: DatePicker
- **æ•¸å€¼è¼¸å…¥**: NumberInput

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * P029_é ç®—ç·¨è¼¯é é¢_1.0.0
 * @module P029é ç®—ç·¨è¼¯é é¢
 * @description Flutter Presentation Layeré ç®—ç·¨è¼¯é é¢ - å®Œæ•´ç·¨è¼¯åŠŸèƒ½ã€å³æ™‚é©—è­‰ã€å››æ¨¡å¼å·®ç•°åŒ–
 * @update 2025-01-26: å‡ç´šè‡³v1.0ç‰ˆæœ¬ï¼Œæ–°å¢å®Œæ•´é ç®—ç·¨è¼¯åŠŸèƒ½è¨­è¨ˆï¼Œæ”¯æ´è¡¨å–®é©—è­‰ã€è¡çªè§£æ±ºã€å”ä½œç·¨è¼¯
 */
```

---

## 2.0 Widgetæ¸…å–®

### 2.1 å®Œæ•´Widgetç´¢å¼•è¡¨

| # | Widgetåç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾çµ„ä»¶ |
|---|------------|------|----------|----------|----------|
| 01 | BudgetEditPage | V1.0.0 | é é¢å®¹å™¨å±¤ | ä¸»é ç®—ç·¨è¼¯é é¢å®¹å™¨åŠç”Ÿå‘½é€±æœŸç®¡ç† | BudgetEditProviderã€Router |
| 02 | BudgetEditScaffold | V1.0.0 | ä½ˆå±€çµæ§‹å±¤ | åŸºç¤é é¢çµæ§‹èˆ‡èƒŒæ™¯è¨­å®š | AppBarWithSaveã€FloatingActions |
| 03 | BudgetEditForm | V1.0.0 | è¡¨å–®å®¹å™¨å±¤ | é ç®—ç·¨è¼¯è¡¨å–®ä¸»å®¹å™¨ | FormBuilderã€ValidationProvider |
| 04 | BasicInfoSection | V1.0.0 | åŸºæœ¬è³‡è¨Šå±¤ | é ç®—åç¨±ã€æè¿°ã€ç‹€æ…‹ç·¨è¼¯å€å¡Š | TextFormFieldã€SwitchField |
| 05 | AmountPeriodSection | V1.0.0 | é‡‘é¡æœŸé–“å±¤ | é ç®—é‡‘é¡ã€æœŸé–“ã€é€±æœŸæ€§è¨­å®šå€å¡Š | NumberInputã€DateRangePickerã€RecurringSettings |
| 06 | CategoryProjectSection | V1.0.0 | åˆ†é¡å°ˆæ¡ˆå±¤ | åˆ†é¡é¸æ“‡ã€å°ˆæ¡ˆé—œè¯è¨­å®šå€å¡Š | CategorySelectorã€ProjectSelector |
| 07 | AlertConfigSection | V1.0.0 | è­¦ç¤ºè¨­å®šå±¤ | é ç®—è­¦ç¤ºè¦å‰‡è¨­å®šå€å¡Š | AlertThresholdInputã€NotificationSettings |
| 08 | AdvancedSettingsSection | V1.0.0 | é€²éšè¨­å®šå±¤ | é€²éšç·¨è¼¯é¸é …ï¼ˆä¾æ¨¡å¼é¡¯ç¤ºï¼‰ | AutoAdjustSettingsã€CustomRules |
| 09 | BudgetNameInput | V1.0.0 | è¼¸å…¥å…ƒä»¶å±¤ | é ç®—åç¨±è¼¸å…¥æ¬„ä½èˆ‡é©—è­‰ | TextFormFieldã€NameValidator |
| 10 | BudgetDescriptionInput | V1.0.0 | è¼¸å…¥å…ƒä»¶å±¤ | é ç®—æè¿°è¼¸å…¥æ¬„ä½ | TextFormFieldã€MaxLengthValidator |
| 11 | BudgetAmountInput | V1.0.0 | è¼¸å…¥å…ƒä»¶å±¤ | é ç®—é‡‘é¡è¼¸å…¥æ¬„ä½èˆ‡æ ¼å¼åŒ– | NumberInputã€CurrencyFormatter |
| 12 | DateRangePicker | V1.0.0 | æ—¥æœŸé¸æ“‡å±¤ | é ç®—æœŸé–“æ—¥æœŸç¯„åœé¸æ“‡å™¨ | DatePickerã€DateRangeValidator |
| 13 | RecurringSettings | V1.0.0 | é€±æœŸè¨­å®šå±¤ | é€±æœŸæ€§é ç®—è¨­å®šé¸é … | DropdownFieldã€ToggleSwitch |
| 14 | CategorySelector | V1.0.0 | é¸æ“‡å™¨å±¤ | é ç®—é©ç”¨åˆ†é¡é¸æ“‡å™¨ | MultiSelectChipã€CategoryList |
| 15 | ProjectSelector | V1.0.0 | é¸æ“‡å™¨å±¤ | é—œè¯å°ˆæ¡ˆé¸æ“‡å™¨ | DropdownSearchã€ProjectList |
| 16 | AlertThresholdInput | V1.0.0 | è­¦ç¤ºè¼¸å…¥å±¤ | è­¦ç¤ºé–¾å€¼è¨­å®šè¼¸å…¥ | SliderInputã€PercentageInput |
| 17 | NotificationSettings | V1.0.0 | é€šçŸ¥è¨­å®šå±¤ | é€šçŸ¥æ–¹å¼è¨­å®šé¸é … | CheckboxGroupã€TimePicker |
| 18 | ImpactAnalysisPanel | V1.0.0 | å½±éŸ¿åˆ†æå±¤ | è®Šæ›´å½±éŸ¿åˆ†æå±•ç¤ºé¢æ¿ | ExpandablePanelã€StatisticsChart |
| 19 | ChangeTrackingWidget | V1.0.0 | è®Šæ›´è¿½è¹¤å±¤ | è®Šæ›´è¿½è¹¤èˆ‡ç‰ˆæœ¬å°æ¯” | DiffViewerã€ChangeList |
| 20 | ValidationSummary | V1.0.0 | é©—è­‰æ‘˜è¦å±¤ | è¡¨å–®é©—è­‰çµæœæ‘˜è¦ | ErrorSummaryã€WarningList |
| 21 | SaveCancelActions | V1.0.0 | æ“ä½œæŒ‰éˆ•å±¤ | å„²å­˜ã€å–æ¶ˆã€é‡è¨­æ“ä½œæŒ‰éˆ• | ElevatedButtonã€OutlinedButton |
| 22 | ConflictResolutionDialog | V1.0.0 | è¡çªè§£æ±ºå±¤ | ç·¨è¼¯è¡çªè§£æ±ºå°è©±æ¡† | AlertDialogã€DiffViewer |
| 23 | UnsavedChangesDialog | V1.0.0 | è®Šæ›´æé†’å±¤ | æœªå„²å­˜è®Šæ›´æé†’å°è©±æ¡† | AlertDialogã€ActionButtons |

---

## 3.0 æ ¸å¿ƒWidgetè¨­è¨ˆ

### 3.1 é é¢å®¹å™¨å±¤Widget

#### 3.1.1 BudgetEditPage Widget
```dart
/**
 * 01. å°æ‡‰ 2.1ï¼šä¸»é ç®—ç·¨è¼¯é é¢å®¹å™¨Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—ç·¨è¼¯é é¢çš„ä¸»å®¹å™¨ï¼Œæ”¯æ´è¡¨å–®ç·¨è¼¯èˆ‡å››æ¨¡å¼å·®ç•°åŒ–
 */
class BudgetEditPage extends StatefulWidget {
  static const String routeName = '/budget/edit';
  final String budgetId;
  final UserMode? userMode;

  const BudgetEditPage({
    Key? key,
    required this.budgetId,
    this.userMode,
  });

  @override
  State<BudgetEditPage> createState();
}

/**
 * 02. å°æ‡‰ 2.1ï¼šé ç®—ç·¨è¼¯é é¢ç‹€æ…‹é¡åˆ¥
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description ç®¡ç†é ç®—ç·¨è¼¯é é¢çš„ç‹€æ…‹å’Œè¡¨å–®æ§åˆ¶å™¨
 */
class _BudgetEditPageState extends State<BudgetEditPage> with TickerProviderStateMixin {
  late AnimationController _fadeController;
  late AnimationController _slideController;
  late Animation<double> _fadeAnimation;
  late Animation<Offset> _slideAnimation;
  final GlobalKey<FormBuilderState> _formKey = GlobalKey<FormBuilderState>();
  late Timer _autoSaveTimer;

  @override
  void initState();

  /**
   * 03. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–å‹•ç•«æ§åˆ¶å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è¨­å®šé é¢é€²å…¥å‹•ç•«æ•ˆæœ
   */
  void _initializeAnimations();

  /**
   * 04. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–é é¢ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è¼‰å…¥é ç®—è³‡æ–™ä¸¦åˆå§‹åŒ–ç·¨è¼¯ç‹€æ…‹
   */
  Future<void> _initializePage();

  /**
   * 05. å°æ‡‰ 2.1ï¼šè¨­å®šè‡ªå‹•å„²å­˜
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è¨­å®šå®šæ™‚è‡ªå‹•å„²å­˜æ©Ÿåˆ¶
   */
  void _setupAutoSave();

  @override
  Widget build(BuildContext context);

  @override
  void dispose();
}
```

### 3.2 è¡¨å–®å®¹å™¨å±¤Widget

#### 3.2.1 BudgetEditForm Widget
```dart
/**
 * 06. å°æ‡‰ 3.1ï¼šé ç®—ç·¨è¼¯è¡¨å–®ä¸»å®¹å™¨Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description æ•´åˆæ‰€æœ‰ç·¨è¼¯å€å¡Šçš„è¡¨å–®å®¹å™¨
 */
class BudgetEditForm extends StatefulWidget {
  final GlobalKey<FormBuilderState> formKey;
  final BudgetEditProvider provider;
  final UserMode? userMode;
  final Animation<double> fadeAnimation;

  const BudgetEditForm({
    Key? key,
    required this.formKey,
    required this.provider,
    this.userMode,
    required this.fadeAnimation,
  });

  @override
  State<BudgetEditForm> createState();
}

class _BudgetEditFormState extends State<BudgetEditForm> {
  final ScrollController _scrollController = ScrollController();

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 07. å°æ‡‰ 3.1ï¼šå»ºæ§‹è¡¨å–®å€å¡Šåˆ—è¡¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼å»ºæ§‹å°æ‡‰çš„è¡¨å–®å€å¡Š
   */
  List<Widget> _buildFormSections(BuildContext context);

  /**
   * 08. å°æ‡‰ 3.1ï¼šè™•ç†è¡¨å–®è®Šæ›´
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†è¡¨å–®æ¬„ä½è®Šæ›´ä¸¦è§¸ç™¼é©—è­‰
   */
  void _onFormChanged(String field, dynamic value);

  @override
  void dispose();
}
```

### 3.3 åŸºæœ¬è³‡è¨Šç·¨è¼¯Widget

#### 3.3.1 BasicInfoSection Widget
```dart
/**
 * 09. å°æ‡‰ 3.2ï¼šåŸºæœ¬è³‡è¨Šç·¨è¼¯å€å¡ŠWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—åç¨±ã€æè¿°ã€ç‹€æ…‹çš„ç·¨è¼¯å€å¡Š
 */
class BasicInfoSection extends StatelessWidget {
  final BudgetEditProvider provider;
  final Function(String, dynamic) onFieldChanged;
  final UserMode? userMode;

  const BasicInfoSection({
    Key? key,
    required this.provider,
    required this.onFieldChanged,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 10. å°æ‡‰ 3.2ï¼šå»ºæ§‹å€å¡Šæ¨™é¡Œ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹åŸºæœ¬è³‡è¨Šå€å¡Šçš„æ¨™é¡Œå’Œèªªæ˜
   */
  Widget _buildSectionHeader(BuildContext context);

  /**
   * 11. å°æ‡‰ 3.2ï¼šå»ºæ§‹åç¨±è¼¸å…¥æ¬„ä½
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é ç®—åç¨±è¼¸å…¥æ¬„ä½
   */
  Widget _buildNameField(BuildContext context);

  /**
   * 12. å°æ‡‰ 3.2ï¼šå»ºæ§‹æè¿°è¼¸å…¥æ¬„ä½
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é ç®—æè¿°è¼¸å…¥æ¬„ä½
   */
  Widget _buildDescriptionField(BuildContext context);

  /**
   * 13. å°æ‡‰ 3.2ï¼šå»ºæ§‹ç‹€æ…‹åˆ‡æ›é–‹é—œ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é ç®—å•Ÿç”¨/åœç”¨ç‹€æ…‹åˆ‡æ›é–‹é—œ
   */
  Widget _buildStatusSwitch(BuildContext context);
}
```

### 3.4 é‡‘é¡æœŸé–“ç·¨è¼¯Widget

#### 3.4.1 AmountPeriodSection Widget
```dart
/**
 * 14. å°æ‡‰ 3.3ï¼šé‡‘é¡æœŸé–“ç·¨è¼¯å€å¡ŠWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—é‡‘é¡ã€æœŸé–“ã€é€±æœŸæ€§çš„ç·¨è¼¯å€å¡Š
 */
class AmountPeriodSection extends StatefulWidget {
  final BudgetEditProvider provider;
  final Function(String, dynamic) onFieldChanged;
  final UserMode? userMode;

  const AmountPeriodSection({
    Key? key,
    required this.provider,
    required this.onFieldChanged,
    this.userMode,
  });

  @override
  State<AmountPeriodSection> createState();
}

class _AmountPeriodSectionState extends State<AmountPeriodSection> {
  late TextEditingController _amountController;
  late FocusNode _amountFocusNode;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 15. å°æ‡‰ 3.3ï¼šå»ºæ§‹é‡‘é¡è¼¸å…¥æ¬„ä½
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é ç®—é‡‘é¡è¼¸å…¥æ¬„ä½èˆ‡æ ¼å¼åŒ–
   */
  Widget _buildAmountField(BuildContext context);

  /**
   * 16. å°æ‡‰ 3.3ï¼šå»ºæ§‹æœŸé–“é¸æ“‡å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é ç®—æœŸé–“æ—¥æœŸç¯„åœé¸æ“‡å™¨
   */
  Widget _buildPeriodPicker(BuildContext context);

  /**
   * 17. å°æ‡‰ 3.3ï¼šå»ºæ§‹é€±æœŸæ€§è¨­å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é€±æœŸæ€§é ç®—è¨­å®šé¸é …
   */
  Widget _buildRecurringSettings(BuildContext context);

  /**
   * 18. å°æ‡‰ 3.3ï¼šé©—è­‰é‡‘é¡èˆ‡æ­·å²è³‡æ–™ä¸€è‡´æ€§
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é©—è­‰æ–°é‡‘é¡æ˜¯å¦èˆ‡å·²æœ‰äº¤æ˜“è¨˜éŒ„ä¸€è‡´
   */
  String? _validateAmountConsistency(double? newAmount);

  @override
  void dispose();
}
```

### 3.5 åˆ†é¡å°ˆæ¡ˆç·¨è¼¯Widget

#### 3.5.1 CategoryProjectSection Widget
```dart
/**
 * 19. å°æ‡‰ 3.4ï¼šåˆ†é¡å°ˆæ¡ˆç·¨è¼¯å€å¡ŠWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—é©ç”¨åˆ†é¡å’Œé—œè¯å°ˆæ¡ˆçš„ç·¨è¼¯å€å¡Š
 */
class CategoryProjectSection extends StatefulWidget {
  final BudgetEditProvider provider;
  final Function(String, dynamic) onFieldChanged;
  final UserMode? userMode;

  const CategoryProjectSection({
    Key? key,
    required this.provider,
    required this.onFieldChanged,
    this.userMode,
  });

  @override
  State<CategoryProjectSection> createState();
}

class _CategoryProjectSectionState extends State<CategoryProjectSection> {
  @override
  Widget build(BuildContext context);

  /**
   * 20. å°æ‡‰ 3.4ï¼šå»ºæ§‹åˆ†é¡é¸æ“‡å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹å¤šé¸åˆ†é¡é¸æ“‡å™¨
   */
  Widget _buildCategorySelector(BuildContext context);

  /**
   * 21. å°æ‡‰ 3.4ï¼šå»ºæ§‹å°ˆæ¡ˆé¸æ“‡å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é—œè¯å°ˆæ¡ˆé¸æ“‡å™¨
   */
  Widget _buildProjectSelector(BuildContext context);

  /**
   * 22. å°æ‡‰ 3.4ï¼šå»ºæ§‹ç¯„åœè¨­å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é ç®—é©ç”¨ç¯„åœè¨­å®šé¸é …
   */
  Widget _buildScopeSettings(BuildContext context);

  /**
   * 23. å°æ‡‰ 3.4ï¼šè™•ç†åˆ†é¡è®Šæ›´å½±éŸ¿
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†åˆ†é¡è®Šæ›´å°ç¾æœ‰äº¤æ˜“çš„å½±éŸ¿åˆ†æ
   */
  Future<void> _analyzeCategoryChangeImpact(List<String> newCategories);
}
```

### 3.6 è­¦ç¤ºè¨­å®šç·¨è¼¯Widget

#### 3.6.1 AlertConfigSection Widget
```dart
/**
 * 24. å°æ‡‰ 3.5ï¼šè­¦ç¤ºè¨­å®šç·¨è¼¯å€å¡ŠWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—è­¦ç¤ºè¦å‰‡å’Œé€šçŸ¥è¨­å®šçš„ç·¨è¼¯å€å¡Š
 */
class AlertConfigSection extends StatefulWidget {
  final BudgetEditProvider provider;
  final Function(String, dynamic) onFieldChanged;
  final UserMode? userMode;

  const AlertConfigSection({
    Key? key,
    required this.provider,
    required this.onFieldChanged,
    this.userMode,
  });

  @override
  State<AlertConfigSection> createState();
}

class _AlertConfigSectionState extends State<AlertConfigSection> {
  @override
  Widget build(BuildContext context);

  /**
   * 25. å°æ‡‰ 3.5ï¼šå»ºæ§‹è­¦ç¤ºé–‹é—œ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹è­¦ç¤ºåŠŸèƒ½å•Ÿç”¨/åœç”¨é–‹é—œ
   */
  Widget _buildAlertToggle(BuildContext context);

  /**
   * 26. å°æ‡‰ 3.5ï¼šå»ºæ§‹é–¾å€¼è¨­å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹è­¦ç¤ºé–¾å€¼è¨­å®šæ»‘æ¡¿å’Œè¼¸å…¥æ¡†
   */
  Widget _buildThresholdSettings(BuildContext context);

  /**
   * 27. å°æ‡‰ 3.5ï¼šå»ºæ§‹é€šçŸ¥æ–¹å¼è¨­å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹é€šçŸ¥æ–¹å¼å’Œæ™‚é–“è¨­å®š
   */
  Widget _buildNotificationSettings(BuildContext context);

  /**
   * 28. å°æ‡‰ 3.5ï¼šå»ºæ§‹è‡ªè¨‚è­¦ç¤ºè¦å‰‡
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºæ§‹è‡ªè¨‚è­¦ç¤ºè¦å‰‡ç·¨è¼¯å™¨ï¼ˆé€²éšæ¨¡å¼ï¼‰
   */
  Widget _buildCustomAlertRules(BuildContext context);
}
```

---

## 4.0 ç‹€æ…‹ç®¡ç†æ¶æ§‹

### 4.1 BudgetEditProvider ç‹€æ…‹ç®¡ç†å™¨
```dart
/**
 * 29. å°æ‡‰ 4.1ï¼šé ç®—ç·¨è¼¯é é¢ç‹€æ…‹ç®¡ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description ç®¡ç†é ç®—ç·¨è¼¯é é¢çš„ç‹€æ…‹ï¼Œæ”¯æ´è¡¨å–®ç·¨è¼¯ã€é©—è­‰ã€è¡çªè§£æ±ºå’Œå››æ¨¡å¼å·®ç•°åŒ–
 */
class BudgetEditProvider extends ChangeNotifier {
  // ç‹€æ…‹å±¬æ€§
  BudgetEditPageState _pageState = BudgetEditPageState.loading;
  BudgetDetail? _originalBudget;
  Map<String, dynamic> _currentData = {};
  Map<String, dynamic> _changes = {};
  bool _isLoading = false;
  bool _isSaving = false;
  bool _isDirty = false;
  String? _errorMessage;
  BudgetEditErrorType? _errorType;
  UserMode? _userMode;

  // é©—è­‰ç‹€æ…‹
  Map<String, String> _fieldErrors = {};
  List<String> _warnings = {};
  ImpactAnalysis? _impactAnalysis;

  // ç·¨è¼¯é–å®šå’Œç‰ˆæœ¬æ§åˆ¶
  LockInfo? _lockInfo;
  int _version = 0;
  DateTime? _lastSaved;
  bool _hasConflict = false;

  // Getters
  BudgetEditPageState get pageState;
  BudgetDetail? get originalBudget;
  Map<String, dynamic> get currentData;
  Map<String, dynamic> get changes;
  bool get isLoading;
  bool get isSaving;
  bool get isDirty;
  String? get errorMessage;
  BudgetEditErrorType? get errorType;
  UserMode? get userMode;
  Map<String, String> get fieldErrors;
  List<String> get warnings;
  ImpactAnalysis? get impactAnalysis;
  LockInfo? get lockInfo;
  int get version;
  DateTime? get lastSaved;
  bool get hasConflict;

  /**
   * 30. å°æ‡‰ 4.1ï¼šåˆå§‹åŒ–ç·¨è¼¯é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è¼‰å…¥é ç®—è³‡æ–™ä¸¦åˆå§‹åŒ–ç·¨è¼¯ç‹€æ…‹
   */
  Future<void> initializeEditPage(String budgetId, UserMode? mode);

  /**
   * 31. å°æ‡‰ 4.1ï¼šè¨­å®šä½¿ç”¨è€…æ¨¡å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è¨­å®šä½¿ç”¨è€…æ¨¡å¼ä¸¦èª¿æ•´å¯ç·¨è¼¯æ¬„ä½
   */
  void setUserMode(UserMode mode);

  /**
   * 32. å°æ‡‰ 4.1ï¼šè¼‰å…¥é ç®—è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å¾APIè¼‰å…¥é ç®—è©³ç´°è³‡æ–™
   */
  Future<void> _loadBudgetData(String budgetId);

  /**
   * 33. å°æ‡‰ 4.1ï¼šå–å¾—ç·¨è¼¯é–å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å–å¾—é ç®—ç·¨è¼¯é–å®šä»¥é˜²æ­¢ä½µç™¼ç·¨è¼¯
   */
  Future<void> _acquireEditLock(String budgetId);

  /**
   * 34. å°æ‡‰ 4.1ï¼šæ›´æ–°æ¬„ä½è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æ›´æ–°è¡¨å–®æ¬„ä½è³‡æ–™ä¸¦è§¸ç™¼é©—è­‰
   */
  void updateField(String field, dynamic value);

  /**
   * 35. å°æ‡‰ 4.1ï¼šé©—è­‰æ¬„ä½è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é©—è­‰å–®ä¸€æ¬„ä½çš„è³‡æ–™æ ¼å¼å’Œæ¥­å‹™é‚è¼¯
   */
  Future<void> validateField(String field, dynamic value);

  /**
   * 36. å°æ‡‰ 4.1ï¼šé©—è­‰æ‰€æœ‰æ¬„ä½
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é©—è­‰æ‰€æœ‰è¡¨å–®æ¬„ä½çš„è³‡æ–™
   */
  Future<bool> validateAllFields();

  /**
   * 37. å°æ‡‰ 4.1ï¼šåˆ†æè®Šæ›´å½±éŸ¿
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description åˆ†æé ç®—è®Šæ›´å°ç¾æœ‰è³‡æ–™çš„å½±éŸ¿
   */
  Future<void> analyzeChangeImpact();

  /**
   * 38. å°æ‡‰ 4.1ï¼šå„²å­˜é ç®—è®Šæ›´
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å„²å­˜é ç®—è®Šæ›´åˆ°ä¼ºæœå™¨
   */
  Future<void> saveBudgetChanges();

  /**
   * 39. å°æ‡‰ 4.1ï¼šè‡ªå‹•å„²å­˜
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å®šæ™‚è‡ªå‹•å„²å­˜è‰ç¨¿
   */
  Future<void> autoSave();

  /**
   * 40. å°æ‡‰ 4.1ï¼šé‡è¨­è®Šæ›´
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é‡è¨­æ‰€æœ‰è®Šæ›´å›åˆ°åŸå§‹ç‹€æ…‹
   */
  void resetChanges();

  /**
   * 41. å°æ‡‰ 4.1ï¼šæª¢æŸ¥ç·¨è¼¯è¡çª
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–ä½¿ç”¨è€…åŒæ™‚ç·¨è¼¯
   */
  Future<void> checkEditConflict();

  /**
   * 42. å°æ‡‰ 4.1ï¼šè§£æ±ºç·¨è¼¯è¡çª
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†ç·¨è¼¯è¡çªä¸¦æä¾›è§£æ±ºé¸é …
   */
  Future<void> resolveEditConflict(ConflictResolution resolution);

  /**
   * 43. å°æ‡‰ 4.1ï¼šé‡‹æ”¾ç·¨è¼¯é–å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é‡‹æ”¾é ç®—ç·¨è¼¯é–å®š
   */
  Future<void> releaseEditLock();

  /**
   * 44. å°æ‡‰ 4.1ï¼šè™•ç†é›¢é–‹é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†é›¢é–‹é é¢æ™‚çš„æœªå„²å­˜è®Šæ›´
   */
  Future<bool> handlePageExit();

  // ç§æœ‰æ–¹æ³•
  void _setLoading(bool loading);
  void _setSaving(bool saving);
  void _setPageState(BudgetEditPageState state);
  void _setError(String message, BudgetEditErrorType type);
  void _clearError();
  void _markDirty();
  void _clearDirty();
  Map<String, dynamic> _buildUpdateRequest();
  bool _hasSignificantChanges();
}
```

### 4.2 ç‹€æ…‹æšèˆ‰å®šç¾©
```dart
/**
 * 45. å°æ‡‰ 4.2ï¼šé ç®—ç·¨è¼¯é é¢ç‹€æ…‹æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description å®šç¾©é ç®—ç·¨è¼¯é é¢çš„å„ç¨®ç‹€æ…‹
 */
enum BudgetEditPageState {
  loading,      // è¼‰å…¥ä¸­
  editing,      // ç·¨è¼¯ä¸­
  validating,   // é©—è­‰ä¸­
  saving,       // å„²å­˜ä¸­
  saved,        // å·²å„²å­˜
  conflict,     // ç·¨è¼¯è¡çª
  error,        // éŒ¯èª¤ç‹€æ…‹
}

/**
 * 46. å°æ‡‰ 4.2ï¼šé ç®—ç·¨è¼¯éŒ¯èª¤é¡å‹æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—ç·¨è¼¯éŒ¯èª¤é¡å‹åˆ†é¡
 */
enum BudgetEditErrorType {
  loadError,           // è¼‰å…¥éŒ¯èª¤
  validationError,     // é©—è­‰éŒ¯èª¤
  saveError,           // å„²å­˜éŒ¯èª¤
  conflictError,       // è¡çªéŒ¯èª¤
  permissionError,     // æ¬Šé™éŒ¯èª¤
  networkError,        // ç¶²è·¯éŒ¯èª¤
  lockError,           // é–å®šéŒ¯èª¤
  versionError,        // ç‰ˆæœ¬éŒ¯èª¤
}

/**
 * 47. å°æ‡‰ 4.2ï¼šè¡çªè§£æ±ºç­–ç•¥æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description ç·¨è¼¯è¡çªçš„è§£æ±ºç­–ç•¥
 */
enum ConflictResolution {
  useLocal,    // ä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬
  useRemote,   // ä½¿ç”¨é ç«¯ç‰ˆæœ¬
  merge,       // æ‰‹å‹•åˆä½µ
  cancel,      // å–æ¶ˆç·¨è¼¯
}
```

---

## 5.0 APIæ•´åˆè¨­è¨ˆ

### 5.1 BudgetEditApiService APIæœå‹™
```dart
/**
 * 48. å°æ‡‰ 5.1ï¼šé ç®—ç·¨è¼¯é é¢APIæœå‹™
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description è™•ç†é ç®—ç·¨è¼¯é é¢ç›¸é—œçš„APIèª¿ç”¨ï¼Œæ”¯æ´F016é ç®—æ›´æ–°åŠŸèƒ½
 */
class BudgetEditApiService {
  final ApiClient _apiClient = ApiClient();

  /**
   * 49. å°æ‡‰ 5.1ï¼šå–å¾—ç·¨è¼¯é ç®—è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å–å¾—é ç®—è©³ç´°è³‡æ–™ç”¨æ–¼ç·¨è¼¯ï¼ˆå°æ‡‰F016ç«¯é»ï¼‰
   */
  Future<ApiResponse<BudgetEditData>> getBudgetForEdit(String budgetId);

  /**
   * 50. å°æ‡‰ 5.1ï¼šé©—è­‰é ç®—è®Šæ›´
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é©—è­‰é ç®—è®Šæ›´çš„æœ‰æ•ˆæ€§ï¼ˆå°æ‡‰F016ç«¯é»ï¼‰
   */
  Future<ApiResponse<ValidationResult>> validateBudgetChanges(
    String budgetId,
    Map<String, dynamic> changes,
  );

  /**
   * 51. å°æ‡‰ 5.1ï¼šæ›´æ–°é ç®—
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æ›´æ–°é ç®—è³‡æ–™ï¼ˆå°æ‡‰F016ç«¯é»ï¼‰
   */
  Future<ApiResponse<BudgetUpdateResponse>> updateBudget(
    String budgetId,
    UpdateBudgetRequest request,
  );

  /**
   * 52. å°æ‡‰ 5.1ï¼šå–å¾—ç·¨è¼¯é–å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å–å¾—é ç®—ç·¨è¼¯é–å®š
   */
  Future<ApiResponse<LockResponse>> acquireEditLock(String budgetId);

  /**
   * 53. å°æ‡‰ 5.1ï¼šé‡‹æ”¾ç·¨è¼¯é–å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é‡‹æ”¾é ç®—ç·¨è¼¯é–å®š
   */
  Future<ApiResponse<void>> releaseEditLock(String budgetId, String lockId);

  /**
   * 54. å°æ‡‰ 5.1ï¼šæª¢æŸ¥ç·¨è¼¯è¡çª
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æª¢æŸ¥é ç®—ç·¨è¼¯è¡çª
   */
  Future<ApiResponse<ConflictCheckResult>> checkEditConflict(
    String budgetId,
    int currentVersion,
  );

  /**
   * 55. å°æ‡‰ 5.1ï¼šåˆ†æè®Šæ›´å½±éŸ¿
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description åˆ†æé ç®—è®Šæ›´çš„å½±éŸ¿ç¯„åœ
   */
  Future<ApiResponse<ImpactAnalysis>> analyzeChangeImpact(
    String budgetId,
    Map<String, dynamic> changes,
  );
}
```

### 5.2 è³‡æ–™æ¨¡å‹å®šç¾©
```dart
/**
 * 56. å°æ‡‰ 5.2ï¼šé ç®—ç·¨è¼¯è³‡æ–™æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—ç·¨è¼¯ç›¸é—œçš„è³‡æ–™çµæ§‹
 */
class BudgetEditData {
  final String budgetId;
  final String budgetName;
  final String? description;
  final double budgetAmount;
  final DateTime startDate;
  final DateTime endDate;
  final bool isRecurring;
  final String? recurringType;
  final List<String> categories;
  final String? projectId;
  final AlertConfig? alertConfig;
  final bool isActive;
  final int version;
  final DateTime lastModified;
  final String lastModifiedBy;
  final bool isEditable;
  final List<String> editableFields;

  BudgetEditData({
    required this.budgetId,
    required this.budgetName,
    this.description,
    required this.budgetAmount,
    required this.startDate,
    required this.endDate,
    required this.isRecurring,
    this.recurringType,
    required this.categories,
    this.projectId,
    this.alertConfig,
    required this.isActive,
    required this.version,
    required this.lastModified,
    required this.lastModifiedBy,
    required this.isEditable,
    required this.editableFields,
  });

  factory BudgetEditData.fromJson(Map<String, dynamic> json);
  Map<String, dynamic> toJson();
}

/**
 * 57. å°æ‡‰ 5.2ï¼šé ç®—æ›´æ–°è«‹æ±‚æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—æ›´æ–°è«‹æ±‚çš„è³‡æ–™çµæ§‹
 */
class UpdateBudgetRequest {
  final String budgetId;
  final String? budgetName;
  final String? description;
  final double? budgetAmount;
  final DateTime? startDate;
  final DateTime? endDate;
  final bool? isRecurring;
  final String? recurringType;
  final List<String>? categories;
  final String? projectId;
  final AlertConfig? alertConfig;
  final bool? isActive;
  final int version;
  final String? changeReason;
  final bool forceUpdate;

  UpdateBudgetRequest({
    required this.budgetId,
    this.budgetName,
    this.description,
    this.budgetAmount,
    this.startDate,
    this.endDate,
    this.isRecurring,
    this.recurringType,
    this.categories,
    this.projectId,
    this.alertConfig,
    this.isActive,
    required this.version,
    this.changeReason,
    this.forceUpdate = false,
  });

  factory UpdateBudgetRequest.fromJson(Map<String, dynamic> json);
  Map<String, dynamic> toJson();
}

/**
 * 58. å°æ‡‰ 5.2ï¼šå½±éŸ¿åˆ†æçµæœæ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description é ç®—è®Šæ›´å½±éŸ¿åˆ†æçš„çµæœ
 */
class ImpactAnalysis {
  final int affectedTransactions;
  final double currentUsage;
  final double projectedUsage;
  final List<String> warnings;
  final List<String> recommendations;
  final Map<String, dynamic> statisticsChange;
  final List<AlertImpact> alertImpacts;
  final bool requiresConfirmation;

  ImpactAnalysis({
    required this.affectedTransactions,
    required this.currentUsage,
    required this.projectedUsage,
    required this.warnings,
    required this.recommendations,
    required this.statisticsChange,
    required this.alertImpacts,
    required this.requiresConfirmation,
  });

  factory ImpactAnalysis.fromJson(Map<String, dynamic> json);
  Map<String, dynamic> toJson();
}
```

---

## 6.0 å°èˆªè·¯ç”±è¨­è¨ˆ

### 6.1 è·¯ç”±é…ç½®
```dart
/**
 * 59. å°æ‡‰ 6.1ï¼šé ç®—ç·¨è¼¯é é¢è·¯ç”±é…ç½®
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description å®šç¾©é ç®—ç·¨è¼¯é é¢çš„è·¯ç”±è¦å‰‡èˆ‡å°èˆªé‚è¼¯
 */
class BudgetEditRoutes {
  static const String budgetEdit = '/budget/edit';
  static const String budgetDetail = '/budget/detail';
  static const String budgetList = '/budget/list';

  /**
   * 60. å°æ‡‰ 6.1ï¼šå–å¾—é ç®—ç·¨è¼¯è·¯ç”±
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å»ºç«‹é ç®—ç·¨è¼¯é é¢çš„GoRouteé…ç½®
   */
  static GoRoute getBudgetEditRoute();
}

/**
 * 61. å°æ‡‰ 6.1ï¼šé ç®—ç·¨è¼¯å°èˆªæœå‹™
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description è™•ç†é ç®—ç·¨è¼¯ç›¸é—œçš„å°èˆªé‚è¼¯
 */
class BudgetEditNavigationService {
  static final GoRouter _router;
  static GoRouter get router;

  /**
   * 62. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°é ç®—è©³æƒ…
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description ç·¨è¼¯å®Œæˆå¾Œå°èˆªåˆ°é ç®—è©³æƒ…é é¢
   */
  Future<void> navigateToBudgetDetail(String budgetId);

  /**
   * 63. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°é ç®—åˆ—è¡¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å–æ¶ˆç·¨è¼¯å¾Œå°èˆªåˆ°é ç®—åˆ—è¡¨é é¢
   */
  Future<void> navigateToBudgetList();

  /**
   * 64. å°æ‡‰ 6.1ï¼šè™•ç†æœªå„²å­˜è®Šæ›´
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†é›¢é–‹é é¢æ™‚çš„æœªå„²å­˜è®Šæ›´
   */
  Future<bool> handleUnsavedChanges(BuildContext context);
}
```

---

## 7.0 éŸ¿æ‡‰å¼è¨­è¨ˆ

### 7.1 éŸ¿æ‡‰å¼è¼”åŠ©å·¥å…·
```dart
/**
 * 65. å°æ‡‰ 7.1ï¼šé ç®—ç·¨è¼¯é é¢éŸ¿æ‡‰å¼è¨­è¨ˆè¼”åŠ©å·¥å…·
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description éµå¾ª9005æ–‡ä»¶çš„éŸ¿æ‡‰å¼è¨­è¨ˆè¦ç¯„ï¼Œæä¾›é ç®—ç·¨è¼¯é é¢å°ˆç”¨çš„ä½ˆå±€ç®¡ç†
 */
class BudgetEditResponsiveHelper {
  final BuildContext context;
  late final MediaQueryData _mediaQuery;
  late final Size _screenSize;

  BudgetEditResponsiveHelper.of(BuildContext context);

  // æ–·é»åˆ¤æ–·å±¬æ€§ï¼ˆ9005è¦ç¯„ï¼‰
  bool get isMobile;
  bool get isTablet;
  bool get isSmallDesktop;
  bool get isLargeDesktop;
  DeviceType get deviceType;

  // é ç®—ç·¨è¼¯é é¢å°ˆç”¨å°ºå¯¸å±¬æ€§
  double get formSectionSpacing;
  EdgeInsets get formPadding;
  double get inputFieldHeight;
  double get buttonHeight;
  double get sectionHeaderHeight;

  /**
   * 66. å°æ‡‰ 7.1ï¼šå–å¾—å››æ¨¡å¼è¡¨å–®ä½ˆå±€
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼å’Œè£ç½®é¡å‹è¿”å›é©ç•¶è¡¨å–®ä½ˆå±€
   */
  FormLayoutConfig getFormLayoutForMode(UserMode? mode);

  /**
   * 67. å°æ‡‰ 7.1ï¼šå–å¾—æ¨¡å¼å°æ‡‰æ¬„ä½å¤§å°
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›é©ç•¶æ¬„ä½å¤§å°
   */
  FieldSizeConfig getFieldSizeForMode(UserMode? mode);
}
```

---

## 8.0 ç„¡éšœç¤™åŠŸèƒ½

### 8.1 èªæ„åŒ–æ”¯æ´
```dart
/**
 * 68. å°æ‡‰ 8.1ï¼šé ç®—ç·¨è¼¯é é¢ç„¡éšœç¤™èªæ„åŒ–WidgetåŒ…è£å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description æä¾›WCAG 2.1 AAæ¨™æº–çš„å®Œæ•´ç„¡éšœç¤™æ”¯æ´ï¼ˆ9005è¦ç¯„ï¼‰
 */
class BudgetEditAccessibilityWrapper {

  /**
   * 69. å°æ‡‰ 8.1ï¼šç‚ºè¡¨å–®æ¬„ä½æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description ç‚ºé ç®—ç·¨è¼¯è¡¨å–®æ¬„ä½æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapFormField(
    Widget child, 
    String fieldType, 
    {String? label, String? hint, String? error}
  );

  /**
   * 70. å°æ‡‰ 8.1ï¼šç‚ºæ“ä½œæŒ‰éˆ•æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description ç‚ºå„²å­˜ã€å–æ¶ˆç­‰æ“ä½œæŒ‰éˆ•æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapActionButton(
    Widget child, 
    String actionType, 
    {bool isEnabled = true, bool isLoading = false}
  );

  /**
   * 71. å°æ‡‰ 8.1ï¼šç‚ºé©—è­‰è¨Šæ¯æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description ç‚ºè¡¨å–®é©—è­‰è¨Šæ¯æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapValidationMessage(
    Widget child, 
    String message, 
    MessageType messageType
  );

  /**
   * 72. å°æ‡‰ 8.1ï¼šç‚ºå½±éŸ¿åˆ†ææä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description ç‚ºè®Šæ›´å½±éŸ¿åˆ†ææ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapImpactAnalysis(Widget child, ImpactAnalysis analysis);
}
```

---

## 9.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 9.1 è¡¨å–®å„ªåŒ–ç­–ç•¥
```dart
/**
 * 73. å°æ‡‰ 9.1ï¼šé ç®—ç·¨è¼¯é é¢è¡¨å–®å„ªåŒ–ç®¡ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description å„ªåŒ–é ç®—ç·¨è¼¯è¡¨å–®çš„æ•ˆèƒ½ï¼Œæ¸›å°‘ä¸å¿…è¦çš„é‡å»ºå’Œé©—è­‰
 */
class BudgetEditFormOptimizer {
  static final Map<String, Timer> _debounceTimers = {};
  static const Duration _debounceDelay = Duration(milliseconds: 300);

  /**
   * 74. å°æ‡‰ 9.1ï¼šé˜²æŠ–å‹•æ¬„ä½é©—è­‰
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é˜²æ­¢ä½¿ç”¨è€…å¿«é€Ÿè¼¸å…¥é€ æˆéåº¦é©—è­‰
   */
  static Future<void> debounceValidation(
    String fieldKey, 
    Future<void> Function() validationFunction
  );

  /**
   * 75. å°æ‡‰ 9.1ï¼šå¿«å–è¡¨å–®ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å¿«å–è¡¨å–®ç‹€æ…‹ä»¥æå‡è¼‰å…¥æ•ˆèƒ½
   */
  static Future<void> cacheFormState(String budgetId, Map<String, dynamic> formData);

  /**
   * 76. å°æ‡‰ 9.1ï¼šé‚„åŸè¡¨å–®ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å¾å¿«å–é‚„åŸè¡¨å–®ç‹€æ…‹
   */
  static Future<Map<String, dynamic>?> restoreFormState(String budgetId);

  /**
   * 77. å°æ‡‰ 9.1ï¼šå„ªåŒ–å½±éŸ¿åˆ†æ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description å„ªåŒ–è®Šæ›´å½±éŸ¿åˆ†æçš„æ•ˆèƒ½
   */
  static Future<ImpactAnalysis> optimizedImpactAnalysis(
    String budgetId,
    Map<String, dynamic> changes,
  );
}
```

---

## 10.0 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

### 10.1 é ç®—ç·¨è¼¯éŒ¯èª¤è™•ç†
```dart
/**
 * 78. å°æ‡‰ 10.1ï¼šé ç®—ç·¨è¼¯é é¢éŒ¯èª¤è™•ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 22:00:00
 * @description æ ¹æ“šP029è¦ç¯„çš„å…·é«”éŒ¯èª¤æƒ…å¢ƒé€²è¡Œè©³ç´°è™•ç†
 */
class BudgetEditErrorHandler {

  /**
   * 79. å°æ‡‰ 10.1ï¼šè™•ç†è¡¨å–®é©—è­‰éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†è¡¨å–®æ¬„ä½é©—è­‰éŒ¯èª¤
   */
  static String handleValidationError(String field, dynamic error);

  /**
   * 80. å°æ‡‰ 10.1ï¼šè™•ç†å„²å­˜éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†é ç®—å„²å­˜å¤±æ•—éŒ¯èª¤
   */
  static String handleSaveError(dynamic error);

  /**
   * 81. å°æ‡‰ 10.1ï¼šè™•ç†ç·¨è¼¯è¡çªéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†ä½µç™¼ç·¨è¼¯è¡çªéŒ¯èª¤
   */
  static String handleConflictError(dynamic error);

  /**
   * 82. å°æ‡‰ 10.1ï¼šè™•ç†æ¬Šé™éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†ç·¨è¼¯æ¬Šé™ä¸è¶³éŒ¯èª¤
   */
  static String handlePermissionError(dynamic error);

  /**
   * 83. å°æ‡‰ 10.1ï¼šè™•ç†ç‰ˆæœ¬è¡çªéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description è™•ç†é ç®—ç‰ˆæœ¬è¡çªéŒ¯èª¤
   */
  static String handleVersionError(dynamic error);

  /**
   * 84. å°æ‡‰ 10.1ï¼šé¡¯ç¤ºéŒ¯èª¤å°è©±æ¡†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é¡¯ç¤ºç·¨è¼¯éŒ¯èª¤å°è©±æ¡†
   */
  static Future<void> showEditErrorDialog(
    BuildContext context,
    String message,
    BudgetEditErrorType errorType,
    {VoidCallback? onRetry, VoidCallback? onCancel}
  );

  /**
   * 85. å°æ‡‰ 10.1ï¼šé¡¯ç¤ºè¡çªè§£æ±ºå°è©±æ¡†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 22:00:00
   * @description é¡¯ç¤ºç·¨è¼¯è¡çªè§£æ±ºå°è©±æ¡†
   */
  static Future<ConflictResolution?> showConflictResolutionDialog(
    BuildContext context,
    Map<String, dynamic> localData,
    Map<String, dynamic> remoteData,
  );
}
```

---

## éµå¾ª0055è¨­è¨ˆåŸå‰‡

### éšå±¤æ¶æ§‹å°æ‡‰
- æœ¬TDDæ–‡ä»¶åŸºæ–¼P029_é ç®—ç·¨è¼¯é é¢_SRS.mdçš„éœ€æ±‚è¦æ ¼
- èˆ‡9005. Flutter_Presentation layer.mdçš„ç”¢å“è¦æ ¼ä¿æŒä¸€è‡´
- æ‰€æœ‰å‡½æ•¸ç¯€é»ç·¨è™Ÿå°æ‡‰ä¸Šå±¤æ–‡ä»¶çš„åŠŸèƒ½æ¢ç›®

### è¨­è¨ˆåŸå‰‡éµå¾ª
1. **éšå±¤æ¶æ§‹é‚è¼¯**: åš´æ ¼åŸºæ–¼SRSæ–‡ä»¶å®šç¾©çš„åŠŸèƒ½æ¢ç›®è¨­è¨ˆ
2. **åŒå±¤ç´šä¾è³´é—œä¿‚**: è€ƒé‡èˆ‡é ç®—ç¸½è¦½ã€é ç®—è©³æƒ…ã€å»ºç«‹é ç®—é é¢çš„ä¾è³´é—œä¿‚
3. **ä»£ç¢¼ç¯€é»ç·¨è™Ÿ**: æ¡ç”¨ä¸åŠ å‰ç¶´çš„ç¯€é»ç·¨è™Ÿæ ¼å¼ï¼ˆå¦‚2.1ã€3.2ï¼‰
4. **å‘½åä¸€è‡´æ€§**: ä¿æŒèˆ‡ä½¿ç”¨è€…ä»‹é¢æ“ä½œæµç¨‹çš„åç¨±åŒæ­¥
5. **å¯è®€æ€§è¨­è¨ˆ**: æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œéµå¾ªä½è€¦åˆã€é«˜å…§èšåŸå‰‡

## æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| **v1.0.0** | **2025-01-26 22:00:00 +08:00** | **LCAS SA Team** | **åˆç‰ˆå»ºç«‹ï¼šå®Œæ•´P029é ç®—ç·¨è¼¯é é¢TDDè¦æ ¼ï¼Œæ”¯æ´é ç®—è³‡æ–™ç·¨è¼¯ã€è¡¨å–®é©—è­‰ã€è¡çªè§£æ±ºã€å”ä½œç·¨è¼¯ï¼Œå¯¦ä½œå››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆï¼Œå®Œæ•´éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œéµå¾ª0055è¨­è¨ˆåŸå‰‡ï¼Œå°æ‡‰P029 SRSè¦æ ¼** |

---

## å‚™è¨»

- **ç´”å‡½æ•¸å®£å‘Š**: å®Œå…¨ç§»é™¤æ‰€æœ‰å¯¦ä½œä»£ç¢¼ï¼Œåƒ…ä¿ç•™å‡½æ•¸åç¨±ã€åƒæ•¸å®šç¾©å’Œè¨»è§£
- **é ç®—ç·¨è¼¯åŠŸèƒ½**: æ”¯æ´é ç®—åŸºæœ¬è³‡è¨Šã€é‡‘é¡æœŸé–“ã€åˆ†é¡å°ˆæ¡ˆã€è­¦ç¤ºè¨­å®šç­‰å®Œæ•´ç·¨è¼¯åŠŸèƒ½
- **å››æ¨¡å¼å·®ç•°åŒ–**: æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼æä¾›ä¸åŒè¤‡é›œåº¦çš„ç·¨è¼¯ç•Œé¢å’ŒåŠŸèƒ½é¸é …
- **è¡¨å–®é©—è­‰**: å®Œæ•´çš„å³æ™‚é©—è­‰ã€æ‰¹æ¬¡é©—è­‰ã€æ¥­å‹™é‚è¼¯é©—è­‰æ©Ÿåˆ¶
- **è¡çªè§£æ±º**: å®Œå–„çš„ä½µç™¼ç·¨è¼¯æª¢æ¸¬ã€è¡çªè§£æ±ºã€ç‰ˆæœ¬æ§åˆ¶æ©Ÿåˆ¶
- **å®Œæ•´æŠ€è¡“æ¶æ§‹**: Widgetåˆ†å±¤ã€ç‹€æ…‹ç®¡ç†ã€APIæ•´åˆã€éŸ¿æ‡‰å¼è¨­è¨ˆã€ç„¡éšœç¤™æ”¯æ´ã€æ•ˆèƒ½æœ€ä½³åŒ–
- **è¦ç¯„å®Œå…¨å°é½Š**: èˆ‡0055ã€P029 SRSã€9005æ–‡ä»¶å®Œå…¨ä¸€è‡´
- **ç¯€é»ç·¨è™Ÿæ¨™æº–åŒ–**: çµ±ä¸€ç·¨è™Ÿ01-85ï¼Œéµå¾ª0055è¦ç¯„æ ¼å¼
- **ç‰ˆæœ¬çµ±ä¸€å‡ç´š**: æ‰€æœ‰çµ„ä»¶ç‰ˆæœ¬çµ±ä¸€ç‚ºv1.0.0
