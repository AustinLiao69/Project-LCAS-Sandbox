
# 8809. TDD_P009_è¨˜å¸³æ­·å²é é¢_v1.0.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: P009 è¨˜å¸³æ­·å²é é¢æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v1.0.0
- **å‰µå»ºæ—¥æœŸ**: 2025-01-26 18:00:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-01-26 18:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: P009_è¨˜å¸³æ­·å²é é¢_SRS.md
- **å°æ‡‰PRDæ–‡ä»¶**: 9005. Flutter_Presentation layer.md
- **é é¢ä»£ç¢¼**: P009 (Transaction History Page)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æŠ€è¡“æ¶æ§‹æ¦‚è¿°](#10-æŠ€è¡“æ¶æ§‹æ¦‚è¿°)
2. [Widgetæ¸…å–®](#20-widgetæ¸…å–®)
3. [æ ¸å¿ƒWidgetè¨­è¨ˆ](#30-æ ¸å¿ƒwidgetè¨­è¨ˆ)
4. [ç‹€æ…‹ç®¡ç†æ¶æ§‹](#40-ç‹€æ…‹ç®¡ç†æ¶æ§‹)
5. [APIæ•´åˆè¨­è¨ˆ](#50-apiæ•´åˆè¨­è¨ˆ)
6. [å°èˆªè·¯ç”±è¨­è¨ˆ](#60-å°èˆªè·¯ç”±è¨­è¨ˆ)
7. [éŸ¿æ‡‰å¼è¨­è¨ˆ](#70-éŸ¿æ‡‰å¼è¨­è¨ˆ)
8. [ç„¡éšœç¤™åŠŸèƒ½](#80-ç„¡éšœç¤™åŠŸèƒ½)
9. [æ•ˆèƒ½æœ€ä½³åŒ–](#90-æ•ˆèƒ½æœ€ä½³åŒ–)
10. [éŒ¯èª¤è™•ç†æ©Ÿåˆ¶](#100-éŒ¯èª¤è™•ç†æ©Ÿåˆ¶)

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
P009è¨˜å¸³æ­·å²é é¢ä½œç‚ºLCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„è¨˜å¸³è³‡æ–™ç®¡ç†æ ¸å¿ƒï¼Œè² è²¬è¨˜å¸³è¨˜éŒ„çš„æŸ¥è©¢ã€ç€è¦½ã€ç¯©é¸ã€ç·¨è¼¯å’Œåˆªé™¤åŠŸèƒ½ã€‚æœ¬é é¢æ¡ç”¨Clean Architectureè¨­è¨ˆï¼Œæä¾›é«˜æ•ˆçš„å¤§é‡è³‡æ–™è™•ç†èƒ½åŠ›å’Œç›´è§€çš„ä½¿ç”¨è€…é«”é©—ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**: Flutter 3.x
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **è·¯ç”±ç®¡ç†**: GoRouter
- **HTTPå®¢æˆ¶ç«¯**: Dio
- **æœ¬åœ°å„²å­˜**: SharedPreferences + SQLite
- **è™›æ“¬åŒ–æ¸…å–®**: flutter_sticky_headers
- **åˆ†é è¼‰å…¥**: infinite_scroll_pagination
- **ç¯©é¸æœå°‹**: flutter_typeahead
- **è³‡æ–™å¿«å–**: get_it + injectable

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * P009_è¨˜å¸³æ­·å²é é¢_1.0.0
 * @module P009è¨˜å¸³æ­·å²é é¢
 * @description Flutter Presentation Layerè¨˜å¸³æ­·å²ç®¡ç†é é¢ - è¨˜éŒ„æŸ¥è©¢ã€ç¯©é¸ç·¨è¼¯ã€æ‰¹é‡æ“ä½œã€å››æ¨¡å¼å·®ç•°åŒ–
 * @update 2025-01-26: å‡ç´šè‡³v1.0ç‰ˆæœ¬ï¼Œæ–°å¢å®Œæ•´è¨˜å¸³æ­·å²åŠŸèƒ½è¨­è¨ˆï¼Œæ”¯æ´å¤šç¶­åº¦ç¯©é¸ã€åˆ†é è¼‰å…¥ã€æ‰¹é‡æ“ä½œ
 */
```

---

## 2.0 Widgetæ¸…å–®

### 2.1 å®Œæ•´Widgetç´¢å¼•è¡¨

| # | Widgetåç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾çµ„ä»¶ |
|---|------------|------|----------|----------|----------|
| 01 | TransactionHistoryPage | V1.0.0 | é é¢å®¹å™¨å±¤ | ä¸»è¨˜å¸³æ­·å²é é¢å®¹å™¨åŠç”Ÿå‘½é€±æœŸç®¡ç† | HistoryProviderã€Router |
| 02 | HistoryScaffold | V1.0.0 | ä½ˆå±€çµæ§‹å±¤ | åŸºç¤é é¢çµæ§‹èˆ‡å°èˆªè¨­å®š | AppBarã€FilterDrawer |
| 03 | FilterAppBar | V1.0.0 | å°èˆªæ§åˆ¶å±¤ | ç¯©é¸æ§åˆ¶èˆ‡æœå°‹åŠŸèƒ½çš„é ‚éƒ¨æ¬„ | SearchFieldã€FilterButton |
| 04 | SearchField | V1.0.0 | æœå°‹åŠŸèƒ½å±¤ | è¨˜å¸³è¨˜éŒ„é—œéµå­—æœå°‹æ¬„ä½ | TextFormFieldã€SearchController |
| 05 | FilterDrawer | V1.0.0 | ç¯©é¸æ§åˆ¶å±¤ | æ»‘å‡ºå¼ç¯©é¸é¢æ¿ | DateRangeFilterã€CategoryFilterã€AmountFilter |
| 06 | DateRangeFilter | V1.0.0 | ç¯©é¸å…ƒä»¶å±¤ | æ—¥æœŸç¯„åœç¯©é¸æ§åˆ¶ | DatePickerã€DateRangeSelector |
| 07 | CategoryFilter | V1.0.0 | ç¯©é¸å…ƒä»¶å±¤ | ç§‘ç›®é¡åˆ¥ç¯©é¸é¸æ“‡ | MultiSelectChipsã€CategoryTree |
| 08 | AmountFilter | V1.0.0 | ç¯©é¸å…ƒä»¶å±¤ | é‡‘é¡ç¯„åœç¯©é¸æ§åˆ¶ | RangeSliderã€AmountInput |
| 09 | SortControls | V1.0.0 | æ’åºæ§åˆ¶å±¤ | æ’åºæ–¹å¼é¸æ“‡æ§åˆ¶ | DropdownButtonã€SortDirection |
| 10 | TransactionListView | V1.0.0 | æ¸…å–®å±•ç¤ºå±¤ | è¨˜å¸³è¨˜éŒ„è™›æ“¬åŒ–æ¸…å–® | InfiniteScrollViewã€TransactionCard |
| 11 | TransactionCard | V1.0.0 | è¨˜éŒ„å¡ç‰‡å±¤ | å–®ä¸€è¨˜å¸³è¨˜éŒ„å¡ç‰‡ | SwipeActionsã€SelectableCard |
| 12 | TransactionSummaryCard | V1.0.0 | æ‘˜è¦å±•ç¤ºå±¤ | è¨˜å¸³è¨˜éŒ„æ‘˜è¦çµ±è¨ˆå¡ç‰‡ | StatisticsWidgetã€ChartWidget |
| 13 | SwipeActions | V1.0.0 | äº’å‹•æ“ä½œå±¤ | å·¦å³æ»‘å‹•æ“ä½œåŠŸèƒ½ | EditActionã€DeleteActionã€DuplicateAction |
| 14 | SelectionControls | V1.0.0 | æ‰¹é‡æ“ä½œå±¤ | å¤šé¸æ§åˆ¶èˆ‡æ‰¹é‡æ“ä½œ | SelectAllButtonã€BatchActionBar |
| 15 | BatchActionBar | V1.0.0 | æ‰¹é‡æ“ä½œå±¤ | æ‰¹é‡æ“ä½œå·¥å…·åˆ— | DeleteButtonã€ExportButtonã€TagButton |
| 16 | LoadingStateWidget | V1.0.0 | è¼‰å…¥ç‹€æ…‹å±¤ | è³‡æ–™è¼‰å…¥ä¸­ç‹€æ…‹é¡¯ç¤º | CircularProgressIndicatorã€ShimmerEffect |
| 17 | EmptyStateWidget | V1.0.0 | ç©ºç‹€æ…‹å±¤ | ç„¡è¨˜éŒ„æ™‚çš„ç©ºç‹€æ…‹é¡¯ç¤º | IllustrationWidgetã€ActionButton |
| 18 | ErrorStateWidget | V1.0.0 | éŒ¯èª¤ç‹€æ…‹å±¤ | éŒ¯èª¤ç‹€æ…‹é¡¯ç¤ºèˆ‡é‡è©¦ | ErrorIconã€RetryButton |
| 19 | PullToRefresh | V1.0.0 | é‡æ–°æ•´ç†å±¤ | ä¸‹æ‹‰é‡æ–°æ•´ç†åŠŸèƒ½ | RefreshIndicatorã€CustomScrollView |
| 20 | FloatingActionButton | V1.0.0 | å¿«é€Ÿæ“ä½œå±¤ | å¿«é€Ÿæ–°å¢è¨˜å¸³æŒ‰éˆ• | SpeedDialã€QuickActionMenu |

---

## 3.0 æ ¸å¿ƒWidgetè¨­è¨ˆ

### 3.1 é é¢å®¹å™¨å±¤Widget

#### 3.1.1 TransactionHistoryPage Widget
```dart
/**
 * 01. å°æ‡‰ 2.1ï¼šä¸»è¨˜å¸³æ­·å²é é¢å®¹å™¨Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è¨˜å¸³æ­·å²é é¢çš„ä¸»å®¹å™¨ï¼Œæ”¯æ´å¤šç¶­åº¦ç¯©é¸èˆ‡å››æ¨¡å¼å·®ç•°åŒ–
 */
class TransactionHistoryPage extends StatefulWidget {
  static const String routeName = '/transaction-history';
  final UserMode? userMode;
  final String? initialLedgerId;

  const TransactionHistoryPage({Key? key, this.userMode, this.initialLedgerId});

  @override
  State<TransactionHistoryPage> createState();
}

/**
 * 02. å°æ‡‰ 2.1ï¼šè¨˜å¸³æ­·å²é é¢ç‹€æ…‹é¡åˆ¥
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description ç®¡ç†è¨˜å¸³æ­·å²é é¢çš„ç‹€æ…‹å’Œå‹•ç•«æ§åˆ¶å™¨
 */
class _TransactionHistoryPageState extends State<TransactionHistoryPage> 
    with TickerProviderStateMixin, AutomaticKeepAliveClientMixin {
  late AnimationController _slideController;
  late AnimationController _fadeController;
  late Animation<Offset> _slideAnimation;
  late Animation<double> _fadeAnimation;

  @override
  void initState();

  /**
   * 03. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–å‹•ç•«æ§åˆ¶å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨­å®šé é¢é€²å…¥å’Œéæ¸¡å‹•ç•«æ•ˆæœ
   */
  void _initializeAnimations();

  /**
   * 04. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–é é¢è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¼‰å…¥åˆå§‹è¨˜å¸³æ­·å²è³‡æ–™å’Œè¨­å®š
   */
  Future<void> _initializePageData();

  @override
  Widget build(BuildContext context);

  @override
  bool get wantKeepAlive;

  @override
  void dispose();
}
```

### 3.2 ä½ˆå±€çµæ§‹å±¤Widget

#### 3.2.1 HistoryScaffold Widget
```dart
/**
 * 05. å°æ‡‰ 2.2ï¼šè¨˜å¸³æ­·å²é é¢ä½ˆå±€çµæ§‹Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æä¾›è¨˜å¸³æ­·å²é é¢çš„åŸºç¤ä½ˆå±€çµæ§‹ï¼Œæ”¯æ´å››æ¨¡å¼å·®ç•°åŒ–ç•Œé¢
 */
class HistoryScaffold extends StatelessWidget {
  final Animation<double> fadeAnimation;
  final Animation<Offset> slideAnimation;
  final TransactionHistoryProvider provider;
  final UserMode? userMode;

  const HistoryScaffold({
    Key? key,
    required this.fadeAnimation,
    required this.slideAnimation,
    required this.provider,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 06. å°æ‡‰ 2.2ï¼šå»ºç«‹æµ®å‹•æ“ä½œæŒ‰éˆ•
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šæ¨¡å¼å»ºç«‹å°æ‡‰çš„å¿«é€Ÿæ“ä½œæŒ‰éˆ•
   */
  Widget _buildFloatingActionButton(BuildContext context, TransactionHistoryProvider provider);

  /**
   * 07. å°æ‡‰ 2.2ï¼šå»ºç«‹åº•éƒ¨å°èˆªæ¬„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šé¸æ“‡ç‹€æ…‹é¡¯ç¤ºæ‰¹é‡æ“ä½œæ¬„æˆ–éš±è—
   */
  Widget? _buildBottomNavigationBar(BuildContext context, TransactionHistoryProvider provider);
}
```

### 3.3 ç¯©é¸æ§åˆ¶å±¤Widget

#### 3.3.1 FilterAppBar Widget
```dart
/**
 * 08. å°æ‡‰ 3.1ï¼šç¯©é¸æ§åˆ¶é ‚éƒ¨æ¬„Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æ•´åˆæœå°‹å’Œç¯©é¸åŠŸèƒ½çš„é ‚éƒ¨æ‡‰ç”¨æ¬„
 */
class FilterAppBar extends StatefulWidget implements PreferredSizeWidget {
  final TransactionHistoryProvider provider;
  final UserMode? userMode;
  final VoidCallback? onFilterPressed;

  const FilterAppBar({
    Key? key,
    required this.provider,
    this.userMode,
    this.onFilterPressed,
  });

  @override
  Size get preferredSize;

  @override
  State<FilterAppBar> createState();
}

class _FilterAppBarState extends State<FilterAppBar> {
  late TextEditingController _searchController;
  bool _isSearchActive = false;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 09. å°æ‡‰ 3.1ï¼šåˆ‡æ›æœå°‹æ¨¡å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åœ¨æ­£å¸¸æ¨™é¡Œå’Œæœå°‹è¼¸å…¥ä¹‹é–“åˆ‡æ›
   */
  void _toggleSearchMode();

  /**
   * 10. å°æ‡‰ 3.1ï¼šåŸ·è¡Œæœå°‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŸ·è¡Œé—œéµå­—æœå°‹ä¸¦æ›´æ–°æ¸…å–®
   */
  void _performSearch(String query);

  @override
  void dispose();
}
```

#### 3.3.2 FilterDrawer Widget
```dart
/**
 * 11. å°æ‡‰ 3.1.1ï¼šç¯©é¸æ»‘å‡ºé¢æ¿Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å®Œæ•´çš„ç¯©é¸æ¢ä»¶è¨­å®šé¢æ¿
 */
class FilterDrawer extends StatefulWidget {
  final TransactionHistoryProvider provider;
  final UserMode? userMode;

  const FilterDrawer({
    Key? key,
    required this.provider,
    this.userMode,
  });

  @override
  State<FilterDrawer> createState();
}

class _FilterDrawerState extends State<FilterDrawer> {
  late FilterSettings _tempFilters;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 12. å°æ‡‰ 3.1.1ï¼šå¥—ç”¨ç¯©é¸æ¢ä»¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°‡æš«å­˜çš„ç¯©é¸æ¢ä»¶å¥—ç”¨åˆ°Provider
   */
  void _applyFilters();

  /**
   * 13. å°æ‡‰ 3.1.1ï¼šé‡è¨­ç¯©é¸æ¢ä»¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…ç©ºæ‰€æœ‰ç¯©é¸æ¢ä»¶æ¢å¾©é è¨­
   */
  void _resetFilters();

  /**
   * 14. å°æ‡‰ 3.1.1ï¼šå–å¾—æœ‰æ•ˆç¯©é¸æ•¸é‡
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨ˆç®—ç›®å‰å•Ÿç”¨çš„ç¯©é¸æ¢ä»¶æ•¸é‡
   */
  int _getActiveFilterCount();
}
```

### 3.4 æ¸…å–®å±•ç¤ºå±¤Widget

#### 3.4.1 TransactionListView Widget
```dart
/**
 * 15. å°æ‡‰ 3.2ï¼šè¨˜å¸³è¨˜éŒ„æ¸…å–®Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æ”¯æ´è™›æ“¬åŒ–æ»¾å‹•çš„è¨˜å¸³è¨˜éŒ„æ¸…å–®
 */
class TransactionListView extends StatefulWidget {
  final TransactionHistoryProvider provider;
  final UserMode? userMode;

  const TransactionListView({
    Key? key,
    required this.provider,
    this.userMode,
  });

  @override
  State<TransactionListView> createState();
}

class _TransactionListViewState extends State<TransactionListView> {
  late ScrollController _scrollController;
  final GlobalKey<RefreshIndicatorState> _refreshIndicatorKey = GlobalKey();

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 16. å°æ‡‰ 3.2ï¼šå»ºç«‹åˆ†çµ„æ¨™é ­
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹æ—¥æœŸåˆ†çµ„çš„é»æ€§æ¨™é ­
   */
  Widget _buildGroupHeader(String dateGroup);

  /**
   * 17. å°æ‡‰ 3.2ï¼šè¼‰å…¥æ›´å¤šè³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ»¾å‹•åˆ°åº•éƒ¨æ™‚è¼‰å…¥æ›´å¤šè¨˜éŒ„
   */
  Future<void> _loadMoreData();

  /**
   * 18. å°æ‡‰ 3.2ï¼šé‡æ–°æ•´ç†è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ä¸‹æ‹‰é‡æ–°æ•´ç†è¨˜å¸³è¨˜éŒ„
   */
  Future<void> _refreshData();

  @override
  void dispose();
}
```

#### 3.4.2 TransactionCard Widget
```dart
/**
 * 19. å°æ‡‰ 3.2.1ï¼šè¨˜å¸³è¨˜éŒ„å¡ç‰‡Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å–®ä¸€è¨˜å¸³è¨˜éŒ„çš„å¡ç‰‡å±•ç¤º
 */
class TransactionCard extends StatefulWidget {
  final TransactionEntry transaction;
  final bool isSelected;
  final bool isSelectionMode;
  final VoidCallback? onTap;
  final VoidCallback? onLongPress;
  final Function(bool?)? onSelectionChanged;
  final UserMode? userMode;

  const TransactionCard({
    Key? key,
    required this.transaction,
    this.isSelected = false,
    this.isSelectionMode = false,
    this.onTap,
    this.onLongPress,
    this.onSelectionChanged,
    this.userMode,
  });

  @override
  State<TransactionCard> createState();
}

class _TransactionCardState extends State<TransactionCard> 
    with SingleTickerProviderStateMixin {
  late AnimationController _animationController;
  late Animation<double> _scaleAnimation;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 20. å°æ‡‰ 3.2.1ï¼šå»ºç«‹æ»‘å‹•æ“ä½œ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹å·¦å³æ»‘å‹•çš„æ“ä½œé¸é …
   */
  List<Widget> _buildSwipeActions(BuildContext context);

  /**
   * 21. å°æ‡‰ 3.2.1ï¼šå»ºç«‹å¡ç‰‡å…§å®¹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹è¨˜å¸³è¨˜éŒ„çš„è©³ç´°å…§å®¹å±•ç¤º
   */
  Widget _buildCardContent(BuildContext context);

  /**
   * 22. å°æ‡‰ 3.2.1ï¼šå–å¾—é¡åˆ¥é¡è‰²
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šè¨˜å¸³é¡å‹å’Œé¡åˆ¥å–å¾—å°æ‡‰é¡è‰²
   */
  Color _getCategoryColor();

  @override
  void dispose();
}
```

### 3.5 æ‰¹é‡æ“ä½œå±¤Widget

#### 3.5.1 SelectionControls Widget
```dart
/**
 * 23. å°æ‡‰ 3.3ï¼šé¸æ“‡æ§åˆ¶Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å¤šé¸æ¨¡å¼çš„æ§åˆ¶ä»‹é¢
 */
class SelectionControls extends StatelessWidget {
  final TransactionHistoryProvider provider;
  final UserMode? userMode;

  const SelectionControls({
    Key? key,
    required this.provider,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 24. å°æ‡‰ 3.3ï¼šå…¨é¸åˆ‡æ›
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å…¨é¸æˆ–å–æ¶ˆå…¨é¸ç•¶å‰é é¢è¨˜éŒ„
   */
  void _toggleSelectAll();

  /**
   * 25. å°æ‡‰ 3.3ï¼šæ¸…é™¤é¸æ“‡
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤æ‰€æœ‰é¸ä¸­çš„è¨˜éŒ„
   */
  void _clearSelection();
}

/**
 * 26. å°æ‡‰ 3.3.1ï¼šæ‰¹é‡æ“ä½œå·¥å…·åˆ—Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description é¸ä¸­è¨˜éŒ„å¾Œçš„æ‰¹é‡æ“ä½œå·¥å…·åˆ—
 */
class BatchActionBar extends StatelessWidget {
  final TransactionHistoryProvider provider;
  final List<String> selectedIds;
  final UserMode? userMode;

  const BatchActionBar({
    Key? key,
    required this.provider,
    required this.selectedIds,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 27. å°æ‡‰ 3.3.1ï¼šæ‰¹é‡åˆªé™¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ‰¹é‡åˆªé™¤é¸ä¸­çš„è¨˜éŒ„
   */
  Future<void> _batchDelete(BuildContext context);

  /**
   * 28. å°æ‡‰ 3.3.1ï¼šæ‰¹é‡åŒ¯å‡º
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°‡é¸ä¸­è¨˜éŒ„åŒ¯å‡ºç‚ºæª”æ¡ˆ
   */
  Future<void> _batchExport(BuildContext context);

  /**
   * 29. å°æ‡‰ 3.3.1ï¼šæ‰¹é‡æ¨™è¨˜
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºé¸ä¸­è¨˜éŒ„æ·»åŠ æ¨™ç±¤
   */
  Future<void> _batchTag(BuildContext context);
}
```

### 3.6 ç‹€æ…‹å±•ç¤ºå±¤Widget

#### 3.6.1 ç‹€æ…‹Widgetç¾¤çµ„
```dart
/**
 * 30. å°æ‡‰ 3.4ï¼šè¼‰å…¥ç‹€æ…‹Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è³‡æ–™è¼‰å…¥ä¸­çš„ç‹€æ…‹é¡¯ç¤º
 */
class LoadingStateWidget extends StatelessWidget {
  final UserMode? userMode;
  final String? message;

  const LoadingStateWidget({Key? key, this.userMode, this.message});

  @override
  Widget build(BuildContext context);

  /**
   * 31. å°æ‡‰ 3.4ï¼šå»ºç«‹éª¨æ¶è¼‰å…¥æ•ˆæœ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹è¨˜å¸³å¡ç‰‡çš„éª¨æ¶è¼‰å…¥å‹•ç•«
   */
  Widget _buildSkeletonCards();
}

/**
 * 32. å°æ‡‰ 3.4.1ï¼šç©ºç‹€æ…‹Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description ç„¡è¨˜å¸³è¨˜éŒ„æ™‚çš„ç©ºç‹€æ…‹é¡¯ç¤º
 */
class EmptyStateWidget extends StatelessWidget {
  final UserMode? userMode;
  final VoidCallback? onAddTransaction;
  final String? message;

  const EmptyStateWidget({
    Key? key,
    this.userMode,
    this.onAddTransaction,
    this.message,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 33. å°æ‡‰ 3.4.1ï¼šå–å¾—ç©ºç‹€æ…‹åœ–ç¤º
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›å°æ‡‰çš„ç©ºç‹€æ…‹åœ–ç¤º
   */
  Widget _getEmptyStateIcon();

  /**
   * 34. å°æ‡‰ 3.4.1ï¼šå–å¾—ç©ºç‹€æ…‹è¨Šæ¯
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›å°æ‡‰çš„ç©ºç‹€æ…‹æç¤ºæ–‡å­—
   */
  String _getEmptyStateMessage();
}

/**
 * 35. å°æ‡‰ 3.4.2ï¼šéŒ¯èª¤ç‹€æ…‹Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è³‡æ–™è¼‰å…¥éŒ¯èª¤æ™‚çš„ç‹€æ…‹é¡¯ç¤º
 */
class ErrorStateWidget extends StatelessWidget {
  final String? error;
  final VoidCallback? onRetry;
  final UserMode? userMode;

  const ErrorStateWidget({
    Key? key,
    this.error,
    this.onRetry,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 36. å°æ‡‰ 3.4.2ï¼šå–å¾—éŒ¯èª¤åœ–ç¤º
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šéŒ¯èª¤é¡å‹è¿”å›å°æ‡‰åœ–ç¤º
   */
  Widget _getErrorIcon(String? error);

  /**
   * 37. å°æ‡‰ 3.4.2ï¼šæ ¼å¼åŒ–éŒ¯èª¤è¨Šæ¯
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°‡éŒ¯èª¤è¨Šæ¯æ ¼å¼åŒ–ç‚ºä½¿ç”¨è€…å‹å–„çš„æ–‡å­—
   */
  String _formatErrorMessage(String? error);
}
```

---

## 4.0 ç‹€æ…‹ç®¡ç†æ¶æ§‹

### 4.1 TransactionHistoryProvider ç‹€æ…‹ç®¡ç†å™¨
```dart
/**
 * 38. å°æ‡‰ 4.1ï¼šè¨˜å¸³æ­·å²é é¢ç‹€æ…‹ç®¡ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description ç®¡ç†è¨˜å¸³æ­·å²é é¢çš„ç‹€æ…‹ï¼Œæ”¯æ´ç¯©é¸ã€åˆ†é ã€æ‰¹é‡æ“ä½œå’Œå››æ¨¡å¼å·®ç•°åŒ–
 */
class TransactionHistoryProvider extends ChangeNotifier {
  // åŸºç¤ç‹€æ…‹å±¬æ€§
  HistoryPageState _pageState = HistoryPageState.initial;
  bool _isLoading = false;
  String? _errorMessage;
  UserMode? _userMode;

  // è¨˜å¸³è¨˜éŒ„è³‡æ–™
  List<TransactionEntry> _transactions = [];
  List<TransactionEntry> _filteredTransactions = [];
  Map<String, List<TransactionEntry>> _groupedTransactions = {};

  // åˆ†é æ§åˆ¶
  int _currentPage = 1;
  int _totalPages = 0;
  int _totalRecords = 0;
  bool _hasNextPage = false;
  bool _isLoadingMore = false;

  // ç¯©é¸è¨­å®š
  FilterSettings _filterSettings = FilterSettings.defaultSettings();
  String _searchQuery = '';
  SortSettings _sortSettings = SortSettings.defaultSettings();

  // é¸æ“‡èˆ‡æ‰¹é‡æ“ä½œ
  bool _isSelectionMode = false;
  Set<String> _selectedIds = {};

  // çµ±è¨ˆæ‘˜è¦
  TransactionSummary? _summary;

  // Getters
  HistoryPageState get pageState;
  bool get isLoading;
  String? get errorMessage;
  UserMode? get userMode;
  List<TransactionEntry> get transactions;
  List<TransactionEntry> get filteredTransactions;
  Map<String, List<TransactionEntry>> get groupedTransactions;
  int get currentPage;
  int get totalPages;
  int get totalRecords;
  bool get hasNextPage;
  bool get isLoadingMore;
  FilterSettings get filterSettings;
  String get searchQuery;
  SortSettings get sortSettings;
  bool get isSelectionMode;
  Set<String> get selectedIds;
  TransactionSummary? get summary;
  int get selectedCount;

  /**
   * 39. å°æ‡‰ 4.1ï¼šåˆå§‹åŒ–è¨˜å¸³æ­·å²é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åˆå§‹åŒ–é é¢ç‹€æ…‹ä¸¦è¼‰å…¥è¨˜å¸³è¨˜éŒ„
   */
  Future<void> initializePage(UserMode? mode, String? ledgerId);

  /**
   * 40. å°æ‡‰ 4.1ï¼šè¼‰å…¥è¨˜å¸³è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¼‰å…¥è¨˜å¸³è¨˜éŒ„è³‡æ–™å’Œçµ±è¨ˆæ‘˜è¦
   */
  Future<void> loadTransactions({bool isRefresh = false});

  /**
   * 41. å°æ‡‰ 4.1ï¼šè¼‰å…¥æ›´å¤šè¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åˆ†é è¼‰å…¥æ›´å¤šè¨˜å¸³è¨˜éŒ„
   */
  Future<void> loadMoreTransactions();

  /**
   * 42. å°æ‡‰ 4.1ï¼šæœå°‹è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šé—œéµå­—æœå°‹è¨˜å¸³è¨˜éŒ„
   */
  Future<void> searchTransactions(String query);

  /**
   * 43. å°æ‡‰ 4.1ï¼šå¥—ç”¨ç¯©é¸æ¢ä»¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¥—ç”¨æ–°çš„ç¯©é¸æ¢ä»¶ä¸¦é‡æ–°è¼‰å…¥è³‡æ–™
   */
  Future<void> applyFilters(FilterSettings filters);

  /**
   * 44. å°æ‡‰ 4.1ï¼šæ›´æ–°æ’åºè¨­å®š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ›´æ–°æ’åºè¨­å®šä¸¦é‡æ–°æ’åºè³‡æ–™
   */
  Future<void> updateSortSettings(SortSettings sortSettings);

  /**
   * 45. å°æ‡‰ 4.1ï¼šåˆ‡æ›é¸æ“‡æ¨¡å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é€²å…¥æˆ–é€€å‡ºå¤šé¸æ¨¡å¼
   */
  void toggleSelectionMode();

  /**
   * 46. å°æ‡‰ 4.1ï¼šåˆ‡æ›è¨˜éŒ„é¸æ“‡ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é¸æ“‡æˆ–å–æ¶ˆé¸æ“‡ç‰¹å®šè¨˜éŒ„
   */
  void toggleTransactionSelection(String transactionId);

  /**
   * 47. å°æ‡‰ 4.1ï¼šå…¨é¸æˆ–å–æ¶ˆå…¨é¸
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å…¨é¸ç•¶å‰é é¢çš„æ‰€æœ‰è¨˜éŒ„æˆ–å–æ¶ˆå…¨é¸
   */
  void toggleSelectAll();

  /**
   * 48. å°æ‡‰ 4.1ï¼šæ¸…é™¤é¸æ“‡
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤æ‰€æœ‰é¸ä¸­çš„è¨˜éŒ„ä¸¦é€€å‡ºé¸æ“‡æ¨¡å¼
   */
  void clearSelection();

  /**
   * 49. å°æ‡‰ 4.1ï¼šåˆªé™¤è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åˆªé™¤å–®ä¸€è¨˜å¸³è¨˜éŒ„
   */
  Future<void> deleteTransaction(String transactionId);

  /**
   * 50. å°æ‡‰ 4.1ï¼šæ‰¹é‡åˆªé™¤è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ‰¹é‡åˆªé™¤é¸ä¸­çš„è¨˜å¸³è¨˜éŒ„
   */
  Future<void> batchDeleteTransactions(List<String> transactionIds);

  /**
   * 51. å°æ‡‰ 4.1ï¼šåŒ¯å‡ºè¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŒ¯å‡ºé¸ä¸­æˆ–ç¯©é¸å¾Œçš„è¨˜éŒ„
   */
  Future<void> exportTransactions(List<String>? transactionIds, ExportFormat format);

  /**
   * 52. å°æ‡‰ 4.1ï¼šé‡æ–°æ•´ç†è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é‡æ–°è¼‰å…¥è¨˜å¸³è¨˜éŒ„è³‡æ–™
   */
  Future<void> refreshData();

  /**
   * 53. å°æ‡‰ 4.1ï¼šè™•ç†è³‡æ–™åˆ†çµ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šæ—¥æœŸå°è¨˜å¸³è¨˜éŒ„é€²è¡Œåˆ†çµ„
   */
  void _groupTransactionsByDate();

  /**
   * 54. å°æ‡‰ 4.1ï¼šè¨ˆç®—çµ±è¨ˆæ‘˜è¦
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨ˆç®—ç•¶å‰ç¯©é¸æ¢ä»¶ä¸‹çš„çµ±è¨ˆæ‘˜è¦
   */
  void _calculateSummary();

  /**
   * 55. å°æ‡‰ 4.1ï¼šè¨­å®šè¼‰å…¥ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ›´æ–°è¼‰å…¥ç‹€æ…‹ä¸¦é€šçŸ¥ç›£è½è€…
   */
  void _setLoading(bool loading);

  /**
   * 56. å°æ‡‰ 4.1ï¼šè¨­å®šé é¢ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ›´æ–°é é¢ç‹€æ…‹ä¸¦é€šçŸ¥ç›£è½è€…
   */
  void _setPageState(HistoryPageState state);

  /**
   * 57. å°æ‡‰ 4.1ï¼šè¨­å®šéŒ¯èª¤è¨Šæ¯
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨­å®šéŒ¯èª¤è¨Šæ¯ä¸¦æ›´æ–°é é¢ç‹€æ…‹
   */
  void _setError(String message, dynamic error);

  /**
   * 58. å°æ‡‰ 4.1ï¼šå°èˆªåˆ°ç·¨è¼¯é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°è¨˜å¸³ç·¨è¼¯é é¢
   */
  void navigateToEdit(String transactionId);

  /**
   * 59. å°æ‡‰ 4.1ï¼šå°èˆªåˆ°æ–°å¢é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°è¨˜å¸³æ–°å¢é é¢
   */
  void navigateToAdd();

  /**
   * 60. å°æ‡‰ 4.1ï¼šå°èˆªåˆ°è©³ç´°é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°è¨˜å¸³è©³ç´°æª¢è¦–é é¢
   */
  void navigateToDetail(String transactionId);
}
```

### 4.2 ç‹€æ…‹æšèˆ‰èˆ‡è³‡æ–™æ¨¡å‹
```dart
/**
 * 61. å°æ‡‰ 4.2ï¼šè¨˜å¸³æ­·å²é é¢ç‹€æ…‹æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å®šç¾©è¨˜å¸³æ­·å²é é¢çš„å„ç¨®ç‹€æ…‹
 */
enum HistoryPageState {
  initial,        // åˆå§‹ç‹€æ…‹
  loading,        // è¼‰å…¥ä¸­
  loaded,         // è¼‰å…¥å®Œæˆ
  empty,          // ç©ºè³‡æ–™
  error,          // éŒ¯èª¤ç‹€æ…‹
  refreshing,     // é‡æ–°æ•´ç†ä¸­
}

/**
 * 62. å°æ‡‰ 4.2ï¼šç¯©é¸è¨­å®šè³‡æ–™æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è¨˜å¸³è¨˜éŒ„ç¯©é¸æ¢ä»¶è¨­å®š
 */
class FilterSettings {
  final DateRange? dateRange;
  final List<String> categoryIds;
  final List<TransactionType> transactionTypes;
  final AmountRange? amountRange;
  final List<String> tagIds;
  final List<String> ledgerIds;

  FilterSettings({
    this.dateRange,
    this.categoryIds = const [],
    this.transactionTypes = const [],
    this.amountRange,
    this.tagIds = const [],
    this.ledgerIds = const [],
  });

  factory FilterSettings.defaultSettings();
  FilterSettings copyWith({/* parameters */});
  bool get hasActiveFilters;
  int get activeFilterCount;
}

/**
 * 63. å°æ‡‰ 4.2ï¼šæ’åºè¨­å®šè³‡æ–™æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è¨˜å¸³è¨˜éŒ„æ’åºæ–¹å¼è¨­å®š
 */
class SortSettings {
  final SortField sortField;
  final SortOrder sortOrder;

  SortSettings({
    required this.sortField,
    required this.sortOrder,
  });

  factory SortSettings.defaultSettings();
  SortSettings copyWith({SortField? sortField, SortOrder? sortOrder});
}

enum SortField { date, amount, category, createdAt }
enum SortOrder { ascending, descending }

/**
 * 64. å°æ‡‰ 4.2ï¼šè¨˜å¸³è¨˜éŒ„è³‡æ–™æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è¨˜å¸³è¨˜éŒ„çš„å®Œæ•´è³‡æ–™çµæ§‹
 */
class TransactionEntry {
  final String transactionId;
  final TransactionType transactionType;
  final double amount;
  final String categoryId;
  final String categoryName;
  final Color categoryColor;
  final DateTime transactionDate;
  final String? description;
  final String? merchant;
  final List<String> tags;
  final String ledgerId;
  final String ledgerName;
  final String createdBy;
  final DateTime createdAt;
  final DateTime? updatedAt;

  TransactionEntry({
    required this.transactionId,
    required this.transactionType,
    required this.amount,
    required this.categoryId,
    required this.categoryName,
    required this.categoryColor,
    required this.transactionDate,
    this.description,
    this.merchant,
    this.tags = const [],
    required this.ledgerId,
    required this.ledgerName,
    required this.createdBy,
    required this.createdAt,
    this.updatedAt,
  });

  factory TransactionEntry.fromJson(Map<String, dynamic> json);
  Map<String, dynamic> toJson();
}

/**
 * 65. å°æ‡‰ 4.2ï¼šçµ±è¨ˆæ‘˜è¦è³‡æ–™æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è¨˜å¸³è¨˜éŒ„çš„çµ±è¨ˆæ‘˜è¦è³‡æ–™
 */
class TransactionSummary {
  final int totalTransactions;
  final double totalIncome;
  final double totalExpense;
  final double netAmount;
  final double averageTransaction;
  final Map<String, double> categoryBreakdown;
  final Map<String, int> monthlyTransactionCount;

  TransactionSummary({
    required this.totalTransactions,
    required this.totalIncome,
    required this.totalExpense,
    required this.netAmount,
    required this.averageTransaction,
    required this.categoryBreakdown,
    required this.monthlyTransactionCount,
  });

  factory TransactionSummary.fromJson(Map<String, dynamic> json);
  factory TransactionSummary.empty();
}
```

---

## 5.0 APIæ•´åˆè¨­è¨ˆ

### 5.1 HistoryApiService APIæœå‹™
```dart
/**
 * 66. å°æ‡‰ 5.1ï¼šè¨˜å¸³æ­·å²é é¢APIæœå‹™
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è™•ç†è¨˜å¸³æ­·å²é é¢ç›¸é—œçš„APIèª¿ç”¨ï¼Œæ•´åˆEntryServiceå’ŒReportServiceåŠŸèƒ½
 */
class HistoryApiService {
  final ApiClient _apiClient = ApiClient();

  /**
   * 67. å°æ‡‰ 5.1ï¼šæŸ¥è©¢è¨˜å¸³æ­·å²
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æŸ¥è©¢è¨˜å¸³æ­·å²è¨˜éŒ„APIèª¿ç”¨ï¼ˆå°æ‡‰F007ç«¯é»ï¼‰
   */
  Future<ApiResponse<QueryTransactionsResponse>> queryTransactions(QueryTransactionsRequest request);

  /**
   * 68. å°æ‡‰ 5.1ï¼šåˆªé™¤è¨˜å¸³è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åˆªé™¤è¨˜å¸³è¨˜éŒ„APIèª¿ç”¨ï¼ˆå°æ‡‰F009ç«¯é»ï¼‰
   */
  Future<ApiResponse<DeleteTransactionResponse>> deleteTransaction(String transactionId);

  /**
   * 69. å°æ‡‰ 5.1ï¼šæ‰¹é‡åˆªé™¤è¨˜å¸³è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ‰¹é‡åˆªé™¤è¨˜å¸³è¨˜éŒ„APIèª¿ç”¨
   */
  Future<ApiResponse<BatchDeleteResponse>> batchDeleteTransactions(List<String> transactionIds);

  /**
   * 70. å°æ‡‰ 5.1ï¼šåŒ¯å‡ºè¨˜å¸³è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŒ¯å‡ºè¨˜å¸³è¨˜éŒ„APIèª¿ç”¨ï¼ˆå°æ‡‰F024ç«¯é»ï¼‰
   */
  Future<ApiResponse<ExportResponse>> exportTransactions(ExportTransactionsRequest request);

  /**
   * 71. å°æ‡‰ 5.1ï¼šå–å¾—çµ±è¨ˆæ‘˜è¦
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å–å¾—è¨˜å¸³çµ±è¨ˆæ‘˜è¦APIèª¿ç”¨ï¼ˆå°æ‡‰F022ç«¯é»ï¼‰
   */
  Future<ApiResponse<TransactionSummaryResponse>> getTransactionSummary(SummaryRequest request);

  /**
   * 72. å°æ‡‰ 5.1ï¼šè™•ç†DioéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†DioéŒ¯èª¤ä¸¦è½‰æ›ç‚ºä½¿ç”¨è€…å‹å–„è¨Šæ¯
   */
  String _handleDioError(DioError error);
}
```

### 5.2 è³‡æ–™æ¨¡å‹å®šç¾©
```dart
/**
 * 73. å°æ‡‰ 5.2ï¼šæŸ¥è©¢è¨˜å¸³è¨˜éŒ„è«‹æ±‚æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æŸ¥è©¢è¨˜å¸³è¨˜éŒ„çš„è«‹æ±‚è³‡æ–™çµæ§‹
 */
class QueryTransactionsRequest {
  final String? ledgerId;
  final DateTime? startDate;
  final DateTime? endDate;
  final List<String> categoryIds;
  final List<TransactionType> transactionTypes;
  final double? minAmount;
  final double? maxAmount;
  final String? searchKeyword;
  final SortField sortBy;
  final SortOrder sortOrder;
  final int page;
  final int limit;

  QueryTransactionsRequest({
    this.ledgerId,
    this.startDate,
    this.endDate,
    this.categoryIds = const [],
    this.transactionTypes = const [],
    this.minAmount,
    this.maxAmount,
    this.searchKeyword,
    required this.sortBy,
    required this.sortOrder,
    required this.page,
    required this.limit,
  });

  Map<String, dynamic> toJson();
}

/**
 * 74. å°æ‡‰ 5.2ï¼šæŸ¥è©¢è¨˜å¸³è¨˜éŒ„å›æ‡‰æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æŸ¥è©¢è¨˜å¸³è¨˜éŒ„çš„å›æ‡‰è³‡æ–™çµæ§‹
 */
class QueryTransactionsResponse {
  final bool success;
  final List<TransactionEntry> transactions;
  final PaginationInfo pagination;
  final TransactionSummary summary;
  final String? errorMessage;

  QueryTransactionsResponse({
    required this.success,
    required this.transactions,
    required this.pagination,
    required this.summary,
    this.errorMessage,
  });

  factory QueryTransactionsResponse.fromJson(Map<String, dynamic> json);
}

/**
 * 75. å°æ‡‰ 5.2ï¼šåˆ†é è³‡è¨Šæ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description åˆ†é æŸ¥è©¢çš„è³‡è¨Šè³‡æ–™çµæ§‹
 */
class PaginationInfo {
  final int currentPage;
  final int totalPages;
  final int totalRecords;
  final bool hasNextPage;
  final bool hasPreviousPage;
  final int pageSize;

  PaginationInfo({
    required this.currentPage,
    required this.totalPages,
    required this.totalRecords,
    required this.hasNextPage,
    required this.hasPreviousPage,
    required this.pageSize,
  });

  factory PaginationInfo.fromJson(Map<String, dynamic> json);
}

/**
 * 76. å°æ‡‰ 5.2ï¼šåŒ¯å‡ºè¨˜å¸³è¨˜éŒ„è«‹æ±‚æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description åŒ¯å‡ºè¨˜å¸³è¨˜éŒ„çš„è«‹æ±‚è³‡æ–™çµæ§‹
 */
class ExportTransactionsRequest {
  final List<String>? transactionIds;
  final FilterSettings? filters;
  final ExportFormat format;
  final String? fileName;
  final bool includeHeaders;

  ExportTransactionsRequest({
    this.transactionIds,
    this.filters,
    required this.format,
    this.fileName,
    this.includeHeaders = true,
  });

  Map<String, dynamic> toJson();
}

enum ExportFormat { csv, excel, pdf }

/**
 * 77. å°æ‡‰ 5.2ï¼šåŒ¯å‡ºå›æ‡‰æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description åŒ¯å‡ºæ“ä½œçš„å›æ‡‰è³‡æ–™çµæ§‹
 */
class ExportResponse {
  final bool success;
  final String? downloadUrl;
  final String? fileName;
  final int? fileSize;
  final DateTime? expiryDate;
  final String? errorMessage;

  ExportResponse({
    required this.success,
    this.downloadUrl,
    this.fileName,
    this.fileSize,
    this.expiryDate,
    this.errorMessage,
  });

  factory ExportResponse.fromJson(Map<String, dynamic> json);
}
```

---

## 6.0 å°èˆªè·¯ç”±è¨­è¨ˆ

### 6.1 è·¯ç”±é…ç½®
```dart
/**
 * 78. å°æ‡‰ 6.1ï¼šè¨˜å¸³æ­·å²é é¢è·¯ç”±é…ç½®
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å®šç¾©è¨˜å¸³æ­·å²é é¢çš„è·¯ç”±è¦å‰‡èˆ‡å°èˆªé‚è¼¯
 */
class HistoryRoutes {
  static const String history = '/transaction-history';
  static const String detail = '/transaction-detail';
  static const String edit = '/transaction-edit';
  static const String add = '/transaction-add';
  static const String export = '/transaction-export';

  /**
   * 79. å°æ‡‰ 6.1ï¼šå–å¾—è¨˜å¸³æ­·å²é é¢è·¯ç”±
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹è¨˜å¸³æ­·å²é é¢çš„GoRouteé…ç½®
   */
  static GoRoute getHistoryRoute();

  /**
   * 80. å°æ‡‰ 6.1ï¼šå–å¾—å­è·¯ç”±é…ç½®
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹ç›¸é—œå­é é¢çš„è·¯ç”±é…ç½®
   */
  static List<GoRoute> getSubRoutes();
}

/**
 * 81. å°æ‡‰ 6.1ï¼šè¨˜å¸³æ­·å²å°èˆªæœå‹™
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è™•ç†è¨˜å¸³æ­·å²ç›¸é—œçš„å°èˆªé‚è¼¯
 */
class HistoryNavigationService {
  static final GoRouter _router = GoRouter.of(/* context */);
  static GoRouter get router;

  /**
   * 82. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°è¨˜å¸³è©³ç´°
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°è¨˜å¸³è¨˜éŒ„è©³ç´°é é¢
   */
  Future<void> navigateToDetail(String transactionId);

  /**
   * 83. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°è¨˜å¸³ç·¨è¼¯
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°è¨˜å¸³è¨˜éŒ„ç·¨è¼¯é é¢
   */
  Future<void> navigateToEdit(String transactionId);

  /**
   * 84. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°æ–°å¢è¨˜å¸³
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°æ–°å¢è¨˜å¸³é é¢
   */
  Future<void> navigateToAdd({TransactionType? type});

  /**
   * 85. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°åŒ¯å‡ºé é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°èˆªåˆ°è¨˜å¸³è¨˜éŒ„åŒ¯å‡ºé é¢
   */
  Future<void> navigateToExport({List<String>? transactionIds});

  /**
   * 86. å°æ‡‰ 6.1ï¼šè¿”å›ä¸Šä¸€é 
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¿”å›ä¸Šä¸€å€‹é é¢ä¸¦å¯é¸æ“‡æ€§å‚³éçµæœ
   */
  void goBack({dynamic result});
}
```

---

## 7.0 éŸ¿æ‡‰å¼è¨­è¨ˆ

### 7.1 éŸ¿æ‡‰å¼è¼”åŠ©å·¥å…·
```dart
/**
 * 87. å°æ‡‰ 7.1ï¼šè¨˜å¸³æ­·å²é é¢éŸ¿æ‡‰å¼è¨­è¨ˆè¼”åŠ©å·¥å…·
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description éµå¾ª9005æ–‡ä»¶çš„éŸ¿æ‡‰å¼è¨­è¨ˆè¦ç¯„ï¼Œæä¾›è¨˜å¸³æ­·å²é é¢å°ˆç”¨çš„ä½ˆå±€ç®¡ç†
 */
class HistoryResponsiveHelper {
  final BuildContext context;
  late final MediaQueryData _mediaQuery;
  late final Size _screenSize;

  HistoryResponsiveHelper.of(BuildContext context);

  // æ–·é»åˆ¤æ–·å±¬æ€§ï¼ˆ9005è¦ç¯„ï¼‰
  bool get isMobile;
  bool get isTablet;
  bool get isSmallDesktop;
  bool get isLargeDesktop;
  DeviceType get deviceType;

  // è¨˜å¸³æ­·å²é é¢å°ˆç”¨å°ºå¯¸å±¬æ€§
  double get cardHeight;
  double get cardSpacing;
  EdgeInsets get cardPadding;
  double get filterDrawerWidth;
  double get fabSize;
  int get columnsCount;
  double get summaryCardHeight;

  /**
   * 88. å°æ‡‰ 7.1ï¼šå–å¾—å¡ç‰‡ä½ˆå±€é…ç½®
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šè¢å¹•å°ºå¯¸è¿”å›è¨˜å¸³å¡ç‰‡çš„ä½ˆå±€é…ç½®
   */
  CardLayoutConfig getCardLayoutConfig();

  /**
   * 89. å°æ‡‰ 7.1ï¼šå–å¾—ç¯©é¸é¢æ¿é…ç½®
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šè£ç½®é¡å‹è¿”å›ç¯©é¸é¢æ¿çš„é¡¯ç¤ºé…ç½®
   */
  FilterPanelConfig getFilterPanelConfig();

  /**
   * 90. å°æ‡‰ 7.1ï¼šå–å¾—å››æ¨¡å¼ä½ˆå±€é…ç½®
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›å°æ‡‰çš„ä½ˆå±€é…ç½®
   */
  LayoutConfig getLayoutConfigForMode(UserMode? mode);
}

/**
 * 91. å°æ‡‰ 7.1ï¼šå¡ç‰‡ä½ˆå±€é…ç½®è³‡æ–™æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è¨˜å¸³å¡ç‰‡çš„ä½ˆå±€é…ç½®åƒæ•¸
 */
class CardLayoutConfig {
  final double cardHeight;
  final EdgeInsets cardPadding;
  final double cardSpacing;
  final BorderRadius borderRadius;
  final bool showThumbnail;
  final bool showFullDescription;

  CardLayoutConfig({
    required this.cardHeight,
    required this.cardPadding,
    required this.cardSpacing,
    required this.borderRadius,
    required this.showThumbnail,
    required this.showFullDescription,
  });
}
```

---

## 8.0 ç„¡éšœç¤™åŠŸèƒ½

### 8.1 èªæ„åŒ–æ”¯æ´
```dart
/**
 * 92. å°æ‡‰ 8.1ï¼šè¨˜å¸³æ­·å²é é¢ç„¡éšœç¤™èªæ„åŒ–WidgetåŒ…è£å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æä¾›WCAG 2.1 AAæ¨™æº–çš„å®Œæ•´ç„¡éšœç¤™æ”¯æ´ï¼ˆ9005è¦ç¯„ï¼‰
 */
class HistoryAccessibilityWrapper {

  /**
   * 93. å°æ‡‰ 8.1ï¼šç‚ºè¨˜å¸³å¡ç‰‡æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºè¨˜å¸³è¨˜éŒ„å¡ç‰‡æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤å’Œç‹€æ…‹
   */
  static Widget wrapTransactionCard(Widget child, TransactionEntry transaction, bool isSelected);

  /**
   * 94. å°æ‡‰ 8.1ï¼šç‚ºç¯©é¸æ§åˆ¶æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºç¯©é¸æŒ‰éˆ•å’Œæ§åˆ¶é …æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapFilterControl(Widget child, String filterType, {bool isActive = false});

  /**
   * 95. å°æ‡‰ 8.1ï¼šç‚ºæœå°‹æ¬„ä½æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºæœå°‹è¼¸å…¥æ¬„ä½æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapSearchField(Widget child, String currentQuery);

  /**
   * 96. å°æ‡‰ 8.1ï¼šç‚ºæ‰¹é‡æ“ä½œæä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºæ‰¹é‡æ“ä½œæŒ‰éˆ•æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤å’Œç‹€æ…‹
   */
  static Widget wrapBatchAction(Widget child, String actionType, int selectedCount);

  /**
   * 97. å°æ‡‰ 8.1ï¼šç‚ºçµ±è¨ˆæ‘˜è¦æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºçµ±è¨ˆæ‘˜è¦è³‡è¨Šæ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapSummaryCard(Widget child, TransactionSummary summary);

  /**
   * 98. å°æ‡‰ 8.1ï¼šç‚ºè¼‰å…¥ç‹€æ…‹æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºå„ç¨®è¼‰å…¥ç‹€æ…‹æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapLoadingState(Widget child, String loadingType);
}
```

---

## 9.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 9.1 Widgetå¿«å–ç­–ç•¥
```dart
/**
 * 99. å°æ‡‰ 9.1ï¼šè¨˜å¸³æ­·å²é é¢Widgetå¿«å–ç®¡ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å„ªåŒ–è¨˜å¸³æ­·å²é é¢Widgeté‡å»ºæ•ˆèƒ½ï¼Œæ¸›å°‘ä¸å¿…è¦çš„é‡å»º
 */
class HistoryWidgetCache {
  static final Map<String, Widget> _cache = {};
  static final Map<String, DateTime> _cacheTimestamps = {};
  static const Duration _cacheValidDuration = Duration(minutes: 5);

  /**
   * 100. å°æ‡‰ 9.1ï¼šå–å¾—å¿«å–çš„ç¯©é¸é¢æ¿æˆ–å»ºç«‹æ–°çš„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾å¿«å–ä¸­ç²å–ç¯©é¸é¢æ¿Widgetæˆ–å‰µå»ºæ–°çš„
   */
  static Widget getFilterPanelOrCreate(String cacheKey, Widget Function() creator);

  /**
   * 101. å°æ‡‰ 9.1ï¼šå–å¾—å¿«å–çš„çµ±è¨ˆå¡ç‰‡æˆ–å»ºç«‹æ–°çš„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾å¿«å–ä¸­ç²å–çµ±è¨ˆæ‘˜è¦å¡ç‰‡Widgetæˆ–å‰µå»ºæ–°çš„
   */
  static Widget getSummaryCardOrCreate(String cacheKey, Widget Function() creator);

  /**
   * 102. å°æ‡‰ 9.1ï¼šæ¸…é™¤è¨˜å¸³æ­·å²å¿«å–
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤è¨˜å¸³æ­·å²é é¢ç›¸é—œçš„Widgetå¿«å–
   */
  static void clearHistoryCache();
}
```

### 9.2 è™›æ“¬åŒ–æ¸…å–®æœ€ä½³åŒ–
```dart
/**
 * 103. å°æ‡‰ 9.2ï¼šè¨˜å¸³æ¸…å–®æ•ˆèƒ½å„ªåŒ–å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å„ªåŒ–å¤§é‡è¨˜å¸³è¨˜éŒ„çš„æ¸…å–®é¡¯ç¤ºæ•ˆèƒ½
 */
class HistoryListOptimizer {
  static const int _itemCacheSize = 100;
  static const int _preloadThreshold = 10;

  /**
   * 104. å°æ‡‰ 9.2ï¼šè™›æ“¬åŒ–æ¸…å–®å»ºæ§‹å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹æ”¯æ´è™›æ“¬åŒ–æ»¾å‹•çš„è¨˜å¸³è¨˜éŒ„æ¸…å–®
   */
  static Widget buildVirtualizedList(
    List<TransactionEntry> transactions,
    Widget Function(BuildContext, int) itemBuilder,
  );

  /**
   * 105. å°æ‡‰ 9.2ï¼šé è¼‰å…¥è³‡æ–™
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åœ¨ä½¿ç”¨è€…æ»¾å‹•æ™‚é è¼‰å…¥ä¸‹ä¸€é è³‡æ–™
   */
  static Future<void> preloadNextPage(TransactionHistoryProvider provider, int currentIndex);

  /**
   * 106. å°æ‡‰ 9.2ï¼šæœ€ä½³åŒ–å¡ç‰‡å»ºæ§‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æœ€ä½³åŒ–è¨˜å¸³å¡ç‰‡çš„å»ºæ§‹æ•ˆèƒ½
   */
  static Widget optimizedCardBuilder(
    BuildContext context,
    TransactionEntry transaction,
    {bool isVisible = true}
  );
}
```

---

## 10.0 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

### 10.1 çµ±ä¸€éŒ¯èª¤è™•ç†
```dart
/**
 * 107. å°æ‡‰ 10.1ï¼šè¨˜å¸³æ­·å²é é¢éŒ¯èª¤è™•ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è™•ç†è¨˜å¸³æ­·å²é é¢çš„å„ç¨®éŒ¯èª¤æƒ…å¢ƒ
 */
class HistoryErrorHandler {

  /**
   * 108. å°æ‡‰ 10.1ï¼šè™•ç†è¼‰å…¥éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†è¨˜å¸³è¨˜éŒ„è¼‰å…¥éŒ¯èª¤
   */
  static String handleLoadError(dynamic error);

  /**
   * 109. å°æ‡‰ 10.1ï¼šè™•ç†æœå°‹éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æœå°‹åŠŸèƒ½éŒ¯èª¤
   */
  static String handleSearchError(dynamic error);

  /**
   * 110. å°æ‡‰ 10.1ï¼šè™•ç†åˆªé™¤éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†è¨˜éŒ„åˆªé™¤éŒ¯èª¤
   */
  static String handleDeleteError(dynamic error, {bool isBatch = false});

  /**
   * 111. å°æ‡‰ 10.1ï¼šè™•ç†åŒ¯å‡ºéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†è¨˜éŒ„åŒ¯å‡ºéŒ¯èª¤
   */
  static String handleExportError(dynamic error);

  /**
   * 112. å°æ‡‰ 10.1ï¼šè™•ç†ç¶²è·¯éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†ç¶²è·¯é€£ç·šç›¸é—œéŒ¯èª¤
   */
  static String handleNetworkError(DioError error);

  /**
   * 113. å°æ‡‰ 10.1ï¼šè™•ç†æ¬Šé™éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æ“ä½œæ¬Šé™ç›¸é—œéŒ¯èª¤
   */
  static String handlePermissionError(dynamic error);

  /**
   * 114. å°æ‡‰ 10.1ï¼šé¡¯ç¤ºéŒ¯èª¤å°è©±æ¡†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å°è©±æ¡†
   */
  static Future<void> showErrorDialog(
    BuildContext context,
    String message,
    {String? title, VoidCallback? onRetry, VoidCallback? onDismiss}
  );

  /**
   * 115. å°æ‡‰ 10.1ï¼šé¡¯ç¤ºéŒ¯èª¤æç¤º
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é¡¯ç¤ºç°¡çŸ­çš„éŒ¯èª¤æç¤ºè¨Šæ¯
   */
  static void showErrorSnackBar(BuildContext context, String message);
}
```

### 10.2 éŒ¯èª¤å¾©åŸæ©Ÿåˆ¶
```dart
/**
 * 116. å°æ‡‰ 10.2ï¼šè¨˜å¸³æ­·å²éŒ¯èª¤å¾©åŸç­–ç•¥
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æä¾›è¨˜å¸³æ­·å²å„ç¨®éŒ¯èª¤å¾©åŸæ©Ÿåˆ¶
 */
class HistoryErrorRecovery {

  /**
   * 117. å°æ‡‰ 10.2ï¼šè‡ªå‹•é‡è©¦æ©Ÿåˆ¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é‡å°ç¶²è·¯éŒ¯èª¤ç­‰è‡¨æ™‚æ€§å•é¡Œçš„è‡ªå‹•é‡è©¦æ©Ÿåˆ¶
   */
  static Future<T> retryOperation<T>(
    Future<T> Function() operation,
    {int maxRetries = 3, Duration delay = const Duration(seconds: 1)}
  );

  /**
   * 118. å°æ‡‰ 10.2ï¼šæœ¬åœ°å¿«å–æ¢å¾©
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç•¶ç¶²è·¯ä¸å¯ç”¨æ™‚ï¼Œå¾æœ¬åœ°å¿«å–æ¢å¾©è³‡æ–™
   */
  static Future<List<TransactionEntry>> recoverFromCache();

  /**
   * 119. å°æ‡‰ 10.2ï¼šéƒ¨åˆ†è¼‰å…¥æ¢å¾©
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç•¶å…¨é‡è¼‰å…¥å¤±æ•—æ™‚ï¼Œå˜—è©¦éƒ¨åˆ†è¼‰å…¥
   */
  static Future<void> attemptPartialLoad(TransactionHistoryProvider provider);

  /**
   * 120. å°æ‡‰ 10.2ï¼šé›¢ç·šæ¨¡å¼è™•ç†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†é›¢ç·šç‹€æ…‹çš„è¨˜å¸³æ­·å²ç•Œé¢
   */
  static Widget buildOfflineHistoryWidget({VoidCallback? onRetry});
}
```

---

## éµå¾ª0055è¨­è¨ˆåŸå‰‡

### éšå±¤æ¶æ§‹å°æ‡‰
- æœ¬TDDæ–‡ä»¶åŸºæ–¼P009_è¨˜å¸³æ­·å²é é¢_SRS.mdçš„éœ€æ±‚è¦æ ¼
- èˆ‡9005. Flutter_Presentation layer.mdçš„ç”¢å“è¦æ ¼ä¿æŒä¸€è‡´
- æ•´åˆ8902. EntryService_åŸºç¤è¨˜å¸³.mdå’Œ8906. ReportService_å ±è¡¨åŠŸèƒ½.mdçš„APIæœå‹™
- æ‰€æœ‰å‡½æ•¸ç¯€é»ç·¨è™Ÿå°æ‡‰ä¸Šå±¤æ–‡ä»¶çš„åŠŸèƒ½æ¢ç›®

### è¨­è¨ˆåŸå‰‡éµå¾ª
1. **éšå±¤æ¶æ§‹é‚è¼¯**: åš´æ ¼åŸºæ–¼SRSæ–‡ä»¶å®šç¾©çš„åŠŸèƒ½æ¢ç›®è¨­è¨ˆ
2. **åŒå±¤ç´šä¾è³´é—œä¿‚**: è€ƒé‡èˆ‡å¿«é€Ÿè¨˜å¸³ã€è©³ç´°è¨˜å¸³ã€è¨˜å¸³ç·¨è¼¯é é¢çš„ä¾è³´é—œä¿‚
3. **ä»£ç¢¼ç¯€é»ç·¨è™Ÿ**: æ¡ç”¨ä¸åŠ å‰ç¶´çš„ç¯€é»ç·¨è™Ÿæ ¼å¼ï¼ˆå¦‚2.1ã€3.2ï¼‰
4. **å‘½åä¸€è‡´æ€§**: ä¿æŒèˆ‡ä½¿ç”¨è€…ä»‹é¢æ“ä½œæµç¨‹çš„åç¨±åŒæ­¥
5. **å¯è®€æ€§è¨­è¨ˆ**: æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œéµå¾ªä½è€¦åˆã€é«˜å…§èšåŸå‰‡

## æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| **v1.0.0** | **2025-01-26 18:00:00 +08:00** | **LCAS SA Team** | **åˆç‰ˆå»ºç«‹ï¼šå®Œæ•´P009è¨˜å¸³æ­·å²é é¢TDDè¦æ ¼ï¼Œæ”¯æ´å¤šç¶­åº¦ç¯©é¸æŸ¥è©¢ã€åˆ†é è¼‰å…¥ã€æ‰¹é‡æ“ä½œã€è™›æ“¬åŒ–æ¸…å–®ã€çµ±è¨ˆæ‘˜è¦ï¼Œå¯¦ä½œå››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆï¼Œå®Œæ•´éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œéµå¾ª0055è¨­è¨ˆåŸå‰‡ï¼Œå°æ‡‰P009 SRSè¦æ ¼ï¼Œæ•´åˆEntryServiceå’ŒReportService API** |

---

## å‚™è¨»

- **ç´”å‡½æ•¸å®£å‘Š**: å®Œå…¨ç§»é™¤æ‰€æœ‰å¯¦ä½œä»£ç¢¼ï¼Œåƒ…ä¿ç•™å‡½æ•¸åç¨±ã€åƒæ•¸å®šç¾©å’Œè¨»è§£
- **å¤§é‡è³‡æ–™è™•ç†**: æ”¯æ´è™›æ“¬åŒ–æ¸…å–®ã€åˆ†é è¼‰å…¥ã€æ™ºæ…§å¿«å–ç­‰é«˜æ•ˆèƒ½æ©Ÿåˆ¶
- **å¤šç¶­åº¦ç¯©é¸**: å®Œæ•´çš„æ—¥æœŸã€é¡åˆ¥ã€é‡‘é¡ã€æ¨™ç±¤ç­‰ç¯©é¸åŠŸèƒ½
- **æ‰¹é‡æ“ä½œæ”¯æ´**: æ”¯æ´å¤šé¸ã€æ‰¹é‡åˆªé™¤ã€æ‰¹é‡åŒ¯å‡ºç­‰æ‰¹é‡è™•ç†åŠŸèƒ½
- **å››æ¨¡å¼å·®ç•°åŒ–**: æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼æä¾›ä¸åŒçš„ç•Œé¢è¤‡é›œåº¦å’ŒåŠŸèƒ½
- **å®Œæ•´æŠ€è¡“æ¶æ§‹**: Widgetåˆ†å±¤ã€ç‹€æ…‹ç®¡ç†ã€APIæ•´åˆã€éŸ¿æ‡‰å¼è¨­è¨ˆã€ç„¡éšœç¤™æ”¯æ´ã€æ•ˆèƒ½æœ€ä½³åŒ–
- **APIæ•´åˆ**: æ•´åˆEntryServiceçš„F007æŸ¥è©¢ã€F009åˆªé™¤åŠŸèƒ½å’ŒReportServiceçš„F024åŒ¯å‡ºã€F022çµ±è¨ˆåŠŸèƒ½
- **è¦ç¯„å®Œå…¨å°é½Š**: èˆ‡0055ã€P009 SRSã€9005æ–‡ä»¶å®Œå…¨ä¸€è‡´
- **ç¯€é»ç·¨è™Ÿæ¨™æº–åŒ–**: çµ±ä¸€ç·¨è™Ÿ01-120ï¼Œéµå¾ª0055è¦ç¯„æ ¼å¼
- **ç‰ˆæœ¬çµ±ä¸€å‡ç´š**: æ‰€æœ‰çµ„ä»¶ç‰ˆæœ¬çµ±ä¸€ç‚ºv1.0.0
