
# 8801. TDD_èªè­‰åŠŸèƒ½ç¾¤çµ„_v2.1.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: èªè­‰åŠŸèƒ½ç¾¤çµ„æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v2.1.0
- **å‰µå»ºæ—¥æœŸ**: 2025-01-20 14:00:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-01-20 14:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: 8701. èªè­‰æµç¨‹ç¾¤çµ„_SRS.md
- **æ¨¡çµ„ä»£ç¢¼**: AUTH (Authentication)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. æŠ€è¡“æ¶æ§‹æ¦‚è¿°
   - 1.1 æ¨¡çµ„å®šä½
   - 1.2 æŠ€è¡“å †ç–Š
   - 1.3 æ¨¡çµ„æ¶æ§‹

2. å‡½æ•¸æ¸…å–®
   - 2.1 å®Œæ•´å‡½æ•¸ç´¢å¼•è¡¨
   - 2.2 å‡½æ•¸åˆ†å±¤æ¶æ§‹

3. æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ
   - 3.1 æ­¡è¿é é¢ç®¡ç†å±¤å‡½æ•¸
   - 3.2 ç™»å…¥è™•ç†å±¤å‡½æ•¸
   - 3.3 è¨»å†Šè™•ç†å±¤å‡½æ•¸
   - 3.4 å¯†ç¢¼é‡è¨­å±¤å‡½æ•¸
   - 3.5 ç™»å‡ºç®¡ç†å±¤å‡½æ•¸
   - 3.6 ç‹€æ…‹ç®¡ç†å±¤å‡½æ•¸
   - 3.7 å››æ¨¡å¼UIå±¤å‡½æ•¸

4. å››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆ
   - 4.1 ç²¾æº–æ§åˆ¶è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ
   - 4.2 ç´€éŒ„ç¿’æ…£è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ
   - 4.3 è½‰å‹æŒ‘æˆ°è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ
   - 4.4 æ½›åœ¨è¦ºé†’è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ

5. Widgetæ¶æ§‹è¨­è¨ˆ
   - 5.1 é é¢Widgetçµæ§‹
   - 5.2 å…±ç”¨Widgetå…ƒä»¶
   - 5.3 ç‹€æ…‹ç®¡ç†Widget

6. APIæ•´åˆè¨­è¨ˆ
   - 6.1 èªè­‰APIæ•´åˆ
   - 6.2 OAuthæ•´åˆå¯¦ä½œ
   - 6.3 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

7. ç‹€æ…‹ç®¡ç†æ¶æ§‹
   - 7.1 Providerç‹€æ…‹ç®¡ç†
   - 7.2 é é¢é–“å°èˆªç®¡ç†
   - 7.3 èªè­‰ç‹€æ…‹æŒä¹…åŒ–

8. å®‰å…¨æ©Ÿåˆ¶å¯¦ä½œ
   - 8.1 æœ¬åœ°å®‰å…¨å­˜å„²
   - 8.2 ç”Ÿç‰©è¾¨è­˜æ•´åˆ
   - 8.3 ä»¤ç‰Œå®‰å…¨ç®¡ç†

9. ç„¡éšœç¤™æ”¯æ´å¯¦ä½œ
   - 9.1 èªæ„åŒ–Widgetè¨­è¨ˆ
   - 9.2 è¢å¹•é–±è®€å™¨æœ€ä½³åŒ–
   - 9.3 éµç›¤å°èˆªæ”¯æ´

10. æ•ˆèƒ½æœ€ä½³åŒ–
    - 10.1 Widgetæœ€ä½³åŒ–ç­–ç•¥
    - 10.2 è¨˜æ†¶é«”ç®¡ç†
    - 10.3 ç¶²è·¯è«‹æ±‚æœ€ä½³åŒ–

11. æ¸¬è©¦ç­–ç•¥
    - 11.1 Widgetæ¸¬è©¦è¦†è“‹
    - 11.2 æ•´åˆæ¸¬è©¦å ´æ™¯
    - 11.3 ä½¿ç”¨è€…é«”é©—æ¸¬è©¦

12. æ–‡ä»¶ç¶­è­·è¨˜éŒ„

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
èªè­‰åŠŸèƒ½ç¾¤çµ„ä½œç‚º LCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„**å®‰å…¨å…¥å£èˆ‡èº«ä»½ç®¡ç†æ ¸å¿ƒ**ï¼Œè² è²¬è™•ç†ä½¿ç”¨è€…èº«ä»½é©—è­‰ã€æ¨¡å¼é¸æ“‡ã€å®‰å…¨ç™»å‡ºç­‰åŠŸèƒ½ã€‚æœ¬æ¨¡çµ„å°ˆæ³¨æ–¼Flutter Presentation Layerçš„å¯¦ä½œï¼Œé€éç‹€æ…‹ç®¡ç†èˆ‡Backend APIé€²è¡Œå®‰å…¨çš„èªè­‰æµç¨‹è™•ç†ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **UIæ¡†æ¶**: Flutter/Dart
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **æœ¬åœ°å­˜å„²**: flutter_secure_storage
- **ç¶²è·¯è«‹æ±‚**: dio + retry interceptor
- **OAuthæ•´åˆ**: LINE SDK, Google Sign-In, Apple Sign-In
- **ç”Ÿç‰©è¾¨è­˜**: local_auth
- **ç„¡éšœç¤™**: Semantics + TalkBack/VoiceOver
- **åœ‹éš›åŒ–**: flutter_localizations
- **å‹•ç•«**: flutter/animation

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * AUTH_èªè­‰åŠŸèƒ½ç¾¤çµ„_2.1.0
 * @module AUTHæ¨¡çµ„
 * @description Flutterèªè­‰æµç¨‹ç¾¤çµ„ - å®‰å…¨èº«ä»½é©—è­‰ã€æ¨¡å¼é¸æ“‡ã€ç‹€æ…‹ç®¡ç†
 * @update 2025-01-20: å‡ç´šè‡³v2.1ç‰ˆæœ¬ï¼Œå®Œæ•´å››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆï¼Œå¢å¼·å®‰å…¨æ©Ÿåˆ¶
 */
```

---

## 2.0 å‡½æ•¸æ¸…å–®

### 2.1 å®Œæ•´å‡½æ•¸ç´¢å¼•è¡¨

| # | å‡½æ•¸åç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾æœå‹™ |
|---|----------|------|----------|----------|----------|
| 01 | AUTH_initWelcomePage | V2.1.0 | æ­¡è¿é é¢ç®¡ç†å±¤ | åˆå§‹åŒ–æ­¡è¿é é¢èˆ‡æ¨¡å¼é¸æ“‡ | AuthService |
| 02 | AUTH_handleModeSelection | V2.1.0 | æ­¡è¿é é¢ç®¡ç†å±¤ | è™•ç†ä½¿ç”¨è€…æ¨¡å¼é¸æ“‡ | AuthService |
| 03 | AUTH_checkExistingAuth | V2.1.0 | æ­¡è¿é é¢ç®¡ç†å±¤ | æª¢æŸ¥ç¾æœ‰èªè­‰ç‹€æ…‹ | SecureStorage |
| 04 | AUTH_handleLogin | V2.1.0 | ç™»å…¥è™•ç†å±¤ | è™•ç†ç™»å…¥æµç¨‹ | AuthService |
| 05 | AUTH_handleLineLogin | V2.1.0 | ç™»å…¥è™•ç†å±¤ | è™•ç†LINE OAuthç™»å…¥ | LineLogin |
| 06 | AUTH_handleEmailLogin | V2.1.0 | ç™»å…¥è™•ç†å±¤ | è™•ç†Emailç™»å…¥ | AuthService |
| 07 | AUTH_handleGoogleLogin | V2.1.0 | ç™»å…¥è™•ç†å±¤ | è™•ç†Google OAuthç™»å…¥ | GoogleSignIn |
| 08 | AUTH_handleAppleLogin | V2.1.0 | ç™»å…¥è™•ç†å±¤ | è™•ç†Apple IDç™»å…¥ | AppleSignIn |
| 09 | AUTH_handleRegister | V2.1.0 | è¨»å†Šè™•ç†å±¤ | è™•ç†è¨»å†Šæµç¨‹ | AuthService |
| 10 | AUTH_validateRegistrationForm | V2.1.0 | è¨»å†Šè™•ç†å±¤ | é©—è­‰è¨»å†Šè¡¨å–® | Validator |
| 11 | AUTH_handleEmailVerification | V2.1.0 | è¨»å†Šè™•ç†å±¤ | è™•ç†Emailé©—è­‰ | AuthService |
| 12 | AUTH_setupUserProfile | V2.1.0 | è¨»å†Šè™•ç†å±¤ | è¨­å®šä½¿ç”¨è€…å€‹äººè³‡æ–™ | AuthService |
| 13 | AUTH_initPasswordReset | V2.1.0 | å¯†ç¢¼é‡è¨­å±¤ | åˆå§‹åŒ–å¯†ç¢¼é‡è¨­æµç¨‹ | AuthService |
| 14 | AUTH_sendResetCode | V2.1.0 | å¯†ç¢¼é‡è¨­å±¤ | ç™¼é€é‡è¨­é©—è­‰ç¢¼ | AuthService |
| 15 | AUTH_verifyResetCode | V2.1.0 | å¯†ç¢¼é‡è¨­å±¤ | é©—è­‰é‡è¨­é©—è­‰ç¢¼ | AuthService |
| 16 | AUTH_updatePassword | V2.1.0 | å¯†ç¢¼é‡è¨­å±¤ | æ›´æ–°å¯†ç¢¼ | AuthService |
| 17 | AUTH_handleLogout | V2.1.0 | ç™»å‡ºç®¡ç†å±¤ | è™•ç†ç™»å‡ºæµç¨‹ | AuthService |
| 18 | AUTH_showLogoutOptions | V2.1.0 | ç™»å‡ºç®¡ç†å±¤ | é¡¯ç¤ºç™»å‡ºé¸é … | UI |
| 19 | AUTH_clearUserData | V2.1.0 | ç™»å‡ºç®¡ç†å±¤ | æ¸…ç†ä½¿ç”¨è€…è³‡æ–™ | SecureStorage |
| 20 | AUTH_updateAuthState | V2.1.0 | ç‹€æ…‹ç®¡ç†å±¤ | æ›´æ–°èªè­‰ç‹€æ…‹ | Provider |
| 21 | AUTH_persistAuthState | V2.1.0 | ç‹€æ…‹ç®¡ç†å±¤ | æŒä¹…åŒ–èªè­‰ç‹€æ…‹ | SecureStorage |
| 22 | AUTH_restoreAuthState | V2.1.0 | ç‹€æ…‹ç®¡ç†å±¤ | æ¢å¾©èªè­‰ç‹€æ…‹ | SecureStorage |
| 23 | AUTH_handleStateTransition | V2.1.0 | ç‹€æ…‹ç®¡ç†å±¤ | è™•ç†ç‹€æ…‹è½‰æ› | Navigator |
| 24 | AUTH_buildControllerModeUI | V2.1.0 | å››æ¨¡å¼UIå±¤ | å»ºæ§‹ç²¾æº–æ§åˆ¶è€…æ¨¡å¼UI | Widget |
| 25 | AUTH_buildLoggerModeUI | V2.1.0 | å››æ¨¡å¼UIå±¤ | å»ºæ§‹ç´€éŒ„ç¿’æ…£è€…æ¨¡å¼UI | Widget |
| 26 | AUTH_buildStruggleModeUI | V2.1.0 | å››æ¨¡å¼UIå±¤ | å»ºæ§‹è½‰å‹æŒ‘æˆ°è€…æ¨¡å¼UI | Widget |
| 27 | AUTH_buildSleeperModeUI | V2.1.0 | å››æ¨¡å¼UIå±¤ | å»ºæ§‹æ½›åœ¨è¦ºé†’è€…æ¨¡å¼UI | Widget |

### 2.2 å‡½æ•¸åˆ†å±¤æ¶æ§‹

```
AUTHèªè­‰åŠŸèƒ½ç¾¤çµ„ (v2.1.0)
â”œâ”€â”€ æ­¡è¿é é¢ç®¡ç†å±¤ (3å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ AUTH_initWelcomePage() - åˆå§‹åŒ–æ­¡è¿é é¢
â”‚   â”œâ”€â”€ AUTH_handleModeSelection() - è™•ç†æ¨¡å¼é¸æ“‡
â”‚   â””â”€â”€ AUTH_checkExistingAuth() - æª¢æŸ¥èªè­‰ç‹€æ…‹
â”œâ”€â”€ ç™»å…¥è™•ç†å±¤ (5å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ AUTH_handleLogin() - çµ±ä¸€ç™»å…¥è™•ç†
â”‚   â”œâ”€â”€ AUTH_handleLineLogin() - LINE OAuthç™»å…¥
â”‚   â”œâ”€â”€ AUTH_handleEmailLogin() - Emailç™»å…¥
â”‚   â”œâ”€â”€ AUTH_handleGoogleLogin() - Google OAuthç™»å…¥
â”‚   â””â”€â”€ AUTH_handleAppleLogin() - Apple IDç™»å…¥
â”œâ”€â”€ è¨»å†Šè™•ç†å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ AUTH_handleRegister() - çµ±ä¸€è¨»å†Šè™•ç†
â”‚   â”œâ”€â”€ AUTH_validateRegistrationForm() - è¡¨å–®é©—è­‰
â”‚   â”œâ”€â”€ AUTH_handleEmailVerification() - Emailé©—è­‰
â”‚   â””â”€â”€ AUTH_setupUserProfile() - å€‹äººè³‡æ–™è¨­å®š
â”œâ”€â”€ å¯†ç¢¼é‡è¨­å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ AUTH_initPasswordReset() - åˆå§‹åŒ–é‡è¨­æµç¨‹
â”‚   â”œâ”€â”€ AUTH_sendResetCode() - ç™¼é€é©—è­‰ç¢¼
â”‚   â”œâ”€â”€ AUTH_verifyResetCode() - é©—è­‰é©—è­‰ç¢¼
â”‚   â””â”€â”€ AUTH_updatePassword() - æ›´æ–°å¯†ç¢¼
â”œâ”€â”€ ç™»å‡ºç®¡ç†å±¤ (3å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ AUTH_handleLogout() - çµ±ä¸€ç™»å‡ºè™•ç†
â”‚   â”œâ”€â”€ AUTH_showLogoutOptions() - é¡¯ç¤ºç™»å‡ºé¸é …
â”‚   â””â”€â”€ AUTH_clearUserData() - æ¸…ç†ä½¿ç”¨è€…è³‡æ–™
â”œâ”€â”€ ç‹€æ…‹ç®¡ç†å±¤ (4å€‹å‡½æ•¸)
â”‚   â”œâ”€â”€ AUTH_updateAuthState() - æ›´æ–°èªè­‰ç‹€æ…‹
â”‚   â”œâ”€â”€ AUTH_persistAuthState() - æŒä¹…åŒ–ç‹€æ…‹
â”‚   â”œâ”€â”€ AUTH_restoreAuthState() - æ¢å¾©ç‹€æ…‹
â”‚   â””â”€â”€ AUTH_handleStateTransition() - ç‹€æ…‹è½‰æ›
â””â”€â”€ å››æ¨¡å¼UIå±¤ (4å€‹å‡½æ•¸)
    â”œâ”€â”€ AUTH_buildControllerModeUI() - ç²¾æº–æ§åˆ¶è€…UI
    â”œâ”€â”€ AUTH_buildLoggerModeUI() - ç´€éŒ„ç¿’æ…£è€…UI
    â”œâ”€â”€ AUTH_buildStruggleModeUI() - è½‰å‹æŒ‘æˆ°è€…UI
    â””â”€â”€ AUTH_buildSleeperModeUI() - æ½›åœ¨è¦ºé†’è€…UI
```

---

## 3.0 æ ¸å¿ƒå‡½æ•¸è¨­è¨ˆ

### 3.1 æ­¡è¿é é¢ç®¡ç†å±¤å‡½æ•¸

```dart
/**
 * 01. åˆå§‹åŒ–æ­¡è¿é é¢
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description åˆå§‹åŒ–æ­¡è¿é é¢ï¼Œæª¢æŸ¥èªè­‰ç‹€æ…‹ä¸¦è¨­å®šå››æ¨¡å¼é¸æ“‡ä»‹é¢
 */
Future<WelcomePageState> AUTH_initWelcomePage()
```
- **åŠŸèƒ½**: é é¢åˆå§‹åŒ–èˆ‡èªè­‰ç‹€æ…‹æª¢æŸ¥ï¼ŒåŒ…å«å“ç‰Œå±•ç¤ºèˆ‡æ¨¡å¼é¸æ“‡é è¨­
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `checkAuthStatus()` - æª¢æŸ¥ç•¶å‰èªè­‰ç‹€æ…‹
  - **SecureStorage** `getStoredUserMode()` - å–å¾—å·²å„²å­˜çš„ä½¿ç”¨è€…æ¨¡å¼
  - **AppConfig** `getBrandAssets()` - å–å¾—å“ç‰Œè³‡æº
- **å›å‚³å€¼**: `WelcomePageState{isAuthenticated: boolean, lastSelectedMode: UserMode?, brandAssets: BrandAssets}`

```dart
/**
 * 02. è™•ç†ä½¿ç”¨è€…æ¨¡å¼é¸æ“‡
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†ä½¿ç”¨è€…é¸æ“‡çš„å››ç¨®æ¨¡å¼ï¼Œä¸¦è¨­å®šå°æ‡‰çš„UIä¸»é¡Œ
 */
Future<ModeSelectionResult> AUTH_handleModeSelection(UserMode selectedMode, BuildContext context)
```
- **åŠŸèƒ½**: æ¨¡å¼é¸æ“‡è™•ç†èˆ‡UIä¸»é¡Œè¨­å®šï¼ŒåŒ…å«æ¨¡å¼é©—è­‰å’Œä¸»é¡Œæ‡‰ç”¨
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `setUserMode()` - è¨­å®šä½¿ç”¨è€…æ¨¡å¼
  - **ThemeService** `applyModeTheme()` - æ‡‰ç”¨å°æ‡‰æ¨¡å¼ä¸»é¡Œ
  - **SecureStorage** `storeUserMode()` - å„²å­˜æ¨¡å¼é¸æ“‡
- **å›å‚³å€¼**: `ModeSelectionResult{success: boolean, appliedTheme: ThemeData, nextRoute: String}`

```dart
/**
 * 03. æª¢æŸ¥ç¾æœ‰èªè­‰ç‹€æ…‹
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description æª¢æŸ¥æœ¬åœ°å„²å­˜çš„èªè­‰è³‡è¨Šæ˜¯å¦ä»ç„¶æœ‰æ•ˆ
 */
Future<AuthStatusResult> AUTH_checkExistingAuth()
```
- **åŠŸèƒ½**: æœ¬åœ°èªè­‰ç‹€æ…‹æª¢æŸ¥èˆ‡ä»¤ç‰Œæœ‰æ•ˆæ€§é©—è­‰
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecureStorage** `getStoredTokens()` - å–å¾—å„²å­˜çš„ä»¤ç‰Œ
  - **AuthService** `validateToken()` - é©—è­‰ä»¤ç‰Œæœ‰æ•ˆæ€§
  - **NetworkService** `checkConnectivity()` - æª¢æŸ¥ç¶²è·¯é€£ç·šç‹€æ…‹
- **å›å‚³å€¼**: `AuthStatusResult{isValid: boolean, user: UserProfile?, expiresAt: DateTime?, needsRefresh: boolean}`

### 3.2 ç™»å…¥è™•ç†å±¤å‡½æ•¸

```dart
/**
 * 04. çµ±ä¸€ç™»å…¥è™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description çµ±ä¸€çš„ç™»å…¥æµç¨‹è™•ç†ï¼Œæ”¯æ´å¤šç¨®ç™»å…¥æ–¹å¼çš„è·¯ç”±åˆ†ç™¼
 */
Future<LoginResult> AUTH_handleLogin(LoginType loginType, Map<String, dynamic> credentials)
```
- **åŠŸèƒ½**: ç™»å…¥æ–¹å¼è·¯ç”±åˆ†ç™¼èˆ‡çµ±ä¸€éŒ¯èª¤è™•ç†
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `authenticateUser()` - åŸ·è¡Œä½¿ç”¨è€…èªè­‰
  - **ValidationService** `validateCredentials()` - é©—è­‰ç™»å…¥æ†‘è­‰
  - **AnalyticsService** `trackLoginAttempt()` - è¿½è¹¤ç™»å…¥å˜—è©¦
- **å›å‚³å€¼**: `LoginResult{success: boolean, user: UserProfile?, tokens: AuthTokens?, errorCode: String?}`

```dart
/**
 * 05. LINE OAuthç™»å…¥è™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†LINE OAuthç™»å…¥æµç¨‹ï¼ŒåŒ…å«PKCEå®‰å…¨æ©Ÿåˆ¶
 */
Future<OAuthResult> AUTH_handleLineLogin()
```
- **åŠŸèƒ½**: LINE OAuthå®‰å…¨ç™»å…¥æµç¨‹ï¼ŒåŒ…å«PKCEå’Œç‹€æ…‹é©—è­‰
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **LineLoginService** `initiateLogin()` - å•Ÿå‹•LINEç™»å…¥
  - **AuthService** `exchangeOAuthCode()` - äº¤æ›æˆæ¬Šç¢¼
  - **SecurityService** `validateOAuthState()` - é©—è­‰OAuthç‹€æ…‹
- **å›å‚³å€¼**: `OAuthResult{success: boolean, authCode: String?, idToken: String?, profile: LineProfile?}`

```dart
/**
 * 06. Emailç™»å…¥è™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†Emailå¯†ç¢¼ç™»å…¥ï¼ŒåŒ…å«å®‰å…¨é©—è­‰å’Œé‡è©¦æ©Ÿåˆ¶
 */
Future<EmailLoginResult> AUTH_handleEmailLogin(String email, String password, bool rememberMe)
```
- **åŠŸèƒ½**: å‚³çµ±Emailç™»å…¥è™•ç†ï¼ŒåŒ…å«å¯†ç¢¼å®‰å…¨æª¢æŸ¥å’Œè¨˜ä½ç™»å…¥åŠŸèƒ½
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `authenticateWithEmail()` - Emailèªè­‰
  - **SecurityService** `hashPassword()` - å¯†ç¢¼é›œæ¹Šè™•ç†
  - **SecureStorage** `storeCredentials()` - å®‰å…¨å„²å­˜æ†‘è­‰
- **å›å‚³å€¼**: `EmailLoginResult{success: boolean, requiresTwoFactor: boolean, tokens: AuthTokens?}`

```dart
/**
 * 07. Google OAuthç™»å…¥è™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†Google Sign-In OAuthæµç¨‹
 */
Future<OAuthResult> AUTH_handleGoogleLogin()
```
- **åŠŸèƒ½**: Google OAuthç™»å…¥æµç¨‹è™•ç†
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **GoogleSignInService** `signIn()` - Googleç™»å…¥
  - **AuthService** `authenticateWithGoogle()` - Googleèªè­‰
  - **ProfileService** `syncGoogleProfile()` - åŒæ­¥Googleå€‹äººè³‡æ–™
- **å›å‚³å€¼**: `OAuthResult{success: boolean, googleUser: GoogleUser?, tokens: AuthTokens?}`

```dart
/**
 * 08. Apple IDç™»å…¥è™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†Apple Sign-In OAuthæµç¨‹
 */
Future<OAuthResult> AUTH_handleAppleLogin()
```
- **åŠŸèƒ½**: Apple IDç™»å…¥æµç¨‹è™•ç†ï¼Œæ”¯æ´iOSå’ŒmacOS
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AppleSignInService** `signIn()` - Appleç™»å…¥
  - **AuthService** `authenticateWithApple()` - Appleèªè­‰
  - **PrivacyService** `handleApplePrivacy()` - è™•ç†Appleéš±ç§è¨­å®š
- **å›å‚³å€¼**: `OAuthResult{success: boolean, appleUser: AppleUser?, tokens: AuthTokens?}`

### 3.3 è¨»å†Šè™•ç†å±¤å‡½æ•¸

```dart
/**
 * 09. çµ±ä¸€è¨»å†Šè™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description çµ±ä¸€çš„è¨»å†Šæµç¨‹è™•ç†ï¼Œæ”¯æ´å¤šç¨®è¨»å†Šæ–¹å¼
 */
Future<RegistrationResult> AUTH_handleRegister(RegistrationType regType, RegistrationData data)
```
- **åŠŸèƒ½**: è¨»å†Šæ–¹å¼è·¯ç”±èˆ‡çµ±ä¸€è¡¨å–®é©—è­‰è™•ç†
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `registerUser()` - ä½¿ç”¨è€…è¨»å†Š
  - **ValidationService** `validateRegistrationData()` - é©—è­‰è¨»å†Šè³‡æ–™
  - **EmailService** `sendVerificationEmail()` - ç™¼é€é©—è­‰éƒµä»¶
- **å›å‚³å€¼**: `RegistrationResult{success: boolean, userId: String?, verificationRequired: boolean}`

```dart
/**
 * 10. è¨»å†Šè¡¨å–®é©—è­‰
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å³æ™‚çš„è¨»å†Šè¡¨å–®é©—è­‰ï¼ŒåŒ…å«å¯†ç¢¼å¼·åº¦æª¢æŸ¥
 */
Stream<ValidationResult> AUTH_validateRegistrationForm(Stream<RegistrationFormData> formStream)
```
- **åŠŸèƒ½**: å³æ™‚è¡¨å–®é©—è­‰èˆ‡éŒ¯èª¤æç¤ºç”Ÿæˆ
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **ValidationService** `validateEmail()` - Emailæ ¼å¼é©—è­‰
  - **SecurityService** `checkPasswordStrength()` - å¯†ç¢¼å¼·åº¦æª¢æŸ¥
  - **AuthService** `checkEmailAvailability()` - æª¢æŸ¥Emailå¯ç”¨æ€§
- **å›å‚³å€¼**: `ValidationResult{isValid: boolean, errors: Map<String, String>, warnings: List<String>}`

```dart
/**
 * 11. Emailé©—è­‰è™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†Emailé©—è­‰æµç¨‹ï¼ŒåŒ…å«é‡ç™¼æ©Ÿåˆ¶
 */
Future<EmailVerificationResult> AUTH_handleEmailVerification(String verificationCode, String email)
```
- **åŠŸèƒ½**: Emailé©—è­‰ç¢¼ç¢ºèªèˆ‡å¸³è™Ÿæ¿€æ´»
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `verifyEmailCode()` - é©—è­‰Emailä»£ç¢¼
  - **EmailService** `resendVerificationCode()` - é‡ç™¼é©—è­‰ä»£ç¢¼
  - **AccountService** `activateAccount()` - æ¿€æ´»å¸³è™Ÿ
- **å›å‚³å€¼**: `EmailVerificationResult{verified: boolean, accountActivated: boolean, canResend: boolean}`

```dart
/**
 * 12. è¨­å®šä½¿ç”¨è€…å€‹äººè³‡æ–™
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è¨­å®šæ–°ä½¿ç”¨è€…çš„å€‹äººè³‡æ–™å’Œåå¥½è¨­å®š
 */
Future<ProfileSetupResult> AUTH_setupUserProfile(UserProfileData profileData, UserPreferences preferences)
```
- **åŠŸèƒ½**: æ–°ä½¿ç”¨è€…å€‹äººè³‡æ–™è¨­å®šèˆ‡åå¥½é…ç½®
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **ProfileService** `createUserProfile()` - å»ºç«‹ä½¿ç”¨è€…å€‹äººè³‡æ–™
  - **PreferencesService** `setUserPreferences()` - è¨­å®šä½¿ç”¨è€…åå¥½
  - **OnboardingService** `completeOnboarding()` - å®Œæˆå°å…¥æµç¨‹
- **å›å‚³å€¼**: `ProfileSetupResult{success: boolean, profileId: String?, onboardingComplete: boolean}`

### 3.4 å¯†ç¢¼é‡è¨­å±¤å‡½æ•¸

```dart
/**
 * 13. åˆå§‹åŒ–å¯†ç¢¼é‡è¨­æµç¨‹
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description åˆå§‹åŒ–å¯†ç¢¼é‡è¨­æµç¨‹ï¼Œç™¼é€é‡è¨­éƒµä»¶
 */
Future<PasswordResetInitResult> AUTH_initPasswordReset(String email)
```
- **åŠŸèƒ½**: å¯†ç¢¼é‡è¨­æµç¨‹åˆå§‹åŒ–èˆ‡å®‰å…¨æª¢æŸ¥
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `initiatePasswordReset()` - å•Ÿå‹•å¯†ç¢¼é‡è¨­
  - **SecurityService** `checkResetRateLimit()` - æª¢æŸ¥é‡è¨­é »ç‡é™åˆ¶
  - **EmailService** `sendResetEmail()` - ç™¼é€é‡è¨­éƒµä»¶
- **å›å‚³å€¼**: `PasswordResetInitResult{initiated: boolean, resetToken: String?, canRetryAt: DateTime?}`

```dart
/**
 * 14. ç™¼é€é‡è¨­é©—è­‰ç¢¼
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description ç™¼é€å¯†ç¢¼é‡è¨­çš„é©—è­‰ç¢¼
 */
Future<CodeSendResult> AUTH_sendResetCode(String email, String resetToken)
```
- **åŠŸèƒ½**: å®‰å…¨é©—è­‰ç¢¼ç”Ÿæˆèˆ‡ç™¼é€
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecurityService** `generateSecureCode()` - ç”Ÿæˆå®‰å…¨é©—è­‰ç¢¼
  - **EmailService** `sendResetCode()` - ç™¼é€é©—è­‰ç¢¼
  - **RateLimitService** `checkSendLimit()` - æª¢æŸ¥ç™¼é€é™åˆ¶
- **å›å‚³å€¼**: `CodeSendResult{sent: boolean, expiresAt: DateTime?, attemptsRemaining: int}`

```dart
/**
 * 15. é©—è­‰é‡è¨­é©—è­‰ç¢¼
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description é©—è­‰å¯†ç¢¼é‡è¨­çš„é©—è­‰ç¢¼
 */
Future<CodeVerificationResult> AUTH_verifyResetCode(String code, String resetToken)
```
- **åŠŸèƒ½**: é©—è­‰ç¢¼ç¢ºèªèˆ‡é‡è¨­ä»¤ç‰Œé©—è­‰
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecurityService** `verifyResetCode()` - é©—è­‰é‡è¨­ä»£ç¢¼
  - **AuthService** `validateResetToken()` - é©—è­‰é‡è¨­ä»¤ç‰Œ
  - **TimingService** `checkCodeExpiry()` - æª¢æŸ¥ä»£ç¢¼æœ‰æ•ˆæœŸ
- **å›å‚³å€¼**: `CodeVerificationResult{verified: boolean, resetAllowed: boolean, expiresAt: DateTime?}`

```dart
/**
 * 16. æ›´æ–°å¯†ç¢¼
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description åŸ·è¡Œå¯†ç¢¼æ›´æ–°ä¸¦æ’¤éŠ·ç¾æœ‰æœƒè©±
 */
Future<PasswordUpdateResult> AUTH_updatePassword(String newPassword, String confirmPassword, String resetToken)
```
- **åŠŸèƒ½**: å®‰å…¨å¯†ç¢¼æ›´æ–°èˆ‡æœƒè©±æ’¤éŠ·
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecurityService** `validateNewPassword()` - é©—è­‰æ–°å¯†ç¢¼
  - **AuthService** `updateUserPassword()` - æ›´æ–°ä½¿ç”¨è€…å¯†ç¢¼
  - **SessionService** `revokeAllSessions()` - æ’¤éŠ·æ‰€æœ‰æœƒè©±
- **å›å‚³å€¼**: `PasswordUpdateResult{updated: boolean, sessionsRevoked: int, requiresRelogin: boolean}`

### 3.5 ç™»å‡ºç®¡ç†å±¤å‡½æ•¸

```dart
/**
 * 17. çµ±ä¸€ç™»å‡ºè™•ç†
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description çµ±ä¸€çš„ç™»å‡ºæµç¨‹è™•ç†ï¼ŒåŒ…å«æ¸…ç†å’Œå°èˆª
 */
Future<LogoutResult> AUTH_handleLogout(LogoutType logoutType, bool clearLocalData)
```
- **åŠŸèƒ½**: ç™»å‡ºé¡å‹è™•ç†èˆ‡è³‡æ–™æ¸…ç†é¸é …
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **AuthService** `logout()` - åŸ·è¡Œç™»å‡º
  - **SessionService** `clearSession()` - æ¸…ç†æœƒè©±
  - **NavigationService** `navigateToWelcome()` - å°èˆªè‡³æ­¡è¿é é¢
- **å›å‚³å€¼**: `LogoutResult{success: boolean, dataCleared: boolean, redirectUrl: String}`

```dart
/**
 * 18. é¡¯ç¤ºç™»å‡ºé¸é …
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description é¡¯ç¤ºç™»å‡ºç¢ºèªå°è©±æ¡†èˆ‡é¸é …
 */
Future<LogoutOption?> AUTH_showLogoutOptions(BuildContext context, UserMode userMode)
```
- **åŠŸèƒ½**: å››æ¨¡å¼å·®ç•°åŒ–çš„ç™»å‡ºé¸é …å°è©±æ¡†
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **DialogService** `showLogoutDialog()` - é¡¯ç¤ºç™»å‡ºå°è©±æ¡†
  - **ThemeService** `getModeTheme()` - å–å¾—æ¨¡å¼ä¸»é¡Œ
  - **LocalizationService** `getLocalizedText()` - å–å¾—æœ¬åœ°åŒ–æ–‡å­—
- **å›å‚³å€¼**: `LogoutOption?{type: LogoutType, clearData: boolean, confirmed: boolean}`

```dart
/**
 * 19. æ¸…ç†ä½¿ç”¨è€…è³‡æ–™
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description æ ¹æ“šç™»å‡ºé¡å‹æ¸…ç†ç›¸æ‡‰çš„ä½¿ç”¨è€…è³‡æ–™
 */
Future<DataCleanupResult> AUTH_clearUserData(LogoutType logoutType, List<DataType> dataTypesToClear)
```
- **åŠŸèƒ½**: æ¢ä»¶å¼è³‡æ–™æ¸…ç†èˆ‡å®‰å…¨åˆ é™¤
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecureStorage** `clearStoredData()` - æ¸…ç†å®‰å…¨å­˜å„²
  - **CacheService** `clearCache()` - æ¸…ç†å¿«å–è³‡æ–™
  - **DatabaseService** `clearLocalDatabase()` - æ¸…ç†æœ¬åœ°è³‡æ–™åº«
- **å›å‚³å€¼**: `DataCleanupResult{clearedTypes: List<DataType>, errors: Map<DataType, String>}`

### 3.6 ç‹€æ…‹ç®¡ç†å±¤å‡½æ•¸

```dart
/**
 * 20. æ›´æ–°èªè­‰ç‹€æ…‹
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description æ›´æ–°æ‡‰ç”¨ç¨‹å¼çš„èªè­‰ç‹€æ…‹ä¸¦é€šçŸ¥ç›£è½è€…
 */
void AUTH_updateAuthState(AuthState newState, UserProfile? userProfile)
```
- **åŠŸèƒ½**: Providerç‹€æ…‹æ›´æ–°èˆ‡UIé€šçŸ¥æ©Ÿåˆ¶
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **StateManager** `updateState()` - æ›´æ–°ç‹€æ…‹ç®¡ç†
  - **NotificationService** `notifyStateChange()` - é€šçŸ¥ç‹€æ…‹è®Šæ›´
  - **AnalyticsService** `trackStateChange()` - è¿½è¹¤ç‹€æ…‹è®Šæ›´
- **å›å‚³å€¼**: `void`

```dart
/**
 * 21. æŒä¹…åŒ–èªè­‰ç‹€æ…‹
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å°‡èªè­‰ç‹€æ…‹å®‰å…¨åœ°æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å„²
 */
Future<bool> AUTH_persistAuthState(AuthState state, AuthTokens tokens)
```
- **åŠŸèƒ½**: èªè­‰ç‹€æ…‹èˆ‡ä»¤ç‰Œçš„å®‰å…¨æŒä¹…åŒ–å­˜å„²
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecureStorage** `storeAuthState()` - å­˜å„²èªè­‰ç‹€æ…‹
  - **EncryptionService** `encryptTokens()` - åŠ å¯†ä»¤ç‰Œè³‡æ–™
  - **BackupService** `backupAuthState()` - å‚™ä»½èªè­‰ç‹€æ…‹
- **å›å‚³å€¼**: `bool - æŒä¹…åŒ–æ˜¯å¦æˆåŠŸ`

```dart
/**
 * 22. æ¢å¾©èªè­‰ç‹€æ…‹
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å¾æœ¬åœ°å­˜å„²æ¢å¾©èªè­‰ç‹€æ…‹
 */
Future<AuthStateRestoreResult> AUTH_restoreAuthState()
```
- **åŠŸèƒ½**: æ‡‰ç”¨ç¨‹å¼å•Ÿå‹•æ™‚çš„èªè­‰ç‹€æ…‹æ¢å¾©
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **SecureStorage** `getStoredAuthState()` - å–å¾—å­˜å„²çš„èªè­‰ç‹€æ…‹
  - **DecryptionService** `decryptTokens()` - è§£å¯†ä»¤ç‰Œè³‡æ–™
  - **ValidationService** `validateRestoredState()` - é©—è­‰æ¢å¾©çš„ç‹€æ…‹
- **å›å‚³å€¼**: `AuthStateRestoreResult{restored: boolean, authState: AuthState?, tokens: AuthTokens?}`

```dart
/**
 * 23. è™•ç†ç‹€æ…‹è½‰æ›
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description è™•ç†èªè­‰ç‹€æ…‹é–“çš„è½‰æ›èˆ‡é é¢å°èˆª
 */
Future<NavigationResult> AUTH_handleStateTransition(AuthState fromState, AuthState toState, BuildContext context)
```
- **åŠŸèƒ½**: ç‹€æ…‹è½‰æ›é‚è¼¯èˆ‡é é¢å°èˆªç®¡ç†
- **èˆ‡å…¶ä»–æœå‹™äº’å‹•**:
  - **NavigationService** `navigateToRoute()` - å°èˆªè‡³å°æ‡‰è·¯ç”±
  - **TransitionService** `animateTransition()` - åŸ·è¡Œè½‰æ›å‹•ç•«
  - **GuardService** `checkTransitionPermission()` - æª¢æŸ¥è½‰æ›æ¬Šé™
- **å›å‚³å€¼**: `NavigationResult{navigated: boolean, targetRoute: String, animationComplete: boolean}`

### 3.7 å››æ¨¡å¼UIå±¤å‡½æ•¸

```dart
/**
 * 24. å»ºæ§‹ç²¾æº–æ§åˆ¶è€…æ¨¡å¼UI
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å»ºæ§‹é©åˆç²¾æº–æ§åˆ¶è€…çš„é€²éšèªè­‰ä»‹é¢
 */
Widget AUTH_buildControllerModeUI(BuildContext context, AuthPageType pageType, AuthState state)
```
- **åŠŸèƒ½**: ç²¾æº–æ§åˆ¶è€…æ¨¡å¼çš„å°ˆæ¥­ç´šèªè­‰ä»‹é¢å»ºæ§‹
- **ç‰¹è‰²**: å®Œæ•´åŠŸèƒ½å±•ç¤ºã€è©³ç´°å®‰å…¨è¨­å®šã€é€²éšé¸é …
- **å›å‚³å€¼**: `Widget - ç²¾æº–æ§åˆ¶è€…å°ˆç”¨èªè­‰ä»‹é¢`

```dart
/**
 * 25. å»ºæ§‹ç´€éŒ„ç¿’æ…£è€…æ¨¡å¼UI
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å»ºæ§‹é©åˆç´€éŒ„ç¿’æ…£è€…çš„å„ªé›…èªè­‰ä»‹é¢
 */
Widget AUTH_buildLoggerModeUI(BuildContext context, AuthPageType pageType, AuthState state)
```
- **åŠŸèƒ½**: ç´€éŒ„ç¿’æ…£è€…æ¨¡å¼çš„å„ªé›…ç¾è§€èªè­‰ä»‹é¢å»ºæ§‹
- **ç‰¹è‰²**: æµæš¢å‹•ç•«ã€ç¾è§€è¨­è¨ˆã€è¦–è¦ºå¹³è¡¡
- **å›å‚³å€¼**: `Widget - ç´€éŒ„ç¿’æ…£è€…å°ˆç”¨èªè­‰ä»‹é¢`

```dart
/**
 * 26. å»ºæ§‹è½‰å‹æŒ‘æˆ°è€…æ¨¡å¼UI
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å»ºæ§‹é©åˆè½‰å‹æŒ‘æˆ°è€…çš„æ¿€å‹µèªè­‰ä»‹é¢
 */
Widget AUTH_buildStruggleModeUI(BuildContext context, AuthPageType pageType, AuthState state)
```
- **åŠŸèƒ½**: è½‰å‹æŒ‘æˆ°è€…æ¨¡å¼çš„æ¿€å‹µæ€§èªè­‰ä»‹é¢å»ºæ§‹
- **ç‰¹è‰²**: ç›®æ¨™å°å‘ã€æ¿€å‹µå…ƒç´ ã€æŒ‘æˆ°æç¤º
- **å›å‚³å€¼**: `Widget - è½‰å‹æŒ‘æˆ°è€…å°ˆç”¨èªè­‰ä»‹é¢`

```dart
/**
 * 27. å»ºæ§‹æ½›åœ¨è¦ºé†’è€…æ¨¡å¼UI
 * @version 2025-01-20-V2.1.0
 * @date 2025-01-20 14:00:00
 * @description å»ºæ§‹é©åˆæ½›åœ¨è¦ºé†’è€…çš„ç°¡ç´„èªè­‰ä»‹é¢
 */
Widget AUTH_buildSleeperModeUI(BuildContext context, AuthPageType pageType, AuthState state)
```
- **åŠŸèƒ½**: æ½›åœ¨è¦ºé†’è€…æ¨¡å¼çš„æ¥µç°¡èªè­‰ä»‹é¢å»ºæ§‹
- **ç‰¹è‰²**: å¤§æŒ‰éˆ•è¨­è¨ˆã€ç°¡åŒ–é¸é …ã€æ¸…æ¥šæŒ‡å¼•
- **å›å‚³å€¼**: `Widget - æ½›åœ¨è¦ºé†’è€…å°ˆç”¨èªè­‰ä»‹é¢`

---

## 4.0 å››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆ

### 4.1 ç²¾æº–æ§åˆ¶è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ

#### 4.1.1 UIç‰¹è‰²å¯¦ä½œ
```dart
class ControllerModeTheme {
  static final ThemeData theme = ThemeData(
    primaryColor: Color(0xFF1976D2), // å°ˆæ¥­æ·±è—
    accentColor: Color(0xFF37474F), // æ·±ç°è¼”åŠ©
    cardTheme: CardTheme(
      elevation: 4.0,
      shape: RoundedRectangleBorder(
        borderRadius: BorderRadius.circular(8.0),
        side: BorderSide(color: Color(0xFF1976D2), width: 1.0),
      ),
    ),
  );
  
  static Widget buildAdvancedSecurityOptions() {
    return ExpansionTile(
      title: Text('ğŸ¯ é€²éšå®‰å…¨è¨­å®š'),
      children: [
        SwitchListTile(
          title: Text('å•Ÿç”¨å…©æ­¥é©—è­‰'),
          value: true,
          onChanged: (value) => {},
        ),
        ListTile(
          title: Text('ä¿¡ä»»çš„è£ç½®ç®¡ç†'),
          trailing: Icon(Icons.arrow_forward),
          onTap: () => {},
        ),
        ListTile(
          title: Text('ç™»å…¥æ´»å‹•è¨˜éŒ„'),
          trailing: Icon(Icons.history),
          onTap: () => {},
        ),
      ],
    );
  }
}
```

#### 4.1.2 åŠŸèƒ½è±å¯Œæ€§å¯¦ä½œ
```dart
class ControllerModeAuthPage extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ğŸ¯ ç²¾æº–æ§åˆ¶è€… - é€²éšç™»å…¥'),
        actions: [
          IconButton(
            icon: Icon(Icons.security),
            onPressed: () => showSecuritySettings(),
          ),
          IconButton(
            icon: Icon(Icons.settings),
            onPressed: () => showAdvancedSettings(),
          ),
        ],
      ),
      body: Column(
        children: [
          // å®Œæ•´çš„ç™»å…¥é¸é …
          LoginOptionsGrid(),
          // é€²éšå®‰å…¨è¨­å®š
          ControllerModeTheme.buildAdvancedSecurityOptions(),
          // è©³ç´°çš„ç‹€æ…‹é¡¯ç¤º
          AuthStatusDetailCard(),
          // æŠ€è¡“è³‡è¨Šé¡¯ç¤º
          TechnicalInfoExpansion(),
        ],
      ),
    );
  }
}
```

### 4.2 ç´€éŒ„ç¿’æ…£è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ

#### 4.2.1 å„ªé›…å‹•ç•«å¯¦ä½œ
```dart
class LoggerModeAnimations {
  static final AnimationController fadeController = AnimationController(
    duration: Duration(milliseconds: 800),
    vsync: this,
  );
  
  static final Animation<double> fadeAnimation = Tween<double>(
    begin: 0.0,
    end: 1.0,
  ).animate(CurvedAnimation(
    parent: fadeController,
    curve: Curves.easeInOutCubic,
  ));
  
  static Widget buildAnimatedLoginCard() {
    return AnimatedBuilder(
      animation: fadeAnimation,
      builder: (context, child) {
        return Transform.scale(
          scale: fadeAnimation.value,
          child: Opacity(
            opacity: fadeAnimation.value,
            child: Card(
              elevation: 8.0,
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(16.0),
              ),
              child: Container(
                decoration: BoxDecoration(
                  gradient: LinearGradient(
                    colors: [Color(0xFF6A1B9A), Color(0xFFE1BEE7)],
                    begin: Alignment.topLeft,
                    end: Alignment.bottomRight,
                  ),
                  borderRadius: BorderRadius.circular(16.0),
                ),
                child: LoginForm(),
              ),
            ),
          ),
        );
      },
    );
  }
}
```

#### 4.2.2 è¦–è¦ºç¾æ„Ÿå¯¦ä½œ
```dart
class LoggerModeTheme {
  static final ThemeData theme = ThemeData(
    primaryColor: Color(0xFF6A1B9A), // å„ªé›…ç´«è‰²
    accentColor: Color(0xFFE1BEE7), // æ·ºç´«è¼”åŠ©
    inputDecorationTheme: InputDecorationTheme(
      border: OutlineInputBorder(
        borderRadius: BorderRadius.circular(12.0),
        borderSide: BorderSide(color: Color(0xFF6A1B9A)),
      ),
      filled: true,
      fillColor: Color(0xFFF3E5F5),
    ),
    elevatedButtonTheme: ElevatedButtonThemeData(
      style: ElevatedButton.styleFrom(
        primary: LinearGradient(
          colors: [Color(0xFF6A1B9A), Color(0xFFE1BEE7)],
        ),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(12.0),
        ),
        elevation: 4.0,
      ),
    ),
  );
}
```

### 4.3 è½‰å‹æŒ‘æˆ°è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ

#### 4.3.1 æ¿€å‹µå…ƒç´ å¯¦ä½œ
```dart
class StruggleModeMotivation {
  static Widget buildMotivationalHeader() {
    return Container(
      padding: EdgeInsets.all(16.0),
      decoration: BoxDecoration(
        color: Color(0xFFFFF3E0),
        borderRadius: BorderRadius.circular(8.0),
        border: Border.all(color: Color(0xFFFF6B35), width: 2.0),
      ),
      child: Column(
        children: [
          Text(
            'ğŸ’ª å …æŒå°±æ˜¯å‹åˆ©ï¼',
            style: TextStyle(
              fontSize: 18.0,
              fontWeight: FontWeight.bold,
              color: Color(0xFFE65100),
            ),
          ),
          SizedBox(height: 8.0),
          Text(
            'æ¯ä¸€æ¬¡ç™»å…¥éƒ½æ˜¯æœè‘—è²¡å‹™ç›®æ¨™å‰é€²çš„ä¸€æ­¥',
            style: TextStyle(
              fontSize: 14.0,
              color: Color(0xFFE65100),
            ),
          ),
        ],
      ),
    );
  }
  
  static Widget buildProgressIndicator(double progress) {
    return Column(
      children: [
        Text('ç›®æ¨™é”æˆé€²åº¦'),
        LinearProgressIndicator(
          value: progress,
          backgroundColor: Color(0xFFFFE0B2),
          valueColor: AlwaysStoppedAnimation<Color>(Color(0xFFFF6B35)),
        ),
        Text('${(progress * 100).toInt()}% å®Œæˆ'),
      ],
    );
  }
}
```

#### 4.3.2 ç›®æ¨™å°å‘è¨­è¨ˆå¯¦ä½œ
```dart
class StruggleModeAuthPage extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('ğŸ’ª è½‰å‹æŒ‘æˆ°è€… - é‚å‘ç›®æ¨™'),
        backgroundColor: Color(0xFFFF6B35),
      ),
      body: SingleChildScrollView(
        padding: EdgeInsets.all(16.0),
        child: Column(
          children: [
            // æ¿€å‹µè¨Šæ¯
            StruggleModeMotivation.buildMotivationalHeader(),
            SizedBox(height: 16.0),
            // ç›®æ¨™é€²åº¦
            StruggleModeMotivation.buildProgressIndicator(0.65),
            SizedBox(height: 16.0),
            // ç™»å…¥è¡¨å–®
            LoginFormWithEncouragement(),
            SizedBox(height: 16.0),
            // æˆå°±å¾½ç« 
            AchievementBadges(),
          ],
        ),
      ),
    );
  }
}
```

### 4.4 æ½›åœ¨è¦ºé†’è€…æ¨¡å¼æŠ€è¡“å¯¦ä½œ

#### 4.4.1 æ¥µç°¡ä»‹é¢å¯¦ä½œ
```dart
class SleeperModeTheme {
  static final ThemeData theme = ThemeData(
    primaryColor: Color(0xFF4CAF50), // æº«å’Œç¶ è‰²
    accentColor: Color(0xFFC8E6C9), // æ·ºç¶ è¼”åŠ©
    textTheme: TextTheme(
      headline1: TextStyle(fontSize: 24.0, fontWeight: FontWeight.w600),
      bodyText1: TextStyle(fontSize: 18.0, fontWeight: FontWeight.normal),
    ),
    elevatedButtonTheme: ElevatedButtonThemeData(
      style: ElevatedButton.styleFrom(
        primary: Color(0xFF4CAF50),
        minimumSize: Size(double.infinity, 56.0), // è¶…å¤§æŒ‰éˆ•
        textStyle: TextStyle(fontSize: 18.0),
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(8.0),
        ),
      ),
    ),
  );
}
```

#### 4.4.2 ç°¡åŒ–æ“ä½œå¯¦ä½œ
```dart
class SleeperModeAuthPage extends StatefulWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      body: SafeArea(
        child: Padding(
          padding: EdgeInsets.all(32.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            crossAxisAlignment: CrossAxisAlignment.stretch,
            children: [
              // å“ç‰Œæ¨™èªŒ
              Image.asset('assets/logo.png', height: 120),
              SizedBox(height: 32.0),
              // ç°¡å–®æ¨™é¡Œ
              Text(
                'ğŸŒ± æ­¡è¿ä½¿ç”¨ LCAS',
                textAlign: TextAlign.center,
                style: Theme.of(context).textTheme.headline1,
              ),
              SizedBox(height: 48.0),
              // è¶…å¤§ç™»å…¥æŒ‰éˆ•
              ElevatedButton.icon(
                onPressed: () => AUTH_handleLineLogin(),
                icon: Icon(Icons.login, size: 24.0),
                label: Text('ä½¿ç”¨ LINE ç™»å…¥'),
              ),
              SizedBox(height: 16.0),
              // è¨»å†ŠæŒ‰éˆ•
              OutlinedButton.icon(
                onPressed: () => navigateToRegister(),
                icon: Icon(Icons.person_add, size: 24.0),
                label: Text('å»ºç«‹æ–°å¸³è™Ÿ'),
                style: OutlinedButton.styleFrom(
                  minimumSize: Size(double.infinity, 56.0),
                  textStyle: TextStyle(fontSize: 18.0),
                ),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

---

## 5.0 Widgetæ¶æ§‹è¨­è¨ˆ

### 5.1 é é¢Widgetçµæ§‹
```dart
// èªè­‰é é¢åŸºç¤çµæ§‹
abstract class BaseAuthPage extends StatefulWidget {
  final UserMode userMode;
  final AuthPageType pageType;
  
  const BaseAuthPage({
    Key? key,
    required this.userMode,
    required this.pageType,
  }) : super(key: key);
}

// å„é é¢å…·é«”å¯¦ä½œ
class WelcomePage extends BaseAuthPage { /* P001 å¯¦ä½œ */ }
class LoginPage extends BaseAuthPage { /* P002 å¯¦ä½œ */ }
class RegisterPage extends BaseAuthPage { /* P003 å¯¦ä½œ */ }
class PasswordResetPage extends BaseAuthPage { /* P004 å¯¦ä½œ */ }
class LogoutConfirmPage extends BaseAuthPage { /* P005 å¯¦ä½œ */ }
```

### 5.2 å…±ç”¨Widgetå…ƒä»¶
```dart
// æ¨¡å¼é¸æ“‡å™¨
class ModeSelector extends StatelessWidget {
  final Function(UserMode) onModeSelected;
  final UserMode? currentMode;
  
  @override
  Widget build(BuildContext context) {
    return GridView.count(
      crossAxisCount: 2,
      children: UserMode.values.map((mode) => 
        ModeCard(
          mode: mode,
          isSelected: mode == currentMode,
          onTap: () => onModeSelected(mode),
        ),
      ).toList(),
    );
  }
}

// èªè­‰è¡¨å–®
class AuthForm extends StatefulWidget {
  final AuthFormType formType;
  final UserMode userMode;
  final Function(AuthFormData) onSubmit;
  
  @override
  _AuthFormState createState() => _AuthFormState();
}
```

### 5.3 ç‹€æ…‹ç®¡ç†Widget
```dart
// èªè­‰ç‹€æ…‹Provider
class AuthStateProvider extends ChangeNotifier {
  AuthState _currentState = AuthState.initial;
  UserProfile? _userProfile;
  AuthTokens? _tokens;
  
  AuthState get currentState => _currentState;
  UserProfile? get userProfile => _userProfile;
  bool get isAuthenticated => _currentState == AuthState.authenticated;
  
  Future<void> updateAuthState(AuthState newState) async {
    _currentState = newState;
    await AUTH_persistAuthState(newState, _tokens);
    notifyListeners();
  }
}

// Consumer Widgetä½¿ç”¨ç¯„ä¾‹
class AuthConsumerWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Consumer<AuthStateProvider>(
      builder: (context, authProvider, child) {
        switch (authProvider.currentState) {
          case AuthState.authenticated:
            return DashboardPage();
          case AuthState.unauthenticated:
            return LoginPage();
          default:
            return LoadingPage();
        }
      },
    );
  }
}
```

---

## 6.0 APIæ•´åˆè¨­è¨ˆ

### 6.1 èªè­‰APIæ•´åˆ
```dart
// APIæœå‹™åŸºç¤é¡åˆ¥
class AuthAPIService {
  static const String baseUrl = 'https://api.lcas.app';
  final Dio dio = Dio();
  
  AuthAPIService() {
    dio.interceptors.add(RetryInterceptor(
      dio: dio,
      logPrint: print,
      retries: 3,
      retryDelays: [
        Duration(seconds: 1),
        Duration(seconds: 2),
        Duration(seconds: 3),
      ],
    ));
  }
  
  // F001 - ä½¿ç”¨è€…è¨»å†ŠAPI
  Future<RegistrationResponse> register(RegistrationRequest request) async {
    try {
      final response = await dio.post(
        '$baseUrl/auth/register',
        data: request.toJson(),
      );
      return RegistrationResponse.fromJson(response.data);
    } on DioError catch (e) {
      throw AuthException.fromDioError(e);
    }
  }
  
  // F002 - ä½¿ç”¨è€…ç™»å…¥API
  Future<LoginResponse> login(LoginRequest request) async {
    try {
      final response = await dio.post(
        '$baseUrl/auth/login',
        data: request.toJson(),
      );
      return LoginResponse.fromJson(response.data);
    } on DioError catch (e) {
      throw AuthException.fromDioError(e);
    }
  }
}
```

### 6.2 OAuthæ•´åˆå¯¦ä½œ
```dart
// LINE OAuthæ•´åˆ
class LineOAuthIntegration {
  static Future<LineOAuthResult> performLogin() async {
    try {
      final lineLogin = LineSDK.instance;
      final result = await lineLogin.login(
        scopes: ['profile', 'openid', 'email'],
      );
      
      if (result.isSuccess) {
        // èˆ‡å¾Œç«¯äº¤æ›ä»¤ç‰Œ
        final authResponse = await AuthAPIService().exchangeLineToken(
          accessToken: result.accessToken,
          idToken: result.idToken,
        );
        
        return LineOAuthResult(
          success: true,
          tokens: authResponse.tokens,
          userProfile: authResponse.userProfile,
        );
      }
      
      throw AuthException('LINEç™»å…¥å¤±æ•—');
    } catch (e) {
      throw AuthException('LINE OAuthéŒ¯èª¤: $e');
    }
  }
}

// Google OAuthæ•´åˆ
class GoogleOAuthIntegration {
  static Future<GoogleOAuthResult> performLogin() async {
    try {
      final googleSignIn = GoogleSignIn(
        scopes: ['email', 'profile'],
      );
      
      final account = await googleSignIn.signIn();
      if (account == null) throw AuthException('Googleç™»å…¥å–æ¶ˆ');
      
      final authentication = await account.authentication;
      
      // èˆ‡å¾Œç«¯äº¤æ›ä»¤ç‰Œ
      final authResponse = await AuthAPIService().exchangeGoogleToken(
        idToken: authentication.idToken,
        accessToken: authentication.accessToken,
      );
      
      return GoogleOAuthResult(
        success: true,
        tokens: authResponse.tokens,
        userProfile: authResponse.userProfile,
      );
    } catch (e) {
      throw AuthException('Google OAuthéŒ¯èª¤: $e');
    }
  }
}
```

### 6.3 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶
```dart
// çµ±ä¸€éŒ¯èª¤è™•ç†
class AuthErrorHandler {
  static String getErrorMessage(AuthException error, UserMode userMode) {
    switch (userMode) {
      case UserMode.controller:
        return _getDetailedErrorMessage(error);
      case UserMode.logger:
        return _getElegantErrorMessage(error);
      case UserMode.struggler:
        return _getMotivationalErrorMessage(error);
      case UserMode.sleeper:
        return _getSimpleErrorMessage(error);
      default:
        return error.message;
    }
  }
  
  static String _getDetailedErrorMessage(AuthException error) {
    return 'éŒ¯èª¤ä»£ç¢¼: ${error.code}\nè©³ç´°è¨Šæ¯: ${error.message}\nå»ºè­°æ“ä½œ: ${error.suggestion}';
  }
  
  static String _getElegantErrorMessage(AuthException error) {
    return 'âœ¨ æŠ±æ­‰ï¼Œ${error.friendlyMessage}ï¼Œè«‹ç¨å¾Œå†è©¦';
  }
  
  static String _getMotivationalErrorMessage(AuthException error) {
    return 'ğŸ’ª é‡åˆ°å°æŒ«æŠ˜ï¼${error.message}ï¼Œè®“æˆ‘å€‘å†è©¦ä¸€æ¬¡ï¼';
  }
  
  static String _getSimpleErrorMessage(AuthException error) {
    return 'ğŸŒ± ${error.simpleMessage}';
  }
}
```

---

## 7.0 ç‹€æ…‹ç®¡ç†æ¶æ§‹

### 7.1 Providerç‹€æ…‹ç®¡ç†
```dart
// ä¸»è¦èªè­‰ç‹€æ…‹ç®¡ç†
class AuthProvider extends ChangeNotifier {
  AuthState _state = AuthState.initial;
  UserProfile? _userProfile;
  AuthTokens? _tokens;
  UserMode? _selectedMode;
  
  // Getters
  AuthState get state => _state;
  UserProfile? get userProfile => _userProfile;
  AuthTokens? get tokens => _tokens;
  UserMode? get selectedMode => _selectedMode;
  bool get isAuthenticated => _state == AuthState.authenticated;
  
  // ç‹€æ…‹æ›´æ–°æ–¹æ³•
  Future<void> updateState(AuthState newState) async {
    _state = newState;
    await AUTH_persistAuthState(newState, _tokens);
    notifyListeners();
  }
  
  Future<void> setUserProfile(UserProfile profile) async {
    _userProfile = profile;
    await AUTH_persistUserProfile(profile);
    notifyListeners();
  }
  
  Future<void> setTokens(AuthTokens tokens) async {
    _tokens = tokens;
    await AUTH_persistTokens(tokens);
    notifyListeners();
  }
  
  Future<void> setMode(UserMode mode) async {
    _selectedMode = mode;
    await AUTH_persistUserMode(mode);
    notifyListeners();
  }
}
```

### 7.2 é é¢é–“å°èˆªç®¡ç†
```dart
// å°èˆªç‹€æ…‹ç®¡ç†
class NavigationProvider extends ChangeNotifier {
  String _currentRoute = '/welcome';
  Map<String, dynamic> _routeArguments = {};
  
  String get currentRoute => _currentRoute;
  Map<String, dynamic> get routeArguments => _routeArguments;
  
  Future<void> navigateToRoute(String route, {Map<String, dynamic>? arguments}) async {
    _currentRoute = route;
    _routeArguments = arguments ?? {};
    
    // è¨˜éŒ„å°èˆªäº‹ä»¶
    await AnalyticsService.trackNavigation(route, arguments);
    notifyListeners();
  }
}

// è·¯ç”±é…ç½®
class AuthRoutes {
  static const String welcome = '/welcome';
  static const String login = '/login';
  static const String register = '/register';
  static const String passwordReset = '/password-reset';
  static const String logoutConfirm = '/logout-confirm';
  static const String dashboard = '/dashboard';
  
  static Map<String, WidgetBuilder> getRoutes() {
    return {
      welcome: (context) => WelcomePage(),
      login: (context) => LoginPage(),
      register: (context) => RegisterPage(),
      passwordReset: (context) => PasswordResetPage(),
      logoutConfirm: (context) => LogoutConfirmPage(),
      dashboard: (context) => DashboardPage(),
    };
  }
}
```

### 7.3 èªè­‰ç‹€æ…‹æŒä¹…åŒ–
```dart
// æŒä¹…åŒ–ç®¡ç†æœå‹™
class AuthPersistenceService {
  static const FlutterSecureStorage _secureStorage = FlutterSecureStorage(
    aOptions: AndroidOptions(
      encryptedSharedPreferences: true,
    ),
    iOptions: IOSOptions(
      accessibility: IOSAccessibility.first_unlock_this_device,
    ),
  );
  
  // æŒä¹…åŒ–èªè­‰ç‹€æ…‹
  static Future<bool> persistAuthState(AuthState state, AuthTokens? tokens) async {
    try {
      await _secureStorage.write(key: 'auth_state', value: state.toString());
      
      if (tokens != null) {
        await _secureStorage.write(key: 'access_token', value: tokens.accessToken);
        await _secureStorage.write(key: 'refresh_token', value: tokens.refreshToken);
        await _secureStorage.write(key: 'token_expiry', value: tokens.expiresAt.toIso8601String());
      }
      
      return true;
    } catch (e) {
      print('æŒä¹…åŒ–èªè­‰ç‹€æ…‹å¤±æ•—: $e');
      return false;
    }
  }
  
  // æ¢å¾©èªè­‰ç‹€æ…‹
  static Future<AuthStateRestoreResult> restoreAuthState() async {
    try {
      final stateString = await _secureStorage.read(key: 'auth_state');
      if (stateString == null) {
        return AuthStateRestoreResult(restored: false);
      }
      
      final state = AuthState.values.firstWhere(
        (e) => e.toString() == stateString,
        orElse: () => AuthState.initial,
      );
      
      AuthTokens? tokens;
      final accessToken = await _secureStorage.read(key: 'access_token');
      final refreshToken = await _secureStorage.read(key: 'refresh_token');
      final expiryString = await _secureStorage.read(key: 'token_expiry');
      
      if (accessToken != null && refreshToken != null && expiryString != null) {
        tokens = AuthTokens(
          accessToken: accessToken,
          refreshToken: refreshToken,
          expiresAt: DateTime.parse(expiryString),
        );
      }
      
      return AuthStateRestoreResult(
        restored: true,
        authState: state,
        tokens: tokens,
      );
    } catch (e) {
      print('æ¢å¾©èªè­‰ç‹€æ…‹å¤±æ•—: $e');
      return AuthStateRestoreResult(restored: false);
    }
  }
}
```

---

## 8.0 å®‰å…¨æ©Ÿåˆ¶å¯¦ä½œ

### 8.1 æœ¬åœ°å®‰å…¨å­˜å„²
```dart
// å®‰å…¨å­˜å„²æœå‹™
class SecureStorageService {
  static const _storage = FlutterSecureStorage(
    aOptions: AndroidOptions(
      encryptedSharedPreferences: true,
      keyCipherAlgorithm: KeyCipherAlgorithm.RSA_ECB_PKCS1Padding,
      storageCipherAlgorithm: StorageCipherAlgorithm.AES_GCM_NoPadding,
    ),
    iOptions: IOSOptions(
      accessibility: IOSAccessibility.first_unlock_this_device,
      accountName: 'LCAS_AUTH',
    ),
  );
  
  // å®‰å…¨å­˜å„²æ•æ„Ÿè³‡æ–™
  static Future<bool> storeSecurely(String key, String value) async {
    try {
      // é¡å¤–åŠ å¯†å±¤
      final encryptedValue = await CryptographyService.encrypt(value);
      await _storage.write(key: key, value: encryptedValue);
      return true;
    } catch (e) {
      print('å®‰å…¨å­˜å„²å¤±æ•—: $e');
      return false;
    }
  }
  
  // å®‰å…¨è®€å–æ•æ„Ÿè³‡æ–™
  static Future<String?> readSecurely(String key) async {
    try {
      final encryptedValue = await _storage.read(key: key);
      if (encryptedValue == null) return null;
      
      // è§£å¯†
      return await CryptographyService.decrypt(encryptedValue);
    } catch (e) {
      print('å®‰å…¨è®€å–å¤±æ•—: $e');
      return null;
    }
  }
}
```

### 8.2 ç”Ÿç‰©è¾¨è­˜æ•´åˆ
```dart
// ç”Ÿç‰©è¾¨è­˜æœå‹™
class BiometricAuthService {
  static final LocalAuthentication _localAuth = LocalAuthentication();
  
  // æª¢æŸ¥ç”Ÿç‰©è¾¨è­˜å¯ç”¨æ€§
  static Future<BiometricAvailability> checkAvailability() async {
    try {
      final isAvailable = await _localAuth.canCheckBiometrics;
      final availableBiometrics = await _localAuth.getAvailableBiometrics();
      
      return BiometricAvailability(
        isAvailable: isAvailable,
        types: availableBiometrics,
        hasFingerprint: availableBiometrics.contains(BiometricType.fingerprint),
        hasFaceId: availableBiometrics.contains(BiometricType.face),
      );
    } catch (e) {
      return BiometricAvailability(isAvailable: false, types: []);
    }
  }
  
  // åŸ·è¡Œç”Ÿç‰©è¾¨è­˜èªè­‰
  static Future<BiometricAuthResult> authenticate() async {
    try {
      final isAuthenticated = await _localAuth.authenticate(
        localizedReason: 'è«‹ä½¿ç”¨ç”Ÿç‰©è¾¨è­˜é©—è­‰æ‚¨çš„èº«ä»½',
        options: AuthenticationOptions(
          biometricOnly: true,
          stickyAuth: true,
        ),
      );
      
      return BiometricAuthResult(
        success: isAuthenticated,
        errorMessage: isAuthenticated ? null : 'ç”Ÿç‰©è¾¨è­˜é©—è­‰å¤±æ•—',
      );
    } on PlatformException catch (e) {
      return BiometricAuthResult(
        success: false,
        errorMessage: e.message ?? 'ç”Ÿç‰©è¾¨è­˜éŒ¯èª¤',
      );
    }
  }
}
```

### 8.3 ä»¤ç‰Œå®‰å…¨ç®¡ç†
```dart
// ä»¤ç‰Œå®‰å…¨ç®¡ç†æœå‹™
class TokenSecurityService {
  static const Duration _accessTokenDuration = Duration(minutes: 15);
  static const Duration _refreshTokenDuration = Duration(days: 7);
  
  // ä»¤ç‰Œåˆ·æ–°æª¢æŸ¥
  static Future<bool> shouldRefreshToken(AuthTokens tokens) async {
    final now = DateTime.now();
    final timeUntilExpiry = tokens.expiresAt.difference(now);
    
    // å¦‚æœä»¤ç‰Œåœ¨5åˆ†é˜å…§éæœŸï¼Œå‰‡éœ€è¦åˆ·æ–°
    return timeUntilExpiry.inMinutes <= 5;
  }
  
  // è‡ªå‹•ä»¤ç‰Œåˆ·æ–°
  static Future<AuthTokens?> refreshTokenIfNeeded(AuthTokens currentTokens) async {
    if (await shouldRefreshToken(currentTokens)) {
      try {
        final refreshResponse = await AuthAPIService().refreshToken(
          currentTokens.refreshToken,
        );
        
        final newTokens = AuthTokens(
          accessToken: refreshResponse.accessToken,
          refreshToken: refreshResponse.refreshToken,
          expiresAt: DateTime.now().add(_accessTokenDuration),
        );
        
        await SecureStorageService.storeSecurely('auth_tokens', newTokens.toJson());
        return newTokens;
      } catch (e) {
        print('ä»¤ç‰Œåˆ·æ–°å¤±æ•—: $e');
        return null;
      }
    }
    
    return currentTokens;
  }
  
  // ä»¤ç‰Œæ’¤éŠ·
  static Future<bool> revokeTokens(AuthTokens tokens) async {
    try {
      await AuthAPIService().revokeToken(tokens.refreshToken);
      await SecureStorageService.deleteSecurely('auth_tokens');
      return true;
    } catch (e) {
      print('ä»¤ç‰Œæ’¤éŠ·å¤±æ•—: $e');
      return false;
    }
  }
}
```

---

## 9.0 ç„¡éšœç¤™æ”¯æ´å¯¦ä½œ

### 9.1 èªæ„åŒ–Widgetè¨­è¨ˆ
```dart
// ç„¡éšœç¤™èªè­‰è¼¸å…¥æ¡†
class AccessibleAuthInput extends StatelessWidget {
  final String label;
  final String hint;
  final TextEditingController controller;
  final bool isPassword;
  final String? errorMessage;
  
  const AccessibleAuthInput({
    Key? key,
    required this.label,
    required this.hint,
    required this.controller,
    this.isPassword = false,
    this.errorMessage,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return Semantics(
      label: label,
      hint: hint,
      textField: true,
      obscured: isPassword,
      child: TextFormField(
        controller: controller,
        obscureText: isPassword,
        decoration: InputDecoration(
          labelText: label,
          hintText: hint,
          errorText: errorMessage,
          semanticCounterText: '', // é¿å…è‡ªå‹•èªéŸ³æœ—è®€è¨ˆæ•¸
        ),
        // ç„¡éšœç¤™å±¬æ€§
        enableInteractiveSelection: true,
        autocorrect: !isPassword,
        enableSuggestions: !isPassword,
        textInputAction: TextInputAction.next,
      ),
    );
  }
}

// ç„¡éšœç¤™èªè­‰æŒ‰éˆ•
class AccessibleAuthButton extends StatelessWidget {
  final String label;
  final VoidCallback onPressed;
  final bool isLoading;
  final bool isEnabled;
  
  const AccessibleAuthButton({
    Key? key,
    required this.label,
    required this.onPressed,
    this.isLoading = false,
    this.isEnabled = true,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return Semantics(
      label: label,
      hint: isLoading ? 'è™•ç†ä¸­ï¼Œè«‹ç¨å€™' : 'é»æ“Š$label',
      button: true,
      enabled: isEnabled && !isLoading,
      child: ElevatedButton(
        onPressed: isEnabled && !isLoading ? onPressed : null,
        child: isLoading
            ? SizedBox(
                width: 20,
                height: 20,
                child: CircularProgressIndicator(strokeWidth: 2),
              )
            : Text(label),
      ),
    );
  }
}
```

### 9.2 è¢å¹•é–±è®€å™¨æœ€ä½³åŒ–
```dart
// è¢å¹•é–±è®€å™¨å…¬å‘Šæœå‹™
class ScreenReaderService {
  // å…¬å‘Šèªè­‰ç‹€æ…‹è®Šæ›´
  static void announceAuthStateChange(AuthState oldState, AuthState newState) {
    String announcement = _getStateChangeAnnouncement(oldState, newState);
    SemanticsService.announce(announcement, TextDirection.ltr);
  }
  
  static String _getStateChangeAnnouncement(AuthState oldState, AuthState newState) {
    switch (newState) {
      case AuthState.authenticating:
        return 'æ­£åœ¨ç™»å…¥ï¼Œè«‹ç¨å€™';
      case AuthState.authenticated:
        return 'ç™»å…¥æˆåŠŸï¼Œæ­¡è¿å›ä¾†';
      case AuthState.authenticationFailed:
        return 'ç™»å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ‚¨çš„æ†‘è­‰';
      case AuthState.registering:
        return 'æ­£åœ¨è¨»å†Šï¼Œè«‹ç¨å€™';
      case AuthState.registrationComplete:
        return 'è¨»å†ŠæˆåŠŸï¼Œè«‹æŸ¥çœ‹æ‚¨çš„é›»å­éƒµä»¶é€²è¡Œé©—è­‰';
      case AuthState.loggedOut:
        return 'å·²å®‰å…¨ç™»å‡º';
      default:
        return 'ç‹€æ…‹å·²æ›´æ–°';
    }
  }
  
  // å…¬å‘ŠéŒ¯èª¤è¨Šæ¯
  static void announceError(String errorMessage) {
    SemanticsService.announce('éŒ¯èª¤ï¼š$errorMessage', TextDirection.ltr);
  }
  
  // å…¬å‘ŠæˆåŠŸè¨Šæ¯
  static void announceSuccess(String successMessage) {
    SemanticsService.announce('æˆåŠŸï¼š$successMessage', TextDirection.ltr);
  }
}
```

### 9.3 éµç›¤å°èˆªæ”¯æ´
```dart
// éµç›¤å°èˆªç®¡ç†å™¨
class KeyboardNavigationManager {
  static List<FocusNode> _focusNodes = [];
  
  // è¨­å®šç„¦é»é †åº
  static void setupFocusOrder(List<Widget> widgets) {
    _focusNodes = widgets.map((widget) => FocusNode()).toList();
    
    for (int i = 0; i < _focusNodes.length; i++) {
      _focusNodes[i].addListener(() {
        if (_focusNodes[i].hasFocus) {
          _announceCurrentFocus(i);
        }
      });
    }
  }
  
  static void _announceCurrentFocus(int index) {
    String announcement = 'ç„¦é»ä½æ–¼ç¬¬ ${index + 1} å€‹å…ƒç´ ';
    SemanticsService.announce(announcement, TextDirection.ltr);
  }
  
  // éµç›¤å¿«æ·éµæ”¯æ´
  static Map<LogicalKeySet, Intent> getAuthKeyboardShortcuts() {
    return {
      LogicalKeySet(LogicalKeyboardKey.enter): const SubmitFormIntent(),
      LogicalKeySet(LogicalKeyboardKey.escape): const CancelActionIntent(),
      LogicalKeySet(LogicalKeyboardKey.tab): const NextFieldIntent(),
      LogicalKeySet(LogicalKeyboardKey.shift, LogicalKeyboardKey.tab): 
          const PreviousFieldIntent(),
      LogicalKeySet(LogicalKeyboardKey.f1): const HelpIntent(),
    };
  }
}
```

---

## 10.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 10.1 Widgetæœ€ä½³åŒ–ç­–ç•¥
```dart
// è¨˜æ†¶åŒ–Widgetå»ºæ§‹
class MemoizedAuthWidget extends StatelessWidget {
  final UserMode userMode;
  final AuthState authState;
  
  const MemoizedAuthWidget({
    Key? key,
    required this.userMode,
    required this.authState,
  }) : super(key: key);
  
  @override
  Widget build(BuildContext context) {
    return _MemoizedBuilder(
      userMode: userMode,
      authState: authState,
      builder: (context, mode, state) {
        switch (mode) {
          case UserMode.controller:
            return AUTH_buildControllerModeUI(context, AuthPageType.login, state);
          case UserMode.logger:
            return AUTH_buildLoggerModeUI(context, AuthPageType.login, state);
          case UserMode.struggler:
            return AUTH_buildStruggleModeUI(context, AuthPageType.login, state);
          case UserMode.sleeper:
            return AUTH_buildSleeperModeUI(context, AuthPageType.login, state);
        }
      },
    );
  }
}

// å¿«å–Widgetå»ºæ§‹å™¨
class _MemoizedBuilder extends StatelessWidget {
  static final Map<String, Widget> _cache = <String, Widget>{};
  
  final UserMode userMode;
  final AuthState authState;
  final Widget Function(BuildContext, UserMode, AuthState) builder;
  
  const _MemoizedBuilder({
    required this.userMode,
    required this.authState,
    required this.builder,
  });
  
  @override
  Widget build(BuildContext context) {
    final key = '${userMode.toString()}_${authState.toString()}';
    
    if (!_cache.containsKey(key)) {
      _cache[key] = builder(context, userMode, authState);
    }
    
    return _cache[key]!;
  }
}
```

### 10.2 è¨˜æ†¶é«”ç®¡ç†
```dart
// è¨˜æ†¶é«”ç®¡ç†æœå‹™
class MemoryManagementService {
  static Timer? _cleanupTimer;
  
  // å•Ÿå‹•å®šæœŸæ¸…ç†
  static void startPeriodicCleanup() {
    _cleanupTimer = Timer.periodic(Duration(minutes: 5), (timer) {
      _performMemoryCleanup();
    });
  }
  
  // åœæ­¢å®šæœŸæ¸…ç†
  static void stopPeriodicCleanup() {
    _cleanupTimer?.cancel();
    _cleanupTimer = null;
  }
  
  // åŸ·è¡Œè¨˜æ†¶é«”æ¸…ç†
  static void _performMemoryCleanup() {
    // æ¸…ç†éæœŸçš„èªè­‰ç‹€æ…‹å¿«å–
    _cleanupAuthStateCache();
    
    // æ¸…ç†éæœŸçš„UIå¿«å–
    _cleanupUICache();
    
    // æ¸…ç†æœªä½¿ç”¨çš„åœ–ç‰‡å¿«å–
    PaintingBinding.instance.imageCache.clear();
    
    // å¼·åˆ¶åƒåœ¾å›æ”¶ï¼ˆåƒ…åœ¨å¿…è¦æ™‚ï¼‰
    if (_shouldForceGarbageCollection()) {
      // Dartæœƒè‡ªå‹•è™•ç†åƒåœ¾å›æ”¶ï¼Œæ­¤è™•åƒ…ç‚ºç¤ºæ„
      print('å»ºè­°ç³»çµ±é€²è¡Œåƒåœ¾å›æ”¶');
    }
  }
  
  static void _cleanupAuthStateCache() {
    // å¯¦ä½œèªè­‰ç‹€æ…‹å¿«å–æ¸…ç†é‚è¼¯
  }
  
  static void _cleanupUICache() {
    // å¯¦ä½œUIå¿«å–æ¸…ç†é‚è¼¯
  }
  
  static bool _shouldForceGarbageCollection() {
    // æ ¹æ“šè¨˜æ†¶é«”ä½¿ç”¨é‡æ±ºå®šæ˜¯å¦éœ€è¦åƒåœ¾å›æ”¶
    return false; // ç°¡åŒ–å¯¦ä½œ
  }
}
```

### 10.3 ç¶²è·¯è«‹æ±‚æœ€ä½³åŒ–
```dart
// ç¶²è·¯è«‹æ±‚æœ€ä½³åŒ–æœå‹™
class NetworkOptimizationService {
  static final Map<String, CancelToken> _activeCancelTokens = {};
  static final Map<String, CachedResponse> _responseCache = {};
  
  // æœ€ä½³åŒ–çš„APIè«‹æ±‚
  static Future<T> optimizedRequest<T>({
    required String endpoint,
    required String method,
    Map<String, dynamic>? data,
    Duration cacheDuration = const Duration(minutes: 5),
    bool cancelPrevious = true,
  }) async {
    final requestKey = '$method:$endpoint';
    
    // æª¢æŸ¥å¿«å–
    if (_responseCache.containsKey(requestKey)) {
      final cached = _responseCache[requestKey]!;
      if (cached.isValid) {
        return cached.data as T;
      } else {
        _responseCache.remove(requestKey);
      }
    }
    
    // å–æ¶ˆä¹‹å‰çš„è«‹æ±‚ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if (cancelPrevious && _activeCancelTokens.containsKey(requestKey)) {
      _activeCancelTokens[requestKey]!.cancel('æ–°è«‹æ±‚å–æ¶ˆèˆŠè«‹æ±‚');
    }
    
    // å»ºç«‹æ–°çš„å–æ¶ˆä»¤ç‰Œ
    final cancelToken = CancelToken();
    _activeCancelTokens[requestKey] = cancelToken;
    
    try {
      final dio = Dio();
      final response = await dio.request(
        endpoint,
        data: data,
        cancelToken: cancelToken,
        options: Options(method: method),
      );
      
      // å¿«å–å›æ‡‰
      _responseCache[requestKey] = CachedResponse(
        data: response.data,
        cachedAt: DateTime.now(),
        duration: cacheDuration,
      );
      
      return response.data as T;
    } finally {
      _activeCancelTokens.remove(requestKey);
    }
  }
  
  // æ‰¹æ¬¡è«‹æ±‚æœ€ä½³åŒ–
  static Future<List<T>> batchRequests<T>(List<Future<T>> requests) async {
    // é™åˆ¶åŒæ™‚é€²è¡Œçš„è«‹æ±‚æ•¸é‡
    const maxConcurrent = 3;
    final results = <T>[];
    
    for (int i = 0; i < requests.length; i += maxConcurrent) {
      final batch = requests.skip(i).take(maxConcurrent);
      final batchResults = await Future.wait(batch);
      results.addAll(batchResults);
      
      // åœ¨æ‰¹æ¬¡é–“åŠ å…¥å°å»¶é²ï¼Œé¿å…ä¼ºæœå™¨éè¼‰
      if (i + maxConcurrent < requests.length) {
        await Future.delayed(Duration(milliseconds: 100));
      }
    }
    
    return results;
  }
}

// å¿«å–å›æ‡‰é¡åˆ¥
class CachedResponse {
  final dynamic data;
  final DateTime cachedAt;
  final Duration duration;
  
  CachedResponse({
    required this.data,
    required this.cachedAt,
    required this.duration,
  });
  
  bool get isValid => DateTime.now().difference(cachedAt) < duration;
}
```

---

## 11.0 æ¸¬è©¦ç­–ç•¥

### 11.1 Widgetæ¸¬è©¦è¦†è“‹
```dart
// èªè­‰Widgetæ¸¬è©¦
class AuthWidgetTests {
  
  // æ¸¬è©¦æ­¡è¿é é¢Widget
  static void testWelcomePage() {
    group('WelcomePage Widget Tests', () {
      testWidgets('æ‡‰è©²é¡¯ç¤ºå“ç‰Œæ¨™èªŒå’Œæ¨¡å¼é¸æ“‡', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(home: WelcomePage()));
        
        // é©—è­‰å“ç‰Œæ¨™èªŒå­˜åœ¨
        expect(find.byKey(Key('brand_logo')), findsOneWidget);
        
        // é©—è­‰å››å€‹æ¨¡å¼é¸æ“‡æŒ‰éˆ•
        expect(find.byKey(Key('mode_controller')), findsOneWidget);
        expect(find.byKey(Key('mode_logger')), findsOneWidget);
        expect(find.byKey(Key('mode_struggler')), findsOneWidget);
        expect(find.byKey(Key('mode_sleeper')), findsOneWidget);
      });
      
      testWidgets('æ¨¡å¼é¸æ“‡æ‡‰è©²è§¸ç™¼æ­£ç¢ºçš„å›èª¿', (WidgetTester tester) async {
        UserMode? selectedMode;
        
        await tester.pumpWidget(MaterialApp(
          home: WelcomePage(
            onModeSelected: (mode) => selectedMode = mode,
          ),
        ));
        
        // é»æ“Šç²¾æº–æ§åˆ¶è€…æ¨¡å¼
        await tester.tap(find.byKey(Key('mode_controller')));
        await tester.pump();
        
        expect(selectedMode, equals(UserMode.controller));
      });
    });
  }
  
  // æ¸¬è©¦ç™»å…¥é é¢Widget
  static void testLoginPage() {
    group('LoginPage Widget Tests', () {
      testWidgets('æ‡‰è©²é¡¯ç¤ºæ‰€æœ‰ç™»å…¥é¸é …', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(
          home: LoginPage(userMode: UserMode.controller),
        ));
        
        // é©—è­‰ç™»å…¥é¸é …
        expect(find.byKey(Key('line_login_button')), findsOneWidget);
        expect(find.byKey(Key('google_login_button')), findsOneWidget);
        expect(find.byKey(Key('apple_login_button')), findsOneWidget);
        expect(find.byKey(Key('email_login_form')), findsOneWidget);
      });
      
      testWidgets('Emailç™»å…¥è¡¨å–®é©—è­‰', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(
          home: LoginPage(userMode: UserMode.sleeper),
        ));
        
        // è¼¸å…¥ç„¡æ•ˆEmail
        await tester.enterText(find.byKey(Key('email_input')), 'invalid_email');
        await tester.enterText(find.byKey(Key('password_input')), 'password');
        await tester.tap(find.byKey(Key('login_button')));
        await tester.pump();
        
        // æ‡‰è©²é¡¯ç¤ºEmailæ ¼å¼éŒ¯èª¤
        expect(find.text('è«‹è¼¸å…¥æ­£ç¢ºçš„Emailæ ¼å¼'), findsOneWidget);
      });
    });
  }
}
```

### 11.2 æ•´åˆæ¸¬è©¦å ´æ™¯
```dart
// èªè­‰æµç¨‹æ•´åˆæ¸¬è©¦
class AuthIntegrationTests {
  
  // å®Œæ•´è¨»å†Šæµç¨‹æ¸¬è©¦
  static void testCompleteRegistrationFlow() {
    group('å®Œæ•´è¨»å†Šæµç¨‹æ•´åˆæ¸¬è©¦', () {
      testWidgets('ä½¿ç”¨è€…æ‡‰è©²èƒ½å®Œæˆå®Œæ•´è¨»å†Šæµç¨‹', (WidgetTester tester) async {
        // æ¨¡æ“¬APIå›æ‡‰
        MockAuthAPIService.setupMockResponses();
        
        await tester.pumpWidget(MaterialApp(
          initialRoute: '/welcome',
          routes: AuthRoutes.getRoutes(),
        ));
        
        // 1. æ­¡è¿é é¢ - é¸æ“‡æ¨¡å¼
        await tester.tap(find.byKey(Key('mode_logger')));
        await tester.pump();
        
        // 2. é»æ“Šè¨»å†ŠæŒ‰éˆ•
        await tester.tap(find.byKey(Key('register_button')));
        await tester.pumpAndSettle();
        
        // 3. å¡«å¯«è¨»å†Šè¡¨å–®
        await tester.enterText(find.byKey(Key('email_input')), 'test@example.com');
        await tester.enterText(find.byKey(Key('password_input')), 'password123');
        await tester.enterText(find.byKey(Key('confirm_password_input')), 'password123');
        await tester.enterText(find.byKey(Key('display_name_input')), 'æ¸¬è©¦ä½¿ç”¨è€…');
        
        // 4. åŒæ„æ¢æ¬¾
        await tester.tap(find.byKey(Key('terms_checkbox')));
        await tester.tap(find.byKey(Key('privacy_checkbox')));
        
        // 5. æäº¤è¨»å†Š
        await tester.tap(find.byKey(Key('register_submit_button')));
        await tester.pumpAndSettle();
        
        // 6. é©—è­‰å°å‘Emailé©—è­‰é é¢
        expect(find.byKey(Key('email_verification_page')), findsOneWidget);
        expect(find.text('è«‹æª¢æŸ¥æ‚¨çš„éƒµä»¶'), findsOneWidget);
      });
    });
  }
  
  // å¤šæ¨¡å¼ç™»å…¥æ¸¬è©¦
  static void testMultiModeLoginExperience() {
    group('å¤šæ¨¡å¼ç™»å…¥é«”é©—æ¸¬è©¦', () {
      for (final mode in UserMode.values) {
        testWidgets('${mode.toString()} æ¨¡å¼ç™»å…¥é«”é©—', (WidgetTester tester) async {
          await tester.pumpWidget(MaterialApp(
            home: LoginPage(userMode: mode),
          ));
          
          // é©—è­‰æ¨¡å¼ç‰¹å®šçš„UIå…ƒç´ 
          switch (mode) {
            case UserMode.controller:
              expect(find.byKey(Key('advanced_options')), findsOneWidget);
              break;
            case UserMode.logger:
              expect(find.byKey(Key('elegant_animation')), findsOneWidget);
              break;
            case UserMode.struggler:
              expect(find.byKey(Key('motivation_message')), findsOneWidget);
              break;
            case UserMode.sleeper:
              expect(find.byKey(Key('large_buttons')), findsOneWidget);
              break;
          }
        });
      }
    });
  }
}
```

### 11.3 ä½¿ç”¨è€…é«”é©—æ¸¬è©¦
```dart
// ä½¿ç”¨è€…é«”é©—æ¸¬è©¦
class AuthUXTests {
  
  // ç„¡éšœç¤™æ¸¬è©¦
  static void testAccessibilityFeatures() {
    group('ç„¡éšœç¤™åŠŸèƒ½æ¸¬è©¦', () {
      testWidgets('æ‰€æœ‰æŒ‰éˆ•éƒ½æœ‰é©ç•¶çš„èªæ„æ¨™ç±¤', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(home: LoginPage()));
        
        final loginButton = find.byKey(Key('login_button'));
        final semantics = tester.widget<Semantics>(
          find.ancestor(of: loginButton, matching: find.byType(Semantics)).first,
        );
        
        expect(semantics.properties.label, isNotNull);
        expect(semantics.properties.hint, isNotNull);
        expect(semantics.properties.button, isTrue);
      });
      
      testWidgets('è¼¸å…¥æ¡†æœ‰é©ç•¶çš„èªæ„æè¿°', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(home: LoginPage()));
        
        final emailInput = find.byKey(Key('email_input'));
        final semantics = tester.widget<Semantics>(
          find.ancestor(of: emailInput, matching: find.byType(Semantics)).first,
        );
        
        expect(semantics.properties.textField, isTrue);
        expect(semantics.properties.label, contains('Email'));
      });
    });
  }
  
  // æ•ˆèƒ½æ¸¬è©¦
  static void testPerformanceMetrics() {
    group('æ•ˆèƒ½æŒ‡æ¨™æ¸¬è©¦', () {
      testWidgets('é é¢è¼‰å…¥æ™‚é–“æ‡‰å°æ–¼2ç§’', (WidgetTester tester) async {
        final stopwatch = Stopwatch()..start();
        
        await tester.pumpWidget(MaterialApp(home: WelcomePage()));
        await tester.pumpAndSettle();
        
        stopwatch.stop();
        expect(stopwatch.elapsedMilliseconds, lessThan(2000));
      });
      
      testWidgets('æ¨¡å¼åˆ‡æ›æ‡‰æµæš¢ç„¡å¡é “', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(home: WelcomePage()));
        
        final stopwatch = Stopwatch()..start();
        
        await tester.tap(find.byKey(Key('mode_controller')));
        await tester.pumpAndSettle();
        
        stopwatch.stop();
        expect(stopwatch.elapsedMilliseconds, lessThan(300));
      });
    });
  }
  
  // éŒ¯èª¤è™•ç†æ¸¬è©¦
  static void testErrorHandling() {
    group('éŒ¯èª¤è™•ç†æ¸¬è©¦', () {
      testWidgets('ç¶²è·¯éŒ¯èª¤æ‡‰æœ‰é©ç•¶çš„ä½¿ç”¨è€…å›é¥‹', (WidgetTester tester) async {
        // æ¨¡æ“¬ç¶²è·¯éŒ¯èª¤
        MockNetworkService.simulateNetworkError();
        
        await tester.pumpWidget(MaterialApp(home: LoginPage()));
        
        await tester.enterText(find.byKey(Key('email_input')), 'test@example.com');
        await tester.enterText(find.byKey(Key('password_input')), 'password');
        await tester.tap(find.byKey(Key('login_button')));
        await tester.pumpAndSettle();
        
        // æ‡‰è©²é¡¯ç¤ºç¶²è·¯éŒ¯èª¤è¨Šæ¯
        expect(find.textContaining('ç¶²è·¯é€£ç·š'), findsOneWidget);
        expect(find.byKey(Key('retry_button')), findsOneWidget);
      });
      
      testWidgets('è¡¨å–®é©—è­‰éŒ¯èª¤æ‡‰å³æ™‚é¡¯ç¤º', (WidgetTester tester) async {
        await tester.pumpWidget(MaterialApp(home: RegisterPage()));
        
        // è¼¸å…¥å¼±å¯†ç¢¼
        await tester.enterText(find.byKey(Key('password_input')), '123');
        await tester.tap(find.byKey(Key('email_input'))); // è§¸ç™¼é©—è­‰
        await tester.pump();
        
        expect(find.textContaining('å¯†ç¢¼è‡³å°‘éœ€8ä½'), findsOneWidget);
      });
    });
  }
}
```

---

## 12.0 æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| **v2.1.0** | **2025-01-20 14:00:00 +08:00** | **LCAS SA Team** | **ğŸ‰ é‡å¤§ç‰ˆæœ¬ï¼šèªè­‰åŠŸèƒ½ç¾¤çµ„Flutter TDDåˆç‰ˆå»ºç«‹** |
|  |  |  | **â€¢ å»ºç«‹å®Œæ•´çš„Flutter Presentation LayeræŠ€è¡“è¨­è¨ˆ** |
|  |  |  | **â€¢ å¯¦ä½œ27å€‹æ ¸å¿ƒèªè­‰å‡½æ•¸çš„è©³ç´°è¨­è¨ˆ** |
|  |  |  | **â€¢ å®Œæˆå››æ¨¡å¼å·®ç•°åŒ–UIæŠ€è¡“æ¶æ§‹** |
|  |  |  | **â€¢ æ•´åˆOAuthã€APIã€ç‹€æ…‹ç®¡ç†å®Œæ•´è§£æ±ºæ–¹æ¡ˆ** |
|  |  |  | **â€¢ å»ºç«‹ç„¡éšœç¤™æ”¯æ´èˆ‡æ•ˆèƒ½æœ€ä½³åŒ–æ©Ÿåˆ¶** |
|  |  |  | **â€¢ åˆ¶å®šå®Œæ•´çš„Widgetæ¸¬è©¦èˆ‡UXæ¸¬è©¦ç­–ç•¥** |
|  |  |  | **â€¢ å¯¦ç¾èˆ‡Backend API (F001-F005)çš„å®Œæ•´æ•´åˆ** |

### 12.1 æŠ€è¡“æ¶æ§‹é‡Œç¨‹ç¢‘

#### 12.1.1 v2.1.0 é‡å¤§æŠ€è¡“æˆæœ
```
ğŸ¯ å‡½æ•¸è¦†è“‹ï¼š27å€‹æ ¸å¿ƒå‡½æ•¸å®Œæ•´è¨­è¨ˆ
ğŸ“± FlutteræŠ€è¡“æ£§ï¼šProvider + Dio + SecureStorage + OAuth
ğŸ¨ å››æ¨¡å¼UIï¼šå·®ç•°åŒ–è¨­è¨ˆå®Œæ•´å¯¦ä½œ
ğŸ”’ å®‰å…¨æ©Ÿåˆ¶ï¼šç”Ÿç‰©è¾¨è­˜ + ä»¤ç‰Œç®¡ç† + å®‰å…¨å­˜å„²
â™¿ ç„¡éšœç¤™ï¼šWCAG 2.1 AAæ¨™æº–å®Œæ•´æ”¯æ´
ğŸŒ åœ‹éš›åŒ–ï¼šå¤šèªç³»æ”¯æ´æ¶æ§‹
ğŸ“Š æ•ˆèƒ½æœ€ä½³åŒ–ï¼šWidgetå¿«å– + è¨˜æ†¶é«”ç®¡ç†
ğŸ§ª æ¸¬è©¦è¦†è“‹ï¼šWidget + æ•´åˆ + UXæ¸¬è©¦ç­–ç•¥
```

#### 12.1.2 æ¶æ§‹è¨­è¨ˆç‰¹è‰²
- âœ… **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼š7å€‹åŠŸèƒ½å±¤ç´šæ¸…æ™°åˆ†é›¢
- âœ… **ç‹€æ…‹ç®¡ç†**ï¼šProvider + ChangeNotifieræ¨¡å¼
- âœ… **å®‰å…¨ç¬¬ä¸€**ï¼šå¤šå±¤å®‰å…¨é˜²è­·æ©Ÿåˆ¶
- âœ… **ä½¿ç”¨è€…é«”é©—**ï¼šå››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆ
- âœ… **ç„¡éšœç¤™å‹å–„**ï¼šå®Œæ•´çš„èªæ„åŒ–Widget

#### 12.1.3 æœªä¾†æŠ€è¡“ç™¼å±•è·¯ç·šåœ–
```
ğŸ“ˆ Phase 2 (v2.2.0)ï¼šæ•´åˆæ¨æ’­é€šçŸ¥èˆ‡æ·±åº¦é€£çµ
ğŸ“ˆ Phase 3 (v2.3.0)ï¼šåŠ å…¥Webæ”¯æ´èˆ‡PWAåŠŸèƒ½
ğŸ“ˆ Phase 4 (v2.4.0)ï¼šæ•´åˆAIæ™ºæ…§æ¨è–¦èˆ‡å€‹äººåŒ–
ğŸ“ˆ Phase 5 (v2.5.0)ï¼šåŠ å…¥ç¤¾äº¤ç™»å…¥èˆ‡åˆ†äº«åŠŸèƒ½
ğŸ“ˆ Phase 6 (v3.0.0)ï¼šå…¨é¢å‡ç´šè‡³Flutter 4.0+æ¶æ§‹
```

---

## å‚™è¨»

### ğŸ“Œ é‡è¦æé†’
- **æœ¬æ–‡ä»¶æ˜¯Flutter Presentation Layerçš„æŠ€è¡“è¨­è¨ˆè—åœ–**ï¼šç‚ºé–‹ç™¼åœ˜éšŠæä¾›è©³ç´°çš„å¯¦ä½œæŒ‡å¼•
- **å››æ¨¡å¼å·®ç•°åŒ–æ˜¯æ ¸å¿ƒåƒ¹å€¼**ï¼šæ¯å€‹Widgetéƒ½å¿…é ˆè€ƒæ…®å››ç¨®æ¨¡å¼çš„å·®ç•°åŒ–é«”é©—
- **å®‰å…¨æ€§æ˜¯æœ€é«˜å„ªå…ˆç´š**ï¼šæ‰€æœ‰èªè­‰ç›¸é—œåŠŸèƒ½éƒ½å¿…é ˆé€šéåš´æ ¼çš„å®‰å…¨æª¢æŸ¥
- **ç„¡éšœç¤™æ”¯æ´æ˜¯å¿…è¦æ¢ä»¶**ï¼šå¿…é ˆé”åˆ°WCAG 2.1 AAæ¨™æº–
- **æ•ˆèƒ½æœ€ä½³åŒ–æ˜¯å“è³ªä¿è­‰**ï¼šç¢ºä¿æµæš¢çš„ä½¿ç”¨è€…é«”é©—

### ğŸ¯ è¨­è¨ˆç›®æ¨™é”æˆåº¦
- âœ… **æŠ€è¡“æ¶æ§‹**ï¼šç¾ä»£åŒ–FlutteræŠ€è¡“æ£§å®Œæ•´è¨­è¨ˆ
- âœ… **ä½¿ç”¨è€…é«”é©—**ï¼šå››æ¨¡å¼å·®ç•°åŒ–é«”é©—å®Œæ•´å¯¦ä½œ
- âœ… **å®‰å…¨é˜²è­·**ï¼šå¤šå±¤å®‰å…¨æ©Ÿåˆ¶å®Œæ•´è¦åŠƒ
- âœ… **æ•ˆèƒ½æœ€ä½³åŒ–**ï¼šè¨˜æ†¶é«”ç®¡ç†èˆ‡ç¶²è·¯æœ€ä½³åŒ–
- âœ… **å¯ç¶­è­·æ€§**ï¼šæ¸…æ™°çš„å‡½æ•¸åˆ†å±¤èˆ‡æ¸¬è©¦ç­–ç•¥

### ğŸš€ å¯¦ä½œæŒ‡å¼•
1. **é–‹ç™¼é †åº**ï¼šæŒ‰ç…§å‡½æ•¸åˆ†å±¤é †åºé€æ­¥å¯¦ä½œ
2. **æ¸¬è©¦é©…å‹•**ï¼šæ¯å€‹å‡½æ•¸éƒ½éœ€è¦å°æ‡‰çš„æ¸¬è©¦æ¡ˆä¾‹
3. **æŒçºŒæ•´åˆ**ï¼šèˆ‡Backend APIä¿æŒåŒæ­¥æ•´åˆ
4. **ä½¿ç”¨è€…æ¸¬è©¦**ï¼šå®šæœŸé€²è¡Œå››æ¨¡å¼ä½¿ç”¨è€…é«”é©—æ¸¬è©¦
5. **æ•ˆèƒ½ç›£æ§**ï¼šå¯¦ä½œæ•ˆèƒ½ç›£æ§èˆ‡æœ€ä½³åŒ–æ©Ÿåˆ¶

---

**ğŸ‰ èªè­‰åŠŸèƒ½ç¾¤çµ„ Flutter TDD v2.1.0 - ç‚ºLCAS 2.0å»ºç«‹å®‰å…¨ã€é«˜æ•ˆã€ç„¡éšœç¤™çš„Flutterèªè­‰é«”é©—åŸºç¤ï¼**
