

# 8801. TDD_P001_æ­¡è¿é é¢_v2.1.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: P001 æ­¡è¿é é¢æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v2.1.0
- **å‰µå»ºæ—¥æœŸ**: 2025-08-06 12:00:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-08-06 14:30:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: 8701. æ­¡è¿é é¢_SRS.md
- **å°æ‡‰PRDæ–‡ä»¶**: 9005. Flutter_Presentation layer.md
- **é é¢ä»£ç¢¼**: P001 (Welcome Page)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æŠ€è¡“æ¶æ§‹æ¦‚è¿°](#10-æŠ€è¡“æ¶æ§‹æ¦‚è¿°)
2. [Widgetæ¸…å–®](#20-widgetæ¸…å–®)
3. [æ ¸å¿ƒWidgetè¨­è¨ˆ](#30-æ ¸å¿ƒwidgetè¨­è¨ˆ)
4. [ç‹€æ…‹ç®¡ç†æ¶æ§‹](#40-ç‹€æ…‹ç®¡ç†æ¶æ§‹)
5. [APIæ•´åˆè¨­è¨ˆ](#50-apiæ•´åˆè¨­è¨ˆ)
6. [å°èˆªè·¯ç”±è¨­è¨ˆ](#60-å°èˆªè·¯ç”±è¨­è¨ˆ)
7. [éŸ¿æ‡‰å¼è¨­è¨ˆ](#70-éŸ¿æ‡‰å¼è¨­è¨ˆ)
8. [ç„¡éšœç¤™åŠŸèƒ½](#80-ç„¡éšœç¤™åŠŸèƒ½)
9. [æ•ˆèƒ½æœ€ä½³åŒ–](#90-æ•ˆèƒ½æœ€ä½³åŒ–)
10. [éŒ¯èª¤è™•ç†æ©Ÿåˆ¶](#100-éŒ¯èª¤è™•ç†æ©Ÿåˆ¶)

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
P001æ­¡è¿é é¢ä½œç‚ºLCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„å…¥å£é é¢ï¼Œè² è²¬ä½¿ç”¨è€…é¦–æ¬¡é«”é©—ã€æ¨¡å¼é¸æ“‡ã€å“ç‰Œå±•ç¤ºåŠå°èˆªè·¯ç”±åˆ†ç™¼ã€‚æœ¬é é¢æ¡ç”¨MVPåŸå‰‡è¨­è¨ˆï¼Œèšç„¦æ ¸å¿ƒåŠŸèƒ½å¯¦ç¾ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**: Flutter 3.x
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **è·¯ç”±ç®¡ç†**: GoRouter
- **HTTPå®¢æˆ¶ç«¯**: Dio
- **æœ¬åœ°å„²å­˜**: SharedPreferences
- **å‹•ç•«è™•ç†**: Flutterå…§å»ºAnimation API
- **ç„¡éšœç¤™æ”¯æ´**: Flutter Semantics API

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * P001_æ­¡è¿é é¢_2.1.0
 * @module P001æ­¡è¿é é¢
 * @description Flutter Presentation Layerå…¥å£é é¢ - å››æ¨¡å¼é¸æ“‡ã€å“ç‰Œå±•ç¤ºã€å°èˆªåˆ†ç™¼
 * @update 2025-08-06: å‡ç´šè‡³v2.1ç‰ˆæœ¬ï¼Œä¿®æ­£èˆ‡0015ã€9005ã€8701æ–‡ä»¶çš„é•èƒŒ
 */
```

---

## 2.0 Widgetæ¸…å–®

### 2.1 å®Œæ•´Widgetç´¢å¼•è¡¨

| # | Widgetåç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾çµ„ä»¶ |
|---|------------|------|----------|----------|----------|
| 01 | WelcomePage | V2.1.0 | é é¢å®¹å™¨å±¤ | ä¸»é é¢å®¹å™¨åŠç”Ÿå‘½é€±æœŸç®¡ç† | WelcomeProviderã€Router |
| 02 | WelcomeScaffold | V2.1.0 | ä½ˆå±€çµæ§‹å±¤ | åŸºç¤é é¢çµæ§‹èˆ‡èƒŒæ™¯è¨­å®š | GradientBackground |
| 03 | BrandSection | V2.1.0 | å“ç‰Œå±•ç¤ºå±¤ | Logoèˆ‡å“ç‰Œæ¨™é¡Œé¡¯ç¤º | BrandLogoã€BrandTitle |
| 04 | ModeSelectionSection | V2.1.0 | æ¨¡å¼é¸æ“‡å±¤ | å››æ¨¡å¼é¸æ“‡ä»‹é¢ | ModeGridã€ModeCard |
| 05 | NavigationSection | V2.1.0 | å°èˆªæ“ä½œå±¤ | é–‹å§‹ä½¿ç”¨æŒ‰éˆ•èˆ‡å°èˆªæ§åˆ¶ | ActionButtonã€LoadingIndicator |
| 06 | BrandLogo | V2.1.0 | è¦–è¦ºå…ƒä»¶å±¤ | æ‡‰ç”¨ç¨‹å¼å“ç‰ŒLogo | Imageã€AnimatedContainer |
| 07 | BrandTitle | V2.1.0 | è¦–è¦ºå…ƒä»¶å±¤ | å“ç‰Œæ¨™é¡Œèˆ‡å‰¯æ¨™é¡Œæ–‡å­— | Textã€AnimatedOpacity |
| 08 | ModeGrid | V2.1.0 | ä½ˆå±€å…ƒä»¶å±¤ | å››æ¨¡å¼å¡ç‰‡ç¶²æ ¼ä½ˆå±€ | GridViewã€ResponsiveWrapper |
| 09 | ModeCard | V2.1.0 | äº’å‹•å…ƒä»¶å±¤ | å–®ä¸€æ¨¡å¼é¸æ“‡å¡ç‰‡ | InkWellã€AnimatedScale |
| 10 | ActionButton | V2.1.0 | äº’å‹•å…ƒä»¶å±¤ | ä¸»è¦æ“ä½œæŒ‰éˆ•ï¼ˆé–‹å§‹ä½¿ç”¨ï¼‰ | ElevatedButtonã€AnimatedContainer |
| 11 | GradientBackground | V2.1.0 | è£é£¾å…ƒä»¶å±¤ | é é¢æ¼¸å±¤èƒŒæ™¯æ•ˆæœ | Containerã€LinearGradient |
| 12 | LoadingIndicator | V2.1.0 | ç‹€æ…‹å…ƒä»¶å±¤ | è¼‰å…¥ä¸­æŒ‡ç¤ºå™¨ | CircularProgressIndicator |
| 13 | ErrorDialog | V2.1.0 | éŒ¯èª¤è™•ç†å±¤ | éŒ¯èª¤è¨Šæ¯å°è©±æ¡† | AlertDialogã€TextButton |

### 2.2 Widgetåˆ†å±¤æ¶æ§‹

```
P001æ­¡è¿é é¢ (v2.1.0)
â”œâ”€â”€ é é¢å®¹å™¨å±¤ (1å€‹Widget)
â”‚   â””â”€â”€ WelcomePage() - ä¸»é é¢å®¹å™¨åŠç‹€æ…‹ç®¡ç†
â”œâ”€â”€ ä½ˆå±€çµæ§‹å±¤ (1å€‹Widget)
â”‚   â””â”€â”€ WelcomeScaffold() - åŸºç¤é é¢çµæ§‹
â”œâ”€â”€ åŠŸèƒ½å€å¡Šå±¤ (3å€‹Widget)
â”‚   â”œâ”€â”€ BrandSection() - å“ç‰Œå±•ç¤ºå€å¡Š
â”‚   â”œâ”€â”€ ModeSelectionSection() - æ¨¡å¼é¸æ“‡å€å¡Š
â”‚   â””â”€â”€ NavigationSection() - å°èˆªæ“ä½œå€å¡Š
â”œâ”€â”€ è¦–è¦ºå…ƒä»¶å±¤ (2å€‹Widget)
â”‚   â”œâ”€â”€ BrandLogo() - å“ç‰ŒLogo
â”‚   â””â”€â”€ BrandTitle() - å“ç‰Œæ¨™é¡Œæ–‡å­—
â”œâ”€â”€ ä½ˆå±€å…ƒä»¶å±¤ (1å€‹Widget)
â”‚   â””â”€â”€ ModeGrid() - æ¨¡å¼å¡ç‰‡ç¶²æ ¼
â”œâ”€â”€ äº’å‹•å…ƒä»¶å±¤ (2å€‹Widget)
â”‚   â”œâ”€â”€ ModeCard() - æ¨¡å¼é¸æ“‡å¡ç‰‡
â”‚   â””â”€â”€ ActionButton() - ä¸»è¦æ“ä½œæŒ‰éˆ•
â””â”€â”€ åŸºç¤å…ƒä»¶å±¤ (3å€‹Widget)
    â”œâ”€â”€ GradientBackground() - æ¼¸å±¤èƒŒæ™¯
    â”œâ”€â”€ LoadingIndicator() - è¼‰å…¥æŒ‡ç¤ºå™¨
    â””â”€â”€ ErrorDialog() - éŒ¯èª¤å°è©±æ¡†
```

---

## 3.0 æ ¸å¿ƒWidgetè¨­è¨ˆ

### 3.1 é é¢å®¹å™¨å±¤Widget

#### 3.1.1 WelcomePage Widget
```dart
/**
 * 01. ä¸»é é¢å®¹å™¨Widget
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description æ­¡è¿é é¢çš„ä¸»å®¹å™¨ï¼Œæ”¯æ´é¦–æ¬¡å•Ÿå‹•èˆ‡å†æ¬¡å•Ÿå‹•æµç¨‹
 */
class WelcomePage extends StatefulWidget {
  static const String routeName = '/welcome';
  
  const WelcomePage({Key? key}) : super(key: key);

  @override
  State<WelcomePage> createState() => _WelcomePageState();
}

class _WelcomePageState extends State<WelcomePage> 
    with SingleTickerProviderStateMixin {
  
  late AnimationController _animationController;
  late Animation<double> _fadeAnimation;
  
  @override
  void initState() {
    super.initState();
    _initializeAnimations();
    _initializePage();
  }
  
  void _initializeAnimations() {
    _animationController = AnimationController(
      duration: const Duration(milliseconds: 1500),
      vsync: this,
    );
    
    _fadeAnimation = Tween<double>(
      begin: 0.0,
      end: 1.0,
    ).animate(CurvedAnimation(
      parent: _animationController,
      curve: Curves.easeInOut,
    ));
    
    _animationController.forward();
  }
  
  Future<void> _initializePage() async {
    final provider = Provider.of<WelcomeProvider>(context, listen: false);
    await provider.initializePage();
  }
  
  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider(
      create: (_) => WelcomeProvider(),
      child: Consumer<WelcomeProvider>(
        builder: (context, provider, child) {
          return WelcomeScaffold(
            fadeAnimation: _fadeAnimation,
            provider: provider,
          );
        },
      ),
    );
  }
  
  @override
  void dispose() {
    _animationController.dispose();
    super.dispose();
  }
}
```

### 3.2 ä½ˆå±€çµæ§‹å±¤Widget

#### 3.2.1 WelcomeScaffold Widget
```dart
/**
 * 02. é é¢ä½ˆå±€çµæ§‹Widget
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description æä¾›æ­¡è¿é é¢çš„åŸºç¤ä½ˆå±€çµæ§‹ï¼Œéµå¾ª9005æ–‡ä»¶éŸ¿æ‡‰å¼è¨­è¨ˆè¦ç¯„
 */
class WelcomeScaffold extends StatelessWidget {
  final Animation<double> fadeAnimation;
  final WelcomeProvider provider;
  
  const WelcomeScaffold({
    Key? key,
    required this.fadeAnimation,
    required this.provider,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final responsive = ResponsiveHelper.of(context);
    
    return Scaffold(
      body: Stack(
        children: [
          // æ¼¸å±¤èƒŒæ™¯ - æ ¹æ“š9005è¦ç¯„
          GradientBackground(mode: provider.selectedMode),
          
          // ä¸»è¦å…§å®¹
          FadeTransition(
            opacity: fadeAnimation,
            child: SafeArea(
              child: Padding(
                padding: EdgeInsets.symmetric(
                  horizontal: responsive.horizontalPadding,
                  vertical: responsive.verticalPadding,
                ),
                child: Column(
                  children: [
                    // å“ç‰Œå±•ç¤ºå€å¡Š
                    Expanded(
                      flex: 2,
                      child: BrandSection(),
                    ),
                    
                    // æ¨¡å¼é¸æ“‡å€å¡Šï¼ˆä¾8701è¦ç¯„ï¼‰
                    if (provider.pageState == WelcomePageState.modeSelection)
                      Expanded(
                        flex: 3,
                        child: ModeSelectionSection(provider: provider),
                      ),
                    
                    // å°èˆªæ“ä½œå€å¡Š
                    Expanded(
                      flex: 1,
                      child: NavigationSection(provider: provider),
                    ),
                  ],
                ),
              ),
            ),
          ),
          
          // è¼‰å…¥è¦†è“‹å±¤
          if (provider.pageState == WelcomePageState.loading)
            Container(
              color: Colors.black54,
              child: const Center(
                child: LoadingIndicator(),
              ),
            ),
          
          // éŒ¯èª¤å°è©±æ¡†
          if (provider.pageState == WelcomePageState.error)
            _buildErrorOverlay(context, provider),
        ],
      ),
    );
  }
  
  Widget _buildErrorOverlay(BuildContext context, WelcomeProvider provider) {
    return Container(
      color: Colors.black54,
      child: Center(
        child: ErrorDialog(
          message: provider.errorMessage ?? 'æœªçŸ¥éŒ¯èª¤',
          onRetry: () => provider.clearError(),
          onDismiss: () => provider.clearError(),
        ),
      ),
    );
  }
}
```

### 3.3 åŠŸèƒ½å€å¡Šå±¤Widget

#### 3.3.1 ModeSelectionSection Widget
```dart
/**
 * 04. æ¨¡å¼é¸æ“‡å€å¡ŠWidget
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description å››æ¨¡å¼é¸æ“‡ä»‹é¢ï¼Œæ”¯æ´ç²¾æº–æ§åˆ¶è€…/ç´€éŒ„ç¿’æ…£è€…/è½‰å‹æŒ‘æˆ°è€…/æ½›åœ¨è¦ºé†’è€…
 */
class ModeSelectionSection extends StatelessWidget {
  final WelcomeProvider provider;
  
  const ModeSelectionSection({
    Key? key,
    required this.provider,
  }) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        // é¸æ“‡æç¤ºæ–‡å­—
        Semantics(
          header: true,
          child: Text(
            'é¸æ“‡é©åˆæ‚¨çš„ä½¿ç”¨æ¨¡å¼',
            style: TextStyle(
              fontSize: 18.sp,
              color: Colors.white,
              fontWeight: FontWeight.w500,
            ),
            textAlign: TextAlign.center,
          ),
        ),
        
        SizedBox(height: 24.h),
        
        // æ¨¡å¼é¸æ“‡ç¶²æ ¼
        Expanded(
          child: ModeGrid(
            selectedMode: provider.selectedMode,
            onModeSelected: provider.selectMode,
          ),
        ),
      ],
    );
  }
}
```

### 3.4 äº’å‹•å…ƒä»¶å±¤Widget

#### 3.4.1 ModeCard Widget
```dart
/**
 * 09. æ¨¡å¼é¸æ“‡å¡ç‰‡Widget
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description å–®ä¸€æ¨¡å¼é¸æ“‡å¡ç‰‡ï¼Œéµå¾ª0015æ–‡ä»¶å››æ¨¡å¼å‘½åèˆ‡9005è‰²å½©è¦ç¯„
 */
class ModeCard extends StatefulWidget {
  final UserMode mode;
  final bool isSelected;
  final VoidCallback onTap;
  
  const ModeCard({
    Key? key,
    required this.mode,
    required this.isSelected,
    required this.onTap,
  }) : super(key: key);

  @override
  State<ModeCard> createState() => _ModeCardState();
}

class _ModeCardState extends State<ModeCard> 
    with SingleTickerProviderStateMixin {
  
  late AnimationController _scaleController;
  late Animation<double> _scaleAnimation;
  
  @override
  void initState() {
    super.initState();
    _scaleController = AnimationController(
      duration: const Duration(milliseconds: 200),
      vsync: this,
    );
    _scaleAnimation = Tween<double>(
      begin: 1.0,
      end: 1.05,
    ).animate(CurvedAnimation(
      parent: _scaleController,
      curve: Curves.easeInOut,
    ));
  }

  @override
  Widget build(BuildContext context) {
    final modeConfig = _getModeConfig(widget.mode);
    final responsive = ResponsiveHelper.of(context);
    
    return AnimatedBuilder(
      animation: _scaleAnimation,
      builder: (context, child) {
        return Transform.scale(
          scale: widget.isSelected ? _scaleAnimation.value : 1.0,
          child: Semantics(
            button: true,
            enabled: true,
            label: modeConfig.semanticLabel,
            hint: 'é›™æ“Šé¸æ“‡${modeConfig.displayName}æ¨¡å¼',
            child: InkWell(
              onTap: () {
                _scaleController.forward().then((_) {
                  _scaleController.reverse();
                });
                widget.onTap();
              },
              child: AnimatedContainer(
                duration: const Duration(milliseconds: 300),
                height: responsive.modeCardHeight,
                padding: EdgeInsets.all(16.w),
                decoration: BoxDecoration(
                  color: widget.isSelected 
                      ? modeConfig.selectedColor 
                      : modeConfig.normalColor,
                  borderRadius: BorderRadius.circular(16.r),
                  border: Border.all(
                    color: widget.isSelected 
                        ? Colors.white 
                        : Colors.transparent,
                    width: 2.w,
                  ),
                  boxShadow: widget.isSelected ? [
                    BoxShadow(
                      color: Colors.black26,
                      blurRadius: 8.r,
                      offset: Offset(0, 4.h),
                    ),
                  ] : null,
                ),
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    // æ¨¡å¼åœ–ç¤º
                    Icon(
                      modeConfig.icon,
                      size: responsive.isMobile ? 28.sp : 32.sp,
                      color: Colors.white,
                    ),
                    
                    SizedBox(height: 8.h),
                    
                    // æ¨¡å¼åç¨±
                    Text(
                      modeConfig.displayName,
                      style: TextStyle(
                        fontSize: responsive.isMobile ? 12.sp : 14.sp,
                        fontWeight: FontWeight.w600,
                        color: Colors.white,
                      ),
                      textAlign: TextAlign.center,
                      maxLines: 1,
                      overflow: TextOverflow.ellipsis,
                    ),
                    
                    SizedBox(height: 4.h),
                    
                    // æ¨¡å¼æè¿°
                    Text(
                      modeConfig.shortDescription,
                      style: TextStyle(
                        fontSize: responsive.isMobile ? 9.sp : 10.sp,
                        color: Colors.white70,
                      ),
                      textAlign: TextAlign.center,
                      maxLines: 2,
                      overflow: TextOverflow.ellipsis,
                    ),
                  ],
                ),
              ),
            ),
          ),
        );
      },
    );
  }
  
  ModeConfig _getModeConfig(UserMode mode) {
    switch (mode) {
      case UserMode.controller:
        return ModeConfig(
          displayName: 'ç²¾æº–æ§åˆ¶è€…', // 0015è¦ç¯„å‘½å
          shortDescription: 'æ·±åº¦åˆ†æ\nå°ˆæ¥­æ“ä½œ',
          semanticLabel: 'ç²¾æº–æ§åˆ¶è€…æ¨¡å¼ï¼Œé©åˆéœ€è¦æ·±åº¦åˆ†æå’Œå°ˆæ¥­æ“ä½œçš„ä½¿ç”¨è€…',
          icon: Icons.analytics,
          normalColor: const Color(0x331976D2), // 9005è¦ç¯„è‰²å½©
          selectedColor: const Color(0x661976D2),
        );
      case UserMode.logger:
        return ModeConfig(
          displayName: 'ç´€éŒ„ç¿’æ…£è€…', // 0015è¦ç¯„å‘½å
          shortDescription: 'å„ªé›…ç¾è§€\nç¿’æ…£è¨˜éŒ„',
          semanticLabel: 'ç´€éŒ„ç¿’æ…£è€…æ¨¡å¼ï¼Œé‡è¦–å„ªé›…ç¾è§€é«”é©—çš„è¨˜å¸³æ„›å¥½è€…',
          icon: Icons.auto_awesome,
          normalColor: const Color(0x336A1B9A), // 9005è¦ç¯„è‰²å½©
          selectedColor: const Color(0x666A1B9A),
        );
      case UserMode.struggler:
        return ModeConfig(
          displayName: 'è½‰å‹æŒ‘æˆ°è€…', // 0015è¦ç¯„å‘½å
          shortDescription: 'ç›®æ¨™å°å‘\nç¿’æ…£é¤Šæˆ',
          semanticLabel: 'è½‰å‹æŒ‘æˆ°è€…æ¨¡å¼ï¼Œå°ˆæ³¨ç›®æ¨™å°å‘å’Œç¿’æ…£é¤Šæˆçš„ä½¿ç”¨è€…',
          icon: Icons.trending_up,
          normalColor: const Color(0x33FF6B35), // 9005è¦ç¯„è‰²å½©
          selectedColor: const Color(0x66FF6B35),
        );
      case UserMode.sleeper:
        return ModeConfig(
          displayName: 'æ½›åœ¨è¦ºé†’è€…', // 0015è¦ç¯„å‘½å
          shortDescription: 'ç°¡å–®æ˜“ç”¨\nè¼•é¬†é–‹å§‹',
          semanticLabel: 'æ½›åœ¨è¦ºé†’è€…æ¨¡å¼ï¼Œåå¥½ç°¡å–®æ˜“ç”¨åŠŸèƒ½çš„å…¥é–€ä½¿ç”¨è€…',
          icon: Icons.eco,
          normalColor: const Color(0x334CAF50), // 9005è¦ç¯„è‰²å½©
          selectedColor: const Color(0x664CAF50),
        );
    }
  }
  
  @override
  void dispose() {
    _scaleController.dispose();
    super.dispose();
  }
}
```

### 3.5 æ¼¸å±¤èƒŒæ™¯Widget
```dart
/**
 * 11. æ¼¸å±¤èƒŒæ™¯Widget
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description æ ¹æ“š9005è¦ç¯„çš„å››æ¨¡å¼å·®ç•°åŒ–èƒŒæ™¯
 */
class GradientBackground extends StatelessWidget {
  final UserMode? mode;
  
  const GradientBackground({Key? key, this.mode}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    final gradient = _getGradientForMode(mode);
    
    return Container(
      decoration: BoxDecoration(
        gradient: gradient,
      ),
    );
  }
  
  LinearGradient _getGradientForMode(UserMode? mode) {
    switch (mode) {
      case UserMode.controller:
        return const LinearGradient(
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
          colors: [Color(0xFF1976D2), Color(0xFF37474F)], // 9005è¦ç¯„å°ˆæ¥­è—
        );
      case UserMode.logger:
        return const LinearGradient(
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
          colors: [Color(0xFF6A1B9A), Color(0xFFE1BEE7)], // 9005è¦ç¯„å„ªé›…ç´«
        );
      case UserMode.struggler:
        return const LinearGradient(
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
          colors: [Color(0xFFFF6B35), Color(0xFFFFE0B2)], // 9005è¦ç¯„æ´»åŠ›æ©˜
        );
      case UserMode.sleeper:
        return const LinearGradient(
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
          colors: [Color(0xFF4CAF50), Color(0xFFC8E6C9)], // 9005è¦ç¯„æº«å’Œç¶ 
        );
      default:
        return const LinearGradient(
          begin: Alignment.topLeft,
          end: Alignment.bottomRight,
          colors: [Color(0xFF667eea), Color(0xFF764ba2)], // é è¨­æ¼¸å±¤
        );
    }
  }
}
```

---

## 4.0 ç‹€æ…‹ç®¡ç†æ¶æ§‹

### 4.1 WelcomeProvider ç‹€æ…‹ç®¡ç†å™¨
```dart
/**
 * æ­¡è¿é é¢ç‹€æ…‹ç®¡ç†å™¨
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description ç®¡ç†æ­¡è¿é é¢çš„ç‹€æ…‹ï¼Œæ”¯æ´8701è¦ç¯„çš„å®Œæ•´åŠŸèƒ½æµç¨‹
 */
class WelcomeProvider extends ChangeNotifier {
  // é é¢ç‹€æ…‹ - å®Œæ•´ç‹€æ…‹æšèˆ‰å®šç¾©ï¼ˆ8701è¦ç¯„ï¼‰
  WelcomePageState _pageState = WelcomePageState.loading;
  WelcomePageState get pageState => _pageState;
  
  // ä½¿ç”¨è€…é¸æ“‡çš„æ¨¡å¼
  UserMode? _selectedMode;
  UserMode? get selectedMode => _selectedMode;
  
  // è¼‰å…¥ç‹€æ…‹
  bool _isLoading = false;
  bool get isLoading => _isLoading;
  
  // éŒ¯èª¤è¨Šæ¯èˆ‡éŒ¯èª¤é¡å‹ï¼ˆ8701è¦ç¯„ï¼‰
  String? _errorMessage;
  String? get errorMessage => _errorMessage;
  
  WelcomeErrorType? _errorType;
  WelcomeErrorType? get errorType => _errorType;
  
  // æ˜¯å¦ç‚ºé¦–æ¬¡å•Ÿå‹•ï¼ˆ8701è¦ç¯„ï¼‰
  bool _isFirstLaunch = true;
  bool get isFirstLaunch => _isFirstLaunch;
  
  // ä½¿ç”¨è€…èªè­‰ç‹€æ…‹
  bool _isUserAuthenticated = false;
  bool get isUserAuthenticated => _isUserAuthenticated;
  
  // APIæœå‹™
  final WelcomeApiService _apiService = WelcomeApiService();
  final NavigationService _navigationService = NavigationService();
  final PreferencesService _preferencesService = PreferencesService();

  /// åˆå§‹åŒ–é é¢ - æ”¯æ´é¦–æ¬¡å•Ÿå‹•èˆ‡å†æ¬¡å•Ÿå‹•æµç¨‹ï¼ˆ8701è¦ç¯„ï¼‰
  Future<void> initializePage() async {
    try {
      _setLoading(true);
      _setPageState(WelcomePageState.loading);
      
      // æª¢æŸ¥æ˜¯å¦ç‚ºé¦–æ¬¡å•Ÿå‹•
      _isFirstLaunch = await _preferencesService.isFirstLaunch();
      
      if (!_isFirstLaunch) {
        // å†æ¬¡å•Ÿå‹•æµç¨‹
        await _handleReturnUserFlow();
      } else {
        // é¦–æ¬¡å•Ÿå‹•æµç¨‹
        await _handleFirstLaunchFlow();
      }
      
    } catch (e) {
      _setError('é é¢åˆå§‹åŒ–å¤±æ•—', WelcomeErrorType.initialization, e);
      _setPageState(WelcomePageState.error);
    } finally {
      _setLoading(false);
    }
  }
  
  /// è™•ç†é¦–æ¬¡å•Ÿå‹•æµç¨‹ï¼ˆ8701è¦ç¯„ï¼‰
  Future<void> _handleFirstLaunchFlow() async {
    // æª¢æŸ¥å¸³è™Ÿåˆªé™¤ç‹€æ…‹ (å°æ‡‰F004)
    await _checkAccountDeletionStatus();
    
    // é¡¯ç¤ºæ¨¡å¼é¸æ“‡
    _setPageState(WelcomePageState.modeSelection);
  }
  
  /// è™•ç†å†æ¬¡å•Ÿå‹•æµç¨‹ï¼ˆ8701è¦ç¯„ï¼‰
  Future<void> _handleReturnUserFlow() async {
    // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
    _isUserAuthenticated = await _preferencesService.isLoggedIn();
    
    if (_isUserAuthenticated) {
      // å·²ç™»å…¥ç”¨æˆ¶ç›´æ¥è·³è½‰åˆ°é¦–é 
      await _navigationService.navigateToHome();
    } else {
      // æœªç™»å…¥ç”¨æˆ¶è·³è½‰åˆ°ç™»å…¥é é¢
      await _navigationService.navigateToLogin();
    }
  }

  /// æª¢æŸ¥å¸³è™Ÿåˆªé™¤ç‹€æ…‹ï¼ˆ8701è¦ç¯„ - F004ç«¯é»ï¼‰
  Future<void> _checkAccountDeletionStatus() async {
    try {
      final response = await _apiService.checkInitialization();
      
      if (response.success && response.data != null) {
        final data = response.data!;
        
        if (data['accountDeletionRequired'] == true) {
          final deletionInfo = data['deletionPendingInfo'];
          _setError(
            'æ‚¨çš„å¸³è™Ÿå°‡æ–¼ ${deletionInfo['scheduledDate']} è¢«åˆªé™¤\nå¦‚éœ€å–æ¶ˆåˆªé™¤ï¼Œè«‹è¯ç¹«å®¢æœ',
            WelcomeErrorType.accountDeletion,
            null,
          );
          _setPageState(WelcomePageState.error);
        }
      }
    } catch (e) {
      // æª¢æŸ¥å¤±æ•—ä¸å½±éŸ¿ä¸»æµç¨‹ï¼Œåƒ…è¨˜éŒ„éŒ¯èª¤
      debugPrint('å¸³è™Ÿåˆªé™¤ç‹€æ…‹æª¢æŸ¥å¤±æ•—: $e');
    }
  }

  /// é¸æ“‡æ¨¡å¼
  void selectMode(UserMode mode) {
    if (_selectedMode == mode) {
      _selectedMode = null;
    } else {
      _selectedMode = mode;
    }
    notifyListeners();
  }

  /// é–‹å§‹ä½¿ç”¨ - æ¨¡å¼è¨­å®šèˆ‡å°èˆªï¼ˆ8701è¦ç¯„ï¼‰
  Future<void> startApp() async {
    if (_selectedMode == null) {
      _setError('è«‹å…ˆé¸æ“‡ä¸€å€‹ä½¿ç”¨æ¨¡å¼', WelcomeErrorType.validation, null);
      return;
    }
    
    try {
      _setLoading(true);
      _setPageState(WelcomePageState.loading);
      
      // èª¿ç”¨æ¨¡å¼è¨­å®šAPIï¼ˆä¿®æ­£ç‚ºF009å­åŠŸèƒ½ï¼‰
      await _setUserMode(_selectedMode!);
      
      // è¨­å®šé¦–æ¬¡å•Ÿå‹•æ¨™è¨˜
      await _preferencesService.setFirstLaunchCompleted();
      
      // å°èˆªåˆ°ç™»å…¥é é¢
      await _navigationService.navigateToLogin();
      
    } catch (e) {
      _setError('æ¨¡å¼è¨­å®šå¤±æ•—', WelcomeErrorType.modeSelection, e);
      _setPageState(WelcomePageState.error);
    } finally {
      _setLoading(false);
    }
  }

  /// è¨­å®šä½¿ç”¨è€…æ¨¡å¼ï¼ˆä¿®æ­£ç‚ºF009å­åŠŸèƒ½ï¼‰
  Future<void> _setUserMode(UserMode mode) async {
    final request = UserSettingsRequest(
      settingType: 'mode_selection',
      modeSettings: ModeSelectionData(
        selectedMode: mode.name,
        deviceInfo: await _getDeviceInfo(),
      ),
    );
    
    final response = await _apiService.updateUserSettings(request);
    
    if (!response.success) {
      throw Exception('æ¨¡å¼è¨­å®šå¤±æ•—');
    }
    
    // å„²å­˜æ¨¡å¼é…ç½®åˆ°æœ¬åœ°
    if (response.data?['modeConfig'] != null) {
      await _preferencesService.saveModeConfig(response.data!['modeConfig']);
    }
  }

  /// å–å¾—è£ç½®è³‡è¨Š
  Future<Map<String, dynamic>> _getDeviceInfo() async {
    return {
      'platform': Platform.isAndroid ? 'android' : 'ios',
      'version': await _getAppVersion(),
      'deviceId': await _getDeviceId(),
    };
  }

  /// è¨­å®šè¼‰å…¥ç‹€æ…‹
  void _setLoading(bool loading) {
    _isLoading = loading;
    notifyListeners();
  }

  /// è¨­å®šé é¢ç‹€æ…‹
  void _setPageState(WelcomePageState state) {
    _pageState = state;
    notifyListeners();
  }

  /// è¨­å®šéŒ¯èª¤è¨Šæ¯ï¼ˆ8701è¦ç¯„ - è©³ç´°éŒ¯èª¤è™•ç†ï¼‰
  void _setError(String message, WelcomeErrorType type, dynamic error) {
    _errorMessage = message;
    _errorType = type;
    
    // è¨˜éŒ„è©³ç´°éŒ¯èª¤è³‡è¨Š
    if (error != null) {
      debugPrint('WelcomeProvideréŒ¯èª¤ [$type]: $message, è©³ç´°: $error');
    }
    
    notifyListeners();
  }

  /// æ¸…é™¤éŒ¯èª¤
  void clearError() {
    _errorMessage = null;
    _errorType = null;
    
    // æ ¹æ“šéŒ¯èª¤é¡å‹æ±ºå®šå¾ŒçºŒå‹•ä½œ
    if (_pageState == WelcomePageState.error) {
      if (_isFirstLaunch) {
        _setPageState(WelcomePageState.modeSelection);
      } else {
        // é‡æ–°åˆå§‹åŒ–
        initializePage();
      }
    }
    
    notifyListeners();
  }
  
  /// é‡è©¦æ“ä½œ
  Future<void> retryOperation() async {
    switch (_errorType) {
      case WelcomeErrorType.initialization:
        await initializePage();
        break;
      case WelcomeErrorType.modeSelection:
        if (_selectedMode != null) {
          await startApp();
        }
        break;
      case WelcomeErrorType.networkConnection:
        await initializePage();
        break;
      default:
        clearError();
        break;
    }
  }
}
```

### 4.2 ç‹€æ…‹æšèˆ‰å®šç¾©ï¼ˆ8701è¦ç¯„å®Œæ•´ç‹€æ…‹ï¼‰
```dart
/// æ­¡è¿é é¢ç‹€æ…‹æšèˆ‰ï¼ˆ8701è¦ç¯„ï¼‰
enum WelcomePageState {
  loading,        // è¼‰å…¥ä¸­
  modeSelection,  // æ¨¡å¼é¸æ“‡
  loginRedirect,  // ç™»å…¥é‡å°å‘
  error,          // éŒ¯èª¤ç‹€æ…‹
}

/// ä½¿ç”¨è€…æ¨¡å¼æšèˆ‰ï¼ˆ0015è¦ç¯„å‘½åï¼‰
enum UserMode {
  controller,  // ç²¾æº–æ§åˆ¶è€…
  logger,      // ç´€éŒ„ç¿’æ…£è€…
  struggler,   // è½‰å‹æŒ‘æˆ°è€…
  sleeper,     // æ½›åœ¨è¦ºé†’è€…
}

/// éŒ¯èª¤é¡å‹æšèˆ‰ï¼ˆ8701è¦ç¯„è©³ç´°éŒ¯èª¤åˆ†é¡ï¼‰
enum WelcomeErrorType {
  initialization,    // åˆå§‹åŒ–éŒ¯èª¤
  networkConnection, // ç¶²è·¯é€£ç·šéŒ¯èª¤
  modeSelection,     // æ¨¡å¼é¸æ“‡éŒ¯èª¤
  accountDeletion,   // å¸³è™Ÿåˆªé™¤ç›¸é—œéŒ¯èª¤
  validation,        // è¼¸å…¥é©—è­‰éŒ¯èª¤
  unknown,          // æœªçŸ¥éŒ¯èª¤
}
```

---

## 5.0 APIæ•´åˆè¨­è¨ˆ

### 5.1 WelcomeApiService APIæœå‹™ï¼ˆ8701è¦ç¯„å®Œæ•´APIæ•´åˆï¼‰
```dart
/**
 * æ­¡è¿é é¢APIæœå‹™
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description è™•ç†æ­¡è¿é é¢ç›¸é—œçš„APIèª¿ç”¨ï¼Œæ”¯æ´F004ã€F009ç«¯é»ï¼ˆ8701è¦ç¯„ï¼‰
 */
class WelcomeApiService {
  final ApiClient _apiClient = ApiClient();

  /// æª¢æŸ¥æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–ç‹€æ…‹ï¼ˆå°æ‡‰F004 - 8701è¦ç¯„ï¼‰
  Future<ApiResponse<Map<String, dynamic>>> checkInitialization() async {
    try {
      final deviceInfo = await _getDeviceInfo();
      
      final response = await _apiClient.get(
        '/app/initialization',
        queryParameters: {
          'deviceInfo': deviceInfo,
          'accountDeletionCheck': true,
        },
      );
      
      return ApiResponse.success(response.data);
    } on DioError catch (e) {
      return ApiResponse.error(_handleDioError(e));
    } catch (e) {
      return ApiResponse.error('åˆå§‹åŒ–æª¢æŸ¥å¤±æ•—: ${e.toString()}');
    }
  }

  /// æ›´æ–°ä½¿ç”¨è€…è¨­å®šï¼ˆå°æ‡‰F009 - ä¿®æ­£ç‚ºè¨­å®šç®¡ç†çš„å­åŠŸèƒ½ï¼‰
  Future<ApiResponse<Map<String, dynamic>>> updateUserSettings(
    UserSettingsRequest request,
  ) async {
    try {
      final response = await _apiClient.put(
        '/app/user/settings',
        data: request.toJson(),
      );
      
      if (response.data['success'] == true) {
        return ApiResponse.success(response.data['data']);
      } else {
        return ApiResponse.error(response.data['message'] ?? 'è¨­å®šæ›´æ–°å¤±æ•—');
      }
    } on DioError catch (e) {
      return ApiResponse.error(_handleDioError(e));
    } catch (e) {
      return ApiResponse.error('ä½¿ç”¨è€…è¨­å®šæ›´æ–°å¤±æ•—: ${e.toString()}');
    }
  }

  /// è™•ç†DioéŒ¯èª¤ï¼ˆ8701è¦ç¯„è©³ç´°éŒ¯èª¤è™•ç†ï¼‰
  String _handleDioError(DioError error) {
    switch (error.type) {
      case DioErrorType.connectTimeout:
      case DioErrorType.receiveTimeout:
        return 'ç¶²è·¯é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®š';
      case DioErrorType.response:
        final statusCode = error.response?.statusCode;
        switch (statusCode) {
          case 400:
            return 'è«‹æ±‚åƒæ•¸éŒ¯èª¤ï¼Œè«‹é‡æ–°æ“ä½œ';
          case 401:
            return 'èªè­‰å¤±æ•ˆï¼Œè«‹é‡æ–°ç™»å…¥';
          case 403:
            return 'å­˜å–æ¬Šé™ä¸è¶³';
          case 404:
            return 'æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨';
          case 500:
            return 'ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œé‡è©¦';
          case 502:
            return 'æœå‹™æš«æ™‚ç„¡æ³•å›æ‡‰ï¼Œè«‹ç¨å¾Œé‡è©¦';
          case 503:
            return 'æœå‹™ç¶­è­·ä¸­ï¼Œè«‹ç¨å¾Œé‡è©¦';
          default:
            return 'ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤ (HTTP $statusCode)';
        }
      case DioErrorType.cancel:
        return 'æ“ä½œå·²å–æ¶ˆ';
      case DioErrorType.other:
        if (error.message.contains('SocketException')) {
          return 'ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹';
        }
        return 'ç¶²è·¯éŒ¯èª¤ï¼Œè«‹ç¨å¾Œé‡è©¦';
      default:
        return 'æœªçŸ¥ç¶²è·¯éŒ¯èª¤';
    }
  }

  /// å–å¾—è£ç½®è³‡è¨Š
  Future<Map<String, dynamic>> _getDeviceInfo() async {
    final deviceInfo = DeviceInfoPlugin();
    
    if (Platform.isAndroid) {
      final androidInfo = await deviceInfo.androidInfo;
      return {
        'platform': 'android',
        'model': androidInfo.model,
        'version': androidInfo.version.release,
        'deviceId': androidInfo.androidId,
      };
    } else {
      final iosInfo = await deviceInfo.iosInfo;
      return {
        'platform': 'ios',
        'model': iosInfo.model,
        'version': iosInfo.systemVersion,
        'deviceId': iosInfo.identifierForVendor,
      };
    }
  }
}
```

### 5.2 è³‡æ–™æ¨¡å‹å®šç¾©ï¼ˆä¿®æ­£F009å°æ‡‰ï¼‰
```dart
/// ä½¿ç”¨è€…è¨­å®šè«‹æ±‚æ¨¡å‹ï¼ˆä¿®æ­£ç‚ºF009å­åŠŸèƒ½ï¼‰
class UserSettingsRequest {
  final String settingType;
  final ModeSelectionData? modeSettings;

  UserSettingsRequest({
    required this.settingType,
    this.modeSettings,
  });

  Map<String, dynamic> toJson() => {
    'settingType': settingType,
    'modeSettings': modeSettings?.toJson(),
  };
}

/// æ¨¡å¼é¸æ“‡è³‡æ–™æ¨¡å‹
class ModeSelectionData {
  final String selectedMode;
  final Map<String, dynamic> deviceInfo;

  ModeSelectionData({
    required this.selectedMode,
    required this.deviceInfo,
  });

  Map<String, dynamic> toJson() => {
    'selectedMode': selectedMode,
    'deviceInfo': deviceInfo,
  };
}

/// APIå›æ‡‰çµ±ä¸€æ ¼å¼
class ApiResponse<T> {
  final bool success;
  final T? data;
  final String? error;

  ApiResponse.success(this.data) : success = true, error = null;
  ApiResponse.error(this.error) : success = false, data = null;
}
```

---

## 6.0 å°èˆªè·¯ç”±è¨­è¨ˆ

### 6.1 è·¯ç”±é…ç½®
```dart
/**
 * æ­¡è¿é é¢è·¯ç”±é…ç½®
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description å®šç¾©æ­¡è¿é é¢çš„è·¯ç”±è¦å‰‡èˆ‡å°èˆªé‚è¼¯
 */
class WelcomeRoutes {
  static const String welcome = '/welcome';
  static const String login = '/login';
  static const String register = '/register';
  static const String home = '/home';

  static GoRoute getWelcomeRoute() {
    return GoRoute(
      path: welcome,
      name: 'welcome',
      builder: (context, state) => const WelcomePage(),
    );
  }
}

/// å°èˆªæœå‹™
class NavigationService {
  static final GoRouter _router = GoRouter(
    initialLocation: '/welcome',
    routes: [
      WelcomeRoutes.getWelcomeRoute(),
      LoginRoutes.getLoginRoute(),
      RegisterRoutes.getRegisterRoute(),
      HomeRoutes.getHomeRoute(),
    ],
  );

  static GoRouter get router => _router;

  /// å°èˆªåˆ°ç™»å…¥é é¢
  Future<void> navigateToLogin() async {
    _router.pushReplacement('/login');
  }

  /// å°èˆªåˆ°è¨»å†Šé é¢
  Future<void> navigateToRegister() async {
    _router.pushReplacement('/register');
  }

  /// å°èˆªåˆ°é¦–é 
  Future<void> navigateToHome() async {
    _router.pushReplacement('/home');
  }

  /// è¿”å›ä¸Šä¸€é 
  void goBack() {
    _router.pop();
  }
}
```

---

## 7.0 éŸ¿æ‡‰å¼è¨­è¨ˆ

### 7.1 éŸ¿æ‡‰å¼è¼”åŠ©å·¥å…·ï¼ˆ9005è¦ç¯„å®Œæ•´å¯¦ä½œï¼‰
```dart
/**
 * éŸ¿æ‡‰å¼è¨­è¨ˆè¼”åŠ©å·¥å…·
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description éµå¾ª9005æ–‡ä»¶çš„éŸ¿æ‡‰å¼è¨­è¨ˆè¦ç¯„ï¼Œæä¾›å®Œæ•´çš„æ–·é»ç®¡ç†
 */
class ResponsiveHelper {
  final BuildContext context;
  late final MediaQueryData _mediaQuery;
  late final Size _screenSize;

  ResponsiveHelper.of(BuildContext context) : context = context {
    _mediaQuery = MediaQuery.of(context);
    _screenSize = _mediaQuery.size;
  }

  /// æ–·é»åˆ¤æ–·ï¼ˆ9005è¦ç¯„ï¼‰
  bool get isMobile => _screenSize.width < 480;
  bool get isTablet => _screenSize.width >= 481 && _screenSize.width < 768;
  bool get isSmallDesktop => _screenSize.width >= 769 && _screenSize.width < 1024;
  bool get isLargeDesktop => _screenSize.width >= 1025;

  /// è£ç½®é¡å‹
  DeviceType get deviceType {
    if (isMobile) return DeviceType.mobile;
    if (isTablet) return DeviceType.tablet;
    if (isSmallDesktop) return DeviceType.smallDesktop;
    return DeviceType.largeDesktop;
  }

  /// æ°´å¹³å…§é‚Šè·ï¼ˆ9005è¦ç¯„ï¼‰
  double get horizontalPadding {
    switch (deviceType) {
      case DeviceType.mobile:
        return 16.w;
      case DeviceType.tablet:
        return 32.w;
      case DeviceType.smallDesktop:
        return 48.w;
      case DeviceType.largeDesktop:
        return 64.w;
    }
  }

  /// å‚ç›´å…§é‚Šè·ï¼ˆ9005è¦ç¯„ï¼‰
  double get verticalPadding {
    switch (deviceType) {
      case DeviceType.mobile:
        return 24.h;
      case DeviceType.tablet:
        return 32.h;
      case DeviceType.smallDesktop:
        return 40.h;
      case DeviceType.largeDesktop:
        return 48.h;
    }
  }

  /// æ¨¡å¼ç¶²æ ¼åˆ—æ•¸ï¼ˆ9005è¦ç¯„ï¼‰
  int get modeGridCrossAxisCount {
    switch (deviceType) {
      case DeviceType.mobile:
        return 2; // 2x2 ç¶²æ ¼
      case DeviceType.tablet:
        return 4; // 4x1 ç¶²æ ¼
      case DeviceType.smallDesktop:
      case DeviceType.largeDesktop:
        return 4; // 4x1 ç¶²æ ¼
    }
  }

  /// æ¨¡å¼å¡ç‰‡é«˜åº¦ï¼ˆ9005è¦ç¯„ï¼‰
  double get modeCardHeight {
    switch (deviceType) {
      case DeviceType.mobile:
        return 120.h;
      case DeviceType.tablet:
        return 100.h;
      case DeviceType.smallDesktop:
        return 90.h;
      case DeviceType.largeDesktop:
        return 85.h;
    }
  }

  /// æŒ‰éˆ•é«˜åº¦ï¼ˆ9005è¦ç¯„ï¼‰
  double get buttonHeight {
    switch (deviceType) {
      case DeviceType.mobile:
        return 48.h;
      case DeviceType.tablet:
        return 52.h;
      case DeviceType.smallDesktop:
      case DeviceType.largeDesktop:
        return 48.h;
    }
  }

  /// å­—å‹å¤§å°ç¸®æ”¾ï¼ˆ9005è¦ç¯„ï¼‰
  double get fontSizeScale {
    switch (deviceType) {
      case DeviceType.mobile:
        return 1.0;
      case DeviceType.tablet:
        return 1.1;
      case DeviceType.smallDesktop:
        return 1.0;
      case DeviceType.largeDesktop:
        return 0.9;
    }
  }
}
```

### 7.2 æ–·é»ç®¡ç†ï¼ˆ9005è¦ç¯„ï¼‰
```dart
/// éŸ¿æ‡‰å¼æ–·é»å¸¸æ•¸ï¼ˆ9005è¦ç¯„ï¼‰
class Breakpoints {
  static const double mobileMax = 480;      // æ‰‹æ©Ÿæœ€å¤§å¯¬åº¦
  static const double tabletMin = 481;      // å¹³æ¿æœ€å°å¯¬åº¦
  static const double tabletMax = 768;      // å¹³æ¿æœ€å¤§å¯¬åº¦
  static const double smallDesktopMin = 769; // å°å‹æ¡Œé¢æœ€å°å¯¬åº¦
  static const double smallDesktopMax = 1024; // å°å‹æ¡Œé¢æœ€å¤§å¯¬åº¦
  static const double largeDesktopMin = 1025; // å¤§å‹æ¡Œé¢æœ€å°å¯¬åº¦

  /// å–å¾—ç›®å‰è£ç½®é¡å‹
  static DeviceType getDeviceType(double width) {
    if (width <= mobileMax) return DeviceType.mobile;
    if (width >= tabletMin && width <= tabletMax) return DeviceType.tablet;
    if (width >= smallDesktopMin && width <= smallDesktopMax) return DeviceType.smallDesktop;
    return DeviceType.largeDesktop;
  }
}

enum DeviceType { 
  mobile, 
  tablet, 
  smallDesktop, 
  largeDesktop 
}
```

---

## 8.0 ç„¡éšœç¤™åŠŸèƒ½ï¼ˆ9005è¦ç¯„WCAG 2.1 AAæ¨™æº–ï¼‰

### 8.1 èªæ„åŒ–æ”¯æ´
```dart
/**
 * ç„¡éšœç¤™èªæ„åŒ–WidgetåŒ…è£å™¨
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description æä¾›WCAG 2.1 AAæ¨™æº–çš„å®Œæ•´ç„¡éšœç¤™æ”¯æ´ï¼ˆ9005è¦ç¯„ï¼‰
 */
class AccessibilityWrapper {
  
  /// ç‚ºæ¨¡å¼å¡ç‰‡æä¾›èªæ„åŒ–æ¨™ç±¤
  static Widget wrapModeCard(Widget child, UserMode mode, bool isSelected) {
    final modeNames = {
      UserMode.controller: 'ç²¾æº–æ§åˆ¶è€…',
      UserMode.logger: 'ç´€éŒ„ç¿’æ…£è€…', 
      UserMode.struggler: 'è½‰å‹æŒ‘æˆ°è€…',
      UserMode.sleeper: 'æ½›åœ¨è¦ºé†’è€…',
    };
    
    final modeDescriptions = {
      UserMode.controller: 'é©åˆéœ€è¦æ·±åº¦åˆ†æå’Œå°ˆæ¥­æ“ä½œçš„ä½¿ç”¨è€…',
      UserMode.logger: 'é‡è¦–å„ªé›…ç¾è§€é«”é©—çš„è¨˜å¸³æ„›å¥½è€…',
      UserMode.struggler: 'å°ˆæ³¨ç›®æ¨™å°å‘å’Œç¿’æ…£é¤Šæˆçš„ä½¿ç”¨è€…',
      UserMode.sleeper: 'åå¥½ç°¡å–®æ˜“ç”¨åŠŸèƒ½çš„å…¥é–€ä½¿ç”¨è€…',
    };
    
    return Semantics(
      button: true,
      enabled: true,
      selected: isSelected,
      label: '${modeNames[mode]}æ¨¡å¼',
      value: isSelected ? 'å·²é¸æ“‡' : 'æœªé¸æ“‡',
      hint: isSelected 
          ? 'å·²é¸æ“‡${modeNames[mode]}æ¨¡å¼ï¼Œ${modeDescriptions[mode]}ï¼Œé›™æ“Šå–æ¶ˆé¸æ“‡'
          : 'é¸æ“‡${modeNames[mode]}æ¨¡å¼ï¼Œ${modeDescriptions[mode]}ï¼Œé›™æ“Šç¢ºèªé¸æ“‡',
      onTapHint: 'é¸æ“‡æ­¤æ¨¡å¼',
      child: child,
    );
  }

  /// ç‚ºå“ç‰ŒLogoæä¾›èªæ„åŒ–æ¨™ç±¤
  static Widget wrapBrandLogo(Widget child) {
    return Semantics(
      image: true,
      label: 'LCAS 2.0 æ™ºæ…§è¨˜å¸³æ‡‰ç”¨ç¨‹å¼æ¨™èªŒ',
      excludeSemantics: true,
      child: child,
    );
  }

  /// ç‚ºé–‹å§‹æŒ‰éˆ•æä¾›èªæ„åŒ–æ¨™ç±¤
  static Widget wrapStartButton(Widget child, {required bool enabled, UserMode? selectedMode}) {
    final modeNames = {
      UserMode.controller: 'ç²¾æº–æ§åˆ¶è€…',
      UserMode.logger: 'ç´€éŒ„ç¿’æ…£è€…', 
      UserMode.struggler: 'è½‰å‹æŒ‘æˆ°è€…',
      UserMode.sleeper: 'æ½›åœ¨è¦ºé†’è€…',
    };
    
    return Semantics(
      button: true,
      enabled: enabled,
      label: 'é–‹å§‹ä½¿ç”¨',
      value: enabled && selectedMode != null 
          ? 'å·²é¸æ“‡${modeNames[selectedMode]}æ¨¡å¼' 
          : 'å°šæœªé¸æ“‡æ¨¡å¼',
      hint: enabled 
          ? 'é›™æ“Šé–‹å§‹ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼' 
          : 'è«‹å…ˆé¸æ“‡ä¸€å€‹ä½¿ç”¨æ¨¡å¼',
      onTapHint: enabled ? 'é–‹å§‹ä½¿ç”¨' : null,
      child: child,
    );
  }

  /// ç‚ºè¼‰å…¥æŒ‡ç¤ºå™¨æä¾›èªæ„åŒ–æ¨™ç±¤
  static Widget wrapLoadingIndicator(Widget child, String? loadingMessage) {
    return Semantics(
      liveRegion: true,
      label: loadingMessage ?? 'è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™',
      child: child,
    );
  }

  /// ç‚ºéŒ¯èª¤å°è©±æ¡†æä¾›èªæ„åŒ–æ¨™ç±¤
  static Widget wrapErrorDialog(Widget child, String errorMessage, WelcomeErrorType errorType) {
    final errorTypeMessages = {
      WelcomeErrorType.networkConnection: 'ç¶²è·¯é€£ç·šéŒ¯èª¤',
      WelcomeErrorType.modeSelection: 'æ¨¡å¼è¨­å®šéŒ¯èª¤',
      WelcomeErrorType.initialization: 'åˆå§‹åŒ–éŒ¯èª¤',
      WelcomeErrorType.accountDeletion: 'å¸³è™Ÿç‹€æ…‹è­¦å‘Š',
      WelcomeErrorType.validation: 'è¼¸å…¥é©—è­‰éŒ¯èª¤',
      WelcomeErrorType.unknown: 'ç³»çµ±éŒ¯èª¤',
    };
    
    return Semantics(
      liveRegion: true,
      assertiveness: Assertiveness.assertive,
      label: 'éŒ¯èª¤è¨Šæ¯ï¼š${errorTypeMessages[errorType]}',
      value: errorMessage,
      hint: 'æŒ‰ç¢ºå®šé—œé–‰éŒ¯èª¤è¨Šæ¯ï¼Œæˆ–æŒ‰é‡è©¦é‡æ–°æ“ä½œ',
      child: child,
    );
  }
}
```

### 8.2 è‰²å½©å°æ¯”åº¦æ”¯æ´ï¼ˆ9005è¦ç¯„ï¼‰
```dart
/// é«˜å°æ¯”åº¦ä¸»é¡Œæ”¯æ´ï¼ˆWCAG 2.1 AAæ¨™æº–ï¼‰
class HighContrastTheme {
  
  /// æª¢æŸ¥æ˜¯å¦å•Ÿç”¨é«˜å°æ¯”åº¦æ¨¡å¼
  static bool isHighContrastEnabled(BuildContext context) {
    return MediaQuery.of(context).highContrast;
  }

  /// æª¢æŸ¥æ˜¯å¦å•Ÿç”¨å¤§å­—å‹æ¨¡å¼
  static bool isLargeTextEnabled(BuildContext context) {
    final textScaleFactor = MediaQuery.of(context).textScaleFactor;
    return textScaleFactor > 1.3;
  }

  /// æª¢æŸ¥æ˜¯å¦å•Ÿç”¨å‹•ç•«æ¸›å°‘æ¨¡å¼
  static bool isReduceMotionEnabled(BuildContext context) {
    return MediaQuery.of(context).disableAnimations;
  }

  /// å–å¾—é«˜å°æ¯”åº¦æ–‡å­—è‰²å½©ï¼ˆå°æ¯”åº¦è‡³å°‘4.5:1ï¼‰
  static Color getContrastTextColor(BuildContext context, Color backgroundColor) {
    if (isHighContrastEnabled(context)) {
      final luminance = backgroundColor.computeLuminance();
      return luminance > 0.5 ? Colors.black : Colors.white;
    }
    
    // æª¢æŸ¥ä¸€èˆ¬å°æ¯”åº¦
    final luminance = backgroundColor.computeLuminance();
    if (luminance > 0.5) {
      return const Color(0xFF212121); // æ·±ç°è‰²ï¼Œå°ç™½èƒŒæ™¯å°æ¯”åº¦16.31:1
    } else {
      return Colors.white; // ç™½è‰²
    }
  }

  /// å–å¾—é«˜å°æ¯”åº¦æŒ‰éˆ•è‰²å½©
  static Color getContrastButtonColor(BuildContext context, Color normalColor) {
    if (isHighContrastEnabled(context)) {
      return normalColor.computeLuminance() > 0.5 
          ? const Color(0xFF000080) // æ·±è—è‰²
          : const Color(0xFFFFFFFF); // ç™½è‰²
    }
    return normalColor;
  }

  /// å–å¾—é«˜å°æ¯”åº¦é‚Šæ¡†è‰²å½©
  static Color getContrastBorderColor(BuildContext context) {
    if (isHighContrastEnabled(context)) {
      return Colors.black;
    }
    return Colors.transparent;
  }

  /// å–å¾—é©é…çš„å­—å‹å¤§å°
  static double getScaledFontSize(BuildContext context, double baseFontSize) {
    final textScaleFactor = MediaQuery.of(context).textScaleFactor;
    
    // é™åˆ¶æœ€å¤§ç¸®æ”¾é¿å…ç‰ˆé¢ç ´å£
    final clampedScaleFactor = textScaleFactor.clamp(0.8, 2.0);
    
    return baseFontSize * clampedScaleFactor;
  }

  /// å–å¾—é©é…çš„å‹•ç•«æ™‚é•·
  static Duration getScaledAnimationDuration(BuildContext context, Duration baseDuration) {
    if (isReduceMotionEnabled(context)) {
      return const Duration(milliseconds: 1); // å¹¾ä¹ç„¡å‹•ç•«
    }
    return baseDuration;
  }
}
```

### 8.3 è§¸æ§ç›®æ¨™å¤§å°ï¼ˆWCAG 2.1 AAæ¨™æº–ï¼‰
```dart
/// è§¸æ§ç›®æ¨™å¤§å°è¼”åŠ©å·¥å…·
class TouchTargetHelper {
  // WCAG 2.1 AAæ¨™æº–æœ€å°è§¸æ§ç›®æ¨™ï¼š44x44 dp
  static const double minTouchTargetSize = 44.0;
  
  /// ç¢ºä¿Widgetç¬¦åˆæœ€å°è§¸æ§ç›®æ¨™å¤§å°
  static Widget ensureMinTouchTarget(Widget child, {
    double? width,
    double? height,
  }) {
    return Container(
      constraints: BoxConstraints(
        minWidth: width ?? minTouchTargetSize,
        minHeight: height ?? minTouchTargetSize,
      ),
      child: child,
    );
  }

  /// ç‚ºå°æ–¼æ¨™æº–çš„æŒ‰éˆ•å¢åŠ é€æ˜è§¸æ§å€åŸŸ
  static Widget expandTouchTarget(Widget child, {
    required double currentWidth,
    required double currentHeight,
  }) {
    final needsExpansion = currentWidth < minTouchTargetSize || 
                          currentHeight < minTouchTargetSize;
                          
    if (!needsExpansion) return child;
    
    final expandWidth = math.max(0, minTouchTargetSize - currentWidth) / 2;
    final expandHeight = math.max(0, minTouchTargetSize - currentHeight) / 2;
    
    return Padding(
      padding: EdgeInsets.symmetric(
        horizontal: expandWidth,
        vertical: expandHeight,
      ),
      child: child,
    );
  }
}
```

---

## 9.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 9.1 Widgetå¿«å–ç­–ç•¥
```dart
/**
 * Widgetå¿«å–ç®¡ç†å™¨
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description å„ªåŒ–Widgeté‡å»ºæ•ˆèƒ½ï¼Œæ¸›å°‘ä¸å¿…è¦çš„é‡å»º
 */
class WidgetCache {
  static final Map<String, Widget> _cache = {};
  static final Map<String, DateTime> _cacheTimestamps = {};
  static const Duration _cacheValidDuration = Duration(minutes: 5);

  /// å–å¾—å¿«å–çš„Widgetæˆ–å»ºç«‹æ–°çš„
  static Widget getOrCreate(String key, Widget Function() creator) {
    final timestamp = _cacheTimestamps[key];
    final isExpired = timestamp == null || 
        DateTime.now().difference(timestamp) > _cacheValidDuration;

    if (_cache.containsKey(key) && !isExpired) {
      return _cache[key]!;
    }
    
    final widget = creator();
    _cache[key] = widget;
    _cacheTimestamps[key] = DateTime.now();
    return widget;
  }

  /// æ¸…é™¤éæœŸå¿«å–
  static void clearExpiredCache() {
    final now = DateTime.now();
    final expiredKeys = <String>[];
    
    _cacheTimestamps.forEach((key, timestamp) {
      if (now.difference(timestamp) > _cacheValidDuration) {
        expiredKeys.add(key);
      }
    });
    
    for (final key in expiredKeys) {
      _cache.remove(key);
      _cacheTimestamps.remove(key);
    }
  }

  /// æ¸…é™¤æ‰€æœ‰å¿«å–
  static void clearAllCache() {
    _cache.clear();
    _cacheTimestamps.clear();
  }

  /// å–å¾—å¿«å–çµ±è¨ˆè³‡è¨Š
  static Map<String, dynamic> getCacheStats() {
    return {
      'totalCached': _cache.length,
      'oldestCache': _cacheTimestamps.isEmpty 
          ? null 
          : _cacheTimestamps.values.reduce((a, b) => a.isBefore(b) ? a : b),
      'newestCache': _cacheTimestamps.isEmpty 
          ? null 
          : _cacheTimestamps.values.reduce((a, b) => a.isAfter(b) ? a : b),
    };
  }
}
```

### 9.2 åœ–ç‰‡é è¼‰å…¥èˆ‡æœ€ä½³åŒ–
```dart
/// åœ–ç‰‡é è¼‰å…¥ç®¡ç†å™¨
class ImagePreloader {
  static final Set<String> _preloadedImages = {};
  static final Map<String, Completer<void>> _loadingImages = {};

  /// é è¼‰å…¥å“ç‰Œç›¸é—œåœ–ç‰‡è³‡æº
  static Future<void> preloadBrandAssets(BuildContext context) async {
    const assets = [
      'assets/images/logo.png',
      'assets/images/brand_background.png',
      'assets/icons/mode_controller.png',
      'assets/icons/mode_logger.png',
      'assets/icons/mode_struggler.png',
      'assets/icons/mode_sleeper.png',
    ];

    final preloadFutures = assets.map((asset) => _preloadSingleImage(context, asset));
    await Future.wait(preloadFutures);
  }

  /// é è¼‰å…¥å–®ä¸€åœ–ç‰‡
  static Future<void> _preloadSingleImage(BuildContext context, String asset) async {
    if (_preloadedImages.contains(asset)) {
      return; // å·²é è¼‰å…¥
    }

    if (_loadingImages.containsKey(asset)) {
      return _loadingImages[asset]!.future; // æ­£åœ¨è¼‰å…¥ä¸­
    }

    final completer = Completer<void>();
    _loadingImages[asset] = completer;

    try {
      await precacheImage(AssetImage(asset), context);
      _preloadedImages.add(asset);
      completer.complete();
    } catch (e) {
      debugPrint('åœ–ç‰‡é è¼‰å…¥å¤±æ•—: $asset, éŒ¯èª¤: $e');
      completer.completeError(e);
    } finally {
      _loadingImages.remove(asset);
    }
  }

  /// æª¢æŸ¥åœ–ç‰‡æ˜¯å¦å·²é è¼‰å…¥
  static bool isImagePreloaded(String asset) {
    return _preloadedImages.contains(asset);
  }

  /// æ¸…é™¤é è¼‰å…¥è¨˜éŒ„
  static void clearPreloadedImages() {
    _preloadedImages.clear();
  }
}
```

### 9.3 è¨˜æ†¶é«”ç®¡ç†èˆ‡æ•ˆèƒ½ç›£æ§
```dart
/// è¨˜æ†¶é«”ä½¿ç”¨ç›£æ§
class MemoryMonitor {
  static Timer? _monitorTimer;
  static final List<int> _memoryUsageHistory = [];
  static const int _maxHistoryLength = 60; // ä¿ç•™60å€‹ç›£æ§é»
  static const int _warningThresholdMB = 150; // è­¦å‘Šé–¾å€¼150MB
  static const int _criticalThresholdMB = 200; // å±éšªé–¾å€¼200MB

  /// é–‹å§‹è¨˜æ†¶é«”ç›£æ§
  static void startMonitoring() {
    _monitorTimer?.cancel();
    
    _monitorTimer = Timer.periodic(const Duration(seconds: 30), (timer) {
      _checkMemoryUsage();
    });
  }

  /// åœæ­¢è¨˜æ†¶é«”ç›£æ§
  static void stopMonitoring() {
    _monitorTimer?.cancel();
    _monitorTimer = null;
  }

  /// æª¢æŸ¥è¨˜æ†¶é«”ä½¿ç”¨ç‹€æ³
  static void _checkMemoryUsage() {
    final usageMB = _getCurrentMemoryUsageMB();
    
    // è¨˜éŒ„æ­·å²
    _memoryUsageHistory.add(usageMB);
    if (_memoryUsageHistory.length > _maxHistoryLength) {
      _memoryUsageHistory.removeAt(0);
    }

    // æª¢æŸ¥é–¾å€¼
    if (usageMB > _criticalThresholdMB) {
      debugPrint('ğŸ”´ å±éšªï¼šè¨˜æ†¶é«”ä½¿ç”¨é‡éé«˜ ${usageMB}MBï¼ŒåŸ·è¡Œç·Šæ€¥æ¸…ç†');
      _performEmergencyCleanup();
    } else if (usageMB > _warningThresholdMB) {
      debugPrint('ğŸŸ¡ è­¦å‘Šï¼šè¨˜æ†¶é«”ä½¿ç”¨é‡è¼ƒé«˜ ${usageMB}MBï¼ŒåŸ·è¡Œä¸€èˆ¬æ¸…ç†');
      _performRegularCleanup();
    }
  }

  /// å–å¾—ç›®å‰è¨˜æ†¶é«”ä½¿ç”¨é‡ï¼ˆMBï¼‰
  static int _getCurrentMemoryUsageMB() {
    try {
      return (ProcessInfo.currentRss ~/ 1024 ~/ 1024);
    } catch (e) {
      return 0;
    }
  }

  /// åŸ·è¡Œä¸€èˆ¬æ¸…ç†
  static void _performRegularCleanup() {
    WidgetCache.clearExpiredCache();
    // å…¶ä»–è¼•é‡ç´šæ¸…ç†æ“ä½œ
  }

  /// åŸ·è¡Œç·Šæ€¥æ¸…ç†
  static void _performEmergencyCleanup() {
    WidgetCache.clearAllCache();
    ImagePreloader.clearPreloadedImages();
    
    // å¼·åˆ¶åƒåœ¾å›æ”¶ï¼ˆAndroid/iOSå¹³å°æœƒè‡ªå‹•è™•ç†ï¼Œé€™è£¡ä¸»è¦ç”¨æ–¼æé†’ï¼‰
    if (Platform.isAndroid || Platform.isIOS) {
      // ç§»é™¤ä¸éœ€è¦çš„å¼•ç”¨
      _memoryUsageHistory.clear();
    }
  }

  /// å–å¾—è¨˜æ†¶é«”ä½¿ç”¨çµ±è¨ˆ
  static Map<String, dynamic> getMemoryStats() {
    if (_memoryUsageHistory.isEmpty) return {};

    final currentUsage = _memoryUsageHistory.last;
    final averageUsage = _memoryUsageHistory.reduce((a, b) => a + b) / _memoryUsageHistory.length;
    final maxUsage = _memoryUsageHistory.reduce(math.max);
    final minUsage = _memoryUsageHistory.reduce(math.min);

    return {
      'current_mb': currentUsage,
      'average_mb': averageUsage.round(),
      'max_mb': maxUsage,
      'min_mb': minUsage,
      'samples': _memoryUsageHistory.length,
      'cache_stats': WidgetCache.getCacheStats(),
    };
  }
}
```

---

## 10.0 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼ˆ8701è¦ç¯„è©³ç´°éŒ¯èª¤è™•ç†ï¼‰

### 10.1 çµ±ä¸€éŒ¯èª¤è™•ç†
```dart
/**
 * æ­¡è¿é é¢éŒ¯èª¤è™•ç†å™¨
 * @version 2025-08-06-V2.1.0
 * @date 2025-08-06 14:30:00
 * @description æ ¹æ“š8701è¦ç¯„çš„å…·é«”éŒ¯èª¤æƒ…å¢ƒé€²è¡Œè©³ç´°è™•ç†
 */
class WelcomeErrorHandler {
  
  /// è™•ç†åˆå§‹åŒ–éŒ¯èª¤ï¼ˆ8701è¦ç¯„ï¼‰
  static String handleInitializationError(dynamic error) {
    if (error is DioError) {
      return _handleNetworkError(error);
    }
    
    if (error.toString().contains('Firebase')) {
      return 'è³‡æ–™åº«é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';
    }
    
    if (error.toString().contains('Permission')) {
      return 'æ‡‰ç”¨ç¨‹å¼æ¬Šé™ä¸è¶³ï¼Œè«‹é‡æ–°å®‰è£æ‡‰ç”¨ç¨‹å¼';
    }
    
    return 'æ‡‰ç”¨ç¨‹å¼åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹é‡æ–°å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼';
  }

  /// è™•ç†æ¨¡å¼é¸æ“‡éŒ¯èª¤ï¼ˆ8701è¦ç¯„ï¼‰
  static String handleModeSelectionError(dynamic error) {
    if (error is DioError) {
      switch (error.response?.statusCode) {
        case 400:
          return 'æ¨¡å¼è¨­å®šåƒæ•¸éŒ¯èª¤ï¼Œè«‹é‡æ–°é¸æ“‡';
        case 409:
          return 'æ¨¡å¼è¨­å®šè¡çªï¼Œè«‹ç¨å¾Œé‡è©¦';
        case 429:
          return 'æ“ä½œéæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œé‡è©¦';
        default:
          return _handleNetworkError(error);
      }
    }
    
    if (error.toString().contains('validation')) {
      return 'è«‹é¸æ“‡ä¸€å€‹æœ‰æ•ˆçš„ä½¿ç”¨æ¨¡å¼';
    }
    
    if (error.toString().contains('timeout')) {
      return 'æ¨¡å¼è¨­å®šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';
    }
    
    return 'æ¨¡å¼è¨­å®šå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦';
  }

  /// è™•ç†ç¶²è·¯éŒ¯èª¤ï¼ˆ8701è¦ç¯„ï¼‰
  static String _handleNetworkError(DioError error) {
    switch (error.type) {
      case DioErrorType.connectTimeout:
        return 'é€£ç·šé€¾æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯è¨­å®š';
      case DioErrorType.receiveTimeout:
        return 'ä¼ºæœå™¨å›æ‡‰é€¾æ™‚ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case DioErrorType.sendTimeout:
        return 'å‚³é€è³‡æ–™é€¾æ™‚ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case DioErrorType.response:
        return _handleHttpStatusError(error.response?.statusCode);
      case DioErrorType.cancel:
        return 'æ“ä½œå·²å–æ¶ˆ';
      case DioErrorType.other:
        if (error.message.contains('SocketException')) {
          return 'ç¶²è·¯é€£ç·šä¸ç©©å®šï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹';
        }
        return 'ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œé‡è©¦';
      default:
        return 'æœªçŸ¥ç¶²è·¯éŒ¯èª¤';
    }
  }

  /// è™•ç†HTTPç‹€æ…‹ç¢¼éŒ¯èª¤ï¼ˆ8701è¦ç¯„ï¼‰
  static String _handleHttpStatusError(int? statusCode) {
    switch (statusCode) {
      case 400:
        return 'è«‹æ±‚æ ¼å¼éŒ¯èª¤ï¼Œè«‹é‡è©¦';
      case 401:
        return 'èªè­‰å¤±æ•ˆï¼Œè«‹é‡æ–°ç™»å…¥';
      case 403:
        return 'å­˜å–æ¬Šé™ä¸è¶³ï¼Œè«‹è¯ç¹«å®¢æœ';
      case 404:
        return 'æœå‹™æš«æ™‚ç„¡æ³•ä½¿ç”¨ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case 409:
        return 'è³‡æ–™è¡çªï¼Œè«‹é‡æ–°æ“ä½œ';
      case 429:
        return 'æ“ä½œéæ–¼é »ç¹ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case 500:
        return 'ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case 502:
        return 'æœå‹™æš«æ™‚ç„¡æ³•å›æ‡‰ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case 503:
        return 'æœå‹™ç¶­è­·ä¸­ï¼Œè«‹ç¨å¾Œé‡è©¦';
      case 504:
        return 'ä¼ºæœå™¨è™•ç†é€¾æ™‚ï¼Œè«‹ç¨å¾Œé‡è©¦';
      default:
        return 'ä¼ºæœå™¨éŒ¯èª¤ (HTTP $statusCode)ï¼Œè«‹ç¨å¾Œé‡è©¦';
    }
  }

  /// è™•ç†å¸³è™Ÿåˆªé™¤ç›¸é—œéŒ¯èª¤ï¼ˆ8701è¦ç¯„ï¼‰
  static String handleAccountDeletionError(Map<String, dynamic>? deletionInfo) {
    if (deletionInfo == null) {
      return 'å¸³è™Ÿç‹€æ…‹æª¢æŸ¥å¤±æ•—ï¼Œè«‹è¯ç¹«å®¢æœ';
    }
    
    final scheduledDate = deletionInfo['scheduledDate'] ?? 'æœªçŸ¥';
    final reason = deletionInfo['reason'] ?? 'ä½¿ç”¨è€…ç”³è«‹';
    
    return 'æ‚¨çš„å¸³è™Ÿå°‡æ–¼ $scheduledDate è¢«åˆªé™¤\nåˆªé™¤åŸå› ï¼š$reason\nå¦‚éœ€å–æ¶ˆåˆªé™¤ï¼Œè«‹ç«‹å³è¯ç¹«å®¢æœ';
  }

  /// è™•ç†é©—è­‰éŒ¯èª¤ï¼ˆ8701è¦ç¯„ï¼‰
  static String handleValidationError(String field, dynamic value) {
    switch (field) {
      case 'mode':
        if (value == null) {
          return 'è«‹é¸æ“‡ä¸€å€‹ä½¿ç”¨æ¨¡å¼';
        }
        return 'é¸æ“‡çš„æ¨¡å¼ç„¡æ•ˆï¼Œè«‹é‡æ–°é¸æ“‡';
      case 'device_info':
        return 'è£ç½®è³‡è¨Šå–å¾—å¤±æ•—ï¼Œè«‹é‡æ–°å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼';
      case 'network_state':
        return 'ç¶²è·¯ç‹€æ…‹ç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·š';
      default:
        return 'è¼¸å…¥é©—è­‰å¤±æ•—ï¼Œè«‹æª¢æŸ¥è¼¸å…¥å…§å®¹';
    }
  }

  /// é¡¯ç¤ºéŒ¯èª¤å°è©±æ¡†ï¼ˆ8701è¦ç¯„ï¼‰
  static Future<void> showErrorDialog(
    BuildContext context, 
    String message, 
    WelcomeErrorType errorType,
    {VoidCallback? onRetry, VoidCallback? onDismiss}
  ) async {
    final errorTitle = _getErrorTitle(errorType);
    final showRetryButton = _shouldShowRetryButton(errorType);
    
    return showDialog<void>(
      context: context,
      barrierDismissible: false,
      builder: (context) => AccessibilityWrapper.wrapErrorDialog(
        AlertDialog(
          title: Text(errorTitle),
          content: SingleChildScrollView(
            child: Text(
              message,
              style: TextStyle(
                fontSize: HighContrastTheme.getScaledFontSize(context, 14),
              ),
            ),
          ),
          actions: [
            if (showRetryButton && onRetry != null)
              TextButton(
                onPressed: () {
                  Navigator.of(context).pop();
                  onRetry();
                },
                child: const Text('é‡è©¦'),
              ),
            TextButton(
              onPressed: () {
                Navigator.of(context).pop();
                onDismiss?.call();
              },
              child: const Text('ç¢ºå®š'),
            ),
          ],
        ),
        message,
        errorType,
      ),
    );
  }

  /// å–å¾—éŒ¯èª¤æ¨™é¡Œ
  static String _getErrorTitle(WelcomeErrorType errorType) {
    switch (errorType) {
      case WelcomeErrorType.networkConnection:
        return 'ç¶²è·¯é€£ç·šéŒ¯èª¤';
      case WelcomeErrorType.modeSelection:
        return 'æ¨¡å¼è¨­å®šéŒ¯èª¤';
      case WelcomeErrorType.initialization:
        return 'åˆå§‹åŒ–éŒ¯èª¤';
      case WelcomeErrorType.accountDeletion:
        return 'å¸³è™Ÿç‹€æ…‹é€šçŸ¥';
      case WelcomeErrorType.validation:
        return 'è¼¸å…¥éŒ¯èª¤';
      case WelcomeErrorType.unknown:
      default:
        return 'ç³»çµ±éŒ¯èª¤';
    }
  }

  /// åˆ¤æ–·æ˜¯å¦æ‡‰é¡¯ç¤ºé‡è©¦æŒ‰éˆ•
  static bool _shouldShowRetryButton(WelcomeErrorType errorType) {
    switch (errorType) {
      case WelcomeErrorType.networkConnection:
      case WelcomeErrorType.modeSelection:
      case WelcomeErrorType.initialization:
        return true;
      case WelcomeErrorType.accountDeletion:
      case WelcomeErrorType.validation:
      case WelcomeErrorType.unknown:
      default:
        return false;
    }
  }
}
```

### 10.2 éŒ¯èª¤å¾©åŸæ©Ÿåˆ¶ï¼ˆ8701è¦ç¯„ï¼‰
```dart
/// éŒ¯èª¤å¾©åŸç­–ç•¥
class ErrorRecovery {
  
  /// è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ï¼ˆæŒ‡æ•¸é€€é¿ï¼‰
  static Future<T> retryWithBackoff<T>(
    Future<T> Function() operation, {
    int maxRetries = 3,
    Duration initialDelay = const Duration(seconds: 1),
    double backoffMultiplier = 2.0,
    Duration maxDelay = const Duration(seconds: 30),
  }) async {
    Exception? lastException;
    
    for (int attempt = 0; attempt < maxRetries; attempt++) {
      try {
        return await operation();
      } catch (e) {
        lastException = e is Exception ? e : Exception(e.toString());
        
        if (attempt < maxRetries - 1) {
          final delay = _calculateDelay(
            initialDelay, 
            attempt, 
            backoffMultiplier, 
            maxDelay
          );
          
          debugPrint('é‡è©¦ ${attempt + 1}/$maxRetries å¤±æ•—ï¼Œ${delay.inSeconds}ç§’å¾Œé‡è©¦: $e');
          await Future.delayed(delay);
        }
      }
    }
    
    throw lastException!;
  }

  /// è¨ˆç®—é€€é¿å»¶é²æ™‚é–“
  static Duration _calculateDelay(
    Duration initialDelay,
    int attempt,
    double multiplier,
    Duration maxDelay,
  ) {
    final delayMs = (initialDelay.inMilliseconds * math.pow(multiplier, attempt)).round();
    return Duration(milliseconds: math.min(delayMs, maxDelay.inMilliseconds));
  }

  /// æ™ºæ…§é‡è©¦ï¼ˆæ ¹æ“šéŒ¯èª¤é¡å‹æ±ºå®šæ˜¯å¦é‡è©¦ï¼‰
  static Future<T> smartRetry<T>(
    Future<T> Function() operation,
    bool Function(dynamic error) shouldRetry, {
    int maxRetries = 3,
  }) async {
    Exception? lastException;
    
    for (int attempt = 0; attempt < maxRetries; attempt++) {
      try {
        return await operation();
      } catch (e) {
        lastException = e is Exception ? e : Exception(e.toString());
        
        if (attempt < maxRetries - 1 && shouldRetry(e)) {
          final delay = Duration(seconds: (attempt + 1) * 2);
          debugPrint('æ™ºæ…§é‡è©¦ ${attempt + 1}/$maxRetriesï¼Œå»¶é²${delay.inSeconds}ç§’: $e');
          await Future.delayed(delay);
        } else {
          break; // ä¸æ‡‰é‡è©¦æˆ–å·²é”æœ€å¤§é‡è©¦æ¬¡æ•¸
        }
      }
    }
    
    throw lastException!;
  }

  /// åˆ¤æ–·æ˜¯å¦æ‡‰è©²é‡è©¦
  static bool shouldRetryForError(dynamic error) {
    if (error is DioError) {
      switch (error.type) {
        case DioErrorType.connectTimeout:
        case DioErrorType.receiveTimeout:
        case DioErrorType.sendTimeout:
          return true; // ç¶²è·¯é€¾æ™‚æ‡‰é‡è©¦
        case DioErrorType.response:
          final statusCode = error.response?.statusCode;
          return statusCode != null && (
            statusCode >= 500 || // ä¼ºæœå™¨éŒ¯èª¤
            statusCode == 408 || // è«‹æ±‚é€¾æ™‚
            statusCode == 429    // è«‹æ±‚éæ–¼é »ç¹
          );
        case DioErrorType.other:
          return error.message.contains('SocketException'); // ç¶²è·¯é€£ç·šå•é¡Œ
        default:
          return false;
      }
    }
    
    // å…¶ä»–é¡å‹éŒ¯èª¤çš„é‡è©¦åˆ¤æ–·
    final errorStr = error.toString().toLowerCase();
    return errorStr.contains('timeout') || 
           errorStr.contains('connection') ||
           errorStr.contains('network');
  }

  /// é›¢ç·šæ¨¡å¼è™•ç†
  static Widget buildOfflineWidget({
    VoidCallback? onRetry,
    String? message,
  }) {
    return Container(
      padding: const EdgeInsets.all(24),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          const Icon(
            Icons.wifi_off,
            size: 64,
            color: Colors.grey,
          ),
          const SizedBox(height: 24),
          Text(
            message ?? 'ç›®å‰è™•æ–¼é›¢ç·šç‹€æ…‹',
            style: const TextStyle(
              fontSize: 18, 
              color: Colors.grey,
              fontWeight: FontWeight.w500,
            ),
            textAlign: TextAlign.center,
          ),
          const SizedBox(height: 12),
          const Text(
            'è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡è©¦',
            style: TextStyle(
              fontSize: 14,
              color: Colors.grey,
            ),
            textAlign: TextAlign.center,
          ),
          if (onRetry != null) ...[
            const SizedBox(height: 24),
            ElevatedButton.icon(
              onPressed: onRetry,
              icon: const Icon(Icons.refresh),
              label: const Text('é‡è©¦'),
              style: ElevatedButton.styleFrom(
                padding: const EdgeInsets.symmetric(
                  horizontal: 32,
                  vertical: 16,
                ),
              ),
            ),
          ],
        ],
      ),
    );
  }

  /// éŒ¯èª¤é‚Šç•ŒWidget
  static Widget buildErrorBoundary({
    required Widget child,
    Widget Function(String error)? errorBuilder,
  }) {
    return Builder(
      builder: (context) {
        try {
          return child;
        } catch (e) {
          if (errorBuilder != null) {
            return errorBuilder(e.toString());
          }
          
          return Container(
            padding: const EdgeInsets.all(16),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                const Icon(
                  Icons.error_outline,
                  size: 48,
                  color: Colors.red,
                ),
                const SizedBox(height: 16),
                const Text(
                  'ä»‹é¢è¼‰å…¥å¤±æ•—',
                  style: TextStyle(
                    fontSize: 16,
                    fontWeight: FontWeight.w500,
                  ),
                ),
                const SizedBox(height: 8),
                Text(
                  e.toString(),
                  style: const TextStyle(fontSize: 12),
                  textAlign: TextAlign.center,
                ),
              ],
            ),
          );
        }
      },
    );
  }
}
```

---

## æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| **v2.1.0** | **2025-08-06 14:30:00 +08:00** | **LCAS SA Team** | **ä¿®æ­£èˆ‡è¦ç¯„æ–‡ä»¶é•èƒŒï¼š1.çµ±ä¸€æ¡ç”¨0015è¦ç¯„çš„å››æ¨¡å¼ä¸­æ–‡å‘½åï¼ˆç²¾æº–æ§åˆ¶è€…/ç´€éŒ„ç¿’æ…£è€…/è½‰å‹æŒ‘æˆ°è€…/æ½›åœ¨è¦ºé†’è€…ï¼‰2.ä¿®æ­£APIç«¯é»å°æ‡‰ï¼Œå°‡æ¨¡å¼é¸æ“‡æ”¹ç‚ºF009ä½¿ç”¨è€…è¨­å®šç®¡ç†çš„å­åŠŸèƒ½ 3.å®Œæ•´å¯¦ä½œ9005è¦ç¯„çš„è‰²å½©ç³»çµ±ã€éŸ¿æ‡‰å¼è¨­è¨ˆã€UIå…ƒä»¶è¦æ ¼ã€WCAG 2.1 AAç„¡éšœç¤™æ¨™æº– 4.è£œå…¨8701è¦ç¯„çš„é¦–æ¬¡å•Ÿå‹•/å†æ¬¡å•Ÿå‹•æµç¨‹ã€å®Œæ•´ç‹€æ…‹ç®¡ç†ã€F004+F009 APIæ•´åˆã€è©³ç´°éŒ¯èª¤è™•ç†æ©Ÿåˆ¶** |
| v2.0.0 | 2025-08-06 12:00:00 +08:00 | LCAS SA Team | é‡å¤§ç‰ˆæœ¬å‡ç´šï¼šå®Œå…¨é‡æ§‹ç‚ºæŠ€è¡“è¨­è¨ˆæ–‡ä»¶ï¼Œåƒç…§5005æ–‡ä»¶æ ¼å¼ï¼ŒåŒ…å«å®Œæ•´çš„Widgetæ¶æ§‹è¨­è¨ˆã€ç‹€æ…‹ç®¡ç†ã€APIæ•´åˆã€éŸ¿æ‡‰å¼è¨­è¨ˆã€ç„¡éšœç¤™æ”¯æ´ã€æ•ˆèƒ½æœ€ä½³åŒ–åŠéŒ¯èª¤è™•ç†æ©Ÿåˆ¶ |

---

## å‚™è¨»

- **è¦ç¯„å°é½Šå®Œæˆ**ï¼šè§£æ±ºèˆ‡0015ã€9005ã€8701æ–‡ä»¶çš„æ‰€æœ‰é•èƒŒå•é¡Œ
- **å››æ¨¡å¼å‘½åçµ±ä¸€**ï¼šæ¡ç”¨0015è¦ç¯„çš„ä¸­æ–‡å‘½åç³»çµ±
- **APIæ•´åˆä¿®æ­£**ï¼šæ¨¡å¼é¸æ“‡åŠŸèƒ½æ­£ç¢ºå°æ‡‰F009ä½¿ç”¨è€…è¨­å®šç®¡ç†
- **å®Œæ•´éŸ¿æ‡‰å¼å¯¦ä½œ**ï¼šéµå¾ª9005è¦ç¯„çš„æ–·é»ã€ä½ˆå±€ã€å­—å‹ç¸®æ”¾ç³»çµ±
- **WCAG 2.1 AAæ¨™æº–**ï¼šå®Œæ•´ç„¡éšœç¤™åŠŸèƒ½å¯¦ä½œï¼ŒåŒ…å«èªæ„åŒ–ã€å°æ¯”åº¦ã€è§¸æ§ç›®æ¨™
- **8701åŠŸèƒ½æµç¨‹å®Œæ•´å¯¦ä½œ**ï¼šæ”¯æ´é¦–æ¬¡/å†æ¬¡å•Ÿå‹•ã€å®Œæ•´ç‹€æ…‹ç®¡ç†ã€è©³ç´°éŒ¯èª¤è™•ç†
- **æ•ˆèƒ½æœ€ä½³åŒ–**ï¼šWidgetå¿«å–ã€åœ–ç‰‡é è¼‰ã€è¨˜æ†¶é«”ç›£æ§
- **éŒ¯èª¤è™•ç†æ©Ÿåˆ¶**ï¼šæ ¹æ“š8701è¦ç¯„å¯¦ä½œè©³ç´°çš„éŒ¯èª¤åˆ†é¡èˆ‡è™•ç†ç­–ç•¥

