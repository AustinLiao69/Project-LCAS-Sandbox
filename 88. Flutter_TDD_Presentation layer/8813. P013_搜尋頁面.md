
# 8813. TDD_P013_æœå°‹é é¢_v1.0.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: P013 æœå°‹é é¢æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v1.0.0
- **å‰µå»ºæ—¥æœŸ**: 2025-01-26 18:00:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-01-26 18:00:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: P013_æœå°‹é é¢_SRS.md
- **å°æ‡‰PRDæ–‡ä»¶**: 9005. Flutter_Presentation layer.md
- **é é¢ä»£ç¢¼**: P013 (Search Page)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æŠ€è¡“æ¶æ§‹æ¦‚è¿°](#10-æŠ€è¡“æ¶æ§‹æ¦‚è¿°)
2. [Widgetæ¸…å–®](#20-widgetæ¸…å–®)
3. [æ ¸å¿ƒWidgetè¨­è¨ˆ](#30-æ ¸å¿ƒwidgetè¨­è¨ˆ)
4. [ç‹€æ…‹ç®¡ç†æ¶æ§‹](#40-ç‹€æ…‹ç®¡ç†æ¶æ§‹)
5. [APIæ•´åˆè¨­è¨ˆ](#50-apiæ•´åˆè¨­è¨ˆ)
6. [å°èˆªè·¯ç”±è¨­è¨ˆ](#60-å°èˆªè·¯ç”±è¨­è¨ˆ)
7. [éŸ¿æ‡‰å¼è¨­è¨ˆ](#70-éŸ¿æ‡‰å¼è¨­è¨ˆ)
8. [ç„¡éšœç¤™åŠŸèƒ½](#80-ç„¡éšœç¤™åŠŸèƒ½)
9. [æ•ˆèƒ½æœ€ä½³åŒ–](#90-æ•ˆèƒ½æœ€ä½³åŒ–)
10. [éŒ¯èª¤è™•ç†æ©Ÿåˆ¶](#100-éŒ¯èª¤è™•ç†æ©Ÿåˆ¶)

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
P013æœå°‹é é¢ä½œç‚ºLCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„æ ¸å¿ƒæŸ¥è©¢åŠŸèƒ½ï¼Œæä¾›å¼·å¤§çš„è¨˜å¸³è¨˜éŒ„æœå°‹èƒ½åŠ›ï¼Œæ”¯æ´å¤šç¶­åº¦æ¢ä»¶æœå°‹ã€æ™ºèƒ½ç¯©é¸ã€æ­·å²æœå°‹è¨˜éŒ„ï¼Œä»¥åŠæœå°‹çµæœçš„åˆ†æèˆ‡åŒ¯å‡ºåŠŸèƒ½ã€‚æœ¬é é¢æ¡ç”¨Clean Architectureè¨­è¨ˆï¼Œç¢ºä¿æœå°‹æ•ˆèƒ½èˆ‡ä½¿ç”¨è€…é«”é©—çš„å¹³è¡¡ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**: Flutter 3.x
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **è·¯ç”±ç®¡ç†**: GoRouter
- **HTTPå®¢æˆ¶ç«¯**: Dio
- **æœ¬åœ°å„²å­˜**: SharedPreferences + FlutterSecureStorage
- **æœå°‹å¼•æ“**: è‡ªè¨‚æœå°‹é‚è¼¯ + FirestoreæŸ¥è©¢
- **å¿«å–ç®¡ç†**: flutter_cache_manager
- **åˆ†é è¼‰å…¥**: infinite_scroll_pagination
- **è³‡æ–™å¯è¦–åŒ–**: fl_chart

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * P013_æœå°‹é é¢_1.0.0
 * @module P013æœå°‹é é¢
 * @description Flutter Presentation Layeræœå°‹æŸ¥è©¢é é¢ - å¤šç¶­åº¦æœå°‹ã€æ™ºèƒ½ç¯©é¸ã€å››æ¨¡å¼å·®ç•°åŒ–
 * @update 2025-01-26: å‡ç´šè‡³v1.0ç‰ˆæœ¬ï¼Œæ–°å¢å®Œæ•´æœå°‹åŠŸèƒ½è¨­è¨ˆï¼Œæ”¯æ´é—œéµå­—æœå°‹ã€é€²éšç¯©é¸ã€æœå°‹æ­·å²
 */
```

---

## 2.0 Widgetæ¸…å–®

### 2.1 å®Œæ•´Widgetç´¢å¼•è¡¨

| # | Widgetåç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾çµ„ä»¶ |
|---|------------|------|----------|----------|----------|
| 01 | SearchPage | V1.0.0 | é é¢å®¹å™¨å±¤ | ä¸»æœå°‹é é¢å®¹å™¨åŠç”Ÿå‘½é€±æœŸç®¡ç† | SearchProviderã€Router |
| 02 | SearchScaffold | V1.0.0 | ä½ˆå±€çµæ§‹å±¤ | åŸºç¤é é¢çµæ§‹èˆ‡èƒŒæ™¯è¨­å®š | AppBarã€Body |
| 03 | SearchAppBar | V1.0.0 | å°èˆªæ¬„å±¤ | æœå°‹é é¢å°ˆç”¨å°èˆªæ¬„ | BackButtonã€SearchTitle |
| 04 | SearchInputSection | V1.0.0 | æœå°‹è¼¸å…¥å±¤ | æœå°‹æ¡†èˆ‡å¿«æ·æ“ä½œå€åŸŸ | SearchFieldã€FilterToggleã€VoiceSearch |
| 05 | SearchField | V1.0.0 | ä¸»è¦è¼¸å…¥å±¤ | ä¸»æœå°‹è¼¸å…¥æ¡†èˆ‡è‡ªå‹•å®Œæˆ | TextFormFieldã€AutoComplete |
| 06 | SearchSuggestions | V1.0.0 | å»ºè­°æç¤ºå±¤ | æœå°‹å»ºè­°èˆ‡è‡ªå‹•å®Œæˆæ¸…å–® | ListViewã€SuggestionTile |
| 07 | VoiceSearchButton | V1.0.0 | èªéŸ³è¼¸å…¥å±¤ | èªéŸ³æœå°‹æŒ‰éˆ• | IconButtonã€SpeechToText |
| 08 | AdvancedFilterPanel | V1.0.0 | é€²éšç¯©é¸å±¤ | å¯å±•é–‹çš„é€²éšç¯©é¸é¢æ¿ | FilterSectionã€DateRangeFilterã€AmountFilter |
| 09 | DateRangeFilter | V1.0.0 | æ—¥æœŸç¯©é¸å±¤ | æ—¥æœŸç¯„åœé¸æ“‡å™¨ | DateRangePickerã€QuickDateButtons |
| 10 | AmountRangeFilter | V1.0.0 | é‡‘é¡ç¯©é¸å±¤ | é‡‘é¡ç¯„åœæ»‘æ¡¿ | RangeSliderã€AmountInput |
| 11 | CategoryFilter | V1.0.0 | ç§‘ç›®ç¯©é¸å±¤ | ç§‘ç›®å¤šé¸ç¯©é¸å™¨ | CheckboxListTileã€CategoryChips |
| 12 | TagFilter | V1.0.0 | æ¨™ç±¤ç¯©é¸å±¤ | æ¨™ç±¤å¤šé¸ç¯©é¸å™¨ | FilterChipsã€TagSelector |
| 13 | TypeFilter | V1.0.0 | é¡å‹ç¯©é¸å±¤ | æ”¶å…¥/æ”¯å‡º/è½‰å¸³é¡å‹ç¯©é¸ | ToggleButtonsã€RadioGroup |
| 14 | ActiveFiltersBar | V1.0.0 | ç¯©é¸æ¨™ç±¤å±¤ | å·²å•Ÿç”¨ç¯©é¸æ¢ä»¶é¡¯ç¤ºåˆ— | FilterChipsã€ClearAllButton |
| 15 | SearchResultsSection | V1.0.0 | çµæœé¡¯ç¤ºå±¤ | æœå°‹çµæœä¸»è¦å€åŸŸ | ResultsListã€StatisticsCard |
| 16 | SearchResultsList | V1.0.0 | çµæœæ¸…å–®å±¤ | åˆ†é æœå°‹çµæœæ¸…å–® | ListViewã€ResultTileã€LoadMoreButton |
| 17 | ResultTile | V1.0.0 | çµæœé …ç›®å±¤ | å–®å€‹æœå°‹çµæœé …ç›® | EntryTileã€HighlightedText |
| 18 | SearchStatistics | V1.0.0 | çµ±è¨ˆè³‡è¨Šå±¤ | æœå°‹çµæœçµ±è¨ˆæ¦‚è¦½ | StatCardã€PieChart |
| 19 | EmptySearchResults | V1.0.0 | ç©ºç‹€æ…‹å±¤ | ç„¡æœå°‹çµæœæ™‚çš„æç¤º | EmptyStateã€SearchTips |
| 20 | SearchHistorySection | V1.0.0 | æ­·å²è¨˜éŒ„å±¤ | æœå°‹æ­·å²è¨˜éŒ„å€åŸŸ | HistoryListã€HistoryTile |
| 21 | SearchHistoryTile | V1.0.0 | æ­·å²é …ç›®å±¤ | å–®å€‹æœå°‹æ­·å²é …ç›® | ListTileã€DeleteButton |
| 22 | SavedSearchesSection | V1.0.0 | å„²å­˜æœå°‹å±¤ | å¸¸ç”¨æœå°‹æ¢ä»¶å„²å­˜ | SavedSearchListã€SaveSearchButton |
| 23 | QuickFilterButtons | V1.0.0 | å¿«æ·ç¯©é¸å±¤ | å¸¸ç”¨ç¯©é¸æ¢ä»¶å¿«æ·æŒ‰éˆ• | FilterButtonã€PresetFilters |
| 24 | SortOptionsMenu | V1.0.0 | æ’åºé¸é …å±¤ | æœå°‹çµæœæ’åºé¸å–® | PopupMenuButtonã€SortOption |
| 25 | ExportResultsButton | V1.0.0 | åŒ¯å‡ºåŠŸèƒ½å±¤ | æœå°‹çµæœåŒ¯å‡ºæŒ‰éˆ• | IconButtonã€ExportDialog |
| 26 | LoadingOverlay | V1.0.0 | è¼‰å…¥ç‹€æ…‹å±¤ | æœå°‹ä¸­è¼‰å…¥è¦†è“‹å±¤ | CircularProgressIndicatorã€Backdrop |
| 27 | SearchErrorDialog | V1.0.0 | éŒ¯èª¤è™•ç†å±¤ | æœå°‹éŒ¯èª¤å°è©±æ¡† | AlertDialogã€RetryButton |
| 28 | SearchResultsEmpty | V1.0.0 | ç©ºçµæœæç¤ºå±¤ | æœå°‹ç„¡çµæœæ™‚çš„å»ºè­° | Containerã€SuggestedActions |

---

## 3.0 æ ¸å¿ƒWidgetè¨­è¨ˆ

### 3.1 é é¢å®¹å™¨å±¤Widget

#### 3.1.1 SearchPage Widget
```dart
/**
 * 01. å°æ‡‰ 2.1ï¼šä¸»æœå°‹é é¢å®¹å™¨Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹é é¢çš„ä¸»å®¹å™¨ï¼Œæ”¯æ´å¤šç¶­åº¦æœå°‹èˆ‡å››æ¨¡å¼å·®ç•°åŒ–
 */
class SearchPage extends StatefulWidget {
  static const String routeName = '/search';
  final UserMode? userMode;
  final String? initialQuery;
  final Map<String, dynamic>? initialFilters;

  const SearchPage({
    Key? key,
    this.userMode,
    this.initialQuery,
    this.initialFilters,
  });

  @override
  State<SearchPage> createState();
}

/**
 * 02. å°æ‡‰ 2.1ï¼šæœå°‹é é¢ç‹€æ…‹é¡åˆ¥
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description ç®¡ç†æœå°‹é é¢çš„ç‹€æ…‹å’Œå‹•ç•«æ§åˆ¶å™¨
 */
class _SearchPageState extends State<SearchPage> with TickerProviderStateMixin {
  late AnimationController _fadeController;
  late AnimationController _filterController;
  late Animation<double> _fadeAnimation;
  late Animation<double> _filterAnimation;
  late TextEditingController _searchController;
  late FocusNode _searchFocusNode;

  @override
  void initState();

  /**
   * 03. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–å‹•ç•«æ§åˆ¶å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨­å®šé é¢é€²å…¥å‹•ç•«æ•ˆæœ
   */
  void _initializeAnimations();

  /**
   * 04. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–æœå°‹ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description èª¿ç”¨Provideré€²è¡Œæœå°‹é é¢åˆå§‹åŒ–
   */
  Future<void> _initializeSearch();

  @override
  Widget build(BuildContext context);

  @override
  void dispose();
}
```

### 3.2 æœå°‹è¼¸å…¥å±¤Widget

#### 3.2.1 SearchInputSection Widget
```dart
/**
 * 05. å°æ‡‰ 3.1ï¼šæœå°‹è¼¸å…¥å€åŸŸWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æä¾›æœå°‹è¼¸å…¥æ¡†èˆ‡ç›¸é—œæ§åˆ¶å…ƒä»¶ï¼Œæ”¯æ´å››æ¨¡å¼å·®ç•°åŒ–
 */
class SearchInputSection extends StatelessWidget {
  final Animation<double> fadeAnimation;
  final SearchProvider provider;
  final UserMode? userMode;
  final TextEditingController searchController;
  final FocusNode searchFocusNode;

  const SearchInputSection({
    Key? key,
    required this.fadeAnimation,
    required this.provider,
    required this.searchController,
    required this.searchFocusNode,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 06. å°æ‡‰ 3.1ï¼šå–å¾—æ¨¡å¼å°æ‡‰æœå°‹æ¨£å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›å°æ‡‰çš„æœå°‹æ¡†æ¨£å¼
   */
  SearchFieldStyle _getSearchStyleForMode(UserMode? mode);
}
```

#### 3.2.2 SearchField Widget
```dart
/**
 * 07. å°æ‡‰ 3.1.1ï¼šä¸»æœå°‹è¼¸å…¥æ¡†Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æ ¸å¿ƒæœå°‹è¼¸å…¥æ¡†ï¼Œæ”¯æ´è‡ªå‹•å®Œæˆèˆ‡æœå°‹å»ºè­°
 */
class SearchField extends StatefulWidget {
  final TextEditingController controller;
  final FocusNode focusNode;
  final SearchProvider provider;
  final UserMode? userMode;
  final String? hintText;
  final VoidCallback? onClear;

  const SearchField({
    Key? key,
    required this.controller,
    required this.focusNode,
    required this.provider,
    this.userMode,
    this.hintText,
    this.onClear,
  });

  @override
  State<SearchField> createState();
}

class _SearchFieldState extends State<SearchField> {
  Timer? _debounceTimer;
  static const Duration _debounceDelay = Duration(milliseconds: 500);

  @override
  Widget build(BuildContext context);

  /**
   * 08. å°æ‡‰ 3.1.1ï¼šè™•ç†æœå°‹è¼¸å…¥è®ŠåŒ–
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é˜²æŠ–å‹•è™•ç†æœå°‹è¼¸å…¥ä¸¦è§¸ç™¼å»ºè­°
   */
  void _onSearchChanged(String query);

  /**
   * 09. å°æ‡‰ 3.1.1ï¼šåŸ·è¡Œæœå°‹æ“ä½œ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŸ·è¡Œå¯¦éš›çš„æœå°‹æ“ä½œ
   */
  Future<void> _performSearch(String query);

  @override
  void dispose();
}
```

### 3.3 é€²éšç¯©é¸å±¤Widget

#### 3.3.1 AdvancedFilterPanel Widget
```dart
/**
 * 10. å°æ‡‰ 3.2ï¼šé€²éšç¯©é¸é¢æ¿Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å¯å±•é–‹çš„é€²éšç¯©é¸é¢æ¿ï¼Œæ”¯æ´å¤šç¶­åº¦ç¯©é¸æ¢ä»¶
 */
class AdvancedFilterPanel extends StatefulWidget {
  final SearchProvider provider;
  final Animation<double> filterAnimation;
  final UserMode? userMode;
  final VoidCallback? onFiltersChanged;

  const AdvancedFilterPanel({
    Key? key,
    required this.provider,
    required this.filterAnimation,
    this.userMode,
    this.onFiltersChanged,
  });

  @override
  State<AdvancedFilterPanel> createState();
}

class _AdvancedFilterPanelState extends State<AdvancedFilterPanel> {
  @override
  Widget build(BuildContext context);

  /**
   * 11. å°æ‡‰ 3.2ï¼šå–å¾—æ¨¡å¼å¯ç”¨ç¯©é¸å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼è¿”å›å¯ç”¨çš„ç¯©é¸å™¨åˆ—è¡¨
   */
  List<FilterType> _getAvailableFiltersForMode(UserMode? mode);
}
```

#### 3.3.2 DateRangeFilter Widget
```dart
/**
 * 12. å°æ‡‰ 3.2.1ï¼šæ—¥æœŸç¯„åœç¯©é¸å™¨Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æ—¥æœŸç¯„åœé¸æ“‡å™¨ï¼Œæ”¯æ´å¿«æ·æ—¥æœŸé¸é …
 */
class DateRangeFilter extends StatefulWidget {
  final DateRange? initialRange;
  final ValueChanged<DateRange?> onChanged;
  final UserMode? userMode;

  const DateRangeFilter({
    Key? key,
    this.initialRange,
    required this.onChanged,
    this.userMode,
  });

  @override
  State<DateRangeFilter> createState();
}

class _DateRangeFilterState extends State<DateRangeFilter> {
  DateRange? _selectedRange;

  @override
  Widget build(BuildContext context);

  /**
   * 13. å°æ‡‰ 3.2.1ï¼šé¡¯ç¤ºæ—¥æœŸé¸æ“‡å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é¡¯ç¤ºæ—¥æœŸç¯„åœé¸æ“‡å°è©±æ¡†
   */
  Future<void> _showDateRangePicker();

  /**
   * 14. å°æ‡‰ 3.2.1ï¼šè¨­å®šå¿«æ·æ—¥æœŸç¯„åœ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨­å®šé å®šç¾©çš„æ—¥æœŸç¯„åœï¼ˆä»Šå¤©ã€æœ¬é€±ã€æœ¬æœˆç­‰ï¼‰
   */
  void _setQuickDateRange(QuickDateRange range);
}
```

#### 3.3.3 AmountRangeFilter Widget
```dart
/**
 * 15. å°æ‡‰ 3.2.2ï¼šé‡‘é¡ç¯„åœç¯©é¸å™¨Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description é‡‘é¡ç¯„åœæ»‘æ¡¿é¸æ“‡å™¨
 */
class AmountRangeFilter extends StatefulWidget {
  final AmountRange? initialRange;
  final ValueChanged<AmountRange?> onChanged;
  final double minAmount;
  final double maxAmount;

  const AmountRangeFilter({
    Key? key,
    this.initialRange,
    required this.onChanged,
    this.minAmount = 0.0,
    this.maxAmount = 100000.0,
  });

  @override
  State<AmountRangeFilter> createState();
}

class _AmountRangeFilterState extends State<AmountRangeFilter> {
  late RangeValues _currentRangeValues;

  @override
  Widget build(BuildContext context);

  /**
   * 16. å°æ‡‰ 3.2.2ï¼šè™•ç†ç¯„åœè®ŠåŒ–
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†é‡‘é¡ç¯„åœæ»‘æ¡¿è®ŠåŒ–
   */
  void _onRangeChanged(RangeValues values);
}
```

### 3.4 æœå°‹çµæœå±¤Widget

#### 3.4.1 SearchResultsSection Widget
```dart
/**
 * 17. å°æ‡‰ 4.1ï¼šæœå°‹çµæœå€åŸŸWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹çµæœä¸»è¦é¡¯ç¤ºå€åŸŸï¼ŒåŒ…å«çµ±è¨ˆèˆ‡æ¸…å–®
 */
class SearchResultsSection extends StatelessWidget {
  final SearchProvider provider;
  final UserMode? userMode;
  final VoidCallback? onResultTap;

  const SearchResultsSection({
    Key? key,
    required this.provider,
    this.userMode,
    this.onResultTap,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 18. å°æ‡‰ 4.1ï¼šå»ºç«‹çµæœçµ±è¨ˆå¡ç‰‡
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹æœå°‹çµæœçµ±è¨ˆè³‡è¨Šå¡ç‰‡
   */
  Widget _buildStatisticsCard(SearchStatistics statistics);
}
```

#### 3.4.2 SearchResultsList Widget
```dart
/**
 * 19. å°æ‡‰ 4.1.1ï¼šæœå°‹çµæœæ¸…å–®Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description åˆ†é æœå°‹çµæœæ¸…å–®ï¼Œæ”¯æ´ç„¡é™æ»¾å‹•
 */
class SearchResultsList extends StatefulWidget {
  final SearchProvider provider;
  final String searchQuery;
  final VoidCallback? onResultTap;
  final UserMode? userMode;

  const SearchResultsList({
    Key? key,
    required this.provider,
    required this.searchQuery,
    this.onResultTap,
    this.userMode,
  });

  @override
  State<SearchResultsList> createState();
}

class _SearchResultsListState extends State<SearchResultsList> {
  late ScrollController _scrollController;
  static const double _scrollThreshold = 200.0;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 20. å°æ‡‰ 4.1.1ï¼šè™•ç†æ»¾å‹•è¼‰å…¥æ›´å¤š
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æª¢æ¸¬æ»¾å‹•ä½ç½®ä¸¦è¼‰å…¥æ›´å¤šçµæœ
   */
  void _onScroll();

  /**
   * 21. å°æ‡‰ 4.1.1ï¼šè¼‰å…¥æ›´å¤šçµæœ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¼‰å…¥ä¸‹ä¸€é æœå°‹çµæœ
   */
  Future<void> _loadMoreResults();

  @override
  void dispose();
}
```

#### 3.4.3 ResultTile Widget
```dart
/**
 * 22. å°æ‡‰ 4.1.2ï¼šæœå°‹çµæœé …ç›®Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å–®å€‹æœå°‹çµæœé …ç›®ï¼Œæ”¯æ´é—œéµå­—é«˜äº®
 */
class ResultTile extends StatelessWidget {
  final EntryModel entry;
  final String searchQuery;
  final VoidCallback? onTap;
  final UserMode? userMode;

  const ResultTile({
    Key? key,
    required this.entry,
    required this.searchQuery,
    this.onTap,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 23. å°æ‡‰ 4.1.2ï¼šå»ºç«‹é«˜äº®æ–‡å­—
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åœ¨æ–‡å­—ä¸­é«˜äº®æœå°‹é—œéµå­—
   */
  Widget _buildHighlightedText(String text, String query);

  /**
   * 24. å°æ‡‰ 4.1.2ï¼šå–å¾—æ¨¡å¼å°æ‡‰æ¨£å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šæ¨¡å¼é¡å‹è¿”å›å°æ‡‰çš„çµæœé …ç›®æ¨£å¼
   */
  ResultTileStyle _getTileStyleForMode(UserMode? mode);
}
```

### 3.5 æœå°‹æ­·å²å±¤Widget

#### 3.5.1 SearchHistorySection Widget
```dart
/**
 * 25. å°æ‡‰ 5.1ï¼šæœå°‹æ­·å²å€åŸŸWidget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹æ­·å²è¨˜éŒ„å€åŸŸ
 */
class SearchHistorySection extends StatelessWidget {
  final SearchProvider provider;
  final VoidCallback? onHistoryTap;
  final UserMode? userMode;

  const SearchHistorySection({
    Key? key,
    required this.provider,
    this.onHistoryTap,
    this.userMode,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 26. å°æ‡‰ 5.1ï¼šæ¸…é™¤æ‰€æœ‰æ­·å²è¨˜éŒ„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤æ‰€æœ‰æœå°‹æ­·å²è¨˜éŒ„
   */
  Future<void> _clearAllHistory();
}
```

#### 3.5.2 SearchHistoryTile Widget
```dart
/**
 * 27. å°æ‡‰ 5.1.1ï¼šæœå°‹æ­·å²é …ç›®Widget
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å–®å€‹æœå°‹æ­·å²è¨˜éŒ„é …ç›®
 */
class SearchHistoryTile extends StatelessWidget {
  final SearchHistoryItem item;
  final VoidCallback? onTap;
  final VoidCallback? onDelete;

  const SearchHistoryTile({
    Key? key,
    required this.item,
    this.onTap,
    this.onDelete,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 28. å°æ‡‰ 5.1.1ï¼šé¡¯ç¤ºåˆªé™¤ç¢ºèªå°è©±æ¡†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é¡¯ç¤ºåˆªé™¤æ­·å²è¨˜éŒ„ç¢ºèªå°è©±æ¡†
   */
  Future<void> _showDeleteConfirmation(BuildContext context);
}
```

---

## 4.0 ç‹€æ…‹ç®¡ç†æ¶æ§‹

### 4.1 SearchProvider ç‹€æ…‹ç®¡ç†å™¨
```dart
/**
 * 29. å°æ‡‰ 6.1ï¼šæœå°‹é é¢ç‹€æ…‹ç®¡ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description ç®¡ç†æœå°‹é é¢çš„ç‹€æ…‹ï¼Œæ”¯æ´å¤šç¶­åº¦æœå°‹å’Œå››æ¨¡å¼å·®ç•°åŒ–
 */
class SearchProvider extends ChangeNotifier {
  // ç‹€æ…‹å±¬æ€§
  SearchPageState _pageState = SearchPageState.initial;
  String _searchQuery = '';
  SearchFilters _activeFilters = SearchFilters.empty();
  List<EntryModel> _searchResults = [];
  SearchStatistics? _statistics;
  List<SearchHistoryItem> _searchHistory = [];
  List<SavedSearch> _savedSearches = [];
  bool _isLoading = false;
  String? _errorMessage;
  bool _hasMore = true;
  int _currentPage = 1;

  // æœå°‹å»ºè­°
  List<SearchSuggestion> _suggestions = [];
  bool _showSuggestions = false;

  // ç¯©é¸é¢æ¿ç‹€æ…‹
  bool _isFilterPanelExpanded = false;
  UserMode? _userMode;

  // Getters
  SearchPageState get pageState;
  String get searchQuery;
  SearchFilters get activeFilters;
  List<EntryModel> get searchResults;
  SearchStatistics? get statistics;
  List<SearchHistoryItem> get searchHistory;
  List<SavedSearch> get savedSearches;
  bool get isLoading;
  String? get errorMessage;
  bool get hasMore;
  int get currentPage;
  List<SearchSuggestion> get suggestions;
  bool get showSuggestions;
  bool get isFilterPanelExpanded;
  UserMode? get userMode;

  /**
   * 30. å°æ‡‰ 6.1ï¼šåˆå§‹åŒ–æœå°‹é é¢
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åˆå§‹åŒ–æœå°‹é é¢ç‹€æ…‹å’Œè¼‰å…¥æœå°‹æ­·å²
   */
  Future<void> initializeSearch(UserMode? mode, {String? initialQuery, Map<String, dynamic>? initialFilters});

  /**
   * 31. å°æ‡‰ 6.1ï¼šåŸ·è¡Œæœå°‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŸ·è¡Œæœå°‹æ“ä½œä¸¦æ›´æ–°çµæœ
   */
  Future<void> performSearch(String query, {bool clearResults = true});

  /**
   * 32. å°æ‡‰ 6.1ï¼šè¼‰å…¥æ›´å¤šçµæœ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¼‰å…¥ä¸‹ä¸€é æœå°‹çµæœ
   */
  Future<void> loadMoreResults();

  /**
   * 33. å°æ‡‰ 6.1ï¼šæ›´æ–°æœå°‹ç¯©é¸å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ›´æ–°æœå°‹ç¯©é¸æ¢ä»¶ä¸¦é‡æ–°æœå°‹
   */
  Future<void> updateFilters(SearchFilters filters);

  /**
   * 34. å°æ‡‰ 6.1ï¼šå–å¾—æœå°‹å»ºè­°
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šè¼¸å…¥å–å¾—æœå°‹å»ºè­°
   */
  Future<void> getSuggestions(String query);

  /**
   * 35. å°æ‡‰ 6.1ï¼šæ–°å¢åˆ°æœå°‹æ­·å²
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å°‡æœå°‹æ¢ä»¶æ–°å¢åˆ°æ­·å²è¨˜éŒ„
   */
  Future<void> addToSearchHistory(String query, SearchFilters filters);

  /**
   * 36. å°æ‡‰ 6.1ï¼šåˆªé™¤æœå°‹æ­·å²é …ç›®
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åˆªé™¤ç‰¹å®šçš„æœå°‹æ­·å²é …ç›®
   */
  Future<void> deleteSearchHistoryItem(String id);

  /**
   * 37. å°æ‡‰ 6.1ï¼šæ¸…é™¤æ‰€æœ‰æœå°‹æ­·å²
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤æ‰€æœ‰æœå°‹æ­·å²è¨˜éŒ„
   */
  Future<void> clearSearchHistory();

  /**
   * 38. å°æ‡‰ 6.1ï¼šå„²å­˜æœå°‹æ¢ä»¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å„²å­˜ç•¶å‰æœå°‹æ¢ä»¶ç‚ºå¸¸ç”¨æœå°‹
   */
  Future<void> saveCurrentSearch(String name);

  /**
   * 39. å°æ‡‰ 6.1ï¼šè¼‰å…¥å„²å­˜çš„æœå°‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¼‰å…¥ä¸¦åŸ·è¡Œå„²å­˜çš„æœå°‹æ¢ä»¶
   */
  Future<void> loadSavedSearch(String id);

  /**
   * 40. å°æ‡‰ 6.1ï¼šåˆ‡æ›ç¯©é¸é¢æ¿
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å±•é–‹æˆ–æ”¶åˆé€²éšç¯©é¸é¢æ¿
   */
  void toggleFilterPanel();

  /**
   * 41. å°æ‡‰ 6.1ï¼šæ¸…é™¤æ‰€æœ‰ç¯©é¸å™¨
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤æ‰€æœ‰å·²è¨­å®šçš„ç¯©é¸æ¢ä»¶
   */
  Future<void> clearAllFilters();

  /**
   * 42. å°æ‡‰ 6.1ï¼šåŒ¯å‡ºæœå°‹çµæœ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŒ¯å‡ºç•¶å‰æœå°‹çµæœç‚ºæª”æ¡ˆ
   */
  Future<void> exportSearchResults(ExportFormat format);

  /**
   * 43. å°æ‡‰ 6.1ï¼šè¨­å®šè¼‰å…¥ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ›´æ–°è¼‰å…¥ç‹€æ…‹ä¸¦é€šçŸ¥ç›£è½è€…
   */
  void _setLoading(bool loading);

  /**
   * 44. å°æ‡‰ 6.1ï¼šè¨­å®šé é¢ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ›´æ–°é é¢ç‹€æ…‹ä¸¦é€šçŸ¥ç›£è½è€…
   */
  void _setPageState(SearchPageState state);

  /**
   * 45. å°æ‡‰ 6.1ï¼šè¨­å®šéŒ¯èª¤è¨Šæ¯
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨­å®šéŒ¯èª¤è¨Šæ¯ä¸¦æ›´æ–°ç‹€æ…‹
   */
  void _setError(String message);

  /**
   * 46. å°æ‡‰ 6.1ï¼šæ¸…é™¤éŒ¯èª¤ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤éŒ¯èª¤ç‹€æ…‹
   */
  void clearError();
}
```

### 4.2 ç‹€æ…‹æšèˆ‰å®šç¾©
```dart
/**
 * 47. å°æ‡‰ 6.2ï¼šæœå°‹é é¢ç‹€æ…‹æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å®šç¾©æœå°‹é é¢çš„å„ç¨®ç‹€æ…‹
 */
enum SearchPageState {
  initial,        // åˆå§‹ç‹€æ…‹
  searching,      // æœå°‹ä¸­
  results,        // é¡¯ç¤ºçµæœ
  noResults,      // ç„¡æœå°‹çµæœ
  error,          // éŒ¯èª¤ç‹€æ…‹
}

/**
 * 48. å°æ‡‰ 6.2ï¼šæœå°‹å»ºè­°é¡å‹æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹å»ºè­°çš„é¡å‹åˆ†é¡
 */
enum SuggestionType {
  keyword,        // é—œéµå­—å»ºè­°
  category,       // ç§‘ç›®å»ºè­°
  amount,         // é‡‘é¡å»ºè­°
  date,          // æ—¥æœŸå»ºè­°
  history,       // æ­·å²æœå°‹
}

/**
 * 49. å°æ‡‰ 6.2ï¼šåŒ¯å‡ºæ ¼å¼æšèˆ‰
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹çµæœåŒ¯å‡ºæ ¼å¼
 */
enum ExportFormat {
  csv,           // CSVæ ¼å¼
  excel,         // Excelæ ¼å¼
  pdf,           // PDFæ ¼å¼
}
```

---

## 5.0 APIæ•´åˆè¨­è¨ˆ

### 5.1 SearchApiService APIæœå‹™
```dart
/**
 * 50. å°æ‡‰ 7.1ï¼šæœå°‹é é¢APIæœå‹™
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è™•ç†æœå°‹é é¢ç›¸é—œçš„APIèª¿ç”¨ï¼Œæ”¯æ´å¤šç¶­åº¦æœå°‹åŠŸèƒ½
 */
class SearchApiService {
  final ApiClient _apiClient = ApiClient();

  /**
   * 51. å°æ‡‰ 7.1ï¼šåŸ·è¡Œè¨˜å¸³è¨˜éŒ„æœå°‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŸ·è¡Œè¨˜å¸³è¨˜éŒ„æœå°‹APIèª¿ç”¨
   */
  Future<ApiResponse<SearchResultsResponse>> searchEntries(SearchEntriesRequest request);

  /**
   * 52. å°æ‡‰ 7.1ï¼šå–å¾—æœå°‹å»ºè­°
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å–å¾—æœå°‹é—œéµå­—å»ºè­°
   */
  Future<ApiResponse<SuggestionsResponse>> getSuggestions(SuggestionsRequest request);

  /**
   * 53. å°æ‡‰ 7.1ï¼šå–å¾—æœå°‹çµ±è¨ˆ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å–å¾—æœå°‹çµæœçµ±è¨ˆè³‡è¨Š
   */
  Future<ApiResponse<SearchStatisticsResponse>> getSearchStatistics(SearchStatisticsRequest request);

  /**
   * 54. å°æ‡‰ 7.1ï¼šå„²å­˜æœå°‹æ¢ä»¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å„²å­˜å¸¸ç”¨æœå°‹æ¢ä»¶
   */
  Future<ApiResponse<SavedSearchResponse>> saveSearch(SaveSearchRequest request);

  /**
   * 55. å°æ‡‰ 7.1ï¼šå–å¾—å„²å­˜çš„æœå°‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å–å¾—ä½¿ç”¨è€…å„²å­˜çš„æœå°‹æ¢ä»¶æ¸…å–®
   */
  Future<ApiResponse<SavedSearchesResponse>> getSavedSearches();

  /**
   * 56. å°æ‡‰ 7.1ï¼šåŒ¯å‡ºæœå°‹çµæœ
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description åŒ¯å‡ºæœå°‹çµæœç‚ºæª”æ¡ˆ
   */
  Future<ApiResponse<ExportResponse>> exportSearchResults(ExportSearchRequest request);

  /**
   * 57. å°æ‡‰ 7.1ï¼šè™•ç†DioéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†DioéŒ¯èª¤ä¸¦è½‰æ›ç‚ºä½¿ç”¨è€…å‹å–„è¨Šæ¯
   */
  String _handleDioError(DioError error);
}
```

### 5.2 è³‡æ–™æ¨¡å‹å®šç¾©
```dart
/**
 * 58. å°æ‡‰ 7.2ï¼šæœå°‹è«‹æ±‚æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹è¨˜å¸³è¨˜éŒ„è«‹æ±‚è³‡æ–™çµæ§‹
 */
class SearchEntriesRequest {
  final String? keyword;
  final DateTime? startDate;
  final DateTime? endDate;
  final List<String>? entryTypes;
  final List<String>? categoryIds;
  final double? minAmount;
  final double? maxAmount;
  final List<String>? tags;
  final String? ledgerId;
  final int page;
  final int limit;
  final String? sortBy;
  final String? sortOrder;

  SearchEntriesRequest({
    this.keyword,
    this.startDate,
    this.endDate,
    this.entryTypes,
    this.categoryIds,
    this.minAmount,
    this.maxAmount,
    this.tags,
    this.ledgerId,
    this.page = 1,
    this.limit = 20,
    this.sortBy = 'date',
    this.sortOrder = 'desc',
  });

  Map<String, dynamic> toJson();
}

/**
 * 59. å°æ‡‰ 7.2ï¼šæœå°‹çµæœå›æ‡‰æ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹çµæœå›æ‡‰è³‡æ–™çµæ§‹
 */
class SearchResultsResponse {
  final bool success;
  final List<EntryModel> entries;
  final SearchStatistics statistics;
  final PaginationInfo pagination;
  final String message;

  SearchResultsResponse({
    required this.success,
    required this.entries,
    required this.statistics,
    required this.pagination,
    required this.message,
  });

  factory SearchResultsResponse.fromJson(Map<String, dynamic> json);
}

/**
 * 60. å°æ‡‰ 7.2ï¼šæœå°‹çµ±è¨ˆæ¨¡å‹
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æœå°‹çµæœçµ±è¨ˆè³‡æ–™çµæ§‹
 */
class SearchStatistics {
  final int totalCount;
  final double totalAmount;
  final double averageAmount;
  final Map<String, int> categoryBreakdown;
  final Map<String, double> monthlyTrend;

  SearchStatistics({
    required this.totalCount,
    required this.totalAmount,
    required this.averageAmount,
    required this.categoryBreakdown,
    required this.monthlyTrend,
  });

  factory SearchStatistics.fromJson(Map<String, dynamic> json);
}
```

---

## 6.0 å°èˆªè·¯ç”±è¨­è¨ˆ

### 6.1 è·¯ç”±é…ç½®
```dart
/**
 * 61. å°æ‡‰ 8.1ï¼šæœå°‹é é¢è·¯ç”±é…ç½®
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å®šç¾©æœå°‹é é¢çš„è·¯ç”±è¦å‰‡èˆ‡å°èˆªé‚è¼¯
 */
class SearchRoutes {
  static const String search = '/search';
  static const String searchResults = '/search/results';
  static const String savedSearches = '/search/saved';

  /**
   * 62. å°æ‡‰ 8.1ï¼šå–å¾—æœå°‹é é¢è·¯ç”±
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å»ºç«‹æœå°‹é é¢çš„GoRouteé…ç½®
   */
  static GoRoute getSearchRoute();
}

/**
 * 63. å°æ‡‰ 8.1ï¼šæœå°‹å°èˆªæœå‹™
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è™•ç†æœå°‹ç›¸é—œçš„å°èˆªé‚è¼¯
 */
class SearchNavigationService {
  static final GoRouter _router;
  static GoRouter get router;

  /**
   * 64. å°æ‡‰ 8.1ï¼šå°èˆªåˆ°è¨˜å¸³è©³æƒ…
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾æœå°‹çµæœå°èˆªåˆ°è¨˜å¸³è©³æƒ…é é¢
   */
  Future<void> navigateToEntryDetail(String entryId);

  /**
   * 65. å°æ‡‰ 8.1ï¼šå°èˆªåˆ°è¨˜å¸³ç·¨è¼¯
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾æœå°‹çµæœå°èˆªåˆ°è¨˜å¸³ç·¨è¼¯é é¢
   */
  Future<void> navigateToEntryEdit(String entryId);

  /**
   * 66. å°æ‡‰ 8.1ï¼šè¿”å›ä¸Šä¸€é 
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¿”å›åˆ°ä¸Šä¸€å€‹é é¢
   */
  void navigateBack();
}
```

---

## 7.0 éŸ¿æ‡‰å¼è¨­è¨ˆ

### 7.1 éŸ¿æ‡‰å¼è¼”åŠ©å·¥å…·
```dart
/**
 * 67. å°æ‡‰ 9.1ï¼šæœå°‹é é¢éŸ¿æ‡‰å¼è¨­è¨ˆè¼”åŠ©å·¥å…·
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description éµå¾ª9005æ–‡ä»¶çš„éŸ¿æ‡‰å¼è¨­è¨ˆè¦ç¯„ï¼Œæä¾›æœå°‹é é¢å°ˆç”¨çš„ä½ˆå±€ç®¡ç†
 */
class SearchResponsiveHelper {
  final BuildContext context;
  late final MediaQueryData _mediaQuery;
  late final Size _screenSize;

  SearchResponsiveHelper.of(BuildContext context);

  // æ–·é»åˆ¤æ–·å±¬æ€§ï¼ˆ9005è¦ç¯„ï¼‰
  bool get isMobile;
  bool get isTablet;
  bool get isSmallDesktop;
  bool get isLargeDesktop;
  DeviceType get deviceType;

  // æœå°‹é é¢å°ˆç”¨å°ºå¯¸å±¬æ€§
  double get searchFieldHeight;
  EdgeInsets get searchFieldPadding;
  double get filterPanelMaxHeight;
  EdgeInsets get filterItemPadding;
  double get resultTileHeight;
  int get resultsPerPage;

  /**
   * 68. å°æ‡‰ 9.1ï¼šå–å¾—å››æ¨¡å¼æœå°‹æ¡†æ¨£å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼å’Œè£ç½®é¡å‹è¿”å›é©ç•¶æœå°‹æ¡†æ¨£å¼
   */
  SearchFieldStyle getSearchFieldStyleForMode(UserMode? mode);

  /**
   * 69. å°æ‡‰ 9.1ï¼šå–å¾—çµæœæ¸…å–®ä½ˆå±€
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šè£ç½®é¡å‹è¿”å›é©ç•¶çš„çµæœæ¸…å–®ä½ˆå±€
   */
  ResultsLayoutConfig getResultsLayoutConfig();
}
```

---

## 8.0 ç„¡éšœç¤™åŠŸèƒ½

### 8.1 èªæ„åŒ–æ”¯æ´
```dart
/**
 * 70. å°æ‡‰ 10.1ï¼šæœå°‹é é¢ç„¡éšœç¤™èªæ„åŒ–WidgetåŒ…è£å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æä¾›WCAG 2.1 AAæ¨™æº–çš„å®Œæ•´ç„¡éšœç¤™æ”¯æ´ï¼ˆ9005è¦ç¯„ï¼‰
 */
class SearchAccessibilityWrapper {

  /**
   * 71. å°æ‡‰ 10.1ï¼šç‚ºæœå°‹æ¡†æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºæœå°‹è¼¸å…¥æ¡†æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapSearchField(Widget child, String hint, bool hasResults);

  /**
   * 72. å°æ‡‰ 10.1ï¼šç‚ºç¯©é¸å™¨æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºå„ç¨®ç¯©é¸å™¨æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapFilterWidget(Widget child, String filterType, dynamic value);

  /**
   * 73. å°æ‡‰ 10.1ï¼šç‚ºæœå°‹çµæœæä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºæœå°‹çµæœé …ç›®æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapResultTile(Widget child, EntryModel entry, int index, int total);

  /**
   * 74. å°æ‡‰ 10.1ï¼šç‚ºæœå°‹å»ºè­°æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç‚ºæœå°‹å»ºè­°æ¸…å–®æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapSuggestionsList(Widget child, List<SearchSuggestion> suggestions);
}
```

---

## 9.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 9.1 Widgetå¿«å–ç­–ç•¥
```dart
/**
 * 75. å°æ‡‰ 11.1ï¼šæœå°‹é é¢Widgetå¿«å–ç®¡ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å„ªåŒ–æœå°‹é é¢Widgeté‡å»ºæ•ˆèƒ½ï¼Œæ¸›å°‘ä¸å¿…è¦çš„é‡å»º
 */
class SearchWidgetCache {
  static final Map<String, Widget> _cache = {};
  static final Map<String, DateTime> _cacheTimestamps = {};
  static const Duration _cacheValidDuration = Duration(minutes: 5);

  /**
   * 76. å°æ‡‰ 11.1ï¼šå–å¾—å¿«å–çš„ç¯©é¸å™¨é¢æ¿æˆ–å»ºç«‹æ–°çš„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾å¿«å–ä¸­ç²å–ç¯©é¸å™¨é¢æ¿Widgetæˆ–å‰µå»ºæ–°çš„
   */
  static Widget getFilterPanelOrCreate(UserMode? mode, Widget Function() creator);

  /**
   * 77. å°æ‡‰ 11.1ï¼šå–å¾—å¿«å–çš„æœå°‹å»ºè­°æˆ–å»ºç«‹æ–°çš„
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾å¿«å–ä¸­ç²å–æœå°‹å»ºè­°Widgetæˆ–å‰µå»ºæ–°çš„
   */
  static Widget getSuggestionsOrCreate(String query, Widget Function() creator);

  /**
   * 78. å°æ‡‰ 11.1ï¼šæ¸…é™¤æœå°‹é é¢å¿«å–
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤æœå°‹é é¢ç›¸é—œçš„Widgetå¿«å–
   */
  static void clearSearchCache();
}
```

### 9.2 æœå°‹æ•ˆèƒ½å„ªåŒ–
```dart
/**
 * 79. å°æ‡‰ 11.2ï¼šæœå°‹æ•ˆèƒ½å„ªåŒ–å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description å„ªåŒ–æœå°‹æµç¨‹æ•ˆèƒ½ï¼Œæå‡ä½¿ç”¨è€…é«”é©—
 */
class SearchPerformanceOptimizer {
  static final Map<String, Timer> _debounceTimers = {};
  static final Map<String, List<SearchSuggestion>> _suggestionsCache = {};
  static const Duration _debounceDelay = Duration(milliseconds: 500);

  /**
   * 80. å°æ‡‰ 11.2ï¼šé˜²æŠ–å‹•æœå°‹è«‹æ±‚
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é˜²æ­¢ä½¿ç”¨è€…å¿«é€Ÿè¼¸å…¥é€ æˆé‡è¤‡æœå°‹è«‹æ±‚
   */
  static Future<void> debounceSearch(String key, Future<void> Function() searchFunction);

  /**
   * 81. å°æ‡‰ 11.2ï¼šå¿«å–æœå°‹å»ºè­°
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¿«å–æœå°‹å»ºè­°ï¼Œæ¸›å°‘é‡è¤‡APIèª¿ç”¨
   */
  static List<SearchSuggestion>? getCachedSuggestions(String query);

  /**
   * 82. å°æ‡‰ 11.2ï¼šè¨­å®šæœå°‹å»ºè­°å¿«å–
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è¨­å®šæœå°‹å»ºè­°åˆ°å¿«å–
   */
  static void cacheSuggestions(String query, List<SearchSuggestion> suggestions);

  /**
   * 83. å°æ‡‰ 11.2ï¼šå„ªåŒ–æœå°‹çµæœè¼‰å…¥
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å„ªåŒ–æœå°‹çµæœåˆ†é è¼‰å…¥æ•ˆèƒ½
   */
  static void optimizeResultsLoading(ScrollController controller, VoidCallback loadMore);
}
```

---

## 10.0 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

### 10.1 çµ±ä¸€éŒ¯èª¤è™•ç†
```dart
/**
 * 84. å°æ‡‰ 12.1ï¼šæœå°‹é é¢éŒ¯èª¤è™•ç†å™¨
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description è™•ç†æœå°‹é é¢å„ç¨®éŒ¯èª¤æƒ…å¢ƒ
 */
class SearchErrorHandler {

  /**
   * 85. å°æ‡‰ 12.1ï¼šè™•ç†æœå°‹APIéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æœå°‹APIèª¿ç”¨éŒ¯èª¤
   */
  static String handleSearchApiError(dynamic error);

  /**
   * 86. å°æ‡‰ 12.1ï¼šè™•ç†æœå°‹å»ºè­°éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æœå°‹å»ºè­°APIéŒ¯èª¤
   */
  static String handleSuggestionsError(dynamic error);

  /**
   * 87. å°æ‡‰ 12.1ï¼šè™•ç†æœå°‹çµæœè¼‰å…¥éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æœå°‹çµæœåˆ†é è¼‰å…¥éŒ¯èª¤
   */
  static String handleResultsLoadingError(dynamic error);

  /**
   * 88. å°æ‡‰ 12.1ï¼šè™•ç†æœå°‹æ­·å²éŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æœå°‹æ­·å²æ“ä½œéŒ¯èª¤
   */
  static String handleHistoryError(dynamic error);

  /**
   * 89. å°æ‡‰ 12.1ï¼šè™•ç†åŒ¯å‡ºéŒ¯èª¤
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†æœå°‹çµæœåŒ¯å‡ºéŒ¯èª¤
   */
  static String handleExportError(dynamic error);

  /**
   * 90. å°æ‡‰ 12.1ï¼šé¡¯ç¤ºæœå°‹éŒ¯èª¤å°è©±æ¡†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é¡¯ç¤ºæœå°‹éŒ¯èª¤è¨Šæ¯å°è©±æ¡†
   */
  static Future<void> showSearchErrorDialog(
    BuildContext context, 
    String message, 
    SearchErrorType errorType,
    {VoidCallback? onRetry, VoidCallback? onDismiss}
  );

  /**
   * 91. å°æ‡‰ 12.1ï¼šå–å¾—éŒ¯èª¤æ¢å¾©å»ºè­°
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ ¹æ“šéŒ¯èª¤é¡å‹æä¾›æ¢å¾©å»ºè­°
   */
  static List<String> getRecoveryActions(SearchErrorType errorType);
}
```

### 10.2 éŒ¯èª¤å¾©åŸæ©Ÿåˆ¶
```dart
/**
 * 92. å°æ‡‰ 12.2ï¼šæœå°‹éŒ¯èª¤å¾©åŸç­–ç•¥
 * @version 2025-01-26-V1.0.0
 * @date 2025-01-26 18:00:00
 * @description æä¾›æœå°‹å„ç¨®éŒ¯èª¤å¾©åŸæ©Ÿåˆ¶
 */
class SearchErrorRecovery {

  /**
   * 93. å°æ‡‰ 12.2ï¼šè‡ªå‹•é‡è©¦æœå°‹æ©Ÿåˆ¶
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description é‡å°ç¶²è·¯éŒ¯èª¤ç­‰è‡¨æ™‚æ€§å•é¡Œçš„è‡ªå‹•é‡è©¦æ©Ÿåˆ¶
   */
  static Future<T> retrySearch<T>(
    Future<T> Function() searchOperation,
    {int maxRetries = 3, Duration initialDelay = const Duration(seconds: 1)}
  );

  /**
   * 94. å°æ‡‰ 12.2ï¼šæä¾›æ›¿ä»£æœå°‹æ–¹å¼
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description ç•¶æœå°‹å¤±æ•—æ™‚ï¼Œæä¾›æ›¿ä»£æœå°‹æ–¹å¼å»ºè­°
   */
  static List<String> suggestAlternativeSearches(String originalQuery, SearchErrorType errorType);

  /**
   * 95. å°æ‡‰ 12.2ï¼šé›¢ç·šæœå°‹è™•ç†
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description è™•ç†é›¢ç·šç‹€æ…‹çš„æœå°‹ç•Œé¢
   */
  static Widget buildOfflineSearchWidget({
    VoidCallback? onRetry,
    String? message,
  });

  /**
   * 96. å°æ‡‰ 12.2ï¼šæœå°‹å¿«å–æ¢å¾©
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description å¾æœ¬åœ°å¿«å–æ¢å¾©æœå°‹çµæœ
   */
  static Future<List<EntryModel>?> recoverFromCache(String query, SearchFilters filters);

  /**
   * 97. å°æ‡‰ 12.2ï¼šæ¸…é™¤æœå°‹ç‹€æ…‹
   * @version 2025-01-26-V1.0.0
   * @date 2025-01-26 18:00:00
   * @description æ¸…é™¤å¯èƒ½å°è‡´æœå°‹å•é¡Œçš„ç‹€æ…‹
   */
  static Future<void> clearSearchState();
}
```

---

## éµå¾ª0055è¨­è¨ˆåŸå‰‡

### éšå±¤æ¶æ§‹å°æ‡‰
- æœ¬TDDæ–‡ä»¶åŸºæ–¼P013_æœå°‹é é¢_SRS.mdçš„éœ€æ±‚è¦æ ¼
- èˆ‡9005. Flutter_Presentation layer.mdçš„ç”¢å“è¦æ ¼ä¿æŒä¸€è‡´
- æ‰€æœ‰å‡½æ•¸ç¯€é»ç·¨è™Ÿå°æ‡‰ä¸Šå±¤æ–‡ä»¶çš„åŠŸèƒ½æ¢ç›®

### è¨­è¨ˆåŸå‰‡éµå¾ª
1. **éšå±¤æ¶æ§‹é‚è¼¯**: åš´æ ¼åŸºæ–¼SRSæ–‡ä»¶å®šç¾©çš„åŠŸèƒ½æ¢ç›®è¨­è¨ˆ
2. **åŒå±¤ç´šä¾è³´é—œä¿‚**: è€ƒé‡èˆ‡è¨˜å¸³æ­·å²é é¢ã€ç§‘ç›®ç®¡ç†é é¢ã€è¨­å®šé é¢çš„ä¾è³´é—œä¿‚
3. **ä»£ç¢¼ç¯€é»ç·¨è™Ÿ**: æ¡ç”¨ä¸åŠ å‰ç¶´çš„ç¯€é»ç·¨è™Ÿæ ¼å¼ï¼ˆå¦‚2.1ã€3.2ï¼‰
4. **å‘½åä¸€è‡´æ€§**: ä¿æŒèˆ‡ä½¿ç”¨è€…ä»‹é¢æ“ä½œæµç¨‹çš„åç¨±åŒæ­¥
5. **å¯è®€æ€§è¨­è¨ˆ**: æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œéµå¾ªä½è€¦åˆã€é«˜å…§èšåŸå‰‡

## æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| **v1.0.0** | **2025-01-26 18:00:00 +08:00** | **LCAS SA Team** | **åˆç‰ˆå»ºç«‹ï¼šå®Œæ•´P013æœå°‹é é¢TDDè¦æ ¼ï¼Œæ”¯æ´å¤šç¶­åº¦æœå°‹ï¼ˆé—œéµå­—æœå°‹ã€é€²éšç¯©é¸ã€æœå°‹å»ºè­°ã€æœå°‹æ­·å²ã€çµ±è¨ˆåˆ†æã€åŒ¯å‡ºåŠŸèƒ½ï¼‰ï¼Œå¯¦ä½œå››æ¨¡å¼å·®ç•°åŒ–è¨­è¨ˆï¼Œå®Œæ•´éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œéµå¾ª0055è¨­è¨ˆåŸå‰‡ï¼Œå°æ‡‰P013_æœå°‹é é¢_SRSè¦æ ¼** |

---

## å‚™è¨»

- **ç´”å‡½æ•¸å®£å‘Š**: å®Œå…¨ç§»é™¤æ‰€æœ‰å¯¦ä½œä»£ç¢¼ï¼Œåƒ…ä¿ç•™å‡½æ•¸åç¨±ã€åƒæ•¸å®šç¾©å’Œè¨»è§£
- **å¤šç¶­åº¦æœå°‹æ”¯æ´**: æ”¯æ´é—œéµå­—æœå°‹ã€æ—¥æœŸç¯„åœã€é‡‘é¡ç¯„åœã€ç§‘ç›®åˆ†é¡ã€æ¨™ç±¤ç­‰å¤šç¨®æœå°‹æ¢ä»¶
- **å››æ¨¡å¼å·®ç•°åŒ–**: æ ¹æ“šä½¿ç”¨è€…æ¨¡å¼æä¾›ä¸åŒçš„æœå°‹ç•Œé¢è¤‡é›œåº¦å’Œé¸é …
- **æ™ºèƒ½æœå°‹åŠŸèƒ½**: å®Œæ•´çš„è‡ªå‹•å®Œæˆã€æœå°‹å»ºè­°ã€æœå°‹æ­·å²ã€å¸¸ç”¨æœå°‹å„²å­˜æ©Ÿåˆ¶
- **å®Œæ•´æŠ€è¡“æ¶æ§‹**: Widgetåˆ†å±¤ã€ç‹€æ…‹ç®¡ç†ã€APIæ•´åˆã€éŸ¿æ‡‰å¼è¨­è¨ˆã€ç„¡éšœç¤™æ”¯æ´ã€æ•ˆèƒ½æœ€ä½³åŒ–
- **è¦ç¯„å®Œå…¨å°é½Š**: èˆ‡0055ã€P013_æœå°‹é é¢_SRS.mdã€9005æ–‡ä»¶å®Œå…¨ä¸€è‡´
- **ç¯€é»ç·¨è™Ÿæ¨™æº–åŒ–**: çµ±ä¸€ç·¨è™Ÿ01-97ï¼Œéµå¾ª0055è¦ç¯„æ ¼å¼
- **ç‰ˆæœ¬çµ±ä¸€å‡ç´š**: æ‰€æœ‰çµ„ä»¶ç‰ˆæœ¬çµ±ä¸€ç‚ºv1.0.0
- **æœå°‹æ•ˆèƒ½å„ªåŒ–**: é˜²æŠ–å‹•æœå°‹ã€çµæœå¿«å–ã€åˆ†é è¼‰å…¥ã€å»ºè­°å¿«å–ç­‰æ•ˆèƒ½å„ªåŒ–ç­–ç•¥
- **å®Œæ•´éŒ¯èª¤è™•ç†**: æ¶µè“‹æœå°‹APIéŒ¯èª¤ã€ç¶²è·¯éŒ¯èª¤ã€å»ºè­°éŒ¯èª¤ã€æ­·å²éŒ¯èª¤ã€åŒ¯å‡ºéŒ¯èª¤ç­‰å„ç¨®éŒ¯èª¤æƒ…å¢ƒ
