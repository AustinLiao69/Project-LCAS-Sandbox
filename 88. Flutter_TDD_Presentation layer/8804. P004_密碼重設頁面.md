
# 8804. TDD_P004_å¯†ç¢¼é‡è¨­é é¢_v1.0.0

## æ–‡ä»¶è³‡è¨Š
- **æ–‡ä»¶æ¨™é¡Œ**: P004 å¯†ç¢¼é‡è¨­é é¢æŠ€è¡“è¨­è¨ˆæ–‡ä»¶
- **æ–‡ä»¶ç‰ˆæœ¬**: v1.0.0
- **å‰µå»ºæ—¥æœŸ**: 2025-08-06 21:30:00 +08:00 (å°ç£æ™‚é–“)
- **å‰µå»ºè€…**: LCAS SA Team
- **æœ€å¾Œæ›´æ–°**: 2025-08-06 21:30:00 +08:00 (å°ç£æ™‚é–“)
- **å°æ‡‰éœ€æ±‚æ–‡ä»¶**: 8704. å¯†ç¢¼é‡è¨­é é¢_SRS.md
- **å°æ‡‰PRDæ–‡ä»¶**: 9005. Flutter_Presentation layer.md
- **é é¢ä»£ç¢¼**: P004 (Password Reset Page)

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æŠ€è¡“æ¶æ§‹æ¦‚è¿°](#10-æŠ€è¡“æ¶æ§‹æ¦‚è¿°)
2. [Widgetæ¸…å–®](#20-widgetæ¸…å–®)
3. [æ ¸å¿ƒWidgetè¨­è¨ˆ](#30-æ ¸å¿ƒwidgetè¨­è¨ˆ)
4. [ç‹€æ…‹ç®¡ç†æ¶æ§‹](#40-ç‹€æ…‹ç®¡ç†æ¶æ§‹)
5. [APIæ•´åˆè¨­è¨ˆ](#50-apiæ•´åˆè¨­è¨ˆ)
6. [å°èˆªè·¯ç”±è¨­è¨ˆ](#60-å°èˆªè·¯ç”±è¨­è¨ˆ)
7. [éŸ¿æ‡‰å¼è¨­è¨ˆ](#70-éŸ¿æ‡‰å¼è¨­è¨ˆ)
8. [ç„¡éšœç¤™åŠŸèƒ½](#80-ç„¡éšœç¤™åŠŸèƒ½)
9. [æ•ˆèƒ½æœ€ä½³åŒ–](#90-æ•ˆèƒ½æœ€ä½³åŒ–)
10. [éŒ¯èª¤è™•ç†æ©Ÿåˆ¶](#100-éŒ¯èª¤è™•ç†æ©Ÿåˆ¶)

---

## 1.0 æŠ€è¡“æ¶æ§‹æ¦‚è¿°

### 1.1 æ¨¡çµ„å®šä½
P004å¯†ç¢¼é‡è¨­é é¢ä½œç‚ºLCAS 2.0 Flutteræ‡‰ç”¨ç¨‹å¼çš„å¯†ç¢¼æ¢å¾©å…¥å£ï¼Œè² è²¬å®‰å…¨çš„å¯†ç¢¼é‡è¨­æµç¨‹ã€Emailé©—è­‰ã€å¤šæ­¥é©Ÿå¼•å°ã€å®‰å…¨æ€§æ§åˆ¶åŠä½¿ç”¨è€…é«”é©—å„ªåŒ–ã€‚æœ¬é é¢æ¡ç”¨Clean Architectureè¨­è¨ˆï¼Œç¢ºä¿å®‰å…¨æ€§èˆ‡æ˜“ç”¨æ€§ä¸¦é‡ã€‚

### 1.2 æŠ€è¡“å †ç–Š
- **å‰ç«¯æ¡†æ¶**: Flutter 3.x
- **ç‹€æ…‹ç®¡ç†**: Provider + ChangeNotifier
- **è·¯ç”±ç®¡ç†**: GoRouter
- **HTTPå®¢æˆ¶ç«¯**: Dio
- **æœ¬åœ°å„²å­˜**: SharedPreferences + FlutterSecureStorage
- **Emailé©—è­‰**: Emailæœå‹™API
- **è¡¨å–®é©—è­‰**: FormBuilderValidators
- **å®‰å…¨æ€§**: Crypto + Password Validators

### 1.3 æ¨¡çµ„æ¶æ§‹
```dart
/**
 * P004_å¯†ç¢¼é‡è¨­é é¢_1.0.0
 * @module P004å¯†ç¢¼é‡è¨­é é¢
 * @description Flutter Presentation Layerå¯†ç¢¼é‡è¨­é é¢ - å®‰å…¨é‡è¨­ã€Emailé©—è­‰ã€å¤šæ­¥é©Ÿå¼•å°
 * @update 2025-08-06: å‡ç´šè‡³v1.0ç‰ˆæœ¬ï¼Œæ–°å¢å®Œæ•´å¯†ç¢¼é‡è¨­åŠŸèƒ½è¨­è¨ˆï¼Œæ”¯æ´Emailé©—è­‰ã€å®‰å…¨æ€§æª¢æŸ¥ã€åˆ†æ­¥é©Ÿé‡è¨­æµç¨‹
 */
```

---

## 2.0 Widgetæ¸…å–®

### 2.1 å®Œæ•´Widgetç´¢å¼•è¡¨

| # | Widgetåç¨± | ç‰ˆæœ¬ | æ‰€å±¬å±¤ç´š | åŠŸèƒ½æè¿° | ç›¸ä¾çµ„ä»¶ |
|---|------------|------|----------|----------|----------|
| 01 | PasswordResetPage | V1.0.0 | é é¢å®¹å™¨å±¤ | ä¸»å¯†ç¢¼é‡è¨­é é¢å®¹å™¨åŠç”Ÿå‘½é€±æœŸç®¡ç† | PasswordResetProviderã€Router |
| 02 | ResetScaffold | V1.0.0 | ä½ˆå±€çµæ§‹å±¤ | åŸºç¤é é¢çµæ§‹èˆ‡èƒŒæ™¯è¨­å®š | GradientBackground |
| 03 | StepsIndicator | V1.0.0 | é€²åº¦æŒ‡ç¤ºå±¤ | é‡è¨­æ­¥é©Ÿé€²åº¦æŒ‡ç¤ºå™¨ | AnimatedContainer |
| 04 | EmailInputSection | V1.0.0 | Emailè¼¸å…¥å±¤ | Emailåœ°å€è¼¸å…¥èˆ‡é©—è­‰ | EmailInputã€SendCodeButton |
| 05 | EmailInput | V1.0.0 | è¡¨å–®å…ƒä»¶å±¤ | Emailè¼¸å…¥æ¬„ä½èˆ‡æ ¼å¼é©—è­‰ | TextFormFieldã€EmailValidator |
| 06 | SendCodeButton | V1.0.0 | äº’å‹•å…ƒä»¶å±¤ | ç™¼é€é©—è­‰ç¢¼æŒ‰éˆ• | ElevatedButtonã€LoadingIndicator |
| 07 | VerificationSection | V1.0.0 | é©—è­‰ç¢¼å±¤ | é©—è­‰ç¢¼è¼¸å…¥èˆ‡é©—è­‰ | CodeInputWidgetã€ResendButton |
| 08 | CodeInputWidget | V1.0.0 | é©—è­‰ç¢¼è¼¸å…¥å±¤ | 6ä½æ•¸é©—è­‰ç¢¼è¼¸å…¥ä»‹é¢ | TextFormFieldã€InputFormatter |
| 09 | ResendButton | V1.0.0 | è¼”åŠ©åŠŸèƒ½å±¤ | é‡æ–°ç™¼é€é©—è­‰ç¢¼æŒ‰éˆ• | TextButtonã€Timer |
| 10 | PasswordInputSection | V1.0.0 | å¯†ç¢¼è¨­å®šå±¤ | æ–°å¯†ç¢¼è¨­å®šèˆ‡ç¢ºèª | NewPasswordInputã€ConfirmPasswordInput |
| 11 | NewPasswordInput | V1.0.0 | å¯†ç¢¼è¼¸å…¥å±¤ | æ–°å¯†ç¢¼è¼¸å…¥æ¬„ä½èˆ‡å¼·åº¦æª¢æŸ¥ | TextFormFieldã€PasswordStrengthIndicator |
| 12 | ConfirmPasswordInput | V1.0.0 | å¯†ç¢¼ç¢ºèªå±¤ | ç¢ºèªå¯†ç¢¼è¼¸å…¥æ¬„ä½èˆ‡ä¸€è‡´æ€§æª¢æŸ¥ | TextFormFieldã€PasswordValidator |
| 13 | PasswordStrengthIndicator | V1.0.0 | å¯†ç¢¼å¼·åº¦å±¤ | å¯†ç¢¼å¼·åº¦è¦–è¦ºæŒ‡ç¤ºå™¨ | LinearProgressIndicatorã€Text |
| 14 | PasswordRequirements | V1.0.0 | éœ€æ±‚èªªæ˜å±¤ | å¯†ç¢¼è¦æ±‚èªªæ˜æ¸…å–® | CheckboxListTileã€Icon |
| 15 | ResetPasswordButton | V1.0.0 | åŸ·è¡ŒæŒ‰éˆ•å±¤ | åŸ·è¡Œå¯†ç¢¼é‡è¨­æŒ‰éˆ• | ElevatedButtonã€LoadingIndicator |
| 16 | SuccessSection | V1.0.0 | æˆåŠŸé é¢å±¤ | é‡è¨­æˆåŠŸç¢ºèªé é¢ | SuccessIconã€MessageText |
| 17 | SecurityNotice | V1.0.0 | å®‰å…¨æç¤ºå±¤ | å®‰å…¨æ€§æé†’èˆ‡æ³¨æ„äº‹é … | Containerã€Icon |
| 18 | BackToLoginButton | V1.0.0 | å°èˆªæŒ‰éˆ•å±¤ | è¿”å›ç™»å…¥é é¢æŒ‰éˆ• | TextButtonã€Router |
| 19 | LoadingOverlay | V1.0.0 | è¼‰å…¥ç‹€æ…‹å±¤ | è™•ç†ä¸­è¼‰å…¥è¦†è“‹å±¤ | CircularProgressIndicatorã€Backdrop |
| 20 | ErrorDialog | V1.0.0 | éŒ¯èª¤è™•ç†å±¤ | éŒ¯èª¤è¨Šæ¯å°è©±æ¡† | AlertDialogã€TextButton |

---

## 3.0 æ ¸å¿ƒWidgetè¨­è¨ˆ

### 3.1 é é¢å®¹å™¨å±¤Widget

#### 3.1.1 PasswordResetPage Widget
```dart
/**
 * 01. å°æ‡‰ 2.1ï¼šä¸»å¯†ç¢¼é‡è¨­é é¢å®¹å™¨Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å¯†ç¢¼é‡è¨­é é¢çš„ä¸»å®¹å™¨ï¼Œæ”¯æ´å¤šæ­¥é©Ÿé‡è¨­æµç¨‹èˆ‡å®‰å…¨æ€§æ§åˆ¶
 */
class PasswordResetPage extends StatefulWidget {
  static const String routeName = '/password-reset';
  final String? email;

  const PasswordResetPage({Key? key, this.email});

  @override
  State<PasswordResetPage> createState();
}

/**
 * 02. å°æ‡‰ 2.1ï¼šå¯†ç¢¼é‡è¨­é é¢ç‹€æ…‹é¡åˆ¥
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description ç®¡ç†å¯†ç¢¼é‡è¨­é é¢çš„ç‹€æ…‹å’Œæ­¥é©Ÿæ§åˆ¶å™¨
 */
class _PasswordResetPageState extends State<PasswordResetPage> 
    with TickerProviderStateMixin {
  late AnimationController _fadeController;
  late AnimationController _slideController;
  late Animation<double> _fadeAnimation;
  late Animation<Offset> _slideAnimation;

  @override
  void initState();

  /**
   * 03. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–å‹•ç•«æ§åˆ¶å™¨
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è¨­å®šé é¢è½‰å ´å‹•ç•«æ•ˆæœ
   */
  void _initializeAnimations();

  /**
   * 04. å°æ‡‰ 2.1ï¼šåˆå§‹åŒ–é é¢ç‹€æ…‹
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description èª¿ç”¨Provideré€²è¡Œå¯†ç¢¼é‡è¨­é é¢åˆå§‹åŒ–
   */
  Future<void> _initializePage();

  @override
  Widget build(BuildContext context);

  @override
  void dispose();
}
```

### 3.2 ä½ˆå±€çµæ§‹å±¤Widget

#### 3.2.1 ResetScaffold Widget
```dart
/**
 * 05. å°æ‡‰ 2.2ï¼šå¯†ç¢¼é‡è¨­é é¢ä½ˆå±€çµæ§‹Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description æä¾›å¯†ç¢¼é‡è¨­é é¢çš„åŸºç¤ä½ˆå±€çµæ§‹ï¼Œæ”¯æ´å¤šæ­¥é©Ÿé¡¯ç¤º
 */
class ResetScaffold extends StatelessWidget {
  final Animation<double> fadeAnimation;
  final Animation<Offset> slideAnimation;
  final PasswordResetProvider provider;

  const ResetScaffold({
    Key? key,
    required this.fadeAnimation,
    required this.slideAnimation,
    required this.provider,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 06. å°æ‡‰ 2.2ï¼šå»ºç«‹å®‰å…¨æç¤ºè¦†è“‹å±¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é¡¯ç¤ºå®‰å…¨æç¤ºæˆ–éŒ¯èª¤å°è©±æ¡†çš„è¦†è“‹å±¤
   */
  Widget _buildSecurityOverlay(BuildContext context, PasswordResetProvider provider);
}
```

### 3.3 é€²åº¦æŒ‡ç¤ºå±¤Widget

#### 3.3.1 StepsIndicator Widget
```dart
/**
 * 07. å°æ‡‰ 3.1ï¼šæ­¥é©Ÿé€²åº¦æŒ‡ç¤ºå™¨Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description é¡¯ç¤ºå¯†ç¢¼é‡è¨­çš„é€²åº¦æ­¥é©Ÿï¼Œæä¾›è¦–è¦ºå¼•å°
 */
class StepsIndicator extends StatelessWidget {
  final ResetPasswordStep currentStep;
  final List<ResetPasswordStep> completedSteps;

  const StepsIndicator({
    Key? key,
    required this.currentStep,
    required this.completedSteps,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 08. å°æ‡‰ 3.1ï¼šå–å¾—æ­¥é©Ÿé¡¯ç¤ºç‹€æ…‹
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ ¹æ“šç•¶å‰æ­¥é©Ÿè¿”å›å°æ‡‰çš„é¡¯ç¤ºç‹€æ…‹
   */
  StepStatus _getStepStatus(ResetPasswordStep step);
}
```

### 3.4 Emailè¼¸å…¥å±¤Widget

#### 3.4.1 EmailInputSection Widget
```dart
/**
 * 09. å°æ‡‰ 3.2ï¼šEmailè¼¸å…¥å€å¡ŠWidget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description Emailåœ°å€è¼¸å…¥èˆ‡é©—è­‰ç¢¼ç™¼é€åŠŸèƒ½
 */
class EmailInputSection extends StatefulWidget {
  final PasswordResetProvider provider;
  final String? initialEmail;

  const EmailInputSection({
    Key? key,
    required this.provider,
    this.initialEmail,
  });

  @override
  State<EmailInputSection> createState();
}

class _EmailInputSectionState extends State<EmailInputSection> {
  final GlobalKey<FormState> _formKey = GlobalKey<FormState>();
  late TextEditingController _emailController;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 10. å°æ‡‰ 3.2ï¼šé©—è­‰Emailæ ¼å¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é©—è­‰Emailåœ°å€æ ¼å¼çš„æœ‰æ•ˆæ€§
   */
  bool _validateEmail();

  /**
   * 11. å°æ‡‰ 3.2ï¼šç™¼é€é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å‘æŒ‡å®šEmailç™¼é€é©—è­‰ç¢¼
   */
  Future<void> _sendVerificationCode();

  @override
  void dispose();
}
```

#### 3.4.2 EmailInput & SendCodeButton Widgets
```dart
/**
 * 12. å°æ‡‰ 3.2.1ï¼šEmailè¼¸å…¥æ¬„ä½Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description Emailè¼¸å…¥æ¬„ä½èˆ‡æ ¼å¼é©—è­‰
 */
class EmailInput extends StatelessWidget {
  final TextEditingController controller;
  final String? Function(String?)? validator;
  final bool enabled;

  const EmailInput({
    Key? key,
    required this.controller,
    this.validator,
    this.enabled = true,
  });

  @override
  Widget build(BuildContext context);
}

/**
 * 13. å°æ‡‰ 3.2.2ï¼šç™¼é€é©—è­‰ç¢¼æŒ‰éˆ•Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description ç™¼é€Emailé©—è­‰ç¢¼æŒ‰éˆ•
 */
class SendCodeButton extends StatelessWidget {
  final VoidCallback onPressed;
  final bool isLoading;
  final bool isEnabled;

  const SendCodeButton({
    Key? key,
    required this.onPressed,
    this.isLoading = false,
    this.isEnabled = true,
  });

  @override
  Widget build(BuildContext context);
}
```

### 3.5 é©—è­‰ç¢¼å±¤Widget

#### 3.5.1 VerificationSection Widget
```dart
/**
 * 14. å°æ‡‰ 3.3ï¼šé©—è­‰ç¢¼è¼¸å…¥å€å¡ŠWidget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description é©—è­‰ç¢¼è¼¸å…¥èˆ‡é©—è­‰åŠŸèƒ½
 */
class VerificationSection extends StatefulWidget {
  final PasswordResetProvider provider;
  final String email;

  const VerificationSection({
    Key? key,
    required this.provider,
    required this.email,
  });

  @override
  State<VerificationSection> createState();
}

class _VerificationSectionState extends State<VerificationSection> {
  late List<TextEditingController> _codeControllers;
  late List<FocusNode> _focusNodes;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 15. å°æ‡‰ 3.3ï¼šé©—è­‰é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é©—è­‰6ä½æ•¸é©—è­‰ç¢¼çš„æ­£ç¢ºæ€§
   */
  Future<void> _verifyCode();

  /**
   * 16. å°æ‡‰ 3.3ï¼šè™•ç†é©—è­‰ç¢¼è¼¸å…¥
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†å–®å€‹æ•¸å­—è¼¸å…¥ä¸¦è‡ªå‹•è·³è½‰
   */
  void _onCodeChanged(String value, int index);

  @override
  void dispose();
}
```

#### 3.5.2 CodeInputWidget & ResendButton Widgets
```dart
/**
 * 17. å°æ‡‰ 3.3.1ï¼šé©—è­‰ç¢¼è¼¸å…¥Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description 6ä½æ•¸é©—è­‰ç¢¼è¼¸å…¥ä»‹é¢
 */
class CodeInputWidget extends StatelessWidget {
  final List<TextEditingController> controllers;
  final List<FocusNode> focusNodes;
  final Function(String, int) onChanged;

  const CodeInputWidget({
    Key? key,
    required this.controllers,
    required this.focusNodes,
    required this.onChanged,
  });

  @override
  Widget build(BuildContext context);
}

/**
 * 18. å°æ‡‰ 3.3.2ï¼šé‡æ–°ç™¼é€æŒ‰éˆ•Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description é‡æ–°ç™¼é€é©—è­‰ç¢¼æŒ‰éˆ•èˆ‡å€’æ•¸è¨ˆæ™‚
 */
class ResendButton extends StatefulWidget {
  final VoidCallback onPressed;
  final bool isEnabled;

  const ResendButton({
    Key? key,
    required this.onPressed,
    this.isEnabled = true,
  });

  @override
  State<ResendButton> createState();
}

class _ResendButtonState extends State<ResendButton> with TickerProviderStateMixin {
  late AnimationController _timerController;
  Timer? _countdownTimer;
  int _countdown = 60;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 19. å°æ‡‰ 3.3.2ï¼šé–‹å§‹å€’æ•¸è¨ˆæ™‚
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é–‹å§‹60ç§’å€’æ•¸è¨ˆæ™‚
   */
  void _startCountdown();

  @override
  void dispose();
}
```

### 3.6 å¯†ç¢¼è¨­å®šå±¤Widget

#### 3.6.1 PasswordInputSection Widget
```dart
/**
 * 20. å°æ‡‰ 3.4ï¼šå¯†ç¢¼è¨­å®šå€å¡ŠWidget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description æ–°å¯†ç¢¼è¨­å®šèˆ‡ç¢ºèªåŠŸèƒ½
 */
class PasswordInputSection extends StatefulWidget {
  final PasswordResetProvider provider;

  const PasswordInputSection({
    Key? key,
    required this.provider,
  });

  @override
  State<PasswordInputSection> createState();
}

class _PasswordInputSectionState extends State<PasswordInputSection> {
  final GlobalKey<FormState> _formKey = GlobalKey<FormState>();
  late TextEditingController _passwordController;
  late TextEditingController _confirmPasswordController;

  @override
  void initState();

  @override
  Widget build(BuildContext context);

  /**
   * 21. å°æ‡‰ 3.4ï¼šé©—è­‰å¯†ç¢¼è¡¨å–®
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é©—è­‰æ–°å¯†ç¢¼å’Œç¢ºèªå¯†ç¢¼çš„ä¸€è‡´æ€§
   */
  bool _validatePasswords();

  /**
   * 22. å°æ‡‰ 3.4ï¼šé‡è¨­å¯†ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description åŸ·è¡Œå¯†ç¢¼é‡è¨­æ“ä½œ
   */
  Future<void> _resetPassword();

  @override
  void dispose();
}
```

#### 3.6.2 Password Input Widgets
```dart
/**
 * 23. å°æ‡‰ 3.4.1ï¼šæ–°å¯†ç¢¼è¼¸å…¥æ¬„ä½Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description æ–°å¯†ç¢¼è¼¸å…¥æ¬„ä½èˆ‡å¼·åº¦æª¢æŸ¥
 */
class NewPasswordInput extends StatefulWidget {
  final TextEditingController controller;
  final String? Function(String?)? validator;
  final bool enabled;
  final Function(PasswordStrength)? onStrengthChanged;

  const NewPasswordInput({
    Key? key,
    required this.controller,
    this.validator,
    this.enabled = true,
    this.onStrengthChanged,
  });

  @override
  State<NewPasswordInput> createState();
}

class _NewPasswordInputState extends State<NewPasswordInput> {
  bool _isObscured = true;
  PasswordStrength _currentStrength = PasswordStrength.weak;

  @override
  Widget build(BuildContext context);

  /**
   * 24. å°æ‡‰ 3.4.1ï¼šæª¢æŸ¥å¯†ç¢¼å¼·åº¦
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å³æ™‚æª¢æŸ¥å¯†ç¢¼å¼·åº¦ä¸¦æ›´æ–°æŒ‡ç¤ºå™¨
   */
  void _checkPasswordStrength(String password);

  /**
   * 25. å°æ‡‰ 3.4.1ï¼šåˆ‡æ›å¯†ç¢¼å¯è¦‹æ€§
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ§åˆ¶å¯†ç¢¼æ¬„ä½é¡¯ç¤º/éš±è—
   */
  void _togglePasswordVisibility();
}

/**
 * 26. å°æ‡‰ 3.4.2ï¼šç¢ºèªå¯†ç¢¼è¼¸å…¥æ¬„ä½Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description ç¢ºèªå¯†ç¢¼è¼¸å…¥æ¬„ä½èˆ‡ä¸€è‡´æ€§æª¢æŸ¥
 */
class ConfirmPasswordInput extends StatefulWidget {
  final TextEditingController controller;
  final String? Function(String?)? validator;
  final bool enabled;
  final String comparePassword;

  const ConfirmPasswordInput({
    Key? key,
    required this.controller,
    this.validator,
    this.enabled = true,
    required this.comparePassword,
  });

  @override
  State<ConfirmPasswordInput> createState();
}

class _ConfirmPasswordInputState extends State<ConfirmPasswordInput> {
  bool _isObscured = true;

  @override
  Widget build(BuildContext context);

  /**
   * 27. å°æ‡‰ 3.4.2ï¼šé©—è­‰å¯†ç¢¼ä¸€è‡´æ€§
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å³æ™‚æª¢æŸ¥å…©æ¬¡å¯†ç¢¼è¼¸å…¥æ˜¯å¦ä¸€è‡´
   */
  bool _checkPasswordMatch();

  /**
   * 28. å°æ‡‰ 3.4.2ï¼šåˆ‡æ›å¯†ç¢¼å¯è¦‹æ€§
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ§åˆ¶ç¢ºèªå¯†ç¢¼æ¬„ä½é¡¯ç¤º/éš±è—
   */
  void _togglePasswordVisibility();
}
```

### 3.7 è¼”åŠ©åŠŸèƒ½å±¤Widget

#### 3.7.1 PasswordStrengthIndicator Widget
```dart
/**
 * 29. å°æ‡‰ 3.5ï¼šå¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description è¦–è¦ºåŒ–å¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨
 */
class PasswordStrengthIndicator extends StatelessWidget {
  final PasswordStrength strength;
  final bool isVisible;

  const PasswordStrengthIndicator({
    Key? key,
    required this.strength,
    this.isVisible = true,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 30. å°æ‡‰ 3.5ï¼šå–å¾—å¼·åº¦é¡è‰²
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ ¹æ“šå¯†ç¢¼å¼·åº¦è¿”å›å°æ‡‰é¡è‰²
   */
  Color _getStrengthColor(PasswordStrength strength);

  /**
   * 31. å°æ‡‰ 3.5ï¼šå–å¾—å¼·åº¦æ–‡å­—
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ ¹æ“šå¯†ç¢¼å¼·åº¦è¿”å›å°æ‡‰æ–‡å­—æè¿°
   */
  String _getStrengthText(PasswordStrength strength);
}
```

#### 3.7.2 PasswordRequirements Widget
```dart
/**
 * 32. å°æ‡‰ 3.6ï¼šå¯†ç¢¼è¦æ±‚èªªæ˜Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å¯†ç¢¼è¦æ±‚æ¸…å–®èˆ‡æª¢æŸ¥ç‹€æ…‹
 */
class PasswordRequirements extends StatelessWidget {
  final String currentPassword;
  final bool isVisible;

  const PasswordRequirements({
    Key? key,
    required this.currentPassword,
    this.isVisible = true,
  });

  @override
  Widget build(BuildContext context);

  /**
   * 33. å°æ‡‰ 3.6ï¼šæª¢æŸ¥å¯†ç¢¼è¦æ±‚
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æª¢æŸ¥å¯†ç¢¼æ˜¯å¦ç¬¦åˆå„é …è¦æ±‚
   */
  Map<String, bool> _checkPasswordRequirements(String password);
}
```

#### 3.7.3 Success & Navigation Widgets
```dart
/**
 * 34. å°æ‡‰ 3.7ï¼šæˆåŠŸé é¢å€å¡ŠWidget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å¯†ç¢¼é‡è¨­æˆåŠŸç¢ºèªé é¢
 */
class SuccessSection extends StatelessWidget {
  final VoidCallback onBackToLogin;

  const SuccessSection({Key? key, required this.onBackToLogin});

  @override
  Widget build(BuildContext context);
}

/**
 * 35. å°æ‡‰ 3.8ï¼šå®‰å…¨æç¤ºå€å¡ŠWidget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å®‰å…¨æ€§æé†’èˆ‡æ³¨æ„äº‹é …
 */
class SecurityNotice extends StatelessWidget {
  final String message;
  final IconData icon;

  const SecurityNotice({
    Key? key,
    required this.message,
    this.icon = Icons.security,
  });

  @override
  Widget build(BuildContext context);
}

/**
 * 36. å°æ‡‰ 3.9ï¼šè¿”å›ç™»å…¥æŒ‰éˆ•Widget
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description è¿”å›ç™»å…¥é é¢å°èˆªæŒ‰éˆ•
 */
class BackToLoginButton extends StatelessWidget {
  final VoidCallback onPressed;

  const BackToLoginButton({Key? key, required this.onPressed});

  @override
  Widget build(BuildContext context);
}
```

---

## 4.0 ç‹€æ…‹ç®¡ç†æ¶æ§‹

### 4.1 PasswordResetProvider ç‹€æ…‹ç®¡ç†å™¨
```dart
/**
 * 37. å°æ‡‰ 4.1ï¼šå¯†ç¢¼é‡è¨­é é¢ç‹€æ…‹ç®¡ç†å™¨
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description ç®¡ç†å¯†ç¢¼é‡è¨­é é¢çš„ç‹€æ…‹ï¼Œæ”¯æ´å¤šæ­¥é©Ÿæµç¨‹å’Œå®‰å…¨æ€§æ§åˆ¶
 */
class PasswordResetProvider extends ChangeNotifier {
  // ç‹€æ…‹å±¬æ€§
  ResetPasswordStep _currentStep = ResetPasswordStep.emailInput;
  bool _isLoading = false;
  String? _errorMessage;
  ResetErrorType? _errorType;
  String _email = '';
  String _verificationCode = '';
  String _newPassword = '';
  String _confirmPassword = '';
  String? _resetToken;
  int _remainingAttempts = 5;
  int _resendCountdown = 0;
  PasswordStrength _passwordStrength = PasswordStrength.weak;

  // è¡¨å–®ç‹€æ…‹
  final GlobalKey<FormState> emailFormKey = GlobalKey<FormState>();
  final GlobalKey<FormState> passwordFormKey = GlobalKey<FormState>();

  // Getters
  ResetPasswordStep get currentStep;
  bool get isLoading;
  String? get errorMessage;
  ResetErrorType? get errorType;
  String get email;
  String get verificationCode;
  String get newPassword;
  String get confirmPassword;
  String? get resetToken;
  int get remainingAttempts;
  int get resendCountdown;
  PasswordStrength get passwordStrength;

  /**
   * 38. å°æ‡‰ 4.1ï¼šåˆå§‹åŒ–å¯†ç¢¼é‡è¨­é é¢
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description åˆå§‹åŒ–å¯†ç¢¼é‡è¨­é é¢ç‹€æ…‹
   */
  Future<void> initializePage(String? initialEmail);

  /**
   * 39. å°æ‡‰ 4.1ï¼šç™¼é€é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å‘æŒ‡å®šEmailç™¼é€å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼
   */
  Future<void> sendVerificationCode(String email);

  /**
   * 40. å°æ‡‰ 4.1ï¼šé©—è­‰é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é©—è­‰ç”¨æˆ¶è¼¸å…¥çš„6ä½æ•¸é©—è­‰ç¢¼
   */
  Future<void> verifyCode(String code);

  /**
   * 41. å°æ‡‰ 4.1ï¼šé‡è¨­å¯†ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description åŸ·è¡Œå¯†ç¢¼é‡è¨­æ“ä½œ
   */
  Future<void> resetPassword(String newPassword, String confirmPassword);

  /**
   * 42. å°æ‡‰ 4.1ï¼šé‡æ–°ç™¼é€é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é‡æ–°ç™¼é€é©—è­‰ç¢¼åˆ°Email
   */
  Future<void> resendVerificationCode();

  /**
   * 43. å°æ‡‰ 4.1ï¼šæ›´æ–°Email
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ›´æ–°è¦é‡è¨­å¯†ç¢¼çš„Emailåœ°å€
   */
  void updateEmail(String email);

  /**
   * 44. å°æ‡‰ 4.1ï¼šæ›´æ–°é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ›´æ–°ç”¨æˆ¶è¼¸å…¥çš„é©—è­‰ç¢¼
   */
  void updateVerificationCode(String code);

  /**
   * 45. å°æ‡‰ 4.1ï¼šæ›´æ–°æ–°å¯†ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ›´æ–°æ–°å¯†ç¢¼ä¸¦æª¢æŸ¥å¼·åº¦
   */
  void updateNewPassword(String password);

  /**
   * 46. å°æ‡‰ 4.1ï¼šæ›´æ–°ç¢ºèªå¯†ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ›´æ–°ç¢ºèªå¯†ç¢¼ä¸¦æª¢æŸ¥ä¸€è‡´æ€§
   */
  void updateConfirmPassword(String password);

  /**
   * 47. å°æ‡‰ 4.1ï¼šæª¢æŸ¥å¯†ç¢¼å¼·åº¦
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æª¢æŸ¥å¯†ç¢¼å¼·åº¦ä¸¦æ›´æ–°æŒ‡ç¤ºå™¨
   */
  PasswordStrength _checkPasswordStrength(String password);

  /**
   * 48. å°æ‡‰ 4.1ï¼šè¨­å®šè¼‰å…¥ç‹€æ…‹
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ›´æ–°è¼‰å…¥ç‹€æ…‹ä¸¦é€šçŸ¥ç›£è½è€…
   */
  void _setLoading(bool loading);

  /**
   * 49. å°æ‡‰ 4.1ï¼šè¨­å®šç•¶å‰æ­¥é©Ÿ
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ›´æ–°ç•¶å‰æ­¥é©Ÿä¸¦é€šçŸ¥ç›£è½è€…
   */
  void _setCurrentStep(ResetPasswordStep step);

  /**
   * 50. å°æ‡‰ 4.1ï¼šè¨­å®šéŒ¯èª¤è¨Šæ¯
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è¨­å®šéŒ¯èª¤è¨Šæ¯å’ŒéŒ¯èª¤é¡å‹
   */
  void _setError(String message, ResetErrorType type, dynamic error);

  /**
   * 51. å°æ‡‰ 4.1ï¼šæ¸…é™¤éŒ¯èª¤ç‹€æ…‹
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ¸…é™¤éŒ¯èª¤ç‹€æ…‹ä¸¦æ±ºå®šå¾ŒçºŒå‹•ä½œ
   */
  void clearError();

  /**
   * 52. å°æ‡‰ 4.1ï¼šè¿”å›ä¸Šä¸€æ­¥
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è¿”å›å¯†ç¢¼é‡è¨­æµç¨‹çš„ä¸Šä¸€æ­¥
   */
  void goToPreviousStep();

  /**
   * 53. å°æ‡‰ 4.1ï¼šå°èˆªåˆ°ç™»å…¥é é¢
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å¯†ç¢¼é‡è¨­å®Œæˆå¾Œå°èˆªåˆ°ç™»å…¥é é¢
   */
  void navigateToLogin();
}
```

### 4.2 ç‹€æ…‹æšèˆ‰å®šç¾©
```dart
/**
 * 54. å°æ‡‰ 4.2ï¼šå¯†ç¢¼é‡è¨­æ­¥é©Ÿæšèˆ‰
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å®šç¾©å¯†ç¢¼é‡è¨­æµç¨‹çš„å„å€‹æ­¥é©Ÿ
 */
enum ResetPasswordStep {
  emailInput,     // Emailè¼¸å…¥éšæ®µ
  codeSending,    // é©—è­‰ç¢¼ç™¼é€ä¸­
  codeInput,      // é©—è­‰ç¢¼è¼¸å…¥éšæ®µ
  codeVerifying,  // é©—è­‰ç¢¼é©—è­‰ä¸­
  passwordInput,  // æ–°å¯†ç¢¼è¨­å®šéšæ®µ
  passwordUpdating, // å¯†ç¢¼æ›´æ–°ä¸­
  success,        // é‡è¨­æˆåŠŸ
}

/**
 * 55. å°æ‡‰ 4.2ï¼šå¯†ç¢¼å¼·åº¦æšèˆ‰
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å¯†ç¢¼å¼·åº¦ç­‰ç´š
 */
enum PasswordStrength {
  weak,     // å¼±å¯†ç¢¼
  medium,   // ä¸­ç­‰å¯†ç¢¼
  strong,   // å¼·å¯†ç¢¼
}

/**
 * 56. å°æ‡‰ 4.2ï¼šé‡è¨­éŒ¯èª¤é¡å‹æšèˆ‰
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å¯†ç¢¼é‡è¨­éŒ¯èª¤é¡å‹åˆ†é¡
 */
enum ResetErrorType {
  networkError,       // ç¶²è·¯éŒ¯èª¤
  emailNotFound,      // Emailä¸å­˜åœ¨
  invalidCode,        // é©—è­‰ç¢¼éŒ¯èª¤
  codeExpired,        // é©—è­‰ç¢¼éæœŸ
  tooManyAttempts,    // å˜—è©¦æ¬¡æ•¸éå¤š
  weakPassword,       // å¯†ç¢¼å¼·åº¦ä¸è¶³
  passwordMismatch,   // å¯†ç¢¼ä¸ä¸€è‡´
  rateLimited,        // è«‹æ±‚é »ç‡é™åˆ¶
  serverError,        // ä¼ºæœå™¨éŒ¯èª¤
  unknown,           // æœªçŸ¥éŒ¯èª¤
}

/**
 * 57. å°æ‡‰ 4.2ï¼šæ­¥é©Ÿç‹€æ…‹æšèˆ‰
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å„æ­¥é©Ÿçš„é¡¯ç¤ºç‹€æ…‹
 */
enum StepStatus {
  pending,    // å¾…åŸ·è¡Œ
  active,     // åŸ·è¡Œä¸­
  completed,  // å·²å®Œæˆ
  error,      // éŒ¯èª¤
}
```

---

## 5.0 APIæ•´åˆè¨­è¨ˆ

### 5.1 PasswordResetApiService APIæœå‹™
```dart
/**
 * 58. å°æ‡‰ 5.1ï¼šå¯†ç¢¼é‡è¨­é é¢APIæœå‹™
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description è™•ç†å¯†ç¢¼é‡è¨­é é¢ç›¸é—œçš„APIèª¿ç”¨ï¼Œæ”¯æ´F005å¯†ç¢¼é‡è¨­åŠŸèƒ½
 */
class PasswordResetApiService {
  final ApiClient _apiClient = ApiClient();

  /**
   * 59. å°æ‡‰ 5.1ï¼šç™¼é€å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description ç™¼é€å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼åˆ°æŒ‡å®šEmailï¼ˆå°æ‡‰F005ç«¯é»ç¬¬ä¸€æ­¥ï¼‰
   */
  Future<ApiResponse<SendCodeResponse>> sendResetCode(SendCodeRequest request);

  /**
   * 60. å°æ‡‰ 5.1ï¼šé©—è­‰é‡è¨­é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é©—è­‰å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼ï¼ˆå°æ‡‰F005ç«¯é»ç¬¬äºŒæ­¥ï¼‰
   */
  Future<ApiResponse<VerifyCodeResponse>> verifyResetCode(VerifyCodeRequest request);

  /**
   * 61. å°æ‡‰ 5.1ï¼šåŸ·è¡Œå¯†ç¢¼é‡è¨­
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description åŸ·è¡Œå¯†ç¢¼é‡è¨­æ“ä½œï¼ˆå°æ‡‰F005ç«¯é»ç¬¬ä¸‰æ­¥ï¼‰
   */
  Future<ApiResponse<ResetPasswordResponse>> resetPassword(ResetPasswordRequest request);

  /**
   * 62. å°æ‡‰ 5.1ï¼šé‡æ–°ç™¼é€é©—è­‰ç¢¼
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é‡æ–°ç™¼é€å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼
   */
  Future<ApiResponse<SendCodeResponse>> resendResetCode(ResendCodeRequest request);

  /**
   * 63. å°æ‡‰ 5.1ï¼šè™•ç†DioéŒ¯èª¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†DioéŒ¯èª¤ä¸¦è½‰æ›ç‚ºä½¿ç”¨è€…å‹å–„è¨Šæ¯
   */
  String _handleDioError(DioError error);

  /**
   * 64. å°æ‡‰ 5.1ï¼šå–å¾—è£ç½®è³‡è¨Š
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ”¶é›†è£ç½®è³‡è¨Šç”¨æ–¼APIèª¿ç”¨
   */
  Future<Map<String, dynamic>> _getDeviceInfo();
}
```

### 5.2 è³‡æ–™æ¨¡å‹å®šç¾©
```dart
/**
 * 65. å°æ‡‰ 5.2ï¼šç™¼é€é©—è­‰ç¢¼è«‹æ±‚æ¨¡å‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description ç™¼é€å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼è«‹æ±‚è³‡æ–™çµæ§‹
 */
class SendCodeRequest {
  final String email;
  final String step; // 'send-code'
  final Map<String, dynamic> deviceInfo;

  SendCodeRequest({
    required this.email,
    required this.step,
    required this.deviceInfo,
  });

  Map<String, dynamic> toJson();
}

/**
 * 66. å°æ‡‰ 5.2ï¼šé©—è­‰é©—è­‰ç¢¼è«‹æ±‚æ¨¡å‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description é©—è­‰å¯†ç¢¼é‡è¨­é©—è­‰ç¢¼è«‹æ±‚è³‡æ–™çµæ§‹
 */
class VerifyCodeRequest {
  final String email;
  final String verificationCode;
  final String step; // 'verify-code'
  final Map<String, dynamic> deviceInfo;

  VerifyCodeRequest({
    required this.email,
    required this.verificationCode,
    required this.step,
    required this.deviceInfo,
  });

  Map<String, dynamic> toJson();
}

/**
 * 67. å°æ‡‰ 5.2ï¼šé‡è¨­å¯†ç¢¼è«‹æ±‚æ¨¡å‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description åŸ·è¡Œå¯†ç¢¼é‡è¨­è«‹æ±‚è³‡æ–™çµæ§‹
 */
class ResetPasswordRequest {
  final String email;
  final String resetToken;
  final String newPassword;
  final String step; // 'reset-password'
  final Map<String, dynamic> deviceInfo;

  ResetPasswordRequest({
    required this.email,
    required this.resetToken,
    required this.newPassword,
    required this.step,
    required this.deviceInfo,
  });

  Map<String, dynamic> toJson();
}

/**
 * 68. å°æ‡‰ 5.2ï¼šç™¼é€é©—è­‰ç¢¼å›æ‡‰æ¨¡å‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description ç™¼é€é©—è­‰ç¢¼å›æ‡‰è³‡æ–™çµæ§‹
 */
class SendCodeResponse {
  final bool success;
  final String message;
  final int expiresIn;
  final int canResendIn;
  final String requestId;

  SendCodeResponse({
    required this.success,
    required this.message,
    required this.expiresIn,
    required this.canResendIn,
    required this.requestId,
  });

  factory SendCodeResponse.fromJson(Map<String, dynamic> json);
}

/**
 * 69. å°æ‡‰ 5.2ï¼šé©—è­‰é©—è­‰ç¢¼å›æ‡‰æ¨¡å‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description é©—è­‰é©—è­‰ç¢¼å›æ‡‰è³‡æ–™çµæ§‹
 */
class VerifyCodeResponse {
  final bool success;
  final String message;
  final String resetToken;
  final int tokenExpiresIn;

  VerifyCodeResponse({
    required this.success,
    required this.message,
    required this.resetToken,
    required this.tokenExpiresIn,
  });

  factory VerifyCodeResponse.fromJson(Map<String, dynamic> json);
}

/**
 * 70. å°æ‡‰ 5.2ï¼šé‡è¨­å¯†ç¢¼å›æ‡‰æ¨¡å‹
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å¯†ç¢¼é‡è¨­å›æ‡‰è³‡æ–™çµæ§‹
 */
class ResetPasswordResponse {
  final bool success;
  final String message;

  ResetPasswordResponse({
    required this.success,
    required this.message,
  });

  factory ResetPasswordResponse.fromJson(Map<String, dynamic> json);
}
```

---

## 6.0 å°èˆªè·¯ç”±è¨­è¨ˆ

### 6.1 è·¯ç”±é…ç½®
```dart
/**
 * 71. å°æ‡‰ 6.1ï¼šå¯†ç¢¼é‡è¨­é é¢è·¯ç”±é…ç½®
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å®šç¾©å¯†ç¢¼é‡è¨­é é¢çš„è·¯ç”±è¦å‰‡èˆ‡å°èˆªé‚è¼¯
 */
class PasswordResetRoutes {
  static const String passwordReset = '/password-reset';
  static const String login = '/login';
  static const String home = '/home';

  /**
   * 72. å°æ‡‰ 6.1ï¼šå–å¾—å¯†ç¢¼é‡è¨­é é¢è·¯ç”±
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å»ºç«‹å¯†ç¢¼é‡è¨­é é¢çš„GoRouteé…ç½®
   */
  static GoRoute getPasswordResetRoute();
}

/**
 * 73. å°æ‡‰ 6.1ï¼šå¯†ç¢¼é‡è¨­å°èˆªæœå‹™
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description è™•ç†å¯†ç¢¼é‡è¨­ç›¸é—œçš„å°èˆªé‚è¼¯
 */
class PasswordResetNavigationService {
  static final GoRouter _router;
  static GoRouter get router;

  /**
   * 74. å°æ‡‰ 6.1ï¼šå°èˆªåˆ°ç™»å…¥é é¢
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å¯†ç¢¼é‡è¨­æˆåŠŸå¾Œå°èˆªåˆ°ç™»å…¥é é¢
   */
  Future<void> navigateToLogin({String? message});

  /**
   * 75. å°æ‡‰ 6.1ï¼šè¿”å›ç™»å…¥é é¢
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å–æ¶ˆå¯†ç¢¼é‡è¨­æµç¨‹ï¼Œè¿”å›ç™»å…¥é é¢
   */
  void navigateBackToLogin();

  /**
   * 76. å°æ‡‰ 6.1ï¼šè™•ç†æ·±åº¦é€£çµ
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†å¾Emailé€£çµé€²å…¥çš„å¯†ç¢¼é‡è¨­
   */
  Future<void> handleResetLink(String? email, String? token);
}
```

---

## 7.0 éŸ¿æ‡‰å¼è¨­è¨ˆ

### 7.1 éŸ¿æ‡‰å¼è¼”åŠ©å·¥å…·
```dart
/**
 * 77. å°æ‡‰ 7.1ï¼šå¯†ç¢¼é‡è¨­é é¢éŸ¿æ‡‰å¼è¨­è¨ˆè¼”åŠ©å·¥å…·
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description éµå¾ª9005æ–‡ä»¶çš„éŸ¿æ‡‰å¼è¨­è¨ˆè¦ç¯„ï¼Œæä¾›å¯†ç¢¼é‡è¨­é é¢å°ˆç”¨çš„ä½ˆå±€ç®¡ç†
 */
class PasswordResetResponsiveHelper {
  final BuildContext context;
  late final MediaQueryData _mediaQuery;
  late final Size _screenSize;

  PasswordResetResponsiveHelper.of(BuildContext context);

  // æ–·é»åˆ¤æ–·å±¬æ€§ï¼ˆ9005è¦ç¯„ï¼‰
  bool get isMobile;
  bool get isTablet;
  bool get isSmallDesktop;
  bool get isLargeDesktop;
  DeviceType get deviceType;

  // å¯†ç¢¼é‡è¨­é é¢å°ˆç”¨å°ºå¯¸å±¬æ€§
  double get resetCardWidth;
  double get resetCardMaxWidth;
  EdgeInsets get resetCardPadding;
  double get stepIndicatorHeight;
  double get codeInputSize;
  double get buttonHeight;
  double get inputFieldHeight;

  /**
   * 78. å°æ‡‰ 7.1ï¼šå–å¾—æ­¥é©ŸæŒ‡ç¤ºå™¨å°ºå¯¸
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ ¹æ“šè£ç½®é¡å‹è¿”å›é©ç•¶çš„æ­¥é©ŸæŒ‡ç¤ºå™¨å°ºå¯¸
   */
  double getStepIndicatorSize();

  /**
   * 79. å°æ‡‰ 7.1ï¼šå–å¾—é©—è­‰ç¢¼è¼¸å…¥æ¡†å°ºå¯¸
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ ¹æ“šè£ç½®é¡å‹è¿”å›é©ç•¶çš„é©—è­‰ç¢¼è¼¸å…¥æ¡†å°ºå¯¸
   */
  double getCodeInputSize();
}
```

---

## 8.0 ç„¡éšœç¤™åŠŸèƒ½

### 8.1 èªæ„åŒ–æ”¯æ´
```dart
/**
 * 80. å°æ‡‰ 8.1ï¼šå¯†ç¢¼é‡è¨­é é¢ç„¡éšœç¤™èªæ„åŒ–WidgetåŒ…è£å™¨
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description æä¾›WCAG 2.1 AAæ¨™æº–çš„å®Œæ•´ç„¡éšœç¤™æ”¯æ´ï¼ˆ9005è¦ç¯„ï¼‰
 */
class PasswordResetAccessibilityWrapper {

  /**
   * 81. å°æ‡‰ 8.1ï¼šç‚ºæ­¥é©ŸæŒ‡ç¤ºå™¨æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description ç‚ºå¯†ç¢¼é‡è¨­æ­¥é©ŸæŒ‡ç¤ºå™¨æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapStepsIndicator(Widget child, ResetPasswordStep currentStep, int totalSteps);

  /**
   * 82. å°æ‡‰ 8.1ï¼šç‚ºé©—è­‰ç¢¼è¼¸å…¥æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description ç‚ºé©—è­‰ç¢¼è¼¸å…¥æ¬„ä½æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapCodeInput(Widget child, int position, bool isFilled);

  /**
   * 83. å°æ‡‰ 8.1ï¼šç‚ºå¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description ç‚ºå¯†ç¢¼å¼·åº¦æŒ‡ç¤ºå™¨æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapPasswordStrengthIndicator(Widget child, PasswordStrength strength);

  /**
   * 84. å°æ‡‰ 8.1ï¼šç‚ºéŒ¯èª¤è¨Šæ¯æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description ç‚ºéŒ¯èª¤è¨Šæ¯æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapErrorMessage(Widget child, String errorMessage, ResetErrorType errorType);

  /**
   * 85. å°æ‡‰ 8.1ï¼šç‚ºæˆåŠŸè¨Šæ¯æä¾›èªæ„åŒ–æ¨™ç±¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description ç‚ºæˆåŠŸè¨Šæ¯æ·»åŠ é©ç•¶çš„èªæ„åŒ–æ¨™ç±¤
   */
  static Widget wrapSuccessMessage(Widget child, String successMessage);
}
```

---

## 9.0 æ•ˆèƒ½æœ€ä½³åŒ–

### 9.1 Widgetå¿«å–ç­–ç•¥
```dart
/**
 * 86. å°æ‡‰ 9.1ï¼šå¯†ç¢¼é‡è¨­é é¢Widgetå¿«å–ç®¡ç†å™¨
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å„ªåŒ–å¯†ç¢¼é‡è¨­é é¢Widgeté‡å»ºæ•ˆèƒ½ï¼Œæ¸›å°‘ä¸å¿…è¦çš„é‡å»º
 */
class PasswordResetWidgetCache {
  static final Map<String, Widget> _cache = {};
  static final Map<String, DateTime> _cacheTimestamps = {};
  static const Duration _cacheValidDuration = Duration(minutes: 5);

  /**
   * 87. å°æ‡‰ 9.1ï¼šå–å¾—å¿«å–çš„æ­¥é©ŸæŒ‡ç¤ºå™¨æˆ–å»ºç«‹æ–°çš„
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å¾å¿«å–ä¸­ç²å–æ­¥é©ŸæŒ‡ç¤ºå™¨Widgetæˆ–å‰µå»ºæ–°çš„
   */
  static Widget getStepsIndicatorOrCreate(ResetPasswordStep step, Widget Function() creator);

  /**
   * 88. å°æ‡‰ 9.1ï¼šå–å¾—å¿«å–çš„å®‰å…¨æç¤ºæˆ–å»ºç«‹æ–°çš„
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å¾å¿«å–ä¸­ç²å–å®‰å…¨æç¤ºWidgetæˆ–å‰µå»ºæ–°çš„
   */
  static Widget getSecurityNoticeOrCreate(Widget Function() creator);

  /**
   * 89. å°æ‡‰ 9.1ï¼šæ¸…é™¤å¯†ç¢¼é‡è¨­é é¢å¿«å–
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ¸…é™¤å¯†ç¢¼é‡è¨­é é¢ç›¸é—œçš„Widgetå¿«å–
   */
  static void clearPasswordResetCache();
}
```

### 9.2 æµç¨‹å„ªåŒ–
```dart
/**
 * 90. å°æ‡‰ 9.2ï¼šå¯†ç¢¼é‡è¨­æµç¨‹æ•ˆèƒ½å„ªåŒ–å™¨
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description å„ªåŒ–å¯†ç¢¼é‡è¨­æµç¨‹æ•ˆèƒ½ï¼Œæå‡ä½¿ç”¨è€…é«”é©—
 */
class PasswordResetPerformanceOptimizer {
  static final Map<String, Timer> _debounceTimers = {};
  static const Duration _debounceDelay = Duration(milliseconds: 300);

  /**
   * 91. å°æ‡‰ 9.2ï¼šé˜²æŠ–å‹•é©—è­‰ç¢¼è¼¸å…¥
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é˜²æ­¢ä½¿ç”¨è€…å¿«é€Ÿè¼¸å…¥é€ æˆé‡è¤‡é©—è­‰è«‹æ±‚
   */
  static Future<void> debounceCodeVerification(String key, Future<void> Function() verifyFunction);

  /**
   * 92. å°æ‡‰ 9.2ï¼šé è¼‰å…¥ç›¸é—œè³‡æº
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é è¼‰å…¥å¯†ç¢¼é‡è¨­é é¢ç›¸é—œçš„åœ–ç‰‡å’Œè³‡æº
   */
  static Future<void> preloadResetAssets(BuildContext context);

  /**
   * 93. å°æ‡‰ 9.2ï¼šå„ªåŒ–å¯†ç¢¼å¼·åº¦æª¢æŸ¥
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description å„ªåŒ–å¯†ç¢¼å¼·åº¦æª¢æŸ¥æ•ˆèƒ½ï¼Œé¿å…é »ç¹é‡æ–°è¨ˆç®—
   */
  static PasswordStrength optimizedPasswordStrengthCheck(String password);
}
```

---

## 10.0 éŒ¯èª¤è™•ç†æ©Ÿåˆ¶

### 10.1 çµ±ä¸€éŒ¯èª¤è™•ç†
```dart
/**
 * 94. å°æ‡‰ 10.1ï¼šå¯†ç¢¼é‡è¨­é é¢éŒ¯èª¤è™•ç†å™¨
 * @version 2025-08-06-V1.0.0
 * @date 2025-08-06 21:30:00
 * @description æ ¹æ“š8704è¦ç¯„çš„å…·é«”éŒ¯èª¤æƒ…å¢ƒé€²è¡Œè©³ç´°è™•ç†
 */
class PasswordResetErrorHandler {

  /**
   * 95. å°æ‡‰ 10.1ï¼šè™•ç†Emailç™¼é€éŒ¯èª¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†Emailé©—è­‰ç¢¼ç™¼é€éŒ¯èª¤ï¼ˆ8704è¦ç¯„ï¼‰
   */
  static String handleEmailSendError(dynamic error);

  /**
   * 96. å°æ‡‰ 10.1ï¼šè™•ç†é©—è­‰ç¢¼é©—è­‰éŒ¯èª¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†é©—è­‰ç¢¼é©—è­‰éŒ¯èª¤ï¼ˆ8704è¦ç¯„ï¼‰
   */
  static String handleCodeVerificationError(dynamic error);

  /**
   * 97. å°æ‡‰ 10.1ï¼šè™•ç†å¯†ç¢¼é‡è¨­éŒ¯èª¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†å¯†ç¢¼é‡è¨­åŸ·è¡ŒéŒ¯èª¤ï¼ˆ8704è¦ç¯„ï¼‰
   */
  static String handlePasswordResetError(dynamic error);

  /**
   * 98. å°æ‡‰ 10.1ï¼šè™•ç†é »ç‡é™åˆ¶éŒ¯èª¤
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description è™•ç†è«‹æ±‚é »ç‡é™åˆ¶éŒ¯èª¤ï¼ˆ8704è¦ç¯„ï¼‰
   */
  static String handleRateLimitError(dynamic error, int waitTime);

  /**
   * 99. å°æ‡‰ 10.1ï¼šé¡¯ç¤ºéŒ¯èª¤å°è©±æ¡†
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å°è©±æ¡†ï¼ˆ8704è¦ç¯„ï¼‰
   */
  static Future<void> showErrorDialog(
    BuildContext context, 
    String message, 
    ResetErrorType errorType,
    {VoidCallback? onRetry, VoidCallback? onDismiss}
  );

  /**
   * 100. å°æ‡‰ 10.1ï¼šå–å¾—éŒ¯èª¤è§£æ±ºå»ºè­°
   * @version 2025-08-06-V1.0.0
   * @date 2025-08-06 21:30:00
   * @description æ ¹æ“šéŒ¯èª¤é¡å‹æä¾›è§£æ±ºå»ºè­°
   */
  static String getErrorSolution(ResetErrorType errorType);
}
```

---

## éµå¾ª0055è¨­è¨ˆåŸå‰‡

### éšå±¤æ¶æ§‹å°æ‡‰
- æœ¬TDDæ–‡ä»¶åŸºæ–¼8704. å¯†ç¢¼é‡è¨­é é¢_SRS.mdçš„éœ€æ±‚è¦æ ¼
- èˆ‡9005. Flutter_Presentation layer.mdçš„ç”¢å“è¦æ ¼ä¿æŒä¸€è‡´
- æ‰€æœ‰å‡½æ•¸ç¯€é»ç·¨è™Ÿå°æ‡‰ä¸Šå±¤æ–‡ä»¶çš„åŠŸèƒ½æ¢ç›®

### è¨­è¨ˆåŸå‰‡éµå¾ª
1. **éšå±¤æ¶æ§‹é‚è¼¯**: åš´æ ¼åŸºæ–¼SRSæ–‡ä»¶å®šç¾©çš„åŠŸèƒ½æ¢ç›®è¨­è¨ˆ
2. **åŒå±¤ç´šä¾è³´é—œä¿‚**: è€ƒé‡èˆ‡ç™»å…¥é é¢å’Œè¨»å†Šé é¢çš„ä¾è³´é—œä¿‚
3. **ä»£ç¢¼ç¯€é»ç·¨è™Ÿ**: æ¡ç”¨ä¸åŠ å‰ç¶´çš„ç¯€é»ç·¨è™Ÿæ ¼å¼ï¼ˆå¦‚2.1ã€3.2ï¼‰
4. **å‘½åä¸€è‡´æ€§**: ä¿æŒèˆ‡ä½¿ç”¨è€…ä»‹é¢æ“ä½œæµç¨‹çš„åç¨±åŒæ­¥
5. **å¯è®€æ€§è¨­è¨ˆ**: æ¡ç”¨æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œéµå¾ªä½è€¦åˆã€é«˜å…§èšåŸå‰‡

## æ–‡ä»¶ç¶­è­·è¨˜éŒ„

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹è€… | ä¿®æ”¹å…§å®¹ |
|------|------|--------|----------|
| **v1.0.0** | **2025-08-06 21:30:00 +08:00** | **LCAS SA Team** | **åˆç‰ˆå»ºç«‹ï¼šå®Œæ•´P004å¯†ç¢¼é‡è¨­é é¢TDDè¦æ ¼ï¼Œæ”¯æ´å¤šæ­¥é©Ÿé‡è¨­æµç¨‹ï¼ˆEmailé©—è­‰ã€é©—è­‰ç¢¼ç¢ºèªã€æ–°å¯†ç¢¼è¨­å®šï¼‰ï¼Œå¯¦ä½œå®‰å…¨æ€§æ§åˆ¶ã€éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼Œéµå¾ª0055è¨­è¨ˆåŸå‰‡ï¼Œå°æ‡‰8704 SRSè¦æ ¼** |

---

## å‚™è¨»

- **ç´”å‡½æ•¸å®£å‘Š**: å®Œå…¨ç§»é™¤æ‰€æœ‰å¯¦ä½œä»£ç¢¼ï¼Œåƒ…ä¿ç•™å‡½æ•¸åç¨±ã€åƒæ•¸å®šç¾©å’Œè¨»è§£
- **å¤šæ­¥é©Ÿæµç¨‹**: æ”¯æ´Emailè¼¸å…¥ã€é©—è­‰ç¢¼é©—è­‰ã€æ–°å¯†ç¢¼è¨­å®šçš„å®Œæ•´é‡è¨­æµç¨‹
- **å®‰å…¨æ€§å„ªå…ˆ**: å®Œæ•´çš„é©—è­‰ç¢¼é©—è­‰ã€é »ç‡é™åˆ¶ã€å¯†ç¢¼å¼·åº¦æª¢æŸ¥æ©Ÿåˆ¶
- **ä½¿ç”¨è€…é«”é©—**: æ¸…æ™°çš„æ­¥é©ŸæŒ‡ç¤ºã€å³æ™‚é©—è­‰ã€å‹å–„çš„éŒ¯èª¤æç¤º
- **å®Œæ•´æŠ€è¡“æ¶æ§‹**: Widgetåˆ†å±¤ã€ç‹€æ…‹ç®¡ç†ã€APIæ•´åˆã€éŸ¿æ‡‰å¼è¨­è¨ˆã€ç„¡éšœç¤™æ”¯æ´ã€æ•ˆèƒ½æœ€ä½³åŒ–
- **è¦ç¯„å®Œå…¨å°é½Š**: èˆ‡0055ã€8704ã€9005æ–‡ä»¶å®Œå…¨ä¸€è‡´
- **ç¯€é»ç·¨è™Ÿæ¨™æº–åŒ–**: çµ±ä¸€ç·¨è™Ÿ01-100ï¼Œéµå¾ª0055è¦ç¯„æ ¼å¼
- **ç‰ˆæœ¬çµ±ä¸€**: æ‰€æœ‰çµ„ä»¶ç‰ˆæœ¬çµ±ä¸€ç‚ºv1.0.0
- **APIå°æ‡‰**: å®Œæ•´å°æ‡‰F005å¯†ç¢¼é‡è¨­APIç«¯é»
