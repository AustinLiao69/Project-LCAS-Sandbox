
# P015_科目管理頁面_SRS

**文件編號**: P015_SRS  
**版本**: v1.0.0  
**建立日期**: 2025-01-26  
**建立者**: LCAS PM Team  
**最後更新**: 2025-01-26 16:30:00 UTC+8

---

## 1. 功能目的（Purpose）

科目管理頁面提供使用者完整的會計科目體系管理功能，包含新增、編輯、刪除、排序科目，以及建立自訂科目分類，支援多層級科目架構管理。

### 核心功能
- **科目清單管理**: 顯示所有收入/支出科目
- **科目CRUD操作**: 新增、編輯、刪除科目
- **科目分類管理**: 管理主分類與子分類
- **科目排序**: 自訂科目顯示順序
- **科目統計**: 顯示科目使用頻率與金額統計

---

## 2. 使用者故事（User Story）

**主要使用者故事**:
```
作為一個記帳使用者
我想要管理我的收入支出科目
以便能夠準確分類我的財務記錄

作為一個進階使用者  
我想要建立自訂的科目分類
以便符合我個人的財務管理需求
```

**具體場景**:
- 新增個人化的支出科目（如寵物費用、學習支出）
- 編輯既有科目名稱或圖示
- 刪除不再使用的科目
- 調整科目在記帳時的顯示順序
- 查看各科目的使用統計

---

## 3. 前置條件（Preconditions）

### 使用者狀態
- [x] 使用者已完成登入驗證
- [x] 使用者具備基本帳本存取權限
- [x] 系統已載入預設科目清單

### 系統狀態  
- [x] 網路連線正常
- [x] API服務可用
- [x] 本地快取已同步

### 資料前置條件
- [x] 存在預設科目資料
- [x] 使用者帳本資料完整
- [x] 科目權限設定正確

---

## 4. 功能流程（User Flow / Functional Flow）

### 4.1 主要操作流程
```
科目管理頁面流程:
使用者進入 → 載入科目清單 → 選擇操作類型 → 執行操作 → 確認結果

詳細步驟:
1. 使用者點擊「科目管理」入口
2. 系統載入當前帳本的科目清單
3. 顯示收入/支出科目分頁
4. 使用者選擇操作：
   - 新增科目：點擊「+」→ 填寫科目資訊 → 儲存
   - 編輯科目：點擊科目 → 修改資訊 → 儲存  
   - 刪除科目：長按科目 → 確認刪除
   - 排序科目：拖拽調整順序
5. 系統驗證操作並更新資料
6. 顯示操作結果回饋
```

### 4.2 科目新增流程
```
新增科目流程:
1. 點擊「新增科目」按鈕
2. 選擇科目類型（收入/支出）
3. 填寫科目名稱（必填）
4. 選擇科目圖示（可選）
5. 選擇所屬分類（可選）
6. 設定顯示順序（自動）
7. 確認並儲存
8. 返回科目清單
```

---

## 5. 輸入項目（Inputs）

### 5.1 科目基本資訊
| 欄位名稱 | 資料型別 | 必填 | 長度限制 | 說明 |
|----------|----------|------|----------|------|
| categoryName | String | 是 | 1-20字元 | 科目名稱 |
| categoryType | Enum | 是 | income/expense | 科目類型 |
| categoryIcon | String | 否 | - | 科目圖示代碼 |
| parentCategoryId | String | 否 | - | 上層分類ID |
| displayOrder | Integer | 否 | 1-999 | 顯示順序 |
| isActive | Boolean | 否 | - | 是否啟用 |

### 5.2 科目篩選條件
| 欄位名稱 | 資料型別 | 必填 | 說明 |
|----------|----------|------|------|
| categoryType | String | 否 | 篩選科目類型 |
| isCustom | Boolean | 否 | 是否為自訂科目 |
| searchKeyword | String | 否 | 搜尋關鍵字 |

---

## 6. 輸出項目（Outputs / Responses）

### 6.1 科目清單回應
```json
{
  "success": true,
  "data": {
    "categories": [
      {
        "categoryId": "CAT001",
        "categoryName": "餐飲費",
        "categoryType": "expense", 
        "categoryIcon": "restaurant",
        "parentCategoryId": null,
        "displayOrder": 1,
        "isActive": true,
        "isCustom": false,
        "usageCount": 45,
        "totalAmount": 12500,
        "lastUsedDate": "2025-01-25T10:30:00Z"
      }
    ],
    "totalCount": 25,
    "customCount": 8
  },
  "message": "科目清單載入成功"
}
```

### 6.2 科目操作回應
```json
{
  "success": true,
  "data": {
    "categoryId": "CAT_NEW_001",
    "operation": "create",
    "affectedRecords": 1
  },
  "message": "科目新增成功"
}
```

---

## 7. 驗證規則（Validation Rules）

### 7.1 輸入驗證
- **科目名稱**: 1-20字元，不可重複，不可包含特殊符號
- **科目類型**: 必須為 income 或 expense
- **顯示順序**: 1-999之間的整數
- **上層分類**: 如指定，必須存在且不可循環參照

### 7.2 業務邏輯驗證  
- **刪除限制**: 已被記帳記錄使用的科目不可刪除
- **分類層級**: 最多支援3層分類架構
- **預設科目**: 系統預設科目不可刪除，僅可停用
- **權限檢查**: 協作帳本中需檢查科目管理權限

### 7.3 完整性檢查
- 科目名稱在同一帳本內不可重複
- 父子分類關係不可循環
- 停用科目仍保留歷史記錄關聯

---

## 8. 錯誤處理（Error Handling）

### 8.1 輸入錯誤
| 錯誤碼 | 錯誤訊息 | 處理方式 |
|--------|----------|----------|
| C001 | 科目名稱不可為空 | 顯示欄位錯誤提示 |
| C002 | 科目名稱已存在 | 建議修改名稱或查看既有科目 |
| C003 | 分類層級過深 | 建議選擇其他上層分類 |

### 8.2 操作錯誤
| 錯誤碼 | 錯誤訊息 | 處理方式 |
|--------|----------|----------|
| C101 | 科目已被使用，無法刪除 | 建議停用科目或轉移記錄 |
| C102 | 無科目管理權限 | 提示聯繫帳本管理員 |
| C103 | 系統預設科目無法刪除 | 說明僅可停用 |

### 8.3 系統錯誤
- **網路錯誤**: 提供重試機制與離線模式
- **資料同步失敗**: 標記本地變更並提示同步
- **權限過期**: 導向重新登入

---

## 9. UI 元件與排版需求（UI Requirements）

### 9.1 頁面佈局
```
科目管理頁面佈局:
┌─────────────────────────────┐
│ [← 返回]  科目管理   [搜尋🔍] │
├─────────────────────────────┤
│ [收入科目] [支出科目]        │
├─────────────────────────────┤
│ 📊 餐飲費        [編輯] [...]│
│    45次使用 $12,500         │
├─────────────────────────────┤
│ 🚗 交通費        [編輯] [...]│  
│    23次使用 $3,200          │
├─────────────────────────────┤
│ [+ 新增科目]                │
└─────────────────────────────┘
```

### 9.2 關鍵UI元件
- **科目卡片**: 顯示圖示、名稱、使用統計
- **分頁標籤**: 收入/支出科目切換
- **搜尋框**: 科目名稱快速搜尋
- **排序控制**: 拖拽排序功能
- **操作選單**: 編輯、刪除、停用選項

### 9.3 互動設計
- **點擊**: 進入科目編輯
- **長按**: 顯示操作選單
- **拖拽**: 調整科目順序
- **滑動**: 快速停用/啟用

---

## 10. API 規格（API Specification）

### 10.1 獲取科目清單
```http
GET /api/v1/categories
Headers: Authorization: Bearer {token}
Query Parameters:
  - ledgerId: string (當前帳本ID)
  - type: string (income/expense/all)
  - includeInactive: boolean (是否包含停用科目)
```

### 10.2 新增科目
```http
POST /api/v1/categories
Headers: Authorization: Bearer {token}
Body: {
  "ledgerId": "string",
  "categoryName": "string", 
  "categoryType": "income|expense",
  "categoryIcon": "string",
  "parentCategoryId": "string",
  "displayOrder": number
}
```

### 10.3 更新科目
```http
PUT /api/v1/categories/{categoryId}
Headers: Authorization: Bearer {token}
Body: {
  "categoryName": "string",
  "categoryIcon": "string", 
  "displayOrder": number,
  "isActive": boolean
}
```

### 10.4 刪除科目
```http
DELETE /api/v1/categories/{categoryId}
Headers: Authorization: Bearer {token}
Query Parameters:
  - forceDelete: boolean (強制刪除)
```

---

## 11. 狀態與畫面切換（State Handling）

### 11.1 頁面狀態管理
```typescript
interface CategoryManagementState {
  categories: Category[];
  selectedType: 'income' | 'expense';
  isLoading: boolean;
  searchKeyword: string;
  sortMode: boolean;
  selectedCategory: Category | null;
}
```

### 11.2 狀態變更流程
- **載入狀態**: 顯示骨架屏與載入指示器
- **編輯狀態**: 啟用表單與驗證邏輯
- **排序狀態**: 啟用拖拽功能並暫存變更
- **錯誤狀態**: 顯示錯誤訊息與重試選項

### 11.3 頁面切換
- **進入頁面**: 從設定頁面或記帳頁面進入
- **離開頁面**: 確認未儲存變更後離開
- **子頁面**: 科目編輯、統計詳情

---

## 12. 安全性與權限檢查（Security / Access Control）

### 12.1 存取權限
- **基本權限**: 已登入使用者可檢視科目
- **編輯權限**: 帳本擁有者或具管理權限者可編輯
- **刪除權限**: 僅帳本擁有者可刪除自訂科目

### 12.2 資料安全
- **輸入清理**: 科目名稱XSS過濾
- **權限驗證**: 每次操作前驗證使用者權限
- **資料完整性**: 檢查科目關聯記錄一致性

### 12.3 敏感操作
- **批量刪除**: 需要二次確認
- **科目轉移**: 記錄操作日誌
- **權限變更**: 僅限帳本擁有者

---

## 13. 其他補充需求（Others）

### 13.1 效能需求
- **載入時間**: 科目清單載入 < 2秒
- **操作回應**: 新增/編輯/刪除 < 1秒
- **搜尋效能**: 本地搜尋即時回應 < 100ms

### 13.2 無障礙支援
- **螢幕閱讀器**: 科目資訊朗讀支援
- **鍵盤導航**: 支援Tab鍵操作
- **高對比**: 支援高對比顯示模式

### 13.3 多語言支援
- **科目名稱**: 支援繁體中文、簡體中文、英文
- **系統預設科目**: 多語言本地化
- **錯誤訊息**: 多語言錯誤提示

### 13.4 離線支援
- **本地快取**: 科目清單本地儲存
- **離線編輯**: 支援離線新增/編輯科目
- **同步機制**: 上線後自動同步變更

---

**文件狀態**: ✅ 已完成  
**下一階段**: P016_設定頁面_SRS.md  
**相關文件**: P011_快速記帳頁面_SRS.md、P012_詳細記帳頁面_SRS.md
