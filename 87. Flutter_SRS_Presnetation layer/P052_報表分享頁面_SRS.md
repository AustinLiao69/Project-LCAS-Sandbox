# P056 報表分享頁面 (Report Sharing Page + 報表分享頁面)

**文件版本**: v1.0.0
**建立日期**: 2025-01-26
**最後更新**: 2025-01-26
**負責團隊**: LCAS PM Team

---

## 目次
1. [功能目的](#1-功能目的purpose)
2. [使用者故事](#2-使用者故事user-story)
3. [前置條件](#3-前置條件preconditions)
4. [功能流程](#4-功能流程user-flow--functional-flow)
5. [輸入項目](#5-輸入項目inputs)
6. [輸出項目](#6-輸出項目outputs--responses)
7. [驗證規則](#7-驗證規則validation-rules)
8. [錯誤處理](#8-錯誤處理error-handling)
9. [UI 元件與排版需求](#9-ui-元件與排版需求ui-requirements)
10. [API 規格](#10-api-規格api-specification)
11. [狀態與畫面切換](#11-狀態與畫面切換state-handling)
12. [安全性與權限檢查](#12-安全性與權限檢查security--access-control)
13. [其他補充需求](#13-其他補充需求others)

---

## 版本記錄
| 版本 | 日期 | 異動內容 | 負責人員 |
|------|------|----------|----------|
| v1.0.0 | 2025-01-26 | 初始版本建立，完整SRS文件架構 | LCAS PM Team |

---

## 1. 功能目的（Purpose）
提供報表分享功能，讓使用者能夠安全地分享財務報表給團隊成員或外部利害關係人，包含權限控制、時效管理和存取追蹤。

---

## 2. 使用者故事（User Story）
- 作為一位財務管理者，我希望能分享月度財務報表給團隊成員，以便協作決策分析
- 作為一位專案負責人，我希望能設定報表分享權限和時效，以便控制資料存取安全
- 作為一位會計人員，我希望能追蹤報表分享狀況，以便了解報表使用情形
- 作為一位使用者，我希望能透過多種方式分享報表，以便滿足不同情境需求

---

## 3. 前置條件（Preconditions）
- 使用者已完成登入驗證
- 使用者具備報表分享權限
- 系統中存在可分享的報表
- 網路連線正常

---

## 4. 功能流程（User Flow / Functional Flow）

### 4.1 主要分享流程
1. 進入報表分享頁面
2. 選擇要分享的報表
3. 設定分享參數
4. 選擇分享方式
5. 確認分享設定
6. 執行分享動作
7. 查看分享狀態

### 4.2 權限管理流程
1. 設定存取權限等級
2. 指定分享對象
3. 設定時效期限
4. 配置操作限制
5. 生成分享連結
6. 發送分享通知

---

## 5. 輸入項目（Inputs）

| 欄位名稱 | 型別 | 限制條件 | UI 顯示 | 備註 |
|----------|------|----------|---------|------|
| 報表選擇 | 下拉選單 | 必選，限已完成報表 | 報表清單選擇器 | 顯示報表名稱和類型 |
| 分享對象 | 多選清單 | 選填，限已授權用戶 | 成員選擇器 | 支援內部/外部分享 |
| 權限等級 | 單選按鈕 | 必選 | 權限選項組 | 檢視/下載/編輯 |
| 有效期限 | 日期選擇器 | 選填，不超過90天 | 日期時間選擇器 | 預設7天 |
| 分享備註 | 文字輸入 | 選填，最多200字 | 多行文字框 | 分享說明 |
| 通知設定 | 複選框 | 選填 | 通知選項組 | 郵件/推播通知 |

---

## 6. 輸出項目（Outputs / Responses）

### 6.1 分享連結資訊
- 報表分享URL
- 存取權限說明
- 有效期限顯示
- QR Code產生

### 6.2 分享狀態回饋
- 分享成功確認
- 分享對象清單
- 存取記錄統計
- 錯誤訊息提示

---

## 7. 驗證規則（Validation Rules）
- 報表選擇：必須選擇有效的已完成報表
- 分享對象：必須是有效的用戶帳號
- 權限等級：必須選擇適當的權限層級
- 有效期限：不得超過系統設定的最大期限
- 分享備註：字數限制在200字以內
- 安全性檢查：確認分享權限合規性

---

## 8. 錯誤處理（Error Handling）
- **報表不存在**：顯示「找不到指定報表」錯誤訊息
- **權限不足**：顯示「您沒有分享此報表的權限」
- **分享對象無效**：標示無效的分享對象
- **期限設定錯誤**：提示有效的期限範圍
- **網路連線失敗**：顯示重試選項
- **分享失敗**：提供詳細錯誤說明和建議

---

## 9. UI 元件與排版需求（UI Requirements）

| 元件名稱 | 類型 | 功能 | 互動說明 |
|----------|------|------|----------|
| 報表選擇區 | 選擇器 | 選擇報表 | 下拉選單含預覽 |
| 分享設定面板 | 表單面板 | 設定分享參數 | 分組展示選項 |
| 對象選擇器 | 多選組件 | 選擇分享對象 | 支援搜尋篩選 |
| 權限控制組 | 單選組 | 設定權限等級 | 圖示化權限說明 |
| 時效設定器 | 日期選擇器 | 設定有效期限 | 快速選項 + 自訂 |
| 分享按鈕組 | 按鈕群組 | 執行分享動作 | 多種分享方式 |
| 狀態顯示區 | 資訊面板 | 顯示分享狀態 | 即時更新狀態 |
| 歷史記錄區 | 清單組件 | 分享歷史查看 | 可排序篩選 |

### 9.1 Layout 結構
```
頂部導航列
├── 頁面標題：「報表分享」
├── 幫助按鈕
└── 返回按鈕
主要內容區
├── 報表選擇區塊
│   ├── 報表清單
│   └── 報表預覽
├── 分享設定區塊
│   ├── 分享對象設定
│   ├── 權限等級選擇
│   ├── 時效期限設定
│   └── 分享備註輸入
├── 分享方式區塊
│   ├── 連結分享
│   ├── 郵件分享
│   ├── QR Code分享
│   └── 嵌入代碼
└── 分享管理區塊
    ├── 分享狀態監控
    ├── 存取記錄查看
    └── 分享歷史管理
```

---

## 10. API 規格（API Specification）

### 10.1 獲取可分享報表列表
**Request**
- URL: `/api/v1/reports/shareable`
- Method: GET
- Headers: Authorization: Bearer {token}

**Response Success (200)**
```json
{
  "reports": [
    {
      "reportId": "rpt_123",
      "name": "月度財務報表",
      "type": "financial",
      "status": "completed",
      "createdAt": "2025-01-01T00:00:00Z"
    }
  ]
}
```

### 10.2 建立分享連結
**Request**
- URL: `/api/v1/reports/{reportId}/share`
- Method: POST
- Body:
```json
{
  "recipients": ["user1@example.com"],
  "permission": "view",
  "expiresAt": "2025-02-01T00:00:00Z",
  "note": "月度報表分享",
  "notifyMethod": ["email"]
}
```

**Response Success (201)**
```json
{
  "shareId": "shr_456",
  "shareUrl": "https://app.lcas.com/shared/rpt_123?token=...",
  "qrCode": "data:image/png;base64,...",
  "expiresAt": "2025-02-01T00:00:00Z"
}
```

---

## 11. 狀態與畫面切換（State Handling）

### 11.1 頁面狀態
- **初始狀態**：顯示報表選擇界面
- **選擇狀態**：顯示分享設定選項
- **設定狀態**：顯示詳細分享參數
- **處理狀態**：顯示分享處理進度
- **完成狀態**：顯示分享結果和管理選項
- **錯誤狀態**：顯示錯誤訊息和修正建議

### 11.2 資料狀態
- **報表載入中**：顯示載入指示器
- **權限檢查中**：顯示驗證進度
- **分享建立中**：顯示處理動畫
- **分享成功**：顯示成功訊息和結果

---

## 12. 安全性與權限檢查（Security / Access Control）

### 12.1 權限驗證
- 驗證使用者報表分享權限
- 檢查報表存取權限
- 確認分享對象有效性
- 驗證權限等級合規性

### 12.2 資料安全
- 分享連結加密處理
- 時效性權限控制
- 存取記錄完整追蹤
- 敏感資料遮罩處理

### 12.3 合規檢查
- 資料分享政策確認
- 外部分享授權檢查
- 稽核記錄完整保存

---

## 13. 其他補充需求（Others）

### 13.1 效能需求
- 報表列表載入時間 < 2秒
- 分享連結生成時間 < 3秒
- 支援大型報表分享（最大50MB）
- 同時支援100個活躍分享連結

### 13.2 相容性需求
- 支援主流瀏覽器
- 響應式設計適配
- 離線模式支援（僅查看功能）

### 13.3 無障礙設計
- 支援螢幕閱讀器
- 鍵盤操作友善
- 色彩對比度符合標準
- 字型大小可調整

### 13.4 多語言支援
- 繁體中文（預設）
- 英文介面切換
- 分享通知多語言化

### 13.5 分析追蹤
- 分享行為統計
- 存取模式分析
- 效果評估報告

---

**文件結束**