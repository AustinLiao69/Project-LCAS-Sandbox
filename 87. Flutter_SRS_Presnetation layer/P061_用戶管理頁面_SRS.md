
## P061 用戶管理頁面（User Management Page）

**版本**: v1.0.0  
**建立日期**: 2025-01-26  
**建立者**: LCAS PM Team  
**最後更新**: 2025-01-26 16:45:00 UTC+8  

---

### 📑 目次 (Table of Contents)

1. [功能目的 (Purpose)](#1-功能目的-purpose)
2. [使用者故事 (User Story)](#2-使用者故事-user-story)
3. [前置條件 (Preconditions)](#3-前置條件-preconditions)
4. [功能流程 (Functional Flow)](#4-功能流程-functional-flow)
5. [輸入項目 (Inputs)](#5-輸入項目-inputs)
6. [輸出項目 (Outputs)](#6-輸出項目-outputs)
7. [驗證規則 (Validation Rules)](#7-驗證規則-validation-rules)
8. [錯誤處理 (Error Handling)](#8-錯誤處理-error-handling)
9. [UI 元件與排版需求 (UI Requirements)](#9-ui-元件與排版需求-ui-requirements)
10. [API 規格 (API Specification)](#10-api-規格-api-specification)
11. [狀態與畫面切換 (State Handling)](#11-狀態與畫面切換-state-handling)
12. [安全性與權限檢查 (Security)](#12-安全性與權限檢查-security)
13. [其他補充需求 (Others)](#13-其他補充需求-others)

---

### 1. 功能目的 (Purpose)

用戶管理頁面提供管理員完整的用戶帳戶管理功能，包含用戶資訊查看、權限管理、狀態控制和批次操作，確保系統用戶管理的完整性和安全性。

---

### 2. 使用者故事 (User Story)

**主要使用者故事**：
- 作為一位系統管理員，我希望能查看所有用戶清單，了解用戶基本資訊和狀態
- 作為一位管理員，我希望能管理用戶權限，控制功能存取範圍
- 作為一位管理員，我希望能停用或啟用用戶帳戶，維護系統安全

**次要使用者故事**：
- 作為一位管理員，我希望能批次處理用戶操作，提升管理效率
- 作為一位管理員，我希望能查看用戶活動記錄，監控使用情況

---

### 3. 前置條件 (Preconditions)

- 使用者已成功登入系統
- 使用者具備系統管理員權限
- 系統已載入用戶資料
- 網路連線正常

---

### 4. 功能流程 (Functional Flow)

#### 4.1 主要流程
1. 管理員進入用戶管理頁面
2. 瀏覽用戶清單和基本資訊
3. 選擇特定用戶進行操作
4. 執行用戶管理動作（檢視/編輯/停用等）
5. 確認操作並執行
6. 顯示操作結果

#### 4.2 分支流程
- **批次操作流程**：選擇多個用戶進行批次處理
- **權限設定流程**：調整特定用戶的功能權限
- **活動查詢流程**：檢視用戶活動歷史記錄

---

### 5. 輸入項目 (Inputs)

| 欄位名稱 | 型別 | 限制條件 | UI 顯示 | 備註 |
|----------|------|----------|---------|------|
| 搜尋關鍵字 | String | 可選，最多50字元 | 搜尋框 | 搜尋用戶姓名或Email |
| 用戶狀態篩選 | Select | 全部/啟用/停用/待驗證 | 下拉選單 | 篩選用戶狀態 |
| 註冊日期範圍 | DateRange | 可選 | 日期選擇器 | 註冊時間篩選 |
| 權限等級篩選 | Select | 全部/一般/進階/管理員 | 下拉選單 | 權限等級篩選 |
| 排序方式 | Select | 註冊時間/姓名/活動時間 | 下拉選單 | 清單排序方式 |
| 用戶狀態 | Select | 啟用/停用/待驗證 | 切換按鈕 | 修改用戶狀態 |
| 權限設定 | Object | 功能權限清單 | 權限矩陣 | 用戶功能權限 |
| 備註說明 | String | 可選，最多200字元 | 文字區域 | 管理備註 |

---

### 6. 輸出項目 (Outputs)

#### 6.1 用戶清單資訊
- 用戶基本資料（姓名、Email、註冊日期）
- 帳戶狀態（啟用、停用、待驗證）
- 權限等級和功能權限
- 最後活動時間
- 使用統計資訊

#### 6.2 操作結果
- 操作成功確認訊息
- 錯誤詳細資訊
- 批次操作結果摘要
- 變更記錄日誌

---

### 7. 驗證規則 (Validation Rules)

#### 7.1 權限驗證
- **管理員權限**：執行用戶管理操作需要管理員權限
- **權限等級限制**：不能設定高於自身權限的等級
- **系統保護**：超級管理員帳戶不可被停用

#### 7.2 操作驗證
- **批次操作限制**：單次操作用戶數量限制
- **狀態變更驗證**：確認用戶狀態變更的合理性
- **權限一致性**：檢查權限設定的邏輯一致性

---

### 8. 錯誤處理 (Error Handling)

#### 8.1 常見錯誤情境
- **權限不足**：操作超出當前管理員權限範圍
- **用戶不存在**：嘗試操作已刪除的用戶
- **操作衝突**：同時有其他管理員在操作同一用戶
- **系統保護**：嘗試操作受保護的系統帳戶

#### 8.2 錯誤訊息設計
```
成功訊息：
- "用戶狀態已成功更新"
- "權限設定已儲存"
- "批次操作已完成"

錯誤訊息：
- "權限不足，無法執行此操作"
- "用戶帳戶不存在或已被刪除"
- "系統保護帳戶，無法修改"
- "批次操作部分失敗，請檢查詳細結果"
```

---

### 9. UI 元件與排版需求 (UI Requirements)

#### 9.1 主要UI元件

| 元件名稱 | 類型 | 功能 | 互動說明 |
|----------|------|------|----------|
| 用戶清單表格 | DataTable | 顯示用戶資訊 | 排序、篩選、選擇 |
| 搜尋篩選欄 | FilterBar | 用戶搜尋篩選 | 輸入關鍵字和條件 |
| 操作按鈕群組 | ButtonGroup | 用戶操作功能 | 點擊執行操作 |
| 用戶詳情卡片 | Card | 顯示詳細資訊 | 展開查看詳情 |
| 權限設定矩陣 | Matrix | 權限配置介面 | 勾選權限項目 |
| 批次操作面板 | Panel | 批次處理功能 | 選擇並執行批次操作 |

#### 9.2 用戶清單欄位
```
📋 用戶清單
├── 選擇框 (全選/單選)
├── 用戶頭像
├── 用戶姓名
├── Email地址
├── 註冊日期
├── 帳戶狀態 (🟢啟用/🔴停用/🟡待驗證)
├── 權限等級
├── 最後活動
└── 操作選單 (檢視/編輯/停用/權限)
```

---

### 10. API 規格 (API Specification)

#### 10.1 獲取用戶清單
- **URL**：`GET /api/admin/users`
- **方法**：GET
- **查詢參數**：
```
?search=keyword&status=active&role=user&page=1&limit=20&sort=created_at&order=desc
```

#### 10.2 更新用戶狀態
- **URL**：`PUT /api/admin/users/{userId}/status`
- **方法**：PUT
- **Body 範例**：
```json
{
  "status": "active|inactive|pending",
  "reason": "管理員手動調整",
  "effectiveDate": "2025-01-26T16:45:00Z"
}
```

#### 10.3 更新用戶權限
- **URL**：`PUT /api/admin/users/{userId}/permissions`
- **方法**：PUT
- **Body 範例**：
```json
{
  "role": "user|admin|super_admin",
  "permissions": {
    "entry_management": true,
    "budget_management": true,
    "report_access": true,
    "collaboration": true,
    "system_settings": false,
    "user_management": false
  },
  "effectiveDate": "2025-01-26T16:45:00Z"
}
```

#### 10.4 批次用戶操作
- **URL**：`POST /api/admin/users/batch`
- **方法**：POST
- **Body 範例**：
```json
{
  "userIds": ["user1", "user2", "user3"],
  "action": "activate|deactivate|delete|update_role",
  "parameters": {
    "status": "active",
    "role": "user",
    "reason": "批次管理操作"
  }
}
```

#### 10.5 回應範例
**成功回應**：
```json
{
  "status": "success",
  "data": {
    "users": [
      {
        "id": "user_123",
        "name": "王小明",
        "email": "wang@example.com",
        "status": "active",
        "role": "user",
        "permissions": {
          "entry_management": true,
          "budget_management": true,
          "report_access": true,
          "collaboration": true
        },
        "createdAt": "2025-01-01T00:00:00Z",
        "lastActivity": "2025-01-26T15:30:00Z",
        "statistics": {
          "entriesCount": 150,
          "budgetsCount": 5,
          "reportsGenerated": 12
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 150,
      "totalPages": 8
    }
  }
}
```

---

### 11. 狀態與畫面切換 (State Handling)

#### 11.1 頁面狀態
- **載入中**：用戶資料載入中
- **正常顯示**：用戶清單正常展示
- **操作中**：用戶操作處理中
- **批次處理中**：批次操作執行中

#### 11.2 用戶狀態
- **啟用**：正常使用系統功能
- **停用**：暫時無法登入使用
- **待驗證**：新註冊等待驗證
- **已刪除**：帳戶已被刪除

---

### 12. 安全性與權限檢查 (Security)

#### 12.1 存取控制
- 管理員角色權限驗證
- 操作權限分級檢查
- 敏感操作二次確認
- 操作日誌完整記錄

#### 12.2 資料保護
- 用戶個人資料保護
- 批次操作安全限制
- 系統帳戶保護機制
- 權限變更審計追蹤

---

### 13. 其他補充需求 (Others)

#### 13.1 多語言支援
- 繁體中文（預設）
- 英文界面
- 簡體中文支援
- 動態語言切換

#### 13.2 無障礙設計
- 支援螢幕閱讀器
- 鍵盤導航支援
- 高對比度模式
- 大字體相容性

#### 13.3 效能最佳化
- 用戶清單分頁載入
- 搜尋結果快取
- 批次操作進度顯示
- 大量資料虛擬滾動

#### 13.4 稽核與合規
- 完整操作日誌記錄
- 用戶隱私保護合規
- 資料匯出權限控制
- 法規遵循檢查

---

**版本記錄**

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| v1.0.0 | 2025-01-26 | LCAS PM Team | 初版建立，完整的用戶管理功能規格 |
