
## P058 報表設定頁面（Report Settings Page）

**版本**: v1.0.0  
**建立日期**: 2025-01-26  
**建立者**: LCAS PM Team  
**最後更新**: 2025-01-26 16:30:00 UTC+8  

---

### 📑 目次 (Table of Contents)

1. [功能目的 (Purpose)](#1-功能目的-purpose)
2. [使用者故事 (User Story)](#2-使用者故事-user-story)
3. [前置條件 (Preconditions)](#3-前置條件-preconditions)
4. [功能流程 (Functional Flow)](#4-功能流程-functional-flow)
5. [輸入項目 (Inputs)](#5-輸入項目-inputs)
6. [輸出項目 (Outputs)](#6-輸出項目-outputs)
7. [驗證規則 (Validation Rules)](#7-驗證規則-validation-rules)
8. [錯誤處理 (Error Handling)](#8-錯誤處理-error-handling)
9. [UI 元件與排版需求 (UI Requirements)](#9-ui-元件與排版需求-ui-requirements)
10. [API 規格 (API Specification)](#10-api-規格-api-specification)
11. [狀態與畫面切換 (State Handling)](#11-狀態與畫面切換-state-handling)
12. [安全性與權限檢查 (Security)](#12-安全性與權限檢查-security)
13. [其他補充需求 (Others)](#13-其他補充需求-others)

---

### 1. 功能目的 (Purpose)

報表設定頁面讓使用者能夠配置報表生成的預設參數、格式偏好、自動化設定和個人化選項，提供統一的報表生成體驗設定管理。

---

### 2. 使用者故事 (User Story)

**主要使用者故事**：
- 作為一位使用者，我希望能設定報表的預設格式和樣式，以便每次生成都符合我的需求
- 作為一位會計師，我希望能配置自動報表生成排程，以便定期獲得財務報表
- 作為一位管理者，我希望能設定報表權限和分享規則，確保資料安全性

**次要使用者故事**：
- 作為一位使用者，我希望能自訂報表封面和標題，展現專業形象
- 作為一位分析師，我希望能設定預設的圖表類型和顏色主題

---

### 3. 前置條件 (Preconditions)

- 使用者已成功登入系統
- 使用者具備報表設定權限
- 系統已載入預設設定選項
- 網路連線正常

---

### 4. 功能流程 (Functional Flow)

#### 4.1 主要流程
1. 使用者進入報表設定頁面
2. 系統載入當前設定值
3. 使用者修改各項設定參數
4. 預覽設定效果（可選）
5. 儲存設定變更
6. 系統驗證並更新設定
7. 顯示設定完成確認

#### 4.2 分支流程
- **重置設定流程**：恢復預設設定值
- **匯入設定流程**：從檔案匯入設定
- **匯出設定流程**：將設定匯出為檔案

---

### 5. 輸入項目 (Inputs)

| 欄位名稱 | 型別 | 限制條件 | UI 顯示 | 備註 |
|----------|------|----------|---------|------|
| 預設格式 | Select | 必選：PDF/Excel/CSV | 單選按鈕 | 預設報表輸出格式 |
| 頁面尺寸 | Select | 可選：A4/A3/Letter | 下拉選單 | 僅PDF格式適用 |
| 字體大小 | Number | 8-24px | 滑桿 | 報表內文字體大小 |
| 色彩主題 | Select | 預設/藍色/綠色/自訂 | 色彩選擇器 | 圖表和樣式主題 |
| 公司Logo | File | 可選，≤2MB，JPG/PNG | 檔案上傳 | 報表封面Logo |
| 公司名稱 | String | 可選，最多100字元 | 輸入框 | 顯示在報表標題 |
| 自動生成 | Boolean | 可選 | 開關按鈕 | 啟用定期自動生成 |
| 生成頻率 | Select | 每日/每週/每月 | 下拉選單 | 自動生成頻率 |
| 發送Email | Boolean | 可選 | 開關按鈕 | 完成後自動發送 |
| Email清單 | Array | 可選，Email格式 | 標籤輸入 | 自動發送收件人 |

---

### 6. 輸出項目 (Outputs)

#### 6.1 設定確認資訊
- 設定變更摘要
- 生效時間說明
- 影響範圍提示
- 預覽效果展示

#### 6.2 驗證結果
- 設定值有效性檢查
- 權限驗證結果
- 儲存狀態回饋
- 錯誤詳細資訊

---

### 7. 驗證規則 (Validation Rules)

#### 7.1 格式驗證
- **檔案格式**：Logo必須為JPG或PNG格式
- **檔案大小**：不得超過2MB限制
- **Email格式**：符合標準Email格式規範
- **字體大小**：在合理範圍內(8-24px)

#### 7.2 業務邏輯驗證
- **自動生成設定**：頻率與權限匹配檢查
- **Email發送**：收件人清單不得為空
- **色彩主題**：自訂色彩符合對比度要求

---

### 8. 錯誤處理 (Error Handling)

#### 8.1 常見錯誤情境
- **檔案上傳失敗**：網路問題或檔案格式錯誤
- **設定儲存失敗**：伺服器錯誤或權限問題
- **Email驗證失敗**：格式錯誤或無效地址
- **預覽生成失敗**：設定參數無效

#### 8.2 錯誤訊息設計
```
成功訊息：
- "報表設定已成功更新"
- "Logo上傳完成"
- "自動生成排程已啟用"

錯誤訊息：
- "檔案格式不支援，請使用JPG或PNG"
- "檔案大小超過2MB限制"
- "Email地址格式不正確"
- "設定儲存失敗，請重試"
```

---

### 9. UI 元件與排版需求 (UI Requirements)

#### 9.1 主要UI元件

| 元件名稱 | 類型 | 功能 | 互動說明 |
|----------|------|------|----------|
| 設定群組 | Accordion | 分類管理設定項目 | 展開/收合 |
| 檔案上傳器 | FileUpload | 上傳Logo檔案 | 拖拽或點擊上傳 |
| 色彩選擇器 | ColorPicker | 選擇主題色彩 | 色輪或色板選擇 |
| 預覽面板 | Preview | 設定效果預覽 | 即時更新預覽 |
| 儲存按鈕 | Button | 儲存所有設定 | 確認變更 |
| 重置按鈕 | Button | 恢復預設設定 | 二次確認 |

#### 9.2 設定群組結構
```
📋 基本設定
├── 預設格式
├── 頁面配置
└── 字體設定

🎨 外觀設定
├── 色彩主題
├── 公司Logo
└── 標題設定

⚙️ 自動化設定
├── 自動生成
├── 生成排程
└── 發送設定
```

---

### 10. API 規格 (API Specification)

#### 10.1 獲取設定
- **URL**：`GET /api/reports/settings`
- **方法**：GET

#### 10.2 更新設定
- **URL**：`PUT /api/reports/settings`
- **方法**：PUT
- **Body 範例**：
```json
{
  "default_format": "pdf",
  "page_size": "A4",
  "font_size": 12,
  "color_theme": "blue",
  "company_name": "LCAS科技有限公司",
  "auto_generate": true,
  "generate_frequency": "monthly",
  "auto_email": true,
  "email_recipients": ["admin@lcas.com", "finance@lcas.com"]
}
```

#### 10.3 回應範例
**成功回應**：
```json
{
  "status": "success",
  "data": {
    "settings": {
      "default_format": "pdf",
      "page_size": "A4",
      "font_size": 12,
      "color_theme": "blue",
      "company_logo_url": "https://storage.lcas.com/logos/company_logo.png",
      "company_name": "LCAS科技有限公司",
      "auto_generate": true,
      "generate_frequency": "monthly",
      "next_generate_time": "2025-02-01T00:00:00Z",
      "auto_email": true,
      "email_recipients": ["admin@lcas.com", "finance@lcas.com"]
    },
    "updated_at": "2025-01-26T16:30:00Z"
  }
}
```

---

### 11. 狀態與畫面切換 (State Handling)

#### 11.1 頁面狀態
- **載入中**：設定值載入狀態
- **編輯中**：使用者修改設定
- **儲存中**：設定更新處理中
- **完成**：設定更新完成

#### 11.2 互動狀態
- **檔案上傳**：上傳進度和結果顯示
- **預覽更新**：設定變更即時預覽
- **驗證狀態**：輸入驗證結果提示

---

### 12. 安全性與權限檢查 (Security)

#### 12.1 資料安全
- 上傳檔案病毒掃描
- 設定值範圍限制
- 敏感資訊加密儲存
- 操作日誌記錄

#### 12.2 權限控制
- 使用者身份驗證
- 設定修改權限檢查
- 自動化功能權限驗證
- 企業級設定權限管控

---

### 13. 其他補充需求 (Others)

#### 13.1 多語言支援
- 繁體中文（預設）
- 英文介面切換
- 報表內容多語言設定

#### 13.2 無障礙設計
- 支援螢幕閱讀器
- 鍵盤導航支援
- 高對比度模式

#### 13.3 平台差異
- **iOS**：原生檔案選擇器
- **Android**：系統文件管理器
- **Web**：拖拽上傳支援

#### 13.4 效能最佳化
- 設定值快取機制
- 預覽生成節流處理
- 大檔案上傳分片
- 設定變更批次更新

---

**版本記錄**

| 版本 | 日期 | 修改者 | 修改內容 |
|------|------|--------|----------|
| v1.0.0 | 2025-01-26 | LCAS PM Team | 初版建立，完整的報表設定管理功能規格 |
