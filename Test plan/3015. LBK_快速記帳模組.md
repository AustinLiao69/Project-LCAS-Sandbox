
# TP_LBK_快速記帳模組 Test Plan v1.0

## 1. 測試範圍
### 1.1 快速記帳核心功能
- 1.1.1 LINE OA文字訊息接收與解析
- 1.1.2 自然語言記帳格式識別
- 1.1.3 金額提取與驗證
- 1.1.4 科目代碼匹配（精確匹配與模糊匹配）
- 1.1.5 支付方式識別與驗證

### 1.2 資料處理與儲存
- 1.2.1 記帳資料驗證與格式化
- 1.2.2 唯一記帳ID生成
- 1.2.3 Firestore資料儲存
- 1.2.4 與BK模組資料格式相容性
- 1.2.5 時區處理（台灣時區）

### 1.3 錯誤處理與回覆
- 1.3.1 解析失敗處理
- 1.3.2 科目不存在處理
- 1.3.3 系統錯誤處理
- 1.3.4 回覆訊息格式化
- 1.3.5 日誌記錄完整性

### 1.4 效能與穩定性
- 1.4.1 處理時間驗證（<2秒目標）
- 1.4.2 併發處理能力
- 1.4.3 記憶體使用效率
- 1.4.4 長時間運行穩定性

### 1.5 整合性測試
- 1.5.1 與WH模組介面整合
- 1.5.2 與DL模組日誌整合
- 1.5.3 與Firestore資料庫整合
- 1.5.4 與現有BK模組共存性

### 1.6 安全性與資料保護
- 1.6.1 輸入資料驗證
- 1.6.2 SQL注入防護
- 1.6.3 敏感資料處理
- 1.6.4 權限驗證

---

## 2. 測試環境
### 2.1 系統環境
- Node.js 運行環境（LTS版本）
- Firebase Admin SDK v13.4.0+
- 測試專用 Firestore 資料庫
- LCAS 2.0 LBK 快速記帳模組 v1.0.0

### 2.2 測試資料準備
- 測試用LINE使用者ID
- 完整科目表資料
- 各種記帳格式測試案例
- 邊界值與異常資料

### 2.3 相依模組
- WH模組（Webhook處理）
- DL模組（資料記錄）
- Firebase Admin SDK
- moment-timezone庫

---

## 3. 測試案例（Test Cases 詳細說明）

### TC-001 文字解析功能驗證
- 目的：驗證LBK模組能正確解析各種自然語言記帳格式
- 步驟：
  1. 測試負數格式：「午餐-100」、「咖啡-50現金」
  2. 測試標準格式：「薪水50000」、「獎金10000轉帳」
  3. 測試邊界案例：空字串、特殊字元、超長文字
  4. 測試不支援幣別：「午餐100USD」、「咖啡50NT」
- 驗證點：
  - 正確提取科目名稱、金額、支付方式
  - 正確識別收入/支出類型
  - 不支援格式正確拒絕並回覆錯誤訊息
- 預期結果：
  - 支援格式解析準確率 > 95%
  - 錯誤格式正確拒絕，回覆明確提示

---

### TC-002 科目匹配與模糊搜尋
- 目的：驗證科目代碼查詢的準確性和模糊匹配能力
- 步驟：
  1. 精確匹配測試：使用完全相符的科目名稱
  2. 同義詞匹配測試：使用科目同義詞
  3. 模糊匹配測試：使用相似但不完全相符的詞彙
  4. 科目不存在測試：使用完全無關的詞彙
  5. 測試科目表為空的情況
- 驗證點：
  - 精確匹配成功率 100%
  - 同義詞匹配成功率 > 90%
  - 模糊匹配在閾值範圍內準確
  - 無匹配時回覆適當錯誤訊息
- 預期結果：
  - 科目匹配準確性符合預期
  - 查詢效能在可接受範圍內

---

### TC-003 金額處理與驗證
- 目的：驗證金額提取、驗證和處理的正確性
- 步驟：
  1. 測試各種金額格式：整數、小數點、逗號分隔
  2. 測試金額邊界值：1元、999999999元
  3. 測試無效金額：0元、負數、非數字
  4. 測試前導零處理：「01」、「0100」
  5. 測試幣別單位：「元」、「塊」、「圓」
- 驗證點：
  - 正確提取並驗證金額
  - 前導零正確拒絕
  - 無效金額正確處理
  - 幣別單位正確識別
- 預期結果：
  - 金額處理準確性 100%
  - 邊界值處理正確

---

### TC-004 記帳ID生成與唯一性
- 目的：驗證記帳ID生成機制的唯一性和格式正確性
- 步驟：
  1. 生成大量記帳ID檢查唯一性
  2. 跨日期測試ID格式正確性
  3. 測試同日多筆記帳的序號遞增
  4. 測試ID生成失敗時的備用機制
  5. 併發情況下的ID唯一性
- 驗證點：
  - ID格式符合YYYYMMDD-NNNNN規範
  - 同日序號正確遞增
  - 併發情況下無重複ID
  - 失敗時備用機制正常運作
- 預期結果：
  - ID唯一性 100%
  - 格式規範性 100%

---

### TC-005 Firestore資料儲存一致性
- 目的：驗證與BK模組的資料格式完全相容
- 步驟：
  1. 比較LBK與BK模組儲存的資料結構
  2. 驗證所有欄位名稱和資料型別
  3. 測試時區處理的一致性
  4. 驗證currency欄位和timestamp欄位
  5. 測試Firestore連線異常處理
- 驗證點：
  - 資料結構100%相容
  - 欄位格式完全一致
  - 時區處理正確
  - 連線異常正確處理
- 預期結果：
  - 資料相容性 100%
  - 無資料遺失或格式錯誤

---

### TC-006 效能與回應時間驗證
- 目的：驗證LBK模組達成<2秒處理時間目標
- 步驟：
  1. 單筆記帳處理時間測試
  2. 併發100筆記帳處理測試
  3. 不同複雜度解析任務的時間測試
  4. 長時間運行的效能穩定性測試
  5. 記憶體使用監控
- 驗證點：
  - 90%請求處理時間 < 2秒
  - 99%請求處理時間 < 3秒
  - 併發處理不造成顯著延遲
  - 記憶體使用率 < 80%
- 預期結果：
  - 效能目標達成
  - 系統資源使用合理

---

### TC-007 錯誤處理與回覆機制
- 目的：驗證各種錯誤情況的處理和回覆
- 步驟：
  1. 測試解析錯誤回覆
  2. 測試科目不存在回覆
  3. 測試Firestore連線錯誤
  4. 測試系統異常處理
  5. 測試Reply Token超時情況
- 驗證點：
  - 錯誤訊息清楚明確
  - 使用者友善的錯誤提示
  - 系統錯誤不會導致崩潰
  - 日誌記錄完整
- 預期結果：
  - 錯誤處理覆蓋率 100%
  - 使用者體驗良好

---

### TC-008 WH模組整合測試
- 目的：驗證與WH模組的介面整合正確性
- 步驟：
  1. 測試WH調用LBK的介面規格
  2. 驗證輸入參數格式和完整性
  3. 測試回傳結果格式
  4. 驗證processingTime計算正確性
  5. 測試異常情況下的回傳值
- 驗證點：
  - 介面規格完全相符
  - 輸入輸出格式正確
  - 錯誤狀況正確回傳
  - 整合無相容性問題
- 預期結果：
  - 整合測試 100%通過
  - 介面穩定可靠

---

### TC-009 日誌記錄與除錯資訊
- 目的：驗證DL模組整合和日誌記錄功能
- 步驟：
  1. 測試各級別日誌記錄（DEBUG、INFO、WARNING、ERROR）
  2. 驗證日誌格式和內容完整性
  3. 測試processId追蹤功能
  4. 驗證錯誤日誌詳細程度
  5. 測試日誌效能影響
- 驗證點：
  - 日誌記錄完整無遺漏
  - 日誌格式符合規範
  - processId正確追蹤
  - 日誌不影響主要功能效能
- 預期結果：
  - 日誌功能完善
  - 除錯資訊充足

---

### TC-010 邊界與壓力測試
- 目的：驗證極端條件下的系統穩定性
- 步驟：
  1. 測試最大長度文字輸入
  2. 測試特殊字元和Unicode字元
  3. 測試同時1000筆記帳請求
  4. 測試網路延遲和中斷情況
  5. 測試記憶體不足情況
- 驗證點：
  - 極端輸入不造成系統崩潰
  - 大量並發請求穩定處理
  - 網路異常正確處理
  - 資源不足時優雅降級
- 預期結果：
  - 系統在極端條件下穩定運行
  - 異常情況有適當處理

---

## 4. 測試方法
### 4.1 Node.js 單元測試
- 4.1.1 使用 Jest 測試框架撰寫單元測試
- 4.1.2 針對每個核心函數編寫測試案例
- 4.1.3 使用 Mock 隔離外部依賴
- 4.1.4 達成 > 90% 程式碼覆蓋率

### 4.2 整合測試
- 4.2.1 端到端測試流程驗證
- 4.2.2 模組間介面測試
- 4.2.3 Firestore資料庫整合測試
- 4.2.4 真實LINE OA環境測試

### 4.3 效能測試
- 4.3.1 負載測試工具進行壓力測試
- 4.3.2 回應時間監控和分析
- 4.3.3 資源使用率監控
- 4.3.4 併發能力測試

### 4.4 自動化測試
- 4.4.1 建立CI/CD自動化測試流程
- 4.4.2 回歸測試自動執行
- 4.4.3 測試報告自動生成
- 4.4.4 失敗案例自動通知

---

## 5. 測試步驟
### 5.1 環境準備
- 5.1.1 建立獨立測試Firestore資料庫
- 5.1.2 準備完整測試資料集
- 5.1.3 設定測試用LINE Bot環境
- 5.1.4 準備監控和日誌工具

### 5.2 單元測試執行
- 5.2.1 執行所有單元測試案例
- 5.2.2 檢查程式碼覆蓋率
- 5.2.3 修正失敗的測試案例
- 5.2.4 生成單元測試報告

### 5.3 整合測試執行
- 5.3.1 端到端流程測試
- 5.3.2 模組間介面驗證
- 5.3.3 資料一致性檢查
- 5.3.4 錯誤處理驗證

### 5.4 效能測試執行
- 5.4.1 基準效能測試
- 5.4.2 負載壓力測試
- 5.4.3 併發能力測試
- 5.4.4 長時間穩定性測試

### 5.5 使用者驗收測試
- 5.5.1 真實LINE OA環境測試
- 5.5.2 使用者體驗驗證
- 5.5.3 錯誤訊息友善度檢查
- 5.5.4 整體流程順暢度評估

---

## 6. 驗收標準
### 6.1 功能完整性
- 6.1.1 所有核心功能100%通過測試
- 6.1.2 文字解析準確率 > 95%
- 6.1.3 科目匹配成功率 > 90%
- 6.1.4 資料儲存成功率 > 99.9%

### 6.2 效能指標
- 6.2.1 90%請求處理時間 < 2秒
- 6.2.2 99%請求處理時間 < 3秒
- 6.2.3 支援100+併發請求
- 6.2.4 記憶體使用率 < 80%

### 6.3 相容性要求
- 6.3.1 與BK模組資料格式100%相容
- 6.3.2 與WH模組介面100%相容
- 6.3.3 Firestore資料結構一致
- 6.3.4 時區處理正確

### 6.4 錯誤處理能力
- 6.4.1 錯誤處理覆蓋率100%
- 6.4.2 系統錯誤率 < 0.1%
- 6.4.3 異常回復時間 < 10秒
- 6.4.4 日誌記錄完整性100%

### 6.5 安全性要求
- 6.5.1 輸入驗證100%覆蓋
- 6.5.2 無SQL注入漏洞
- 6.5.3 敏感資料正確處理
- 6.5.4 權限驗證正確

---

## 7. 風險評估與緩解措施
### 7.1 高風險項目
- 7.1.1 **解析邏輯錯誤**：可能導致記帳資料錯誤
  - 緩解：加強單元測試，建立完整測試案例庫
- 7.1.2 **Firestore相容性問題**：可能影響與BK模組共存
  - 緩解：詳細比對資料結構，建立相容性測試
- 7.1.3 **效能目標未達成**：可能影響使用者體驗
  - 緩解：持續效能監控，優化瓶頸函數

### 7.2 中風險項目
- 7.2.1 **錯誤處理不完整**：可能導致系統不穩定
  - 緩解：全面錯誤情境測試，完善異常處理
- 7.2.2 **整合介面問題**：可能影響模組間協作
  - 緩解：詳細介面規格驗證，加強整合測試

### 7.3 低風險項目
- 7.3.1 **日誌記錄問題**：影響除錯能力
  - 緩解：驗證日誌完整性，確保格式正確

---

## 8. 測試排程與里程碑
### 8.1 Phase 1: 單元測試 (Week 1)
- Day 1-2: 測試環境建立
- Day 3-4: 核心函數單元測試
- Day 5: 測試結果分析與修正

### 8.2 Phase 2: 整合測試 (Week 2)
- Day 1-2: 模組間整合測試
- Day 3-4: 資料庫整合測試
- Day 5: 整合問題修正

### 8.3 Phase 3: 效能與壓力測試 (Week 3)
- Day 1-2: 效能基準測試
- Day 3-4: 壓力與併發測試
- Day 5: 效能優化建議

### 8.4 Phase 4: 使用者驗收測試 (Week 4)
- Day 1-2: 真實環境測試
- Day 3-4: 使用者體驗驗證
- Day 5: 最終報告與建議

---

## 9. 測試資源與工具
### 9.1 測試工具
- **單元測試**: Jest, Mocha
- **效能測試**: Artillery, LoadRunner
- **監控工具**: New Relic, DataDog
- **程式碼覆蓋率**: Istanbul/nyc

### 9.2 測試資源
- **人力**: 資深SQA 1名，QA工程師2名
- **環境**: 獨立測試環境，模擬生產環境
- **時間**: 4週完整測試週期

### 9.3 測試資料
- **正常案例**: 1000筆各種格式記帳文字
- **邊界案例**: 100筆邊界值測試
- **異常案例**: 200筆錯誤輸入測試
- **壓力案例**: 10000筆併發測試資料

---

## 10. 品質門檻與發布標準
### 10.1 必須達成標準（Go/No-Go）
- 所有TC-001至TC-010測試案例100%通過
- 效能目標90%達成（<2秒處理時間）
- 與BK模組資料格式100%相容
- 系統錯誤率 < 0.1%

### 10.2 建議達成標準
- 程式碼覆蓋率 > 90%
- 文件完整性 > 95%
- 使用者滿意度 > 4.5/5.0

### 10.3 發布條件
- 通過所有必須達成標準
- 無Critical或High severity缺陷
- 效能測試報告通過審核
- 安全性檢查通過

---

## 11. 備註
### 11.1 測試數據管理
- 11.1.1 測試資料請明確標示，避免污染生產環境
- 11.1.2 測試完成後清理測試資料
- 11.1.3 保留關鍵測試案例供回歸測試使用

### 11.2 文件管理
- 11.2.1 所有測試記錄、缺陷報告存於專案workbench
- 11.2.2 維護測試案例版本管理
- 11.2.3 更新測試計畫隨模組版本演進

### 11.3 協作說明
- 11.3.1 適用於LBK模組v1.0.0
- 11.3.2 測試過程中與開發團隊密切配合
- 11.3.3 重大問題及時上報PM和SA

---

**文件狀態**: Draft - 待Approve  
**版本**: v1.0  
**建立日期**: 2025-07-15  
**建立者**: SQA Team  

**下一步行動**:
1. PM審核測試計畫完整性
2. 開發團隊確認測試環境需求
3. 獲得Approve後開始測試環境建立
4. 執行階段性測試並追蹤進度

---

**變更歷史**:
- v1.0 (2025-07-15): 初版建立，基於LBK模組v1.0.0制定完整測試計畫，重點關注效能目標和相容性驗證

---
