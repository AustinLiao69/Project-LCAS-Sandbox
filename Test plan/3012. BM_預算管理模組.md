# TP_BM_預算管理模組 Test Plan v1.2

## 1. 測試範圍
### 1.1 帳本管理功能
- 1.1.1 新增、編輯、刪除帳本
- 1.1.2 帳本歸檔與還原
- 1.1.3 帳本複製、資料遷移

### 1.2 帳本類型與屬性設定
- 1.2.1 支援專案、分類、共享帳本
- 1.2.2 帳本名稱、封面、標籤自訂
- 1.2.3 類型、屬性、分類規則設定

### 1.3 權限與成員管理
- 1.3.1 設定帳本擁有者、管理員、一般成員、僅檢視者
- 1.3.2 邀請、移除協作者
- 1.3.3 權限驗證與異常處理

### 1.4 帳本型態切換與路由
- 1.4.1 前端介面帳本切換
- 1.4.2 API 查詢、切換、權限檢查

### 1.5 整合性測試
- 1.5.1 與預算、協作、備份模組整合
- 1.5.2 各模組間資料同步

### 1.6 錯誤處理與異常情境
- 1.6.1 權限不足阻擋
- 1.6.2 重複名稱阻擋
- 1.6.3 資料遷移失敗重試
- 1.6.4 帳本刪除二次確認

---

## 2. 測試環境
### 2.1 系統環境
- Google Apps Script（GAS）運行環境
- 測試專用 Google Sheet
- LCAS 2.0 預算管理模組 v1.0

### 2.2 測試帳號
- 擁有者、管理員、一般成員、僅檢視者角色帳號各一

### 2.3 其他模組
- 預算、協作、備份模組測試版本

---

## 3. 測試案例（Test Cases 詳細說明）

### TC-001 帳本新增功能
- 目的：驗證各角色新增帳本（各類型）流程與限制。
- 步驟：
  1. 以擁有者、管理員、一般成員、僅檢視者分別登入系統。
  2. 點擊「新增帳本」按鈕，分別選擇「專案帳本」、「分類帳本」、「共享帳本」。
  3. 輸入合法帳本名稱、封面、標籤，提交。
  4. 再次嘗試以相同名稱新增帳本（測試重複名稱）。
  5. 權限不足者嘗試新增帳本。
- 驗證點：
  - 帳本清單是否出現新帳本，屬性（名稱、類型、封面、標籤）是否與輸入一致。
  - 權限不足者（如僅檢視者）操作是否被阻擋並提示「權限不足」。
  - 輸入重複名稱時是否跳出錯誤提示「帳本名稱已存在」。
  - 日誌是否紀錄新增帳本行為及異常狀況。
- 預期結果：
  - 具備權限者可成功新增帳本並取得帳本ID，無權限者被正確阻擋；重複名稱時不得重複建立。

---

### TC-002 帳本編輯與屬性設定
- 目的：確保帳本屬性可正確編輯，權限控制正常。
- 步驟：
  1. 以帳本擁有者、管理員登入，進入現有帳本編輯頁面。
  2. 修改帳本名稱、封面圖片、標籤、類型、分類規則等屬性，保存。
  3. 嘗試將名稱更改為已存在的其他帳本名稱。
  4. 以一般成員、僅檢視者身分嘗試編輯上述屬性。
- 驗證點：
  - 編輯後，帳本清單/詳細頁是否同步顯示新屬性。
  - 權限不足時，前端是否禁止操作並給予提示；API 是否正確阻擋。
  - 編輯為重複名稱時，跳出錯誤提示，不得保存。
  - 日誌紀錄編輯與異常操作。
- 預期結果：
  - 擁有者/管理員可順利編輯並即時反映，無權限者操作被禁止且提示明確。

---

### TC-003 帳本刪除與歸檔
- 目的：驗證刪除、歸檔帳本功能及資料安全機制。
- 步驟：
  1. 以擁有者/管理員身分選擇目標帳本，執行「刪除」或「歸檔」。
  2. 系統彈出二次確認視窗，輸入確認資訊（如再次點擊或輸入「刪除」）。
  3. 檢查帳本是否消失於清單，資料是否進入歸檔區。
  4. 測試歸檔帳本的還原功能。
  5. 權限不足者嘗試刪除、歸檔帳本。
- 驗證點：
  - 刪除/歸檔操作必須經雙重確認，誤操作時可取消。
  - 歸檔帳本於歸檔區可見且可還原，資料未遺失。
  - 刪除後不可還原、資料移除（除非有備份策略）。
  - 權限控制正確，無權限者操作被阻擋。
  - 日誌紀錄所有操作與異常。
- 預期結果：
  - 僅權限者可刪除/歸檔，流程安全，資料可控，異常時有提示。

---

### TC-004 帳本複製與資料遷移
- 目的：確保帳本資料可完整複製、遷移，原帳本資料不受影響。
- 步驟：
  1. 以管理員或擁有者選擇來源帳本，執行「複製帳本」。
  2. 填寫新帳本名稱與屬性，選擇需複製的資料範圍（全部/部分）。
  3. 提交後，檢查新帳本資料（包括明細、成員、分類等）是否正確。
  4. 測試資料遷移時，模擬網路中斷/資料異常。
  5. 驗證原帳本資料不被覆蓋或刪除。
- 驗證點：
  - 新帳本內容是否完整且正確，原帳本不變。
  - 異常時有錯誤提示，系統可重試或回滾。
  - 日誌紀錄所有操作及異常。
- 預期結果：
  - 複製/遷移成功，失敗時資料安全，錯誤處理有明確提示。

---

### TC-005 權限與成員管理
- 目的：驗證帳本成員管理與權限分級的正確性。
- 步驟：
  1. 以帳本擁有者邀請協作者（管理員/一般成員/僅檢視者），設定不同權限。
  2. 編輯、移除成員，觀察成員列表即時變化。
  3. 權限異動後，以不同角色登入確認可執行/不可執行的操作。
  4. 權限不足者嘗試邀請/移除/權限變更。
- 驗證點：
  - 成員列表與權限設定即時生效。
  - 權限異動後，使用者界面與API權限一致。
  - 權限不足時，操作被正確阻擋並提示。
  - 日誌紀錄所有異動。
- 預期結果：
  - 權限分級明確，管理流程流暢，無權限者無法進行管理操作。

---

### TC-006 帳本型態切換與查詢
- 目的：驗證前端多帳本切換與API查詢/權限控管。
- 步驟：
  1. 不同角色登入，於前端介面切換不同帳本類型及具體帳本。
  2. 檢查帳本內容、屬性、成員清單是否正確顯示。
  3. API 端進行多帳本查詢與切換，測試權限不足者查詢未授權帳本。
- 驗證點：
  - 切換時界面資料是否即時正確（含帳本屬性、明細、成員等）。
  - 權限不足時API是否明確回傳錯誤。
  - 日誌是否紀錄查詢與切換行為。
- 預期結果：
  - 切換流暢、資料正確、權限控管嚴謹。

---

### TC-007 與其他模組整合
- 目的：確保帳本與預算、協作、備份模組之間可順利資料同步與權限整合。
- 步驟：
  1. 建立帳本，於預算模組分配預算、協作模組分派任務。
  2. 變更帳本權限或成員，觀察預算/協作/備份模組資料同步情形。
  3. 執行帳本備份、還原，檢查資料正確性。
  4. 模擬整合過程中出現異常（如權限不符、網路斷線）。
- 驗證點：
  - 跨模組資料同步是否即時且正確。
  - 權限異動在各模組均正確反映。
  - 整合異常時有提示並可回滾。
  - 日誌紀錄整合操作及異常。
- 預期結果：
  - 各模組資料一致、整合順暢，異常時有補救。

---

### TC-008 權限錯誤與異常情境
- 目的：驗證權限控制與異常處理機制。
- 步驟：
  1. 以一般成員、僅檢視者操作刪除、編輯、遷移等非授權功能。
  2. 直接調用API模擬權限繞過。
  3. 嘗試存取未被授權的帳本與資料。
- 驗證點：
  - 所有未授權操作均被嚴格阻擋。
  - 前端/後端報錯訊息明確，無資安漏洞。
  - 異常行為均有日誌紀錄。
- 預期結果：
  - 權限控管無死角，異常提示明確且無資料外洩風險。

---

### TC-009 邊界與例外測試
- 目的：評估系統在極端條件下的穩定性與錯誤處理。
- 步驟：
  1. 批量建立1000本帳本及大量成員（如每本帳本加入50人）。
  2. 測試帳本名稱長度上限、特殊符號、空白名稱等情境。
  3. 複製/遷移時模擬網路中斷、資料異常。
  4. 多人同時操作（如同時修改同一帳本）。
- 驗證點：
  - 操作過程中系統反應時間、是否有逾時或崩潰。
  - 邊界值輸入有適當提示與限制。
  - 異常時資料不遺失、不毀損，有重試或回滾。
  - 日誌完整紀錄所有操作與錯誤。
- 預期結果：
  - 系統可承受大量操作，異常/例外時系統穩定且資料安全。

---

## 4. 測試方法
### 4.1 Google Apps Script 測試
- 4.1.1 以 GAS 執行各 API 測試函數
- 4.1.2 檢查回傳值與試算表內容
- 4.1.3 透過 console.log 追蹤測試進度

### 4.2 自動化測試
- 4.2.1 寫自動化腳本覆蓋所有 Test Case
- 4.2.2 自動收集並統計通過/失敗率

### 4.3 手動測試
- 4.3.1 針對複雜權限、異常場景進行人工驗證
- 4.3.2 跨模組資料同步、前端視覺確認

---

## 5. 測試步驟
### 5.1 環境準備
- 5.1.1 建立測試專用試算表與帳號
- 5.1.2 設定帳本類型、成員權限
- 5.1.3 備份原始資料

### 5.2 自動化測試執行
- 5.2.1 執行自動化腳本
- 5.2.2 監控測試進度與結果
- 5.2.3 匯出測試報告

### 5.3 手動測試執行
- 5.3.1 針對權限、異常、整合進行人工驗證
- 5.3.2 視覺檢查介面與資料一致性

### 5.4 結果分析與修正
- 5.4.1 分析測試結果，標記缺陷
- 5.4.2 與開發團隊溝通修正
- 5.4.3 回歸測試驗證問題已解決

---

## 6. 驗收標準
### 6.1 功能完整性
- 6.1.1 所有測試案例100%通過
- 6.1.2 帳本操作、權限管理、資料同步正常

### 6.2 錯誤處理能力
- 6.2.1 權限、資料異常皆可妥善處理
- 6.2.2 錯誤訊息明確，無未捕獲例外

### 6.3 性能標準
- 6.3.1 單次帳本操作回應不超過200ms
- 6.3.2 大量帳本/資料下系統仍穩定

### 6.4 整合效果
- 6.4.1 與預算、協作、備份模組順利整合
- 6.4.2 權限同步不出現資料遺漏或混亂

---

## 7. 備註
### 7.1 測試數據說明
- 7.1.1 測試用帳本/成員請以明確標示，避免污染生產環境
- 7.1.2 覆蓋各類型帳本、權限組合

### 7.2 文件管理
- 7.2.1 測試紀錄、缺陷回報、報告請存於專案workbench

### 7.3 開發階段說明
- 7.3.1 適用於BM模組v1.0
- 7.3.2 模組更新時請同步修訂測試計畫

---