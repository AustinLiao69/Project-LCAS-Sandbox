
# LCAS 2.0 產品規格書 (Product Specification)
**版本**: 1.3  
**建立日期**: 2025-07-04  
**建立者**: AustinLiao69  
**最後更新**: 2025-07-23 10:00:00 UTC+8  

---

## 目次 (Table of Contents)

1. [產品概述 (Product Overview)](#1-產品概述-product-overview)
   - 1.1 [產品定位](#11-產品定位)
   - 1.2 [核心價值主張](#12-核心價值主張)
   - 1.3 [目標使用者](#13-目標使用者)

2. [功能架構 (Feature Architecture)](#2-功能架構-feature-architecture)
   - 2.1 [雙平台策略](#21-雙平台策略)
   - 2.2 [功能對比表](#22-功能對比表)

3. [技術架構 (Technical Architecture)](#3-技術架構-technical-architecture)
   - 3.1 [架構總覽](#31-架構總覽)
   - 3.2 [展示層 (Presentation Layer)](#32-展示層-presentation-layer)
   - 3.3 [商業邏輯層 (Business Logic Layer)](#33-商業邏輯層-business-logic-layer)
   - 3.4 [資料儲存層 (Data Storage Layer)](#34-資料儲存層-data-storage-layer)
   - 3.5 [資料庫架構設計原則](#35-資料庫架構設計原則)

4. [LINE OA 平台規格](#4-line-oa-平台規格)
   - 4.1 [核心功能](#41-核心功能)
   - 4.2 [資料結構 (LINE OA)](#42-資料結構-line-oa)

5. [APP 平台規格](#5-app-平台規格)
   - 5.1 [進階功能模組](#51-進階功能模組)
   - 5.2 [專業功能模組](#52-專業功能模組)
   - 5.3 [APP 資料結構](#53-app-資料結構)

6. [平台間整合](#6-平台間整合)
   - 6.1 [資料同步機制](#61-資料同步機制)
   - 6.2 [使用者升級流程](#62-使用者升級流程)
   - 6.3 [跨平台功能](#63-跨平台功能)

7. [開發里程碑](#7-開發里程碑)

8. [成功指標 (KPIs)](#8-成功指標-kpis)
   - 8.1 [使用者指標](#81-使用者指標)
   - 8.2 [功能指標](#82-功能指標)
   - 8.3 [技術指標](#83-技術指標)

9. [安全與隱私](#9-安全與隱私)
   - 9.1 [資料安全](#91-資料安全)
   - 9.2 [隱私保護](#92-隱私保護)

10. [風險管控](#10-風險管控)
    - 10.1 [技術風險](#101-技術風險)
    - 10.2 [產品風險](#102-產品風險)

---

##  1. 產品概述 (Product Overview)

### 1.1 產品定位
LCAS 2.0 是一個多平台記帳解決方案，提供 LINE OA 基礎服務與 APP 進階功能，滿足多種的記帳需求。

### 1.2 核心價值主張
- **便利性**: LINE OA 即開即用，零學習成本
- **專業性**: APP 提供進階記帳功能
- **擴展性**: 從個人記帳到團隊協作的完整解決方案
- **智能化**: 自動分類、預算管理、報表分析

### 1.3 目標使用者
- **基礎用戶**: 個人記帳需求，使用 LINE OA
- **進階用戶**: 專案記帳需求，使用 APP
- **團隊用戶**: 多人協作記帳需求

---

##  2. 功能架構 (Feature Architecture)

### 2.1 雙平台策略

```
LCAS 2.0 生態系統
├── LINE OA 平台 (基礎版)
│   ├── 基本記帳功能
│   ├── 簡易查詢
│   └── 自動資料庫初始化
│
└── APP 平台 (專業版)
    ├── 基礎功能 (與 LINE OA 同步)
    ├── 進階功能
    │   ├── 專案帳戶管理
    │   ├── 分類帳戶管理
    │   ├── 預算管理系統
    │   └── 共享帳本協作
    └── 專業功能
        ├── 報表產出引擎
        ├── 數據分析工具
        └── 定期備份服務
```

### 2.2 功能對比表

| 功能類別 | LINE OA | APP |
|---------|---------|-----|
| **基礎記帳** | ✅ | ✅ |
| **查詢記錄** | ✅ (簡易) | ✅ (進階) |
| **資料同步** | ✅ | ✅ |
| **專案帳戶** | ❌ | ✅ |
| **分類帳戶** | ❌ | ✅ |
| **預算管理** | ❌ | ✅ |
| **共享帳本** | ❌ | ✅ |
| **報表產出** | ❌ | ✅ |
| **數據分析** | ❌ | ✅ |
| **自動備份** | ❌ | ✅ |

---

##  3. 技術架構 (Technical Architecture)

### 3.1 架構總覽
**架構總覽：LINE OA / APP + Replit + Firebase**

### 3.2 展示層 (Presentation Layer)

#### 3.2.1 LINE OA（LINE 官方帳號）
- 使用者透過 LINE 傳送文字訊息
- LINE 平台透過 Webhook 將訊息 POST 到應用邏輯層
- 使用者收到來自後端的回覆訊息

#### 3.2.2 Mobile App（使用 Flutter 開發）
- 使用者可使用APP相關功能
- App 透過應用邏輯層的 RESTful API 取得或傳送資料

### 3.3 應用邏輯層 (Application Logic Layer)

**定義**：應用邏輯層是 APP 前端（展示層）與後端商業邏輯層之間的橋樑，由標準化的 API 端點與格式規格組成，提供統一的介面規範。

#### 3.3.1 API 架構設計原則
- **RESTful 設計**：遵循 REST 架構原則
- **統一格式**：標準化的請求/回應格式
- **錯誤處理**：一致的錯誤回應機制
- **版本控制**：支援 API 版本管理
- **認證授權**：統一的身份驗證機制

#### 3.3.2 認證與帳戶管理 API
```
POST /auth/register        - 使用者註冊
POST /auth/login          - 使用者登入  
POST /auth/logout         - 使用者登出
DELETE /auth/account      - 帳號刪除
POST /auth/reset-password - 密碼重設
```

#### 3.3.3 基礎記帳功能 API
```
POST /app/ledger/entry    - APP 記帳功能
GET  /app/ledger/query    - APP 記錄查詢
GET  /app/subjects/list   - 科目代碼管理
PUT  /app/user/settings   - 使用者設定管理
```

#### 3.3.4 進階功能 API
```
POST   /app/projects/create     - 專案帳本建立
PUT    /app/projects/manage     - 專案帳本管理
DELETE /app/projects/delete     - 專案帳本刪除
POST   /app/categories/create   - 分類帳本建立
PUT    /app/categories/manage   - 分類帳本管理
GET    /app/ledgers/switch      - 多帳本切換
```

#### 3.3.5 預算管理 API
```
POST /app/budgets/create   - 預算設定建立
GET  /app/budgets/monitor  - 預算追蹤監控
PUT  /app/budgets/alerts   - 預算警示設定
```

#### 3.3.6 協作功能 API
```
POST      /app/shared/create        - 共享帳本建立
PUT       /app/shared/permissions   - 多人協作權限
WebSocket /app/sync/realtime        - 即時協作同步
```

#### 3.3.7 報表功能 API
```
POST /app/reports/generate - 標準報表產出
POST /app/reports/custom   - 自定義報表設計
GET  /app/reports/export   - 報表匯出功能
```

#### 3.3.8 系統管理 API
```
POST /system/backup/schedule  - 定期自動備份
POST /app/backup/manual      - 手動備份還原
GET  /system/health/check    - 系統健康監控
POST /schedule/reminder      - 排程提醒設定
```

#### 3.3.9 API 標準格式
**請求格式**：
```json
{
  "timestamp": "2025-07-23T16:30:00+08:00",
  "user_id": "string",
  "action": "string",
  "data": {}
}
```

**回應格式**：
```json
{
  "status": "success|error",
  "code": "string",
  "message": "string",
  "data": {},
  "timestamp": "2025-07-23T16:30:00+08:00"
}
```

### 3.4 商業邏輯層 (Business Logic Layer)：Replit 模組群

#### 3.4.1 LINE OA模組群（LINE OA module group）
- WH模組接收來自 LINE 平台的 Webhook 請求
- 分析使用者指令（如記帳、查帳、統計）
- 呼叫共用模組群進行 Firestore 資料處理
- 將結果回覆給 LINE 使用者
- **技術堆疊**：Node.js + Express + Firebase Admin SDK

#### 3.4.2 APP模組群（APP module group）
- 實作應用邏輯層定義的 RESTful API 端點
- 驗證 Firebase Token 或 JWT，確保身份安全
- 呼叫共用模組群讀寫 Firestore 資料
- 回傳標準化 JSON 結果給前端 App
- **技術堆疊**：Node.js + Express + Firebase SDK

#### 3.4.3 共用模組群（Shared module group）
- 負責管理 Firestore 資料邏輯與共用工具
- 包含資料模型（User、Ledger、GroupLedger、Notification 等）
- 提供日期處理、金額格式轉換、分類解析等工具方法
- 被 LINE OA模組群 和 APP模組群 引用與共用

### 3.5 資料儲存層：Firebase

#### 3.5.1 Firebase Authentication
- 提供使用者身份驗證（支援 Email、Google、Apple 登入）
- 登入後產生 UID 與 Token
- 用於驗證 API 請求的合法性

#### 3.5.2 Firebase Firestore
- 文件型 NoSQL 資料庫，儲存帳本與用戶資料
- 常見結構範例：
  - /users/{uid}/ledger/{recordId}
  - /groups/{groupId}/ledger/{recordId}
  - /notifications/{uid}/list

#### 3.5.3 Firebase Cloud Storage（選用）
- 儲存報表檔案（如 PDF、Excel）
- 提供可下載的檔案連結給使用者（LINE 或 App）

### 3.6 資料庫架構設計原則

#### 3.6.1 使用者分層結構
```
Firestore Database
├── users/                           # 使用者基本資料
├── user_profiles/                   # 使用者進階設定 (APP專用)
├── ledgers/                         # 帳本集合
│   ├── {user_basic_ledger}/         # 基礎帳本 (LINE OA)
│   ├── {project_ledger}/            # 專案帳本 (APP)
│   └── {shared_ledger}/             # 共享帳本 (APP)
├── budgets/                         # 預算管理 (APP專用)
├── reports/                         # 報表資料 (APP專用)
└── _system/                         # 系統管理
```

#### 3.6.2 帳本類型分類
- **Basic Ledger**: LINE OA 使用者的基礎帳本
- **Project Ledger**: APP 使用者的專案別帳本
- **Category Ledger**: APP 使用者的分類別帳本
- **Shared Ledger**: 多人協作的共享帳本

---

##  4. LINE OA 平台規格

### 4.1 核心功能

#### 4.1.1 自動資料庫初始化
```javascript
// 使用者加入 LINE OA 時觸發
follow_event → checkUserExists() → initBasicUserDatabase()
```

**流程**:
1. 使用者加 LINE OA 為好友
2. 系統檢查 Firestore 中是否已有該用戶
3. 新用戶：自動建立基礎資料庫結構
4. 既有用戶：歡迎回來訊息

#### 4.1.2 基礎記帳功能
- 收支記錄 (文字輸入)
- 自動科目分類
- 即時回饋確認
- 簡易查詢 (當日/當週/當月)

#### 4.1.3 使用者體驗
- 零設定即可開始記帳
- 自然語言輸入
- 即時回應與確認
- 錯誤記錄可修正

### 4.2 資料結構 (LINE OA)

```
users/{LINE_UID}/
├── platform: "line_oa"
├── user_type: "basic"
├── created_at: Timestamp
├── basic_ledger_id: "{LINE_UID}_basic"
└── settings: { timezone, notifications }

ledgers/{LINE_UID}_basic/
├── type: "basic_ledger"
├── platform: "line_oa"
├── entries/          # 記帳項目
├── subjects/         # 科目代碼
└── log/             # 操作日誌
```

---

##  5. APP 平台規格

### 5.1 進階功能模組

#### 5.1.1 專案帳戶管理
- **多專案並行**: 一個使用者可建立多個專案帳本
- **專案分類**: 工作專案、個人專案、投資專案等
- **專案預算**: 每個專案獨立的預算管理
- **專案報表**: 獨立的專案收支分析

#### 5.1.2 分類帳戶管理
- **多維度分類**: 依時間、類別、標籤分類
- **自定義分類**: 使用者可建立專屬分類規則
- **交叉分析**: 跨分類的數據分析
- **分類預算**: 每個分類的預算控制

#### 5.1.3 預算管理系統
- **月度預算**: 每月預算設定與追蹤
- **分類預算**: 各支出類別的預算限制
- **專案預算**: 專案別的預算管理
- **預算警示**: 超支預警與通知

#### 5.1.4 共享帳本協作
- **多人協作**: 團隊成員共同記帳
- **權限管理**: 不同角色的操作權限
- **即時同步**: 多人操作的即時同步
- **協作日誌**: 完整的操作歷史記錄

### 5.2 專業功能模組

#### 5.2.1 報表產出引擎
- **標準報表**: 損益表、現金流量表、資產負債表
- **自定義報表**: 使用者自定義報表格式
- **多格式輸出**: PDF、Excel、CSV 格式
- **定期報表**: 自動產生週/月/季/年報表

#### 5.2.2 數據分析工具
- **趨勢分析**: 收支趨勢、分類趨勢分析
- **比較分析**: 不同期間、專案、分類的比較
- **預測模型**: 基於歷史數據的支出預測
- **視覺化圖表**: 多種圖表類型的數據視覺化

#### 5.2.3 定期備份服務
- **自動備份**: 每日自動備份至雲端
- **手動備份**: 使用者主動備份功能
- **備份還原**: 從備份還原資料功能
- **多雲備份**: 支援多個雲端服務商

### 5.3 APP 資料結構

```
user_profiles/{USER_ID}/
├── platform: "mobile_app"
├── subscription_type: "free/premium/enterprise"
├── projects: []                    # 專案清單
├── budgets: {}                     # 預算設定
└── preferences: {}                 # 個人偏好設定

projects/{PROJECT_ID}/
├── project_name: ""
├── project_type: "work/personal/investment"
├── owner_id: USER_ID
├── members: []                     # 專案成員
├── budget_settings: {}             # 專案預算
└── ledger_id: ""                   # 對應的帳本ID

budgets/{BUDGET_ID}/
├── budget_type: "monthly/category/project"
├── target_amount: Number
├── spent_amount: Number
├── period: {}                      # 預算期間
└── alerts: {}                      # 警示設定

reports/{REPORT_ID}/
├── report_type: "standard/custom"
├── data_source: []                 # 資料來源
├── generated_at: Timestamp
├── format: "pdf/excel/csv"
└── file_url: ""                    # 報表檔案位置
```

---

##  6. 平台間整合

### 6.1 資料同步機制
- **即時同步**: Firestore 即時同步兩平台數據
- **衝突解決**: 時間戳記優先的衝突解決機制
- **離線支援**: APP 支援離線記帳，上線後同步

### 6.2 使用者升級流程
```
LINE OA 使用者 → 下載 APP → 帳號綁定 → 數據遷移 → 功能升級
```

### 6.3 跨平台功能
- **帳號統一**: 統一的 USER_ID 系統
- **數據共享**: 基礎記帳數據跨平台共享
- **功能互補**: LINE OA 快速記帳 + APP 深度分析

---

##  7. 開發里程碑

### Phase 1: 基礎架構 (2025 Q3)
- [ ] Firestore 資料庫架構完成
- [ ] LINE OA 基礎功能開發
- [ ] 自動使用者初始化機制

### Phase 2: APP 核心功能 (2025 Q4)
- [ ] Mobile APP 基礎框架
- [ ] 專案帳戶管理
- [ ] 分類帳戶管理
- [ ] 預算管理系統

### Phase 3: 進階功能 (2026 Q1)
- [ ] 共享帳本協作
- [ ] 報表產出引擎
- [ ] 數據分析工具

### Phase 4: 專業功能 (2026 Q2)
- [ ] 定期備份服務
- [ ] 進階報表功能

---

##  8. 成功指標 (KPIs)

### 8.1 使用者指標
- LINE OA 活躍使用者數
- APP 下載與註冊轉換率
- 使用者留存率 (7天/30天)
- 平台間轉換率

### 8.2 功能指標
- 記帳頻率與準確度
- 報表產出使用率
- 共享帳本參與度
- 預算管理使用率

### 8.3 技術指標
- 系統回應時間 < 2秒
- 資料同步成功率 > 99%
- 系統可用性 > 99.9%
- 資料備份成功率 100%

---

##  9. 安全與隱私

### 9.1 資料安全
- Firebase 加密傳輸與儲存
- 使用者資料隔離
- 定期安全稽核
- 備份資料加密

### 9.2 隱私保護
- 最小資料收集原則
- 使用者資料控制權
- GDPR 合規設計
- 透明的隱私政策

---

##  10. 風險管控

### 10.1 技術風險
- **Firestore 成本控制**: 優化查詢與資料結構
- **擴展性問題**: 分散式架構設計
- **API 限制**: LINE API 使用量管控

### 10.2 產品風險
- **功能複雜度**: 分階段推出功能
- **使用者接受度**: 持續使用者回饋收集
- **競爭者威脅**: 差異化功能開發

---

**備註**: 本產品規格書為 1.3 版，將根據開發進度與使用者回饋持續更新。所有功能開發請以此規格書為準，重大變更需經過 PM 審核。

**下一步行動**:
1. 技術團隊審核可行性
2. UI/UX 團隊設計原型
3. 開發時程規劃
4. 資料庫詳細設計
