
# LCAS 2.0 功能列表文件 (Feature List)
**版本**: 2.2.2  
**建立日期**: 2025-07-23  
**建立者**: AustinLiao69  
**最後更新**: 2025-07-23 16:30:00 UTC+8  
**基於規格**: 0015. Product_SPEC_LCAS_2.0.md v1.3

---

## 📋 文件概述

本文件根據 LCAS 2.0 產品規格書設計，涵蓋雙平台（LINE OA + Mobile APP）的完整功能規劃，提供清晰的 API 路徑與模組對應關係。

## 🏗️ 架構總覽

```
LCAS 2.0 功能架構與模組群分類
├── 認證與帳戶管理 (F001-F011) - 雙平台共用
├── APP 進階功能 (F031-F058) - 專業版
└── 系統管理功能 (F051-F058) - 後台管理

模組群分類:
├── LINE OA模組群: WH, LBK
├── APP模組群: BK, MLS, BM, BS, DD1/DD2/DD3
└── 共用模組群: FS, DL, AM, SR, CM, MRA
```

---

## 📊 功能總覽表

| 功能編號 | 功能名稱 | 平台支援 | API 路徑 | 對應模組 | 模組群 | 優先級 |
|----------|----------|----------|----------|----------|--------|--------|
| **認證與帳戶管理 (雙平台共用)** |
| F001 | 使用者註冊 | LINE OA + APP | POST /auth/register | 2009. AM.js | 共用模組群 | P0 |
| F002 | 使用者登入 | LINE OA + APP | POST /auth/login | 2009. AM.js | 共用模組群 | P0 |
| F003 | 使用者登出 | LINE OA + APP | POST /auth/logout | 2009. AM.js | 共用模組群 | P1 |
| F004 | 帳號刪除 | APP | DELETE /auth/account | 2009. AM.js | 共用模組群 | P2 |
| F005 | 密碼重設 | APP | POST /auth/reset-password | 2009. AM.js | 共用模組群 | P2 |
| **基礎記帳功能** |
| F006 | LINE OA 記帳功能 | LINE OA | POST /lineoa/ledger/entry | 2015. LBK.js | LINE OA模組群 | P0 |
| F007 | APP 記帳功能 | APP | POST /app/ledger/entry | 2001. BK.js | APP模組群 | P0 |
| F008 | LINE OA 記錄查詢 | LINE OA | GET /lineoa/ledger/query | 2015. LBK.js | LINE OA模組群 | P0 |
| F009 | APP 記錄查詢 | APP | GET /app/ledger/query | 2001. BK.js | APP模組群 | P0 |
| F010 | 科目代碼管理 | APP | GET /app/subjects/list | 2031. DD1.js | APP模組群 | P1 |
| F011 | 使用者設定管理 | APP | PUT /app/user/settings | 2009. AM.js | 共用模組群 | P1 |
| **APP 進階功能** |
| F031 | 專案帳本建立 | APP | POST /app/projects/create | 2051. MLS.js | APP模組群 | P1 |
| F032 | 專案帳本管理 | APP | PUT /app/projects/manage | 2051. MLS.js | APP模組群 | P1 |
| F033 | 專案帳本刪除 | APP | DELETE /app/projects/delete | 2051. MLS.js | APP模組群 | P2 |
| F034 | 分類帳本建立 | APP | POST /app/categories/create | 2051. MLS.js | APP模組群 | P1 |
| F035 | 分類帳本管理 | APP | PUT /app/categories/manage | 2051. MLS.js | APP模組群 | P1 |
| F036 | 多帳本切換 | APP | GET /app/ledgers/switch | 2051. MLS.js | APP模組群 | P1 |
| F037 | 預算設定建立 | APP | POST /app/budgets/create | 2012. BM.js | APP模組群 | P2 |
| F038 | 預算追蹤監控 | APP | GET /app/budgets/monitor | 2012. BM.js | APP模組群 | P2 |
| F039 | 預算警示設定 | APP | PUT /app/budgets/alerts | 2012. BM.js | APP模組群 | P2 |
| F040 | 共享帳本建立 | APP | POST /app/shared/create | 2013. CM.js | 共用模組群 | P2 |
| F041 | 多人協作權限 | APP | PUT /app/shared/permissions | 2013. CM.js | 共用模組群 | P2 |
| F042 | 即時協作同步 | APP | WebSocket /app/sync/realtime | 2013. CM.js | 共用模組群 | P2 |
| F043 | 標準報表產出 | APP | POST /app/reports/generate | 2041. MRA.js | 共用模組群 | P2 |
| F044 | 自定義報表設計 | APP | POST /app/reports/custom | 2041. MRA.js | 共用模組群 | P3 |
| F045 | 報表匯出功能 | APP | GET /app/reports/export | 2041. MRA.js | 共用模組群 | P2 |
| **系統管理功能** |
| F051 | 定期自動備份 | 系統 | POST /system/backup/schedule | 2014. BS.js | APP模組群 | P1 |
| F052 | 手動備份還原 | APP | POST /app/backup/manual | 2014. BS.js | APP模組群 | P2 |
| F053 | 備份檔案管理 | APP | GET /app/backup/list | 2014. BS.js | APP模組群 | P2 |
| F054 | 資料同步檢查 | 系統 | GET /system/sync/status | 2011. FS.js | 共用模組群 | P1 |
| F055 | 系統健康監控 | 系統 | GET /system/health/check | 2010. DL.js | 共用模組群 | P0 |
| F056 | 錯誤日誌管理 | 系統 | GET /system/logs/errors | 2010. DL.js | 共用模組群 | P1 |
| F057 | 排程提醒設定 | LINE OA + APP | POST /schedule/reminder | 2005. SR.js | 共用模組群 | P1 |
| F058 | 排程提醒執行 | 系統 | POST /schedule/execute | 2005. SR.js | 共用模組群 | P1 |

---

##  詳細功能規格

### F001 使用者註冊

**使用者故事**  
作為新使用者，我想要快速註冊帳號，以便開始使用LCAS記帳功能。

**業務需求**
- 支援LINE OA自動註冊與APP手動註冊
- 自動生成統一UID並初始化用戶資料
- 預設科目自動導入（9999個標準科目）
- 跨平台帳號關聯準備

**展示層元件**
- **LINE OA平台**：
  - 歡迎訊息卡片（Rich Message）
  - 快速入門選單（Quick Reply）
  - 自動回覆指引訊息
  
- **APP平台**：
  - 註冊按鈕組（Email/Google/Apple登入）
  - 用戶資料輸入表單（暱稱、時區設定）
  - 註冊進度指示器
  - 服務條款確認框

**使用者操作流程**
1. **LINE OA路徑**：
   - 使用者掃描QR Code或搜尋加入LINE OA
   - 系統接收follow事件並提取LINE UID
   - 檢查是否為新用戶，若是則自動註冊
   - 自動建立帳號並初始化科目數據
   - 發送歡迎訊息：「🎉 歡迎使用LCAS！帳號已自動建立」
   - 提供快速入門選單

2. **APP路徑**：
   - 使用者下載APP並點擊「開始使用」
   - 選擇註冊方式（Email/Google/Apple）
   - 完成第三方平台認證流程
   - 填寫基本資料（暱稱、時區等）
   - 點擊「完成註冊」按鈕
   - 顯示註冊成功畫面並自動導向主頁

**API 路徑**
POST /auth/register

**API 傳送格式**
```json
{
  "platform": "line_oa|mobile_app",
  "line_uid": "Uxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "device_info": {
    "device_type": "ios|android",
    "app_version": "1.0.0"
  },
  "display_name": "使用者暱稱",
  "timezone": "Asia/Taipei",
  "auth_provider": "email|google|apple"
}
```

**API 回傳格式**
```json
{
  "success": true,
  "unified_uid": "LCAS_UID_xxxxxxxxxx",
  "user_type": "S",
  "subjects_initialized": true,
  "created_at": "2025-07-23T15:30:00+08:00",
  "welcome_message": "歡迎使用LCAS記帳系統"
}
```

**顯示提示訊息**
- **註冊成功**：「🎉 帳號建立成功！已為您初始化9999個記帳科目」
- **LINE OA歡迎**：「👋 歡迎加入LCAS！現在可以開始記帳了」
- **APP註冊完成**：「✅ 註冊完成！立即開始您的記帳之旅」

**錯誤處理**
- 重複註冊 → 顯示：「此帳號已存在，請直接登入」
- 平台驗證失敗 → 顯示：「第三方登入失敗，請稍後再試」
- 科目初始化異常 → 顯示：「系統初始化中，請稍後」
- 網路連線問題 → 顯示：「網路連線異常，請檢查網路設定」

**對應模組**: 2009. AM.js  
**核心函數**: `AM_registerUser()`

---

### F002 使用者登入

**使用者故事**  
作為已註冊用戶，我想要快速登入系統，以便存取我的記帳資料。

**業務需求**
- 支援多平台登入驗證
- 記住登入狀態（TOKEN機制）
- 跨平台資料同步檢查
- 安全性驗證與異常偵測

**展示層元件**
- **LINE OA平台**：
  - 自動登入（基於LINE UID）
  - 身份確認訊息
  - 主選單Quick Reply按鈕
  
- **APP平台**：
  - 登入表單（帳號密碼/第三方登入）
  - 「記住我」勾選框
  - 忘記密碼連結
  - 生物辨識登入選項（指紋/Face ID）

**使用者操作流程**
1. **LINE OA路徑**：
   - 使用者發送任何訊息給LINE OA
   - 系統自動識別LINE UID
   - 檢查用戶註冊狀態
   - 自動登入並載入用戶資料
   - 回覆：「歡迎回來！」並顯示主選單

2. **APP路徑**：
   - 開啟APP，顯示登入畫面
   - 輸入帳號密碼或選擇第三方登入
   - 點擊「登入」按鈕
   - 系統驗證身份並生成TOKEN
   - 登入成功後導向主頁面

**API 路徑**
POST /auth/login

**API 傳送格式**
```json
{
  "platform": "line_oa|mobile_app",
  "line_uid": "Uxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "email": "user@example.com",
  "password": "hashed_password",
  "auth_provider": "email|google|apple|line",
  "device_info": {
    "device_id": "unique_device_id",
    "fcm_token": "firebase_token"
  }
}
```

**API 回傳格式**
```json
{
  "success": true,
  "access_token": "jwt_token_here",
  "refresh_token": "refresh_token_here",
  "user_info": {
    "unified_uid": "LCAS_UID_xxxxxxxxxx",
    "display_name": "使用者名稱",
    "user_type": "S",
    "last_login": "2025-07-23T15:30:00+08:00"
  },
  "expires_in": 3600
}
```

**顯示提示訊息**
- **登入成功**：「✅ 登入成功！歡迎回來」
- **LINE OA自動登入**：「👋 歡迎回來！您的記帳數據已同步」
- **首次登入**：「🎉 首次登入成功！系統已為您準備就緒」

**錯誤處理**
- 帳號不存在 → 顯示：「帳號不存在，請先註冊」
- 密碼錯誤 → 顯示：「密碼錯誤，請重新輸入」
- TOKEN過期 → 自動重新整理TOKEN或要求重新登入
- 多重登入檢測 → 顯示：「帳號已在其他裝置登入」

**對應模組**: 2009. AM.js  
**核心函數**: `AM_authenticateUser()`

---

### F003 使用者登出

**使用者故事**  
作為使用者，我想要安全登出系統，以保護個人資料安全。

**業務需求**
- 清除本地TOKEN與快取
- 伺服器端SESSION失效
- 同步狀態清理
- 安全性日誌記錄

**展示層元件**
- **LINE OA平台**：
  - 登出確認訊息
  - 重新開始引導選單
  
- **APP平台**：
  - 設定頁面「登出」按鈕
  - 登出確認對話框
  - 登出成功提示

**使用者操作流程**
1. **LINE OA路徑**：
   - 使用者輸入「登出」或點擊相關選單
   - 系統確認登出操作
   - 清除伺服器端SESSION
   - 回覆確認訊息：「已安全登出」

2. **APP路徑**：
   - 進入「設定」頁面
   - 點擊「登出」按鈕
   - 彈出確認對話框：「確定要登出嗎？」
   - 確認後執行登出流程
   - 返回登入畫面

**API 路徑**
POST /auth/logout

**API 傳送格式**
```json
{
  "platform": "line_oa|mobile_app",
  "access_token": "current_jwt_token",
  "device_info": {
    "device_id": "unique_device_id"
  }
}
```

**API 回傳格式**
```json
{
  "success": true,
  "message": "登出成功",
  "logout_time": "2025-07-23T15:30:00+08:00"
}
```

**顯示提示訊息**
- **登出成功**：「👋 已安全登出，感謝使用LCAS」
- **LINE OA登出**：「✅ 登出完成！如需使用請重新發送訊息」
- **APP登出**：「🔒 已安全登出，您的資料已受保護」

**錯誤處理**
- TOKEN無效 → 強制登出並清除本地資料
- 網路異常 → 本地強制登出，提示「網路異常，已本地登出」
- 伺服器錯誤 → 顯示：「系統繁忙，請稍後再試」

**對應模組**: 2009. AM.js  
**核心函數**: `AM_logoutUser()`

---

### F004 帳號刪除

**使用者故事**  
作為使用者，我想要完全刪除我的帳號和所有相關資料，以行使資料自主權。

**業務需求**
- 僅限APP平台提供此功能
- 完整資料清除（記帳記錄、設定、備份）
- 不可逆操作，需多重確認
- 符合GDPR資料保護規範

**展示層元件**
- **APP平台**：
  - 帳號設定頁面「刪除帳號」選項
  - 多層級確認對話框
  - 最終確認輸入框（輸入「DELETE」確認）
  - 刪除進度指示器

**使用者操作流程**
1. **APP路徑**：
   - 進入「帳號設定」→「隱私與安全」
   - 點擊「刪除帳號」選項
   - 第一層確認：「這將永久刪除您的所有資料」
   - 第二層確認：輸入密碼驗證身份
   - 第三層確認：輸入「DELETE」文字確認
   - 執行刪除流程，顯示進度
   - 完成後返回歡迎頁面

**API 路徑**
DELETE /auth/account

**API 傳送格式**
```json
{
  "platform": "mobile_app",
  "confirmation_code": "DELETE",
  "password": "user_password_hash",
  "delete_reason": "user_selected_reason"
}
```

**API 回傳格式**
```json
{
  "success": true,
  "deleted_uid": "LCAS_UID_xxxxxxxxxx",
  "deletion_time": "2025-07-23T15:30:00+08:00",
  "cleanup_status": {
    "ledger_records": "deleted",
    "user_settings": "deleted",
    "backup_files": "deleted"
  }
}
```

**顯示提示訊息**
- **刪除確認**：「⚠️ 此操作將永久刪除所有記帳資料，且無法復原」
- **刪除進行中**：「🔄 正在刪除您的資料，請稍候...」
- **刪除完成**：「✅ 帳號已完全刪除，感謝您曾經使用LCAS」

**錯誤處理**
- 密碼驗證失敗 → 顯示：「密碼錯誤，無法執行刪除操作」
- 確認碼錯誤 → 顯示：「請正確輸入『DELETE』以確認刪除」
- 系統錯誤 → 顯示：「刪除過程發生錯誤，請聯繫客服」
- 權限不足 → 顯示：「操作權限不足，請重新登入」

**對應模組**: 2009. AM.js  
**核心函數**: `AM_deleteUserAccount()`

---

### F005 密碼重設

**使用者故事**  
作為忘記密碼的使用者，我想要安全地重設密碼，以便重新存取我的帳號。

**業務需求**
- 僅限APP平台（LINE OA無密碼概念）
- 透過Email發送重設連結
- 臨時TOKEN機制確保安全性
- 支援多種身份驗證方式

**展示層元件**
- **APP平台**：
  - 登入頁面「忘記密碼？」連結
  - 密碼重設申請表單（Email輸入）
  - 驗證碼輸入介面
  - 新密碼設定表單
  - 密碼強度指示器

**使用者操作流程**
1. **APP路徑**：
   - 在登入頁面點擊「忘記密碼？」
   - 輸入註冊時使用的Email
   - 點擊「發送重設連結」
   - 檢查Email並點擊重設連結
   - 輸入收到的驗證碼
   - 設定新密碼（需符合安全規則）
   - 確認新密碼並提交
   - 重設成功，自動導向登入頁面

**API 路徑**
POST /auth/reset-password

**API 傳送格式**
```json
{
  "step": "request|verify|reset",
  "email": "user@example.com",
  "verification_code": "123456",
  "new_password": "new_hashed_password",
  "reset_token": "temporary_reset_token"
}
```

**API 回傳格式**
```json
{
  "success": true,
  "step_completed": "request|verify|reset",
  "message": "操作成功",
  "reset_token": "temporary_token_for_next_step",
  "expires_in": 900
}
```

**顯示提示訊息**
- **重設申請成功**：「📧 重設連結已發送至您的Email，請檢查收件匣」
- **驗證成功**：「✅ 驗證成功！請設定新密碼」
- **密碼重設完成**：「🔐 密碼重設成功！請使用新密碼登入」

**錯誤處理**
- Email不存在 → 顯示：「此Email未註冊帳號」
- 驗證碼錯誤 → 顯示：「驗證碼錯誤或已過期，請重新申請」
- 密碼強度不足 → 顯示：「密碼需包含大小寫字母、數字及特殊符號」
- TOKEN過期 → 顯示：「重設連結已過期，請重新申請」
- 頻繁申請限制 → 顯示：「申請過於頻繁，請5分鐘後再試」

**對應模組**: 2009. AM.js  
**核心函數**: `AM_resetPassword()`

---

## 📈 開發優先級說明

- **P0 (必要)**: 核心功能，影響基本可用性
- **P1 (重要)**: 主要功能，影響使用者體驗
- **P2 (有用)**: 進階功能，提升產品價值
- **P3 (可選)**: 延伸功能，未來擴展方向

---
