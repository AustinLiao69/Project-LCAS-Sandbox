
%% 0020. User Flow Chart
%% 版本: 1.1.1
%% 建立日期: 2025-08-19
%% 最後更新: 2025-08-19
%% 建立者: AustinLiao69

%% F001: LINE OA 首次加入流程
flowchart TD
    A[使用者點擊 LINE OA 連結] --> B[LINE 系統確認加入好友]
    B --> C[系統檢查使用者是否已存在]
    C --> D{使用者是否存在？}
    D -->|否| E[自動建立 Firestore 用戶資料]
    D -->|是| F[讀取現有用戶資料]
    E --> G[發送歡迎訊息]
    F --> G
    G --> H[提供 Rich Menu 選項]
    H --> I[使用者開始使用基本功能]

    style A fill:#e1f5fe
    style G fill:#c8e6c9
    style H fill:#fff3e0

%% F002: APP 註冊與模式識別流程
flowchart TD
    A2[下載並開啟 APP] --> B2[選擇註冊方式]
    B2 --> C2[輸入基本資料並驗證]
    C2 --> D2[進入模式評估問卷]
    D2 --> E2[回答 5 題評估問題]
    E2 --> F2[系統分析並辨識模式]
    F2 --> G2{辨識結果}
    G2 -->|專家模式| H21[顯示專業功能預覽]
    G2 -->|慣性模式| H22[顯示簡潔介面設計]
    G2 -->|養成模式| H23[顯示習慣養成計畫]
    G2 -->|引導模式| H24[顯示簡化入門引導]
    H21 --> I2[進入個人化設定]
    H22 --> I2
    H23 --> I2
    H24 --> I2

    style D2 fill:#e1f5fe
    style F2 fill:#fff3e0
    style I2 fill:#c8e6c9

%% F003: 四模式個人化設定流程
flowchart TD
    A3[開始個人化設定] --> B3{使用者模式}

    B3 -->|專家模式| C31[完整帳本設定精靈]
    B3 -->|慣性模式| C32[簡化快速設定]
    B3 -->|養成模式| C33[習慣養成計畫設定]
    B3 -->|引導模式| C34[最簡配置]

    C31 --> D31[建立多個帳本]
    C31 --> D32[詳細科目設定]
    C31 --> D33[帳戶類型配置]

    C32 --> E31[使用預設帳本]
    C32 --> E32[基礎科目設定]

    C33 --> F31[設定記帳目標]
    C33 --> F32[選擇提醒頻率]
    C33 --> F33[啟動挑戰計畫]

    C34 --> G31[使用最簡配置]

    D31 --> H3[設定完成]
    D32 --> H3
    D33 --> H3
    E31 --> H3
    E32 --> H3
    F31 --> H3
    F32 --> H3
    F33 --> H3
    G31 --> H3

    H3 --> I3[提供 LINE OA 整合選項]

    style B3 fill:#e1f5fe
    style H3 fill:#c8e6c9
    style I3 fill:#fff3e0

%% F004: 跨平台帳號整合流程
flowchart TD
    A4[APP 中選擇整合 LINE OA] --> B4[顯示 LINE OA 介紹]
    B4 --> C4[使用者確認整合意願]
    C4 --> D4{是否已加入 LINE OA？}
    D4 -->|是| E4[透過 UID 自動綁定]
    D4 -->|否| F4[引導加入 LINE OA]
    F4 --> G4[使用者加入 LINE OA]
    G4 --> E4
    E4 --> H4[驗證綁定成功]
    H4 --> I4[同步設定到 LINE OA]
    I4 --> J4[顯示整合完成訊息]
    J4 --> K4[雙平台可同步使用]

    style A4 fill:#e1f5fe
    style H4 fill:#fff3e0
    style K4 fill:#c8e6c9

%% F005: LINE OA 快速記帳流程
flowchart TD
    A5[使用者在 LINE 輸入記帳訊息] --> B5[WH 模組接收 Webhook]
    B5 --> C5[LBK 模組解析文字內容]
    C5 --> D5[提取金額、科目、帳戶資訊]
    D5 --> E5{解析是否成功？}
    E5 -->|成功| F5[寫入 Firestore 資料庫]
    E5 -->|失敗| G5[回覆格式提示訊息]
    F5 --> H5[即時同步到 APP]
    H5 --> I5[回覆確認訊息給使用者]
    G5 --> J5[使用者重新輸入]
    J5 --> A5

    style A5 fill:#e1f5fe
    style C5 fill:#fff3e0
    style I5 fill:#c8e6c9

%% F006: APP 完整記帳流程
flowchart TD
    A6[開啟 APP 記帳功能] --> B6{使用者模式適配}

    B6 -->|專家模式| C61[顯示完整記帳表單]
    B6 -->|慣性模式| C62[顯示簡潔表單]
    B6 -->|養成模式| C63[顯示引導式表單]
    B6 -->|引導模式| C64[顯示最簡表單]

    C61 --> D6[填寫詳細資訊]
    C62 --> D6
    C63 --> D6
    C64 --> D6

    D6 --> E6[輸入金額]
    E6 --> F6[選擇科目]
    F6 --> G6[選擇帳戶]
    G6 --> H6[選擇帳本]
    H6 --> I6[添加備註 - 可選]
    I6 --> J6[附加檔案 - 可選]
    J6 --> K6[設定重複規則 - 可選]
    K6 --> L6[預覽並確認]
    L6 --> M6[儲存到 Firestore]
    M6 --> N6[即時同步到 LINE OA]
    N6 --> O6[顯示成功訊息]

    style B6 fill:#e1f5fe
    style L6 fill:#fff3e0
    style O6 fill:#c8e6c9

%% F007: 跨平台同步流程
flowchart TD
    A7[數據變更觸發] --> B7{變更來源}
    B7 -->|LINE OA| C71[WH 模組處理]
    B7 -->|APP| C72[APP 模組處理]

    C71 --> D7[寫入 Firestore]
    C72 --> D7

    D7 --> E7[Firestore 觸發 onChange 事件]
    E7 --> F7[所有連接的客戶端接收更新]
    F7 --> G7{客戶端類型}

    G7 -->|APP| H71[更新本地快取]
    G7 -->|LINE OA| H72[更新 Rich Menu 數據]

    H71 --> I7[顯示同步狀態]
    H72 --> I7
    I7 --> J7[同步完成]

    style A7 fill:#e1f5fe
    style E7 fill:#fff3e0
    style J7 fill:#c8e6c9

%% F008: 錯誤處理與修正流程
flowchart TD
    A8[檢測到異常或錯誤] --> B8{錯誤類型}

    B8 -->|輸入格式錯誤| C81[即時格式驗證]
    B8 -->|網路連線錯誤| C82[離線模式處理]
    B8 -->|數據衝突| C83[衝突解決機制]
    B8 -->|誤刪除| C84[恢復機制]

    C81 --> D81[提供格式建議]
    C82 --> D82[本地暫存數據]
    C83 --> D83[最後寫入者優先]
    C84 --> D84[30天內可恢復]

    D81 --> E8[使用者修正]
    D82 --> F8[網路恢復後同步]
    D83 --> G8[通知衝突解決結果]
    D84 --> H8[執行恢復操作]

    E8 --> I8[重新提交]
    F8 --> I8
    G8 --> I8
    H8 --> I8
    I8 --> J8[處理完成]

    style A8 fill:#ffcdd2
    style I8 fill:#fff3e0
    style J8 fill:#c8e6c9

%% F009: 多帳本協作流程
flowchart TD
    A9[創建協作帳本] --> B9[設定帳本基本資訊]
    B9 --> C9[建立邀請連結或 QR Code]
    C9 --> D9[發送邀請通知]
    D9 --> E9[協作者接收邀請]
    E9 --> F9{協作者是否接受？}
    F9 -->|是| G9[加入協作帳本]
    F9 -->|否| H9[邀請失效]
    G9 --> I9[設定協作者權限]
    I9 --> J9[開始協作記帳]
    J9 --> K9[即時活動通知]
    K9 --> L9[留言與標註互動]
    L9 --> M9[查看協作歷史]

    style A9 fill:#e1f5fe
    style G9 fill:#c8e6c9
    style K9 fill:#fff3e0

%% F010: 預算管理流程
flowchart TD
    A10[進入預算管理] --> B10[選擇預算類型]
    B10 --> C10{預算設定類型}

    C10 -->|月度預算| D101[設定月度總額]
    C10 -->|科目預算| D102[分科目設定預算]
    C10 -->|專案預算| D103[分專案設定預算]

    D101 --> E10[預算分配設定]
    D102 --> E10
    D103 --> E10

    E10 --> F10[啟動預算監控]
    F10 --> G10[日常記帳觸發檢查]
    G10 --> H10{是否超過警戒線？}

    H10 -->|否| I10[正常記帳流程]
    H10 -->|是| J10[發送預算警示]

    J10 --> K10{使用者模式適配}
    K10 -->|專家模式| L101[詳細超支分析]
    K10 -->|養成模式| L102[激勵式提醒]
    K10 -->|其他| L103[簡單警示]

    L101 --> M10[繼續記帳或調整預算]
    L102 --> M10
    L103 --> M10
    I10 --> N10[預算執行追蹤]
    M10 --> N10

    style A10 fill:#e1f5fe
    style J10 fill:#fff3e0
    style N10 fill:#c8e6c9

%% F011: 帳戶科目管理流程
flowchart TD
    A11[進入帳戶科目管理] --> B11{管理類型}

    B11 -->|帳戶管理| C111[帳戶操作選擇]
    B11 -->|科目管理| C112[科目操作選擇]

    C111 --> D111{帳戶操作}
    D111 -->|新增| E111[建立新帳戶]
    D111 -->|編輯| E112[修改帳戶資訊]
    D111 -->|停用| E113[停用帳戶]

    C112 --> D112{科目操作}
    D112 -->|新增| F111[建立新科目]
    D112 -->|編輯| F112[修改科目]
    D112 -->|整理| F113[科目重組]

    E111 --> G11[設定帳戶類型和初始餘額]
    E112 --> H11[更新帳戶資訊]
    E113 --> I11[確認停用並處理歷史資料]

    F111 --> J11[設定科目層級和分類]
    F112 --> K11[更新科目資訊]
    F113 --> L11[系統建議最佳化方案]

    G11 --> M11[儲存變更]
    H11 --> M11
    I11 --> M11
    J11 --> M11
    K11 --> M11
    L11 --> M11

    M11 --> N11[同步到所有平台]
    N11 --> O11[管理完成]

    style A11 fill:#e1f5fe
    style M11 fill:#fff3e0
    style O11 fill:#c8e6c9

%% F012: 報表生成流程
flowchart TD
    A12[進入報表功能] --> B12[選擇報表類型]
    B12 --> C12{報表需求}

    C12 -->|標準報表| D121[選擇預設報表模板]
    C12 -->|自訂報表| D122[自訂報表配置]

    D121 --> E12[設定時間範圍]
    D122 --> E12
    E12 --> F12[選擇資料範圍]
    F12 --> G12[選擇圖表類型]
    G12 --> H12[預覽報表內容]
    H12 --> I12{報表是否滿意？}

    I12 -->|否| J12[調整報表設定]
    I12 -->|是| K12[生成最終報表]

    J12 --> G12
    K12 --> L12[選擇輸出格式]
    L12 --> M12{輸出類型}

    M12 -->|PDF| N121[生成 PDF 檔案]
    M12 -->|Excel| N122[生成 Excel 檔案]
    M12 -->|線上檢視| N123[生成網頁版本]

    N121 --> O12[提供下載連結]
    N122 --> O12
    N123 --> P12[直接在 APP 中檢視]

    O12 --> Q12[設定定期報表 - 可選]
    P12 --> Q12
    Q12 --> R12[報表產出完成]

    style A12 fill:#e1f5fe
    style K12 fill:#fff3e0
    style R12 fill:#c8e6c9

%% F013: 數據分析流程
flowchart TD
    A13[啟動數據分析] --> B13[選擇分析維度]
    B13 --> C13{分析類型}

    C13 -->|趨勢分析| D131[時間序列分析]
    C13 -->|比較分析| D132[期間對比分析]
    C13 -->|異常檢測| D133[異常模式識別]
    C13 -->|預測分析| D134[支出預測模型]

    D131 --> E131[生成趨勢圖表]
    D132 --> E132[生成對比圖表]
    D133 --> E133[標記異常交易]
    D134 --> E134[生成預測模型]

    E131 --> F13[智慧分析引擎處理]
    E132 --> F13
    E133 --> F13
    E134 --> F13

    F13 --> G13{使用者模式適配}
    G13 -->|專家模式| H131[詳細技術分析報告]
    G13 -->|慣性模式| H132[簡潔圖表摘要]
    G13 -->|養成模式| H133[習慣改善建議]
    G13 -->|引導模式| H134[簡單視覺化呈現]

    H131 --> I13[提供具體改善建議]
    H132 --> I13
    H133 --> I13
    H134 --> I13

    I13 --> J13[使用者採納建議]
    J13 --> K13{是否需要深度分析？}
    K13 -->|是| L13[啟動進階分析]
    K13 -->|否| M13[分析完成]

    L13 --> B13

    style A13 fill:#e1f5fe
    style F13 fill:#fff3e0
    style M13 fill:#c8e6c9
