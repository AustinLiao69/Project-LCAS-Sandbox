
# 0020. User Flow Chart
**版本**: 1.1.0  
**建立日期**: 2025-08-19  
**最後更新**: 2025-08-19  
**建立者**: AustinLiao69

---

## F001: LINE OA 首次加入流程

```mermaid
flowchart TD
    A[使用者點擊 LINE OA 連結] --> B[LINE 系統確認加入好友]
    B --> C[系統檢查使用者是否已存在]
    C --> D{使用者是否存在？}
    D -->|否| E[自動建立 Firestore 用戶資料]
    D -->|是| F[讀取現有用戶資料]
    E --> G[發送歡迎訊息]
    F --> G
    G --> H[提供 Rich Menu 選項]
    H --> I[使用者開始使用基本功能]
    
    style A fill:#e1f5fe
    style G fill:#c8e6c9
    style H fill:#fff3e0
```

## F002: APP 註冊與模式識別流程

```mermaid
flowchart TD
    A[下載並開啟 APP] --> B[選擇註冊方式]
    B --> C[輸入基本資料並驗證]
    C --> D[進入模式評估問卷]
    D --> E[回答 5 題評估問題]
    E --> F[系統分析並辨識模式]
    F --> G{辨識結果}
    G -->|專家模式| H1[顯示專業功能預覽]
    G -->|慣性模式| H2[顯示簡潔介面設計]
    G -->|養成模式| H3[顯示習慣養成計畫]
    G -->|引導模式| H4[顯示簡化入門引導]
    H1 --> I[進入個人化設定]
    H2 --> I
    H3 --> I
    H4 --> I
    
    style D fill:#e1f5fe
    style F fill:#fff3e0
    style I fill:#c8e6c9
```

## F003: 四模式個人化設定流程

```mermaid
flowchart TD
    A[開始個人化設定] --> B{使用者模式}
    
    B -->|專家模式| C1[完整帳本設定精靈]
    B -->|慣性模式| C2[簡化快速設定]
    B -->|養成模式| C3[習慣養成計畫設定]
    B -->|引導模式| C4[最簡配置]
    
    C1 --> D1[建立多個帳本]
    C1 --> D2[詳細科目設定]
    C1 --> D3[帳戶類型配置]
    
    C2 --> E1[使用預設帳本]
    C2 --> E2[基礎科目設定]
    
    C3 --> F1[設定記帳目標]
    C3 --> F2[選擇提醒頻率]
    C3 --> F3[啟動挑戰計畫]
    
    C4 --> G1[使用最簡配置]
    
    D1 --> H[設定完成]
    D2 --> H
    D3 --> H
    E1 --> H
    E2 --> H
    F1 --> H
    F2 --> H
    F3 --> H
    G1 --> H
    
    H --> I[提供 LINE OA 整合選項]
    
    style B fill:#e1f5fe
    style H fill:#c8e6c9
    style I fill:#fff3e0
```

## F004: 跨平台帳號整合流程

```mermaid
flowchart TD
    A[APP 中選擇整合 LINE OA] --> B[顯示 LINE OA 介紹]
    B --> C[使用者確認整合意願]
    C --> D{是否已加入 LINE OA？}
    D -->|是| E[透過 UID 自動綁定]
    D -->|否| F[引導加入 LINE OA]
    F --> G[使用者加入 LINE OA]
    G --> E
    E --> H[驗證綁定成功]
    H --> I[同步設定到 LINE OA]
    I --> J[顯示整合完成訊息]
    J --> K[雙平台可同步使用]
    
    style A fill:#e1f5fe
    style H fill:#fff3e0
    style K fill:#c8e6c9
```

## F005: LINE OA 快速記帳流程

```mermaid
flowchart TD
    A[使用者在 LINE 輸入記帳訊息] --> B[WH 模組接收 Webhook]
    B --> C[LBK 模組解析文字內容]
    C --> D[提取金額、科目、帳戶資訊]
    D --> E{解析是否成功？}
    E -->|成功| F[寫入 Firestore 資料庫]
    E -->|失敗| G[回覆格式提示訊息]
    F --> H[即時同步到 APP]
    H --> I[回覆確認訊息給使用者]
    G --> J[使用者重新輸入]
    J --> A
    
    style A fill:#e1f5fe
    style C fill:#fff3e0
    style I fill:#c8e6c9
```

## F006: APP 完整記帳流程

```mermaid
flowchart TD
    A[開啟 APP 記帳功能] --> B{使用者模式適配}
    
    B -->|專家模式| C1[顯示完整記帳表單]
    B -->|慣性模式| C2[顯示簡潔表單]
    B -->|養成模式| C3[顯示引導式表單]
    B -->|引導模式| C4[顯示最簡表單]
    
    C1 --> D[填寫詳細資訊]
    C2 --> D
    C3 --> D
    C4 --> D
    
    D --> E[輸入金額]
    E --> F[選擇科目]
    F --> G[選擇帳戶]
    G --> H[選擇帳本]
    H --> I[添加備註（可選）]
    I --> J[附加檔案（可選）]
    J --> K[設定重複規則（可選）]
    K --> L[預覽並確認]
    L --> M[儲存到 Firestore]
    M --> N[即時同步到 LINE OA]
    N --> O[顯示成功訊息]
    
    style B fill:#e1f5fe
    style L fill:#fff3e0
    style O fill:#c8e6c9
```

## F007: 跨平台同步流程

```mermaid
flowchart TD
    A[數據變更觸發] --> B{變更來源}
    B -->|LINE OA| C1[WH 模組處理]
    B -->|APP| C2[APP 模組處理]
    
    C1 --> D[寫入 Firestore]
    C2 --> D
    
    D --> E[Firestore 觸發 onChange 事件]
    E --> F[所有連接的客戶端接收更新]
    F --> G{客戶端類型}
    
    G -->|APP| H1[更新本地快取]
    G -->|LINE OA| H2[更新 Rich Menu 數據]
    
    H1 --> I[顯示同步狀態]
    H2 --> I
    I --> J[同步完成]
    
    style A fill:#e1f5fe
    style E fill:#fff3e0
    style J fill:#c8e6c9
```

## F008: 錯誤處理與修正流程

```mermaid
flowchart TD
    A[檢測到異常或錯誤] --> B{錯誤類型}
    
    B -->|輸入格式錯誤| C1[即時格式驗證]
    B -->|網路連線錯誤| C2[離線模式處理]
    B -->|數據衝突| C3[衝突解決機制]
    B -->|誤刪除| C4[恢復機制]
    
    C1 --> D1[提供格式建議]
    C2 --> D2[本地暫存數據]
    C3 --> D3[最後寫入者優先]
    C4 --> D4[30天內可恢復]
    
    D1 --> E[使用者修正]
    D2 --> F[網路恢復後同步]
    D3 --> G[通知衝突解決結果]
    D4 --> H[執行恢復操作]
    
    E --> I[重新提交]
    F --> I
    G --> I
    H --> I
    I --> J[處理完成]
    
    style A fill:#ffcdd2
    style I fill:#fff3e0
    style J fill:#c8e6c9
```

## F009: 多帳本協作流程

```mermaid
flowchart TD
    A[創建協作帳本] --> B[設定帳本基本資訊]
    B --> C[建立邀請連結或 QR Code]
    C --> D[發送邀請通知]
    D --> E[協作者接收邀請]
    E --> F{協作者是否接受？}
    F -->|是| G[加入協作帳本]
    F -->|否| H[邀請失效]
    G --> I[設定協作者權限]
    I --> J[開始協作記帳]
    J --> K[即時活動通知]
    K --> L[留言與標註互動]
    L --> M[查看協作歷史]
    
    style A fill:#e1f5fe
    style G fill:#c8e6c9
    style K fill:#fff3e0
```

## F010: 預算管理流程

```mermaid
flowchart TD
    A[進入預算管理] --> B[選擇預算類型]
    B --> C{預算設定類型}
    
    C -->|月度預算| D1[設定月度總額]
    C -->|科目預算| D2[分科目設定預算]
    C -->|專案預算| D3[分專案設定預算]
    
    D1 --> E[預算分配設定]
    D2 --> E
    D3 --> E
    
    E --> F[啟動預算監控]
    F --> G[日常記帳觸發檢查]
    G --> H{是否超過警戒線？}
    
    H -->|否| I[正常記帳流程]
    H -->|是| J[發送預算警示]
    
    J --> K{使用者模式適配}
    K -->|專家模式| L1[詳細超支分析]
    K -->|養成模式| L2[激勵式提醒]
    K -->|其他| L3[簡單警示]
    
    L1 --> M[繼續記帳或調整預算]
    L2 --> M
    L3 --> M
    I --> N[預算執行追蹤]
    M --> N
    
    style A fill:#e1f5fe
    style J fill:#fff3e0
    style N fill:#c8e6c9
```

## F011: 帳戶科目管理流程

```mermaid
flowchart TD
    A[進入帳戶科目管理] --> B{管理類型}
    
    B -->|帳戶管理| C1[帳戶操作選擇]
    B -->|科目管理| C2[科目操作選擇]
    
    C1 --> D1{帳戶操作}
    D1 -->|新增| E1[建立新帳戶]
    D1 -->|編輯| E2[修改帳戶資訊]
    D1 -->|停用| E3[停用帳戶]
    
    C2 --> D2{科目操作}
    D2 -->|新增| F1[建立新科目]
    D2 -->|編輯| F2[修改科目]
    D2 -->|整理| F3[科目重組]
    
    E1 --> G[設定帳戶類型和初始餘額]
    E2 --> H[更新帳戶資訊]
    E3 --> I[確認停用並處理歷史資料]
    
    F1 --> J[設定科目層級和分類]
    F2 --> K[更新科目資訊]
    F3 --> L[系統建議最佳化方案]
    
    G --> M[儲存變更]
    H --> M
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N[同步到所有平台]
    N --> O[管理完成]
    
    style A fill:#e1f5fe
    style M fill:#fff3e0
    style O fill:#c8e6c9
```

## F012: 報表生成流程

```mermaid
flowchart TD
    A[進入報表功能] --> B[選擇報表類型]
    B --> C{報表需求}
    
    C -->|標準報表| D1[選擇預設報表模板]
    C -->|自訂報表| D2[自訂報表配置]
    
    D1 --> E[設定時間範圍]
    D2 --> E
    E --> F[選擇資料範圍]
    F --> G[選擇圖表類型]
    G --> H[預覽報表內容]
    H --> I{報表是否滿意？}
    
    I -->|否| J[調整報表設定]
    I -->|是| K[生成最終報表]
    
    J --> G
    K --> L[選擇輸出格式]
    L --> M{輸出類型}
    
    M -->|PDF| N1[生成 PDF 檔案]
    M -->|Excel| N2[生成 Excel 檔案]
    M -->|線上檢視| N3[生成網頁版本]
    
    N1 --> O[提供下載連結]
    N2 --> O
    N3 --> P[直接在 APP 中檢視]
    
    O --> Q[設定定期報表（可選）]
    P --> Q
    Q --> R[報表產出完成]
    
    style A fill:#e1f5fe
    style K fill:#fff3e0
    style R fill:#c8e6c9
```

## F013: 數據分析流程

```mermaid
flowchart TD
    A[啟動數據分析] --> B[選擇分析維度]
    B --> C{分析類型}
    
    C -->|趨勢分析| D1[時間序列分析]
    C -->|比較分析| D2[期間對比分析]
    C -->|異常檢測| D3[異常模式識別]
    C -->|預測分析| D4[支出預測模型]
    
    D1 --> E1[生成趨勢圖表]
    D2 --> E2[生成對比圖表]
    D3 --> E3[標記異常交易]
    D4 --> E4[生成預測模型]
    
    E1 --> F[智慧分析引擎處理]
    E2 --> F
    E3 --> F
    E4 --> F
    
    F --> G{使用者模式適配}
    G -->|專家模式| H1[詳細技術分析報告]
    G -->|慣性模式| H2[簡潔圖表摘要]
    G -->|養成模式| H3[習慣改善建議]
    G -->|引導模式| H4[簡單視覺化呈現]
    
    H1 --> I[提供具體改善建議]
    H2 --> I
    H3 --> I
    H4 --> I
    
    I --> J[使用者採納建議]
    J --> K{是否需要深度分析？}
    K -->|是| L[啟動進階分析]
    K -->|否| M[分析完成]
    
    L --> B
    
    style A fill:#e1f5fe
    style F fill:#fff3e0
    style M fill:#c8e6c9
```

## 四模式差異化流程

### 專家模式專屬流程

```mermaid
flowchart TD
    A[專家模式啟動] --> B[顯示完整功能界面]
    B --> C[提供進階設定選項]
    C --> D[多維度數據展示]
    D --> E[專業分析工具]
    E --> F[批次操作功能]
    F --> G[詳細日誌記錄]
    G --> H[自訂報表引擎]
    H --> I[API 整合能力]
    
    style A fill:#1976d2
    style E fill:#fff3e0
    style I fill:#c8e6c9
```

### 慣性模式簡化流程

```mermaid
flowchart TD
    A[慣性模式啟動] --> B[載入固定界面模板]
    B --> C[提供一致性操作流程]
    C --> D[簡潔的功能選單]
    D --> E[預設操作建議]
    E --> F[固定的視覺風格]
    F --> G[可預測的回應模式]
    G --> H[精簡的通知系統]
    
    style A fill:#388e3c
    style D fill:#fff3e0
    style H fill:#c8e6c9
```

### 養成模式引導流程

```mermaid
flowchart TD
    A[養成模式啟動] --> B[設定習慣目標]
    B --> C[建立提醒機制]
    C --> D[啟動挑戰計畫]
    D --> E[進度追蹤系統]
    E --> F[成就徽章獎勵]
    F --> G[社群互動支持]
    G --> H[定期習慣檢討]
    H --> I[調整養成策略]
    
    style A fill:#f57c00
    style E fill:#fff3e0
    style I fill:#c8e6c9
```

### 引導模式被動流程

```mermaid
flowchart TD
    A[引導模式啟動] --> B[智慧被動引導]
    B --> C[極簡操作界面]
    C --> D[漸進式功能解鎖]
    D --> E[情境感知提示]
    E --> F[無壓力互動設計]
    F --> G[自然覺醒觸發]
    G --> H[平滑升級引導]
    
    style A fill:#7b1fa2
    style E fill:#fff3e0
    style H fill:#c8e6c9
```

## 異常處理流程

### 網路異常處理流程

```mermaid
flowchart TD
    A[檢測網路狀態] --> B{網路是否可用？}
    B -->|是| C[正常操作流程]
    B -->|否| D[啟動離線模式]
    D --> E[本地暫存數據]
    E --> F[顯示離線狀態指示]
    F --> G[定期檢測網路恢復]
    G --> H{網路是否恢復？}
    H -->|否| G
    H -->|是| I[同步本地數據]
    I --> J[解決同步衝突]
    J --> K[恢復正常操作]
    
    style A fill:#e1f5fe
    style D fill:#ffcdd2
    style K fill:#c8e6c9
```

### 數據衝突解決流程

```mermaid
flowchart TD
    A[檢測到數據衝突] --> B[分析衝突類型]
    B --> C{衝突程度}
    C -->|輕微| D[自動採用最後寫入者優先]
    C -->|嚴重| E[向使用者顯示衝突選項]
    D --> F[記錄衝突解決日誌]
    E --> G[使用者選擇解決方案]
    G --> H{使用者選擇}
    H -->|保留本地| I[採用本地版本]
    H -->|採用遠端| J[採用雲端版本]
    H -->|手動合併| K[啟動合併精靈]
    I --> F
    J --> F
    K --> L[使用者手動合併數據]
    L --> F
    F --> M[同步解決結果]
    M --> N[衝突解決完成]
    
    style A fill:#ffcdd2
    style G fill:#fff3e0
    style N fill:#c8e6c9
```

### 權限異常處理流程

```mermaid
flowchart TD
    A[執行需要權限的操作] --> B[檢查使用者權限]
    B --> C{權限是否充足？}
    C -->|是| D[正常執行操作]
    C -->|否| E[顯示權限不足提示]
    E --> F{異常類型}
    F -->|登入過期| G[引導重新登入]
    F -->|權限不足| H[聯繫管理員或升級權限]
    F -->|帳本權限| I[請求帳本存取權限]
    G --> J[重新驗證身份]
    H --> K[等待權限審核]
    I --> L[協作者審核權限]
    J --> M[權限恢復檢查]
    K --> M
    L --> M
    M --> N{權限是否恢復？}
    N -->|是| D
    N -->|否| O[維持受限模式]
    
    style A fill:#e1f5fe
    style E fill:#ffcdd2
    style D fill:#c8e6c9
```

### 系統錯誤恢復流程

```mermaid
flowchart TD
    A[系統錯誤發生] --> B[錯誤捕獲與分類]
    B --> C{錯誤嚴重程度}
    C -->|輕微| D[靜默處理並記錄]
    C -->|中等| E[顯示用戶友善錯誤訊息]
    C -->|嚴重| F[啟動錯誤恢復機制]
    D --> G[繼續正常操作]
    E --> H[提供重試選項]
    F --> I[保存使用者數據]
    H --> J{使用者是否重試？}
    J -->|是| K[重新執行操作]
    J -->|否| L[回到安全狀態]
    I --> M[系統重啟或降級服務]
    K --> N{操作是否成功？}
    N -->|是| G
    N -->|否| E
    M --> O[通知系統管理員]
    O --> P[等待系統修復]
    P --> Q[服務恢復通知]
    
    style A fill:#ffcdd2
    style I fill:#fff3e0
    style G fill:#c8e6c9
```

## 系統架構泳道圖

```mermaid
graph TB
    subgraph "使用者層"
        U1[LINE OA 使用者]
        U2[APP 使用者]
    end
    
    subgraph "展示層"
        P1[LINE OA 平台]
        P2[APP 平台]
    end
    
    subgraph "應用邏輯層"
        A1[RESTful API]
    end
    
    subgraph "商業邏輯層"
        B1[WH 模組]
        B2[LBK 模組]
        B3[其他模組]
    end
    
    subgraph "資料儲存層"
        D1[Firebase Auth]
        D2[Firestore DB]
        D3[Cloud Storage]
    end
    
    U1 --> P1
    U2 --> P2
    P1 --> B1
    P2 --> A1
    A1 --> B2
    B1 --> B2
    B2 --> B3
    B3 --> D1
    B3 --> D2
    B3 --> D3
```

## 使用者流程決策樹

```mermaid
flowchart TD
    A[使用者進入系統] --> B{平台選擇}
    B -->|LINE OA| C[快速記帳流程]
    B -->|APP| D[完整功能流程]
    
    C --> E{記帳類型}
    E -->|文字記帳| F[LBK 解析處理]
    E -->|查詢功能| G[DD 查詢處理]
    
    D --> H{使用者模式}
    H -->|專家模式| I[專業功能界面]
    H -->|慣性模式| J[簡潔固定界面]
    H -->|養成模式| K[引導支持界面]
    H -->|引導模式| L[簡化被動界面]
    
    F --> M[資料儲存]
    G --> M
    I --> M
    J --> M
    K --> M
    L --> M
    
    M --> N[跨平台同步]
```

## 四模式對比流程圖

```mermaid
graph LR
    subgraph "專家模式"
        E1[完整功能] --> E2[深度分析] --> E3[專業報表]
    end
    
    subgraph "慣性模式"
        I1[簡潔介面] --> I2[固定流程] --> I3[一致體驗]
    end
    
    subgraph "養成模式"
        C1[習慣引導] --> C2[激勵機制] --> C3[進度追蹤]
    end
    
    subgraph "引導模式"
        G1[被動引導] --> G2[極簡操作] --> G3[漸進覺醒]
    end
    
    E3 --> Core[核心記帳功能]
    I3 --> Core
    C3 --> Core
    G3 --> Core
```

## 跨平台整合時序圖

```mermaid
sequenceDiagram
    participant U as 使用者
    participant L as LINE OA
    participant A as APP
    participant F as Firestore
    
    U->>L: 在 LINE 快速記帳
    L->>F: 寫入記帳資料
    F->>A: 即時同步更新
    Note over A: APP 顯示最新記錄
    
    U->>A: 在 APP 詳細管理
    A->>F: 更新記帳資料
    F->>L: 同步更新
    Note over L: LINE Rich Menu 更新
    
    U->>A: 生成報表
    A->>F: 讀取歷史資料
    F->>A: 返回資料
    A->>U: 提供報表下載
```

---

## 使用說明

本檔案包含 LCAS 2.0 的完整 User Flow Chart，使用 Mermaid 語法編寫。每個流程圖都可以直接在支援 Mermaid 的平台上渲染，包括：

- GitHub README
- GitLab Wiki
- Notion
- Obsidian
- VS Code (with Mermaid extension)
- 線上 Mermaid 編輯器

### 流程圖分類：

1. **F001-F004**: 進入階段流程
2. **F005-F008**: 記帳階段流程
3. **F009-F011**: 管理階段流程
4. **F012-F013**: 分析階段流程
5. **四模式差異化流程**: 專家、慣性、養成、引導模式
6. **異常處理流程**: 網路、衝突、權限、系統錯誤
7. **系統架構圖**: 泳道圖、決策樹、時序圖

### 設計特色：

- **模組化設計**: 每個流程圖獨立且可重複使用
- **顏色編碼**: 使用一致的顏色系統標示不同狀態
- **四模式支援**: 完整體現 LCAS 2.0 的四模式理論
- **跨平台整合**: 清楚展示 LINE OA 與 APP 的協作流程
- **錯誤處理**: 涵蓋完整的異常情況處理機制

此檔案將作為產品開發、UI/UX 設計、系統測試的重要視覺化參考依據。
