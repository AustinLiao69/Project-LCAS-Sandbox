# 0070. DB schema

**ç‰ˆæœ¬**: 1.0.2  
**å»ºç«‹æ—¥æœŸ**: 2025-12-11  
**å»ºç«‹è€…**: AustinLiao69  
**æœ€å¾Œæ›´æ–°**: 2025-12-19 

________________________________________
## ç›®æ¬¡ (Table of Contents)

1. [æ¦‚è¿° (Overview)](#1-æ¦‚è¿°-overview)
   - 1.1 [è³‡æ–™åº«é¡žåž‹èˆ‡æž¶æ§‹](#11-è³‡æ–™åº«é¡žåž‹èˆ‡æž¶æ§‹)
   - 1.2 [æ ¸å¿ƒæ¨¡çµ„æž¶æ§‹](#12-æ ¸å¿ƒæ¨¡çµ„æž¶æ§‹)
   - 1.3 [æž¶æ§‹åŽŸå‰‡](#13-æž¶æ§‹åŽŸå‰‡)

2. [å‘½åè¦ç¯„ (Naming Conventions)](#2-å‘½åè¦ç¯„-naming-conventions)
   - 2.1 [é›†åˆèˆ‡æ–‡æª”å‘½å](#21-é›†åˆèˆ‡æ–‡æª”å‘½å)
   - 2.2 [æ¬„ä½å‘½åè¦å‰‡](#22-æ¬„ä½å‘½åè¦å‰‡)
   - 2.3 [åƒè€ƒæ¨™è­˜ç¬¦è¦ç¯„](#23-åƒè€ƒæ¨™è­˜ç¬¦è¦ç¯„)

3. [å…¨åŸŸè¦å‰‡ (Global Rules)](#3-å…¨åŸŸè¦å‰‡-global-rules)
   - 3.1 [å¿…è¦æ¬„ä½è¦ç¯„](#31-å¿…è¦æ¬„ä½è¦ç¯„)
   - 3.2 [è³‡æ–™é¡žåž‹è¦ç¯„](#32-è³‡æ–™é¡žåž‹è¦ç¯„)
   - 3.3 [ç‹€æ…‹ç®¡ç†è¦ç¯„](#33-ç‹€æ…‹ç®¡ç†è¦ç¯„)

4. [é›†åˆæž¶æ§‹ (Collections Schema)](#4-é›†åˆæž¶æ§‹-collections-schema)
   - 4.1 [AMæ¨¡çµ„ - å¸³è™Ÿç®¡ç†](#41-amæ¨¡çµ„---å¸³è™Ÿç®¡ç†)
   - 4.2 [æ ¸å¿ƒå¸³æœ¬æž¶æ§‹](#42-æ ¸å¿ƒå¸³æœ¬æž¶æ§‹)
   - 4.3 [WCMæ¨¡çµ„ - å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†](#43-wcmæ¨¡çµ„---å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†)
   - 4.4 [BMæ¨¡çµ„ - é ç®—ç®¡ç†](#44-bmæ¨¡çµ„---é ç®—ç®¡ç†)
   - 4.5 [CMæ¨¡çµ„ - å”ä½œç®¡ç†](#45-cmæ¨¡çµ„---å”ä½œç®¡ç†)
   - 4.6 [ç³»çµ±é…ç½®é›†åˆ](#46-ç³»çµ±é…ç½®é›†åˆ)

5. [é—œè¯æž¶æ§‹ (Relations)](#5-é—œè¯æž¶æ§‹-relations)
   - 5.1 [ä¸»è¦é—œè¯é—œä¿‚](#51-ä¸»è¦é—œè¯é—œä¿‚)
   - 5.2 [æ¨¡çµ„é–“è³‡æ–™æµ](#52-æ¨¡çµ„é–“è³‡æ–™æµ)

6. [é©—è­‰è¦å‰‡ (Validation Rules)](#6-é©—è­‰è¦å‰‡-validation-rules)
   - 6.1 [ä½¿ç”¨è€…é¡žåž‹é©—è­‰](#61-ä½¿ç”¨è€…é¡žåž‹é©—è­‰)
   - 6.2 [æ¬Šé™ç­‰ç´šé©—è­‰](#62-æ¬Šé™ç­‰ç´šé©—è­‰)
   - 6.3 [æ¥­å‹™é‚è¼¯é©—è­‰](#63-æ¥­å‹™é‚è¼¯é©—è­‰)

7. [è³‡æ–™ç”Ÿå‘½é€±æœŸ (Lifecycle)](#7-è³‡æ–™ç”Ÿå‘½é€±æœŸ-lifecycle)
   - 7.1 [ç‹€æ…‹è½‰æ›è¦å‰‡](#71-ç‹€æ…‹è½‰æ›è¦å‰‡)
   - 7.2 [æ¨¡çµ„ç‰¹å®šé€±æœŸ](#72-æ¨¡çµ„ç‰¹å®šé€±æœŸ)

8. [ç´¢å¼•é…ç½® (Indexes)](#8-ç´¢å¼•é…ç½®-indexes)
   - 8.1 [æ•ˆèƒ½æœ€ä½³åŒ–ç´¢å¼•](#81-æ•ˆèƒ½æœ€ä½³åŒ–ç´¢å¼•)
   - 8.2 [è¤‡åˆæŸ¥è©¢ç´¢å¼•](#82-è¤‡åˆæŸ¥è©¢ç´¢å¼•)

9. [ç‰ˆæœ¬æ­·ç¨‹ (Versioning)](#9-ç‰ˆæœ¬æ­·ç¨‹-versioning)

10. [å®‰å…¨è€ƒé‡ (Security Considerations)](#10-å®‰å…¨è€ƒé‡-security-considerations)

---

## 1. æ¦‚è¿° (Overview)

### 1.1 è³‡æ–™åº«é¡žåž‹èˆ‡æž¶æ§‹
**Database Type**: Firestore (NoSQL, document-based)  
**Structure Style**: Collections â†’ Documents â†’ Subcollections  
**Version**: v2.0  
**Last Update**: 2025-12-11  
**Maintainers**: LCAS PM Team  

### 1.2 æ ¸å¿ƒæ¨¡çµ„æž¶æ§‹
LCAS 2.0 æŽ¡ç”¨ Firestore ä½œç‚ºä¸»è¦è³‡æ–™åº«ï¼Œæ”¯æ´å››å¤§æ ¸å¿ƒæ¨¡çµ„ï¼š
- **AM** (Account Management) - å¸³è™Ÿç®¡ç†å’Œå¸³æœ¬åŸºç¤Žçµæ§‹åˆå§‹åŒ–æ¨¡çµ„ï¼ˆå°ˆæ³¨é¦–æœ¬å¸³æœ¬ï¼‰
- **BM** (Budget Management) - é ç®—ç®¡ç†æ¨¡çµ„  
- **CM** (Collaboration Management) - å”ä½œèˆ‡å¸³æœ¬ç®¡ç†æ¨¡çµ„ï¼ˆæ•´åˆMLSåŠŸèƒ½ï¼Œç®¡ç†æ‰€æœ‰å¾ŒçºŒå¸³æœ¬ï¼‰
- **WCM** (Wallet and Category Management) - å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†æ¨¡çµ„ï¼ˆå·²æ•´åˆAMæ¨¡çµ„çš„ç§‘ç›®åˆå§‹åŒ–åŠŸèƒ½åŠé è¨­å¸³æˆ¶å»ºç«‹åŠŸèƒ½ï¼‰

### 1.3 æž¶æ§‹åŽŸå‰‡
â€¢ æ¯å€‹ä¸»é›†åˆéƒ½ä½¿ç”¨è‡ªå‹•ç”Ÿæˆçš„ ID æˆ–æœ‰æ„ç¾©çš„ ID  
â€¢ åš´æ ¼å€åˆ†ä¸»é›†åˆèˆ‡å­é›†åˆï¼Œ**å®Œå…¨ç¦ç”¨é ‚å±¤budgetsé›†åˆ**ï¼Œå¼·åˆ¶ä½¿ç”¨å­é›†åˆæž¶æ§‹  
â€¢ æ‰€æœ‰æ™‚é–“æ¬„ä½ä½¿ç”¨ Firestore Timestamp  
â€¢ æ‰€æœ‰ module éƒ½å¿…é ˆç¶­è­· backward compatibility  
â€¢ æ”¯æ´è·¨å¹³å°å¸³è™Ÿçµ±ä¸€ç®¡ç† (LINE/iOS/Android)  
â€¢ å‹•æ…‹è·¯å¾‘è§£æžæ”¯æ´ç¨ç«‹å¸³æœ¬å’Œå”ä½œå¸³æœ¬  
â€¢ é…ç½®ä¾†æºçµ±ä¸€ä½¿ç”¨03. Default_configè³‡æ–™å¤¾  

________________________________________
## 2. å‘½åè¦ç¯„ (Naming Conventions)

### 2.1 é›†åˆèˆ‡æ–‡æª”å‘½å
**Collections**: camelCase  
**Documents**: autoId æˆ– meaningfulId (å¦‚ user_email æ ¼å¼)  

### 2.2 æ¬„ä½å‘½åè¦å‰‡
**Fields**: camelCase  
**Timestamps**: createdAt, updatedAt  

### 2.3 åƒè€ƒæ¨™è­˜ç¬¦è¦ç¯„
**User Reference**: userId, UID  
**Ledger Reference**: ledgerId  
**Platform Prefix**: LINE_UID, iOS_UID, Android_UID  

________________________________________
## 3. å…¨åŸŸè¦å‰‡ (Global Rules)

### 3.1 å¿…è¦æ¬„ä½è¦ç¯„
â€¢ æ‰€æœ‰ document å¿…é ˆåŒ…å« createdAt
â€¢ æ‰€æœ‰å¯ä¿®æ”¹ document å¿…é ˆåŒ…å« updatedAt  

### 3.2 è³‡æ–™é¡žåž‹è¦ç¯„
â€¢ Boolean ä¸€å¾‹ä½¿ç”¨ true / false
â€¢ é¿å… nullï¼ˆä½¿ç”¨ç©ºå­—ä¸²ã€ç©ºç‰©ä»¶ã€ç©ºé™£åˆ—ï¼‰

### 3.3 ç‹€æ…‹ç®¡ç†è¦ç¯„
â€¢ status æ¬„ä½å¿…é ˆç‚º enumï¼šactive / archived / deleted / inactive / suspended
â€¢ ç”¨æˆ¶é¡žåž‹çµ±ä¸€ä½¿ç”¨ï¼šM (Manager) / S (Single) / J (Join)
â€¢ æ‰€æœ‰æ¨¡çµ„æ“ä½œå¿…é ˆè¨˜éŒ„ module å’Œ version è³‡è¨Š

________________________________________
## 4. é›†åˆæž¶æ§‹ (Collections Schema)

### ðŸ”¹ 4.1 AMæ¨¡çµ„ - å¸³è™Ÿç®¡ç†

#### 4.1.1 Collection: users
**Document ID**: UIDï¼ˆä¾†è‡ª Firebase Auth æˆ–çµ±ä¸€ç”Ÿæˆï¼‰

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| UID | string | required | ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| displayName | string | optional | ç”¨æˆ¶é¡¯ç¤ºåç¨± | max 50 chars |
| userType | string | required | ç”¨æˆ¶é¡žåž‹ | enum: M/S/J |
| email | string | optional | é›»å­éƒµä»¶ | unique when present |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| lastActive | timestamp | optional | æœ€å¾Œæ´»å‹•æ™‚é–“ | |
| timezone | string | optional | æ™‚å€è¨­å®š | default: Asia/Taipei |
| linkedAccounts | object | optional | è·¨å¹³å°å¸³è™Ÿé—œè¯ | see below |
| settings | object | optional | ç”¨æˆ¶è¨­å®š | see below |
| joined_ledgers | array | optional | åƒèˆ‡çš„å¸³æœ¬æ¸…å–® | |
| metadata | object | optional | å…ƒæ•¸æ“š | source, profilePicture, etc |
| defaultLedgerId | string | optional | é è¨­å¸³æœ¬ID | |
| status | string | required | å¸³è™Ÿç‹€æ…‹ | enum: active/suspended/deleted |
| userMode | string | optional | ç”¨æˆ¶æ¨¡å¼ | |

**Substructures**:
```javascript
linkedAccounts: {
  LINE_UID: string,
  iOS_UID: string,
  Android_UID: string
}

settings: {
  notifications: boolean,
  language: string
}

metadata: {
  source: string,        // ä¾†æºå¹³å°
  profilePicture: string,
  appVersion: string,
  deviceInfo: object
}
```

#### 4.1.2 Collection: account_mappings
**Document ID**: mapping_id æˆ– primary_UID

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| primary_UID | string | required | ä¸»è¦ç”¨æˆ¶ID | |
| platform_accounts | object | required | å¹³å°å¸³è™Ÿå°æ‡‰ | see below |
| email | string | optional | é›»å­éƒµä»¶ | |
| created_at | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updated_at | timestamp | required | æ›´æ–°æ™‚é–“ | |
| status | string | required | æ˜ å°„ç‹€æ…‹ | enum: active/suspended/deleted |

**Substructures**:
```javascript
platform_accounts: {
  LINE: string,
  iOS: string,
  Android: string
}
```

### ðŸ”¹ 4.2 æ ¸å¿ƒå¸³æœ¬æž¶æ§‹

#### 4.2.1 Collection: ledgers
**Document ID**: ledgerIdï¼ˆuser_email æ ¼å¼æˆ–è‡ªå‹•ç”Ÿæˆï¼‰

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| id | string | required | å¸³æœ¬ID | primary key |
| name | string | required | å¸³æœ¬åç¨± | max 50 chars |
| owner | string | required | æ“æœ‰è€…ID | must exist in users |
| type | string | required | å¸³æœ¬é¡žåž‹ | enum: personal/shared/project/category |
| userId | string | required | ç”¨æˆ¶ID | |
| description | string | optional | æè¿° | |
| status | string | required | ç‹€æ…‹ | enum: active/archived |
| initializationComplete | boolean | required | åˆå§‹åŒ–å®Œæˆæ¨™èªŒ | |
| categoryCount | number | optional | ç§‘ç›®æ•¸é‡ | |
| walletCount | number | optional | å¸³æˆ¶æ•¸é‡ | |
| settings | object | optional | è¨­å®š | see below |
| metadata | object | optional | å…ƒæ•¸æ“š | see below |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

**Substructures**:
```javascript
settings: {
  currency: string,      // é è¨­è²¨å¹£
  timezone: string,      // æ™‚å€
  dateFormat: string,    // æ—¥æœŸæ ¼å¼
  language: string       // èªžè¨€
}

metadata: {
  version: string,
  createdBy: string,
  initializationStage: string
}
```

**Subcollections**:
| Subcollection | Description |
|---------------|-------------|
| wallets | å¸³æˆ¶åˆ—è¡¨ (WCMæ¨¡çµ„ç®¡ç†) |
| categories | ç§‘ç›®åˆ—è¡¨ (WCMæ¨¡çµ„ç®¡ç†) |
| budgets | é ç®—è¨­å®š (BMæ¨¡çµ„ç®¡ç†) |
| transactions | äº¤æ˜“è¨˜éŒ„ |
| pendingTransactions | æš«å­˜è¨˜å¸³è³‡æ–™ (LBKæ¨¡çµ„ç®¡ç†) |

### ðŸ”¹ 4.3 WCMæ¨¡çµ„ - å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†

#### 4.3.1 Subcollection: ledgers/{ledgerId}/wallets
**Collection Path**: `ledgers/{ledgerId}/wallets`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| walletId | string | required | å¸³æˆ¶ID | primary key |
| walletName | string | required | å¸³æˆ¶åç¨± | max 50 chars |
| subWalletId | string | required | å­å¸³æˆ¶ID | default: TWD |
| subWalletName | string | required | å­å¸³æˆ¶åç¨± | default: TWD |
| currency | string | required | è²¨å¹£å–®ä½ | default: TWD |
| balance | number | required | å¸³æˆ¶é¤˜é¡ | |
| synonyms | string | optional | åŒç¾©è©ž | |
| isDefault | boolean | optional | æ˜¯å¦ç‚ºé è¨­å¸³æˆ¶ | |
| userId | string | required | ç”¨æˆ¶ID | |
| ledgerId | string | required | å¸³æœ¬ID | |
| status | string | required | ç‹€æ…‹ | enum: active/inactive |
| dataSource | string | optional | è³‡æ–™ä¾†æº | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

#### 4.3.2 Subcollection: ledgers/{ledgerId}/categories
**Collection Path**: `ledgers/{ledgerId}/categories`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| id | string | required | ç§‘ç›®ID | primary key |
| subCategoryId | string | required | å­ç§‘ç›®ä»£ç¢¼ | |
| categoryId | string/number | optional | çˆ¶ç§‘ç›®ID | |
| categoryName | string | required | ç§‘ç›®åç¨± | |
| subCategoryName | string | optional | å­ç§‘ç›®åç¨± | |
| synonyms | string | optional | åŒç¾©è©ž | comma separated |
| name | string | required | é¡¯ç¤ºåç¨± | |
| type | string | required | ç§‘ç›®é¡žåž‹ | enum: income/expense |
| level | number | optional | ç§‘ç›®å±¤ç´š | |
| color | string | optional | é¡è‰²ä»£ç¢¼ | |
| icon | string | optional | åœ–ç¤º | |
| description | string | optional | æè¿° | |
| isDefault | boolean | optional | æ˜¯å¦ç‚ºé è¨­ç§‘ç›® | |
| isActive | boolean | required | æ˜¯å¦å•Ÿç”¨ | |
| userId | string | required | ç”¨æˆ¶ID | |
| ledgerId | string | required | å¸³æœ¬ID | |
| status | string | required | ç‹€æ…‹ | enum: active/inactive |
| dataSource | string | optional | è³‡æ–™ä¾†æº | 0099. Subject_code.json |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

#### 4.3.3 Subcollection: ledgers/{ledgerId}/pendingTransactions
**Collection Path**: `ledgers/{ledgerId}/pendingTransactions`
**ç®¡ç†æ¨¡çµ„**: LBK (å¿«é€Ÿè¨˜å¸³æ¨¡çµ„)
**ç”¨é€”**: æš«å­˜å¤šéšŽæ®µè™•ç†çš„è¨˜å¸³è³‡æ–™ï¼Œæ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼æ­§ç¾©æ¶ˆé™¤æµç¨‹

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| pendingId | string | required | æš«å­˜è¨˜éŒ„å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key, auto-generated |
| userId | string | required | ç”¨æˆ¶ID | must exist in users |
| ledgerId | string | required | å¸³æœ¬ID | must match parent ledger |
| originalInput | string | required | ç”¨æˆ¶åŽŸå§‹è¼¸å…¥ | max 200 chars |
| parsedData | object | required | å·²è§£æžçš„è³‡æ–™ | see below |
| walletSynonyms | string | optional | ç”¨æˆ¶åŽŸå§‹æ”¯ä»˜æ–¹å¼è¼¸å…¥ | ä¾†è‡ªwalletså­é›†åˆsynonyms |
| walletId | string | optional | éŒ¢åŒ…IDé—œè¯ | å°æ‡‰walletså­é›†åˆwalletIdä¸»éµ |
| processingStage | string | required | è™•ç†éšŽæ®µ | enum: PENDING_CATEGORY/PENDING_WALLET/COMPLETED/CANCELLED |
| resolvedData | object | optional | å·²è§£æ±ºçš„è³‡æ–™ | see below |
| ambiguityInfo | object | optional | æ­§ç¾©æ¶ˆé™¤è³‡è¨Š | see below |
| metadata | object | required | å…ƒæ•¸æ“š | see below |
| status | string | required | è¨˜éŒ„ç‹€æ…‹ | enum: active/completed/cancelled/expired |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| expiresAt | timestamp | required | éŽæœŸæ™‚é–“ | default: createdAt + 30 minutes |

**Substructures**:
```javascript
parsedData: {
  amount: number,           // é‡‘é¡
  description: string,      // æè¿°
  rawCategory: string,      // åŽŸå§‹ç§‘ç›®é—œéµå­—
  rawWallet: string        // åŽŸå§‹æ”¯ä»˜æ–¹å¼é—œéµå­—
}

resolvedData: {
  categoryId: string,       // å·²é¸æ“‡çš„ç§‘ç›®ID
  categoryName: string,     // å·²é¸æ“‡çš„ç§‘ç›®åç¨±
  walletId: string,        // å·²é¸æ“‡çš„æ”¯ä»˜æ–¹å¼ID
  walletName: string       // å·²é¸æ“‡çš„æ”¯ä»˜æ–¹å¼åç¨±
}

ambiguityInfo: {
  currentAmbiguity: string,    // ç•¶å‰æ­§ç¾©é¡žåž‹: category/wallet/none
  categoryOptions: array,       // ç§‘ç›®é¸é …åˆ—è¡¨
  walletOptions: array         // æ”¯ä»˜æ–¹å¼é¸é …åˆ—è¡¨
}

metadata: {
  source: string,          // ä¾†æºå¹³å° (default: LINE)
  module: string,          // è™•ç†æ¨¡çµ„ (default: LBK)
  version: string          // æ¨¡çµ„ç‰ˆæœ¬ (default: v1.4.8)
}
```

**State Transitions**:
```
PENDING_CATEGORY â†’ PENDING_WALLET â†’ COMPLETED
PENDING_CATEGORY â†’ COMPLETED (ç›´æŽ¥å®Œæˆ)
ä»»ä½•ç‹€æ…‹ â†’ CANCELLED (ç”¨æˆ¶å–æ¶ˆ)
```

**Business Rules**:
- è¨˜éŒ„é è¨­30åˆ†é˜å¾ŒéŽæœŸï¼Œæœ€å¤šå¯å»¶é•·è‡³120åˆ†é˜
- éŽæœŸè¨˜éŒ„è‡ªå‹•æ¸…ç†ï¼Œä¿ç•™7å¤©æ­·å²è¨˜éŒ„
- ç‹€æ…‹è½‰æ›å¿…é ˆç¬¦åˆå®šç¾©çš„è½‰æ›è¦å‰‡
- COMPLETED ç‹€æ…‹çš„è¨˜éŒ„å°‡è½‰æ›ç‚ºæ­£å¼äº¤æ˜“è¨˜éŒ„

### ðŸ”¹ 4.4 BMæ¨¡çµ„ - é ç®—ç®¡ç†

#### 4.4.1 Subcollection: ledgers/{ledgerId}/budgets
**Collection Path**: `ledgers/{ledgerId}/budgets`
**é‡è¦æž¶æ§‹èªªæ˜Ž**: **å®Œå…¨ç¦ç”¨é ‚å±¤budgetsé›†åˆ**ï¼Œç³»çµ±å¼·åˆ¶ä½¿ç”¨å­é›†åˆæž¶æ§‹ï¼Œæ‰€æœ‰é ç®—æ–‡æª”å¿…é ˆå­˜å„²åœ¨ç‰¹å®šå¸³æœ¬çš„å­é›†åˆä¸­

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| budgetId | string | required | é ç®—å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| ledgerId | string | required | å¸³æœ¬ID | |
| name | string | required | é ç®—åç¨± | |
| type | string | required | é ç®—é¡žåž‹ | enum: monthly/yearly/quarterly/project/category |
| amount | number | required | é ç®—ç¸½é‡‘é¡ | |
| consumed_amount | number | required | å·²ä½¿ç”¨é‡‘é¡ | |
| currency | string | required | è²¨å¹£å–®ä½ | default: TWD |
| start_date | timestamp/date | required | é ç®—é–‹å§‹æ™‚é–“ | |
| end_date | timestamp/date | required | é ç®—çµæŸæ™‚é–“ | |
| categories | array | optional | é ç®—åˆ†é¡žé…ç½® | |
| alert_rules | object | required | è­¦ç¤ºè¦å‰‡è¨­å®š | see below |
| userId | string | required | ä½¿ç”¨è€…ID | |
| createdBy | string | required | å»ºç«‹è€…ID | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updated_at | timestamp | required | æ›´æ–°æ™‚é–“ | |
| status | string | required | é ç®—ç‹€æ…‹ | enum: active/completed/archived |
| config_source | string | optional | é…ç½®ä¾†æº | |
| module | string | required | æ¨¡çµ„æ¨™è­˜ | default: BM |
| version | string | required | ç‰ˆæœ¬è™Ÿ | |

**Substructures**:
```javascript
alert_rules: {
  warning_threshold: number,      // è­¦å‘Šé–¾å€¼ (%)
  critical_threshold: number,     // åš´é‡é–¾å€¼ (%)
  enable_notifications: boolean   // å•Ÿç”¨é€šçŸ¥
}

categories: [
  {
    id: string,
    name: string,
    allocated_amount: number,
    used_amount: number,
    percentage: number,
    alert_threshold: number
  }
]
```

#### 4.4.2 Collection: budget_alerts
**Document ID**: alert_id

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| alert_id | string | required | è­¦ç¤ºID | primary key |
| budget_id | string | required | é ç®—ID | |
| alert_type | string | required | è­¦ç¤ºé¡žåž‹ | enum: warning/critical/exceeded |
| trigger_condition | object | required | è§¸ç™¼æ¢ä»¶ | |
| triggered_at | timestamp | required | è§¸ç™¼æ™‚é–“ | |
| notification_sent | boolean | required | é€šçŸ¥ç™¼é€ç‹€æ…‹ | |
| recipients | array | optional | æŽ¥æ”¶è€…æ¸…å–® | |

### ðŸ”¹ 4.5 CMæ¨¡çµ„ - å”ä½œç®¡ç†

#### 4.5.1 Collection: collaborations
**Document ID**: ledgerId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| ledgerId | string | required | å¸³æœ¬ID | primary key |
| ownerId | string | required | å¸³æœ¬æ“æœ‰è€…ID | |
| collaborationType | string | required | å”ä½œé¡žåž‹ | enum: shared/project/category |
| status | string | required | å”ä½œç‹€æ…‹ | enum: active/archived/suspended |
| members | array | required | æˆå“¡æ¸…å–® | see below |
| settings | object | required | å”ä½œè¨­å®š | see below |
| permissions | object | optional | æ¬Šé™é…ç½® | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

**Substructures**:
```javascript
members: [
  {
    memberId: string,
    userId: string,
    permissionLevel: string,    // owner/admin/member/viewer
    joinedAt: timestamp,
    invitedBy: string,
    status: string             // active/invited/suspended
  }
]

settings: {
  allowInvite: boolean,
  allowEdit: boolean,
  allowDelete: boolean,
  requireApproval: boolean,
  maxMembers: number,
  invitationExpireDays: number
}

permissions: {
  owner: string,
  admins: array,
  members: array,
  viewers: array
}
```

**Subcollections**:
| Subcollection | Description |
|---------------|-------------|
| members | æˆå“¡ç®¡ç†å­é›†åˆ |
| invitations | é‚€è«‹ç®¡ç†å­é›†åˆ |

#### 4.5.2 Subcollection: collaborations/{ledgerId}/members
**Collection Path**: `collaborations/{ledgerId}/members`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| userId | string | required | ç”¨æˆ¶å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| email | string | optional | ç”¨æˆ¶é›»å­éƒµä»¶ | |
| role | string | required | è§’è‰² | enum: owner/admin/member/viewer |
| permissions | object | optional | æ¬Šé™è¨­å®š | |
| joinedAt | timestamp | required | åŠ å…¥æ™‚é–“ | |
| status | string | required | æˆå“¡ç‹€æ…‹ | enum: active/invited/suspended |
| createdAt | timestamp | required | å‰µå»ºæ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| createdBy | string | required | å‰µå»ºè€… | |

#### 4.5.3 Subcollection: collaborations/{ledgerId}/invitations
**Collection Path**: `collaborations/{ledgerId}/invitations`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| invitationId | string | required | é‚€è«‹å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key |
| inviterId | string | required | é‚€è«‹è€…ID | |
| inviteeEmail | string | required | è¢«é‚€è«‹è€…email | |
| role | string | required | é è¨­è§’è‰² | |
| status | string | required | é‚€è«‹ç‹€æ…‹ | enum: pending/accepted/declined/expired |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| expiresAt | timestamp | required | é‚€è«‹éŽæœŸæ™‚é–“ | |

#### 4.5.4 Collection: member_invitations
**Document ID**: invitationId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| invitationId | string | required | é‚€è«‹ID | primary key |
| ledgerId | string | required | å¸³æœ¬ID | |
| inviterId | string | required | é‚€è«‹è€…ID | |
| inviteeInfo | object | required | è¢«é‚€è«‹è€…è³‡è¨Š | |
| permissionLevel | string | required | æ¬Šé™ç­‰ç´š | |
| status | string | required | é‚€è«‹ç‹€æ…‹ | |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| expiresAt | timestamp | required | éŽæœŸæ™‚é–“ | |

#### 4.5.5 Collection: collaboration_logs
**Document ID**: logId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| logId | string | required | æ—¥èªŒID | primary key |
| ledgerId | string | required | å¸³æœ¬ID | |
| userId | string | required | ç”¨æˆ¶ID | |
| actionType | string | required | æ“ä½œé¡žåž‹ | |
| actionData | object | optional | æ“ä½œè³‡æ–™ | |
| timestamp | timestamp | required | æ™‚é–“æˆ³ | |
| ipAddress | string | optional | IPåœ°å€ | |

#### 4.5.6 Collection: notification_preferences
**Document ID**: userId_ledgerId

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| userId | string | required | ç”¨æˆ¶ID | |
| ledgerId | string | required | å¸³æœ¬ID | |
| preferences | object | required | åå¥½è¨­å®š | see below |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |

**Substructures**:
```javascript
preferences: {
  memberJoined: boolean,
  memberLeft: boolean,
  permissionChanged: boolean,
  dataUpdated: boolean,
  conflictDetected: boolean,
  channels: array,
  quietHours: object
}
```

### ðŸ”¹ 4.6 ç³»çµ±é…ç½®é›†åˆ

#### 4.6.1 Collection: _system
**Document ID**: config_name

ç”¨æ–¼å„²å­˜å„ç¨®ç³»çµ±æž¶æ§‹å®šç¾©ã€é è¨­è¨­å®šé…ç½®ã€æ¨¡çµ„çµæ§‹é…ç½®ç­‰æ–‡æª”ã€‚

**é‡è¦é…ç½®ä¾†æº**: æ‰€æœ‰é è¨­é…ç½®ä¾†è‡ª**03. Default_configè³‡æ–™å¤¾**ï¼ŒåŒ…æ‹¬ï¼š
- `0301. Default_config.json` - ç³»çµ±ä¸»è¦é…ç½®
- `0302. Default_wallet.json` - é è¨­å¸³æˆ¶é…ç½®  
- `0303. Default_currency.json` - é è¨­è²¨å¹£é…ç½®
- `0304. Default_assessment.json` - é è¨­è©•ä¼°é…ç½®
- `0305. Default_pendingTransaction.json` - Pending Recordé è¨­é…ç½®
- `0099. Subject_code.json` - ç§‘ç›®ä»£ç¢¼é…ç½®

**å‹•æ…‹è·¯å¾‘è§£æžæ©Ÿåˆ¶**: æ”¯æ´WCMå’ŒBMæ¨¡çµ„çš„å‹•æ…‹è·¯å¾‘è§£æžåŠŸèƒ½ï¼Œè‡ªå‹•è­˜åˆ¥ï¼š
- ç¨ç«‹å¸³æœ¬è·¯å¾‘ï¼š`ledgers/{ledgerId}/wallets` æˆ– `ledgers/{ledgerId}/budgets`
- å”ä½œå¸³æœ¬è·¯å¾‘ï¼š`collaborations/{ledgerId}/members/{memberId}/wallets` æˆ–é¡žä¼¼çµæ§‹

### ðŸ”¹ 4.7 LBKæ¨¡çµ„ - Pending Record æš«å­˜è¨˜å¸³

#### 4.7.1 Subcollection: ledgers/{ledgerId}/pendingTransactions
**Collection Path**: `ledgers/{ledgerId}/pendingTransactions`
**ç®¡ç†æ¨¡çµ„**: LBK (å¿«é€Ÿè¨˜å¸³æ¨¡çµ„)
**ç”¨é€”**: æš«å­˜å¤šéšŽæ®µè™•ç†çš„è¨˜å¸³è³‡æ–™ï¼Œæ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼æ­§ç¾©æ¶ˆé™¤æµç¨‹
**é…ç½®ä¾†æº**: `0305. Default_pendingTransaction.json`

**Fields**:
| Field | Type | Required | Description | Constraints |
|-------|------|----------|-------------|-------------|
| pendingId | string | required | æš«å­˜è¨˜éŒ„å”¯ä¸€è­˜åˆ¥ç¢¼ | primary key, Date.now().toString() |
| userId | string | required | ç”¨æˆ¶ID | must exist in users |
| ledgerId | string | required | å¸³æœ¬ID | must match parent ledger |
| originalInput | string | required | ç”¨æˆ¶åŽŸå§‹è¼¸å…¥ | max 200 chars, e.g. "ç«é‹66666æ–°å…‰" |
| parsedData | object | required | å·²è§£æžçš„è³‡æ–™ | see below |
| processingStage | string | required | è™•ç†éšŽæ®µ | enum: PENDING_CATEGORY/PENDING_WALLET/COMPLETED/CANCELLED |
| stageData | object | optional | éšŽæ®µè³‡æ–™ | see below |
| ambiguityInfo | object | optional | æ­§ç¾©æ¶ˆé™¤è³‡è¨Š | see below |
| metadata | object | required | å…ƒæ•¸æ“š | see below |
| status | string | required | è¨˜éŒ„ç‹€æ…‹ | enum: active/completed/cancelled/expired |
| createdAt | timestamp | required | å»ºç«‹æ™‚é–“ | |
| updatedAt | timestamp | required | æ›´æ–°æ™‚é–“ | |
| expiresAt | timestamp | required | éŽæœŸæ™‚é–“ | default: createdAt + 30 minutes |
| completedTransactionId | string | optional | å®Œæˆå¾Œçš„äº¤æ˜“ID | è½‰æ›ç‚ºæ­£å¼äº¤æ˜“å¾Œçš„ID |
| completedAt | timestamp | optional | å®Œæˆæ™‚é–“ | |

**Substructures**:
```javascript
parsedData: {
  amount: number,           // å·²è§£æžçš„é‡‘é¡
  description: string,      // æè¿°è³‡è¨Š
  rawCategory: string,       // åŽŸå§‹ç§‘ç›®é—œéµå­—
  rawWallet: string         // åŽŸå§‹æ”¯ä»˜æ–¹å¼é—œéµå­—
}

stageData: {
  categorySelected: boolean,     // ç§‘ç›®æ˜¯å¦å·²é¸æ“‡
  walletSelected: boolean,      // éŒ¢åŒ…æ˜¯å¦å·²é¸æ“‡
  selectedCategory: {            // å·²é¸æ“‡çš„ç§‘ç›®è³‡è¨Š
    categoryId: string,          // ç§‘ç›®ID (ä¸»éµ)
    categoryName: string         // ç§‘ç›®åç¨±
  },
  selectedWallet: {             // å·²é¸æ“‡çš„éŒ¢åŒ…è³‡è¨Š
    walletId: string,           // éŒ¢åŒ…ID (å°æ‡‰wallets.walletId)
    walletName: string,         // éŒ¢åŒ…åç¨±
    type: string                // éŒ¢åŒ…é¡žåž‹ (cash/bank/credit)
  }
}

ambiguityInfo: {
  currentAmbiguity: string,     // ç•¶å‰æ­§ç¾©é¡žåž‹: category/wallet/none
  categoryOptions: array,        // ç§‘ç›®é¸é …åˆ—è¡¨
  walletOptions: array          // æ”¯ä»˜æ–¹å¼é¸é …åˆ—è¡¨
}

metadata: {
  source: string,               // ä¾†æºå¹³å° (default: LINE)
  module: string,               // è™•ç†æ¨¡çµ„ (default: LBK)
  version: string,              // æ¨¡çµ„ç‰ˆæœ¬
  processId: string,            // è™•ç†ID
  pendingId: string,            // Pending Record ID
  completionSource: string      // å®Œæˆä¾†æºæ¨™è­˜
}
```

**State Machine**:
```
PENDING_CATEGORY â†’ PENDING_WALLET â†’ COMPLETED
PENDING_CATEGORY â†’ COMPLETED (ç›´æŽ¥å®Œæˆ)
ä»»ä½•ç‹€æ…‹ â†’ CANCELLED (ç”¨æˆ¶å–æ¶ˆ)
```

**Business Rules**:
- è¨˜éŒ„é è¨­30åˆ†é˜å¾ŒéŽæœŸï¼Œæœ€å¤šå¯å»¶é•·è‡³120åˆ†é˜
- éŽæœŸè¨˜éŒ„è‡ªå‹•æ¸…ç†ï¼Œä¿ç•™7å¤©æ­·å²è¨˜éŒ„
- ç‹€æ…‹è½‰æ›å¿…é ˆç¬¦åˆå®šç¾©çš„è½‰æ›è¦å‰‡
- COMPLETED ç‹€æ…‹çš„è¨˜éŒ„å°‡è½‰æ›ç‚ºæ­£å¼äº¤æ˜“è¨˜éŒ„
- æ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼çš„æ­§ç¾©æ¶ˆé™¤æµç¨‹
- èˆ‡ wallets å­é›†åˆå»ºç«‹ walletId å¤–éµé—œè¯
- èˆ‡ categories å­é›†åˆå»ºç«‹ categoryId å¤–éµé—œè¯

**Integration Points**:
- **Reference Collections**: `ledgers/{ledgerId}/categories` (ç§‘ç›®è§£æž), `ledgers/{ledgerId}/wallets` (æ”¯ä»˜æ–¹å¼è§£æž)
- **Target Collection**: `ledgers/{ledgerId}/transactions` (å®Œæˆå¾Œè½‰æ›ç›®æ¨™)
- **Event Triggers**: onCreate (è¨­å®šéŽæœŸæ™‚é–“), onUpdate (é©—è­‰ç‹€æ…‹è½‰æ›), onExpire (æ¸…ç†éŽæœŸè¨˜éŒ„)
- **Synonym Learning**: æ”¯æ´ç§‘ç›®èˆ‡æ”¯ä»˜æ–¹å¼çš„åŒç¾©è©žå­¸ç¿’æ©Ÿåˆ¶

________________________________________
## 5. é—œè¯æž¶æ§‹ (Relations)

### 5.1 ä¸»è¦é—œè¯é—œä¿‚
â€¢ **users.UID** â†’ **ledgers.owner**
â€¢ **users.UID** â†’ **ledgers.userId**  
â€¢ **users.UID** â†’ **collaborations.ownerId**
â€¢ **users.UID** â†’ **collaborations.members.userId**
â€¢ **ledgers.id** â†’ **collaborations.ledgerId**
â€¢ **ledgers.id** â†’ **budgets.ledgerId**
â€¢ **ledgers.id** â†’ **wallets.ledgerId**
â€¢ **ledgers.id** â†’ **categories.ledgerId**

### 5.2 æ¨¡çµ„é–“è³‡æ–™æµ
```
users (1) â€”â€”â€” (many) ledgers
users (1) â€”â€”â€” (many) collaborations
ledgers (1) â€”â€”â€” (many) wallets
ledgers (1) â€”â€”â€” (many) categories  
ledgers (1) â€”â€”â€” (many) budgets
collaborations (1) â€”â€”â€” (many) members
collaborations (1) â€”â€”â€” (many) invitations
```

________________________________________
## 6. é©—è­‰è¦å‰‡ (Validation Rules)

### 6.1 ä½¿ç”¨è€…é¡žåž‹é©—è­‰
- userType å¿…é ˆç‚º M/S/J ä¹‹ä¸€
- M é¡žåž‹ï¼šå¯å»ºç«‹å¤šå€‹å¸³æœ¬ï¼Œå…·ç®¡ç†æ¬Šé™
- S é¡žåž‹ï¼šå–®ä¸€å¸³æœ¬ç”¨æˆ¶
- J é¡žåž‹ï¼šåƒ…å¯åŠ å…¥ä»–äººå¸³æœ¬

### 6.2 æ¬Šé™ç­‰ç´šé©—è­‰
- owner: level 4, actions: ["all"]
- admin: level 3, actions: ["invite", "remove", "edit", "view", "manage_permissions"]  
- member: level 2, actions: ["edit", "view", "invite_limited"]
- viewer: level 1, actions: ["view"]

### 6.3 æ¥­å‹™é‚è¼¯é©—è­‰
- amount å¿…é ˆ > 0
- consumed_amount >= 0
- consumed_amount <= amount * 1.5 (å…è¨±è¶…æ”¯ 50%)
- start_date < end_date

________________________________________
## 7. è³‡æ–™ç”Ÿå‘½é€±æœŸ (Lifecycle)

### 7.1 ç‹€æ…‹è½‰æ›è¦å‰‡

#### ç”¨æˆ¶ç‹€æ…‹
```
active â†’ suspended â†’ deleted
active â†’ deleted (ç›´æŽ¥åˆªé™¤)
```

#### å¸³æœ¬ç‹€æ…‹  
```
active â†’ archived â†’ deleted
```

### 7.2 æ¨¡çµ„ç‰¹å®šé€±æœŸ

#### å”ä½œç‹€æ…‹
```
active â†’ suspended â†’ archived
active â†’ archived (æ­£å¸¸çµæŸ)
```

#### é ç®—ç‹€æ…‹
```
active â†’ completed â†’ archived
active â†’ archived (æå‰çµæŸ)
```

________________________________________
## 8. ç´¢å¼•é…ç½® (Indexes)

### 8.1 æ•ˆèƒ½æœ€ä½³åŒ–ç´¢å¼•

#### è¤‡åˆç´¢å¼•
```javascript
// collaborations
{
  "collectionGroup": "collaborations",
  "fields": [
    {"fieldPath": "ledgerId", "order": "ASCENDING"},
    {"fieldPath": "userId", "order": "ASCENDING"}, 
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// budgets
{
  "collectionGroup": "budgets", 
  "fields": [
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "type", "order": "ASCENDING"},
    {"fieldPath": "start_date", "order": "ASCENDING"}
  ]
}
```

### 8.2 è¤‡åˆæŸ¥è©¢ç´¢å¼•
```javascript
// wallets
{
  "collectionGroup": "wallets",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "type", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// categories  
{
  "collectionGroup": "categories",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "type", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// pendingTransactions - åŸºæœ¬æŸ¥è©¢ç´¢å¼•
{
  "collectionGroup": "pendingTransactions",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "processingStage", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// pendingTransactions - éŽæœŸè¨˜éŒ„æ¸…ç†ç´¢å¼•
{
  "collectionGroup": "pendingTransactions", 
  "fields": [
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "expiresAt", "order": "ASCENDING"}
  ]
}

// pendingTransactions - ç‹€æ…‹æ©Ÿè½‰æ›ç´¢å¼•
{
  "collectionGroup": "pendingTransactions",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "processingStage", "order": "ASCENDING"},
    {"fieldPath": "updatedAt", "order": "DESCENDING"}
  ]
}

// pendingTransactions - æ­§ç¾©æ¶ˆé™¤æµç¨‹ç´¢å¼•
{
  "collectionGroup": "pendingTransactions",
  "fields": [
    {"fieldPath": "userId", "order": "ASCENDING"},
    {"fieldPath": "ambiguityInfo.currentAmbiguity", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}

// users
{
  "collectionGroup": "users",
  "fields": [
    {"fieldPath": "userType", "order": "ASCENDING"},
    {"fieldPath": "status", "order": "ASCENDING"},
    {"fieldPath": "createdAt", "order": "DESCENDING"}
  ]
}
```

________________________________________
## 9. ç‰ˆæœ¬æ­·ç¨‹ (Versioning)

| Version | Date | Changes | Modified By |
|---------|------|---------|-------------|
| v2.0 | 2025-12-24 | åˆç‰ˆå»ºç«‹ï¼Œæ•´åˆ AM/BM/CM/WCM æ¨¡çµ„æž¶æ§‹ | LCAS SA Team |
| | | å»ºç«‹å®Œæ•´çš„å­é›†åˆæž¶æ§‹æ”¯æ´ | |
| | | å®šç¾©è·¨å¹³å°å¸³è™Ÿç®¡ç†è¦ç¯„ | |
| | | å»ºç«‹å”ä½œèˆ‡é ç®—ç®¡ç†è³‡æ–™æ¨¡åž‹ | |
| v2.0.1 | 2025-12-19 | æ–°å¢ž pendingTransactions å­é›†åˆæž¶æ§‹ | LCAS SA Team |
| | | å®šç¾© Pending Record è³‡æ–™çµæ§‹èˆ‡ç‹€æ…‹æ©Ÿ | |
| | | å»ºç«‹å¤šéšŽæ®µè¨˜å¸³è™•ç†æµç¨‹åŸºç¤Žæž¶æ§‹ | |
| | | æ–°å¢žå°æ‡‰çš„è¤‡åˆç´¢å¼•é…ç½® | |
| v2.0.2 | 2025-12-22 | å®Œå–„ pendingTransactions å­é›†åˆå®šç¾© | LCAS SA Team |
| | | æ–°å¢ž 4.7 LBKæ¨¡çµ„ - Pending Record ç« ç¯€ | |
| | | è©³ç´°å®šç¾© stageData èˆ‡ ambiguityInfo çµæ§‹ | |
| | | è£œå……ç‹€æ…‹æ©Ÿè½‰æ›è¦å‰‡èˆ‡æ¥­å‹™é‚è¼¯ | |
| | | æ–°å¢žå°ˆç”¨ç´¢å¼•é…ç½®å„ªåŒ–æŸ¥è©¢æ•ˆèƒ½ | |

________________________________________
## 10. å®‰å…¨è€ƒé‡ (Security Considerations)

### 10.1 å­˜å–æ¬Šé™
- ç”¨æˆ¶åƒ…å¯å­˜å–è‡ªå·±çš„ ledgers å’Œç›¸é—œå­é›†åˆ
- å”ä½œå¸³æœ¬ä¾æ“š members æ¬Šé™ç­‰ç´šæŽ§åˆ¶å­˜å–
- ç³»çµ±ç®¡ç†å“¡å¯å­˜å– _system é›†åˆ

### 10.2 è³‡æ–™éš”é›¢
- æ¯å€‹ ledger çš„å­é›†åˆå®Œå…¨éš”é›¢
- è·¨å¹³å°å¸³è™Ÿé—œè¯éœ€è¦é©—è­‰
- æ•æ„Ÿè³‡è¨Š (å¦‚ device info) éœ€åŠ å¯†å„²å­˜

### 10.3 å¯©è¨ˆè¿½è¹¤
- æ‰€æœ‰é‡è¦æ“ä½œè¨˜éŒ„æ–¼ collaboration_logs
- æ¨¡çµ„æ“ä½œåŒ…å« module å’Œ version è³‡è¨Š
- ä¿ç•™å®Œæ•´çš„æ™‚é–“æˆ³è¿½è¹¤

---

**æ–‡ä»¶ç‹€æ…‹**: v2.0 - ç”Ÿç”¢å°±ç·’  
**ç¶­è­·è²¬ä»»**: LCAS æŠ€è¡“åœ˜éšŠ  
**æ›´æ–°é€±æœŸ**: æ¯å­£ reviewï¼Œé‡å¤§è®Šæ›´å³æ™‚æ›´æ–°