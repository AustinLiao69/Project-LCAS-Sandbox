------------------------------------------
20251228. 導入LINE記帳錯誤修改機制

------------------------------------------
20251228. 導入LINE記帳錯誤修改機制

📋 問題分析報告：LINE記帳修改機制
一、調查結論
核心發現：目前系統中並不存在「LINE記帳記錯後在LINE上修改」的機制。

二、問題詳細說明
2.1 現況分析
根據對以下文件的遍歷：
  •	0015 Product_SPEC_LCAS_2.0.md：產品規格書
  •	0070 DB schema.md：資料庫架構
  •	1315 LBK.js：LINE快速記帳模組
  •	1320 WH.js：Webhook處理模組
現有LINE OA功能包含：
功能
狀態
快速記帳（新增）
✅ 已實作
統計查詢（本日/週/月）
✅ 已實作
科目歧義消除（Pending Record）
✅ 已實作
支付方式歧義消除
✅ 已實作
修改已記帳的交易
❌ 未實作
刪除已記帳的交易
❌ 未實作
2.2 用簡單概念解釋
這就像一間只提供「填寫表單服務」的窗口（LINE OA），員工可以幫您填好資料送進系統。但如果填錯了，您需要去另一個部門（APP端）才能申請修改或作廢。目前這個窗口沒有設置「修改/取消」的服務功能。

三、技術原因分析
3.1 根據0015文件的設計意圖
文件2.2功能對比表明確指出：
  •	LINE OA：提供基礎記帳與簡易查詢
  •	APP：提供進階功能（含完整CRUD操作）
這意味著修改/刪除功能原設計就是放在APP端。
3.2 資料庫層面
根據0070文件：
  •	transactions子集合標註為「待新增」
  •	目前記帳資料寫入ledgers/{ledgerId}/entries
  •	資料庫層面具備修改能力，但BL層與LINE入口未實作對應功能

四、我的看法與建議
4.1 需要釐清的問題
在提出解決方案前，需要您確認：
  1	功能範圍：您希望實現的是：
  •	(A) 只能修改「最後一筆」記帳？
  •	(B) 可以查詢歷史記錄並選擇修改特定一筆？
  •	(C) 只能刪除/作廢，不能編輯內容？
  2	時間限制：是否有修改時間限制？（例如：只能修改24小時內的記帳）
  3	修改欄位：允許修改哪些欄位？
  •	金額
  •	科目
  •	支付方式
  •	備註
  •	全部
  4	與APP的關係：此功能是否應同步到APP端的修改歷史？

請您確認上述問題後，我將依據您的需求設計完整的解決方案，包含階段切分與實施計畫。

