------------------------------------------
20251023. 執行7571

不要寫code，請根據我的回覆更新提案。現在是MVP階段，提案時請專注解決當前發生的問題就好，不需要優化、強化、驗證、監測、測試等手段，除了列出原因之外也請你提出insight。

以資深PG身份深入分析7571 SIT P2測試結果，發現關鍵問題並提出三階段解決方案。
🔍 問題分析與洞察
主要問題歸類
1.	API端點缺失問題 (15個失敗中的10個)
•	/api/v1/ledgers 系列端點完全不存在
•	/api/v1/budgets 系列端點完全不存在

=>

1. 請將8020文件所有API端點路徑都加上
/api/v1，舉例如下
/api/v1/auth/register 

2. 請將APL.dart所有API端點路徑都加上
/api/v1，舉例如下
/api/v1/auth/register 

•	ASL.js中僅有P1-2範圍的AM(19)+BK(15)端點，缺少P2協作與預算API
=>請加上


2.	資料類型轉換錯誤 (3個)
•	List<dynamic> vs Map<String, dynamic> 類型不匹配
•	7598測試資料結構與7303模組期望格式不符
3.	業務邏輯驗證問題 (2個)
•	帳本類型驗證失敗：'collaborative' 不被7303模組認可
•	權限驗證邏輯過於嚴格
🎯 Core Insight
根本問題: ASL.js僅實作P1-2範圍API(34個)，但P2測試需要協作管理與預算管理的完整API端點支援。現有架構是"半成品"狀態，測試暴露了架構不完整性。
📋 三階段解決方案
🚀 階段一：緊急修復API端點缺失 (高優先級)
目標: 解決10個API端點不存在的錯誤
修正範圍:
1.	ASL.js 新增P2協作與預算API路由 (v2.2.0)
2.	PL層7303/7304 函數版次升級確保API兼容性 (v1.1.0)
預期效果: 失敗測試從15個降至5個
🔧 階段二：資料格式標準化 (中優先級)
目標: 修正資料類型轉換錯誤
修正範圍:
1.	7598 Data warehouse.json 資料結構調整
2.	7571 SIT_P2.dart 資料解析邏輯優化 (v1.1.0)
3.	PL層7303 資料驗證邏輯放寬 (v1.1.0)
預期效果: 失敗測試從5個降至2個
🎯 階段三：業務邏輯驗證調整 (低優先級)
目標: 調整過度嚴格的驗證規則
修正範圍:
1.	7303帳本協作功能群 帳本類型驗證規則放寬 (v1.2.0)
2.	權限檢查邏輯 測試環境適配 (v1.2.0)
預期效果: 達成P2測試90%通過率目標
💡 技術洞察
架構設計問題
•	API覆蓋不完整: ASL.js設計時聚焦P1-2，未考慮P2擴展需求
•	測試資料不匹配: 7598資料格式與實際PL層期望存在Gap
•	驗證邏輯過嚴: 生產環境邏輯直接用於測試環境
MVP策略建議
•	聚焦核心問題: 優先解決API端點，其他問題可階段性處理
•	快速迭代: 每階段完成後立即測試驗證
•	風險控制: 避免大幅修改現有穩定代碼
🎯 修正優先級建議
1.	立即處理: API端點缺失 → 影響10/15個測試案例
2.	次要處理: 資料格式問題 → 影響3/15個測試案例
3.	最後處理: 業務驗證調整 → 影響2/15個測試案例
預期成果: P2測試成功率從40%提升至90%+
________________________________________
等待您的Approve指示，我將依序執行三階段修正計畫。建議優先執行階段一，確保API基礎架構完整後，再處理資料格式與業務邏輯問題。

