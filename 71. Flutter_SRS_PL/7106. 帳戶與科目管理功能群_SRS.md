# 7106. å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†åŠŸèƒ½ç¾¤_SRS.md

**æ–‡ä»¶ç·¨è™Ÿ**: 7106
**ç‰ˆæœ¬**: v1.0.0
**å»ºç«‹æ—¥æœŸ**: 2025-11-17
**å»ºç«‹è€…**: LCAS PM Team
**æœ€å¾Œæ›´æ–°**: 2025-11-17

---

## ğŸ“‘ ç›®æ¬¡ (Table of Contents)

1. [æ¨¡çµ„æ¦‚è¿° (Module Overview)](#10-æ¨¡çµ„æ¦‚è¿°module-overview)

2. [åŠŸèƒ½éœ€æ±‚ (Functional Requirements)](#20-åŠŸèƒ½éœ€æ±‚functional-requirements)
   - 2.1 å¸³æˆ¶è³‡æ–™ç®¡ç†é‚è¼¯
   - 2.2 ç§‘ç›®éšå±¤ç®¡ç†é‚è¼¯
   - 2.3 å¸³æˆ¶é¤˜é¡è¨ˆç®—é‚è¼¯
   - 2.4 ç§‘ç›®ä½¿ç”¨çµ±è¨ˆé‚è¼¯
   - 2.5 æœ¬åœ°è³‡æ–™å¿«å–èˆ‡åŒæ­¥é‚è¼¯

3. [è¼¸å…¥/è¼¸å‡ºè¦æ ¼ (Input & Output Specifications)](#30-è¼¸å…¥è¼¸å‡ºè¦æ ¼input--output-specifications)
   - 3.1 APL Gatewayè¼¸å…¥è¦æ ¼
   - 3.2 APL Gatewayè¼¸å‡ºè¦æ ¼
   - 3.3 WCM.jsæ¨¡çµ„ä»‹é¢è¦æ ¼
   - 3.4 æœ¬åœ°å¿«å–èˆ‡åŒæ­¥è¦æ ¼

4. [éŒ¯èª¤è™•ç†èˆ‡ä¾‹å¤–ç‹€æ³ (Error Handling & Edge Cases)](#40-éŒ¯èª¤è™•ç†èˆ‡ä¾‹å¤–ç‹€æ³error-handling--edge-cases)
   - 4.1 åŸºæœ¬éŒ¯èª¤è™•ç†
   - 4.2 å¸³æˆ¶ç®¡ç†ç›¸é—œéŒ¯èª¤
   - 4.3 ç§‘ç›®ç®¡ç†ç›¸é—œéŒ¯èª¤
   - 4.4 ç¶²è·¯é€£ç·šéŒ¯èª¤
   - 4.5 æ¥­å‹™é‚è¼¯å±¤ç‰¹æ®Šè™•ç†

---

## 1.0 æ¨¡çµ„æ¦‚è¿°ï¼ˆModule Overviewï¼‰

### 1.1 æ¨¡çµ„å®šä½èˆ‡è·è²¬

**å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†åŠŸèƒ½ç¾¤**æ˜¯LCAS 2.0å°ˆæ¡ˆPresentation Layerçš„é—œéµæ¥­å‹™é‚è¼¯æ¨¡çµ„ç¾¤ï¼Œè² è²¬è™•ç†å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†çš„å®Œæ•´æ¥­å‹™é‚è¼¯æµç¨‹ã€‚æœ¬åŠŸèƒ½ç¾¤å°æ‡‰0090 Sprintè¨ˆç•«çš„**Phase 3**ç¯„åœï¼Œå°ˆæ³¨æ–¼PLå±¤çš„**åŠŸèƒ½ç¾¤æ¥­å‹™é‚è¼¯**ï¼Œè€ŒéUIé é¢ç¾¤ã€‚

**æ ¸å¿ƒè·è²¬ç¯„åœ**ï¼š
**å¸³æˆ¶ç®¡ç†é‚è¼¯**ï¼šAPIèª¿ç”¨ã€è³‡æ–™é©—è­‰ã€ç‹€æ…‹ç®¡ç†
**ç§‘ç›®ç®¡ç†é‚è¼¯**ï¼šéšå±¤çµæ§‹è™•ç†ã€æ¨¹ç‹€åŒæ­¥
**é¤˜é¡è¨ˆç®—é‚è¼¯**ï¼šå³æ™‚è¨ˆç®—
**è³‡æ–™åŒæ­¥**ï¼šåŸºæœ¬å¿«å–èˆ‡APIåŒæ­¥æ©Ÿåˆ¶

### 1.2 åŠŸèƒ½ç¾¤ç¯„åœå®šç¾©

æœ¬åŠŸèƒ½ç¾¤å°ˆæ³¨æ–¼**æ¥­å‹™é‚è¼¯å±¤**ï¼Œä¸æ¶‰åŠUIé é¢ç¾¤ï¼Œå°æ‡‰7302è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤çš„æ¶æ§‹æ¨¡å¼ï¼š

| è·è²¬å±¤ç´š | åŠŸèƒ½ç¯„åœ | å°æ‡‰æ¨¡çµ„ | å‚™è¨» |
|----------|----------|----------|------|
| **æ¥­å‹™é‚è¼¯è™•ç†** | APIèª¿ç”¨ã€ç‹€æ…‹ç®¡ç†ã€è³‡æ–™è½‰æ› | 7106 | æœ¬æ¨¡çµ„æ ¸å¿ƒ |
| **APIæœå‹™å°æ¥** | APL.dart Gateway (çµ±ä¸€APIè½‰ç™¼çª—å£) | APLå±¤ | ä»‹é¢ä¾è³´ |
| **BLå±¤æ•´åˆ** | 1350. WCM.jsæ¨¡çµ„ | BLå±¤ | å¾Œç«¯æœå‹™ |
| **UIé é¢ç¾¤** | S-304ã€S-305ã€S-306é é¢ | é é¢ç¾¤æ¨¡çµ„ | éæœ¬æ¨¡çµ„ç¯„åœ |



### 1.4 æŠ€è¡“æ¶æ§‹æ•´åˆ

#### 1.4.1 èˆ‡APL.dart GatewayåŠWCM.jsæ¨¡çµ„æ•´åˆé—œä¿‚

æœ¬åŠŸèƒ½ç¾¤ä½œç‚ºPLå±¤æ¥­å‹™é‚è¼¯ï¼Œé€éAPL.dartçµ±ä¸€Gatewayèˆ‡BLå±¤1350. WCM.jsæ¨¡çµ„å»ºç«‹æ¸…æ™°çš„æ•´åˆæ¶æ§‹ï¼š

```
7106åŠŸèƒ½ç¾¤ (PLæ¥­å‹™é‚è¼¯å±¤)
    â†“ çµ±ä¸€APIèª¿ç”¨
APL.dart Gateway (çµ±ä¸€APIè½‰ç™¼çª—å£)
    â†“ RESTfulè½‰ç™¼
ASL.js (APIæœå‹™å±¤)
    â†“ æ¥­å‹™é‚è¼¯èª¿ç”¨
1350. WCM.js (BLå±¤æ¨¡çµ„)
    â†“ è³‡æ–™å­˜å–
Firebase (DLå±¤)
```

**æ ¸å¿ƒæ•´åˆé»**ï¼š
- **å¸³æˆ¶ç®¡ç†**ï¼š7106 â†’ APL.account â†’ ASL.js â†’ WCM_createWalletã€WCM_getWalletListç­‰å‡½æ•¸
- **ç§‘ç›®ç®¡ç†**ï¼š7106 â†’ APL.categoryï¼ˆP3ï¼‰ â†’ ASL.js â†’ WCM_createCategoryã€WCM_getCategoryListç­‰å‡½æ•¸
- **é¤˜é¡æŸ¥è©¢**ï¼š7106 â†’ APL.account â†’ ASL.js â†’ WCM_getWalletBalanceå‡½æ•¸
- **è³‡æ–™é©—è­‰**ï¼š7106 â†’ APLçµ±ä¸€Gateway â†’ ASL.js â†’ WCM_validateWalletExistsã€WCM_validateCategoryExistså‡½æ•¸

#### 1.4.2 APIæœå‹™å°æ‡‰è¦ç¯„

åŸºæ–¼8020æ–‡ä»¶APIè¦æ ¼èˆ‡APL.dartçµ±ä¸€Gatewayæ¶æ§‹ï¼Œæœ¬åŠŸèƒ½ç¾¤**åš´æ ¼å°æ‡‰**ä»¥ä¸‹APIæœå‹™ï¼š

| æ¥­å‹™é‚è¼¯åŠŸèƒ½ | APL.dart Gatewayæœå‹™ | APIç«¯é»è·¯å¾‘ | WCM.jså‡½æ•¸ |
|-------------|---------------------|------------|------------|
| å¸³æˆ¶è³‡æ–™ç®¡ç† | APL.accountæœå‹™ | `/api/v1/accounts` | WCM_createWallet, WCM_getWalletList |
| ç§‘ç›®éšå±¤ç®¡ç† | APL.categoryæœå‹™ï¼ˆP3é ç•™ï¼‰ | `/api/v1/categories` | WCM_createCategory, WCM_getCategoryList |
| å¸³æˆ¶é¤˜é¡è¨ˆç®— | APL.accountæœå‹™ | `/api/v1/accounts/{id}/balance` | WCM_getWalletBalance |
| å¸³æˆ¶é©—è­‰é‚è¼¯ | APL.accountæœå‹™ | `/api/v1/accounts/{id}` | WCM_validateWalletExists |
| ç§‘ç›®é©—è­‰é‚è¼¯ | APL.categoryæœå‹™ï¼ˆP3é ç•™ï¼‰ | `/api/v1/categories/{id}` | WCM_validateCategoryExists |

**APL Gatewayæ•´åˆèªªæ˜**ï¼š
- **çµ±ä¸€å…¥å£**ï¼šæ‰€æœ‰APIè«‹æ±‚é€éAPL.dartçµ±ä¸€Gatewayè™•ç†
- **æœå‹™åˆ†çµ„**ï¼šAPL.accountã€APL.categoryç­‰æœå‹™é¡åˆ¥å°è£ç›¸é—œAPI
- **æ¨™æº–åŒ–è·¯å¾‘**ï¼šéµå¾ª`/api/v1/*`æ¨™æº–RESTfulè·¯å¾‘è¦ç¯„
- **P3éšæ®µé ç•™**ï¼šç§‘ç›®ç®¡ç†æœå‹™å°‡åœ¨Phase 3éšæ®µå®Œæ•´å¯¦ç¾

#### 1.4.3 ç‹€æ…‹ç®¡ç†æ¶æ§‹

```dart
// å¸³æˆ¶èˆ‡ç§‘ç›®ç®¡ç†ç‹€æ…‹çµæ§‹
AccountCategoryStateManager/
â”œâ”€â”€ AccountState           // å¸³æˆ¶è³‡æ–™ç‹€æ…‹
â”‚   â”œâ”€â”€ accountList        // å¸³æˆ¶åˆ—è¡¨
â”‚   â”œâ”€â”€ selectedAccount    // é¸ä¸­å¸³æˆ¶
â”‚   â””â”€â”€ loadingState       // è¼‰å…¥ç‹€æ…‹
â””â”€â”€ CategoryState          // ç§‘ç›®è³‡æ–™ç‹€æ…‹
    â”œâ”€â”€ categoryTree       // ç§‘ç›®æ¨¹ç‹€çµæ§‹
    â”œâ”€â”€ selectedCategory   // é¸ä¸­ç§‘ç›®
    â””â”€â”€ loadingState       // è¼‰å…¥ç‹€æ…‹
```

### 1.5 åŸºæœ¬è¦æ±‚

#### 1.5.1 åŸºæœ¬æ•ˆèƒ½è¦æ±‚
- **APIéŸ¿æ‡‰è™•ç†**ï¼šåŸºæœ¬åŠŸèƒ½æ­£å¸¸é‹ä½œ
- **ç‹€æ…‹æ›´æ–°**ï¼šæ“ä½œå¾Œç‹€æ…‹æ­£ç¢ºæ›´æ–°

#### 1.5.2 åŸºæœ¬éŒ¯èª¤è™•ç†
- **APIç•°å¸¸è™•ç†**ï¼šé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯çµ¦ä½¿ç”¨è€…
- **åŸºæœ¬é©—è­‰**ï¼šå¿…å¡«æ¬„ä½æª¢æŸ¥

### 1.6 èˆ‡å…¶ä»–åŠŸèƒ½ç¾¤çš„å”ä½œ

#### 1.6.1 åŠŸèƒ½ç¾¤ä»‹é¢ä¾è³´
- **â† ç³»çµ±é€²å…¥åŠŸèƒ½ç¾¤**ï¼šæ¥æ”¶èªè­‰ç‹€æ…‹ã€ç”¨æˆ¶æ¨¡å¼é…ç½®
- **â†’ è¨˜å¸³æ ¸å¿ƒåŠŸèƒ½ç¾¤**ï¼šæä¾›å¸³æˆ¶èˆ‡ç§‘ç›®é¸æ“‡é‚è¼¯ã€é©—è­‰æœå‹™
- **â†’ å¸³æœ¬å”ä½œåŠŸèƒ½ç¾¤**ï¼šå¸³æœ¬æ¬Šé™é©—è­‰ã€å”ä½œç‹€æ…‹ç®¡ç†
- **â†’ é ç®—ç®¡ç†åŠŸèƒ½ç¾¤**ï¼šå¸³æˆ¶ç§‘ç›®é—œè¯ã€é ç®—åŸ·è¡Œé‚è¼¯

#### 1.6.2 æ¥­å‹™é‚è¼¯è³‡æ–™æµ
```
APIè«‹æ±‚æº–å‚™ â†’ APIèª¿ç”¨ â†’ å›æ‡‰è™•ç† â†’ ç‹€æ…‹æ›´æ–° â†’ å¿«å–åŒæ­¥
    â†“                                            â†‘
éŒ¯èª¤è™•ç† â†  è³‡æ–™é©—è­‰  â†  æ¥­å‹™é‚è¼¯è™•ç†  â†  æœ¬åœ°å¿«å–
```

---

## 2.0 åŠŸèƒ½éœ€æ±‚ï¼ˆFunctional Requirementsï¼‰

### 2.1 å¸³æˆ¶è³‡æ–™ç®¡ç†é‚è¼¯

#### 2.1.1 å¸³æˆ¶è³‡æ–™å‰µå»ºé‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šè™•ç†å¸³æˆ¶å‰µå»ºçš„å®Œæ•´æ¥­å‹™æµç¨‹ï¼ŒåŒ…å«APIèª¿ç”¨ã€è³‡æ–™é©—è­‰èˆ‡ç‹€æ…‹ç®¡ç†ã€‚

**æ ¸å¿ƒè™•ç†æµç¨‹**ï¼š
```
ç”¨æˆ¶è¼¸å…¥ â†’ å‰ç«¯é©—è­‰ â†’ æ ¼å¼åŒ–è™•ç† â†’ APL.accountèª¿ç”¨ â†’ BLå±¤è™•ç† â†’ å›æ‡‰è§£æ â†’ ç‹€æ…‹æ›´æ–° â†’ UIåé¥‹
```

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.1.1-01**ï¼šæ¥æ”¶ä½¿ç”¨è€…è¼¸å…¥çš„å¸³æˆ¶åŸºæœ¬è³‡è¨Šï¼ˆåç¨±ã€é¡å‹ã€åˆå§‹é¤˜é¡ï¼‰
- **FR-2.1.1-02**ï¼šåŸºæœ¬é©—è­‰ï¼š
  - å¸³æˆ¶åç¨±ï¼šå¿…å¡«
  - å¸³æˆ¶é¡å‹ï¼šå¾é å®šç¾©æ¸…å–®é¸æ“‡
  - åˆå§‹é¤˜é¡ï¼šæ•¸å€¼æ ¼å¼
- **FR-2.1.1-03**ï¼šèª¿ç”¨APL.account.createAccount()é€²è¡Œå¾Œç«¯å‰µå»º
- **FR-2.1.1-04**ï¼šè™•ç†å‰µå»ºå›æ‡‰ä¸¦æ›´æ–°æœ¬åœ°ç‹€æ…‹ï¼š
  - æˆåŠŸï¼šæ›´æ–°å¸³æˆ¶æ¸…å–®ã€é¡¯ç¤ºæˆåŠŸè¨Šæ¯
  - å¤±æ•—ï¼šé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯



#### 2.1.2 å¸³æˆ¶è³‡æ–™æ›´æ–°é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šè™•ç†å¸³æˆ¶è³‡è¨Šä¿®æ”¹çš„æ¥­å‹™æµç¨‹ï¼Œç¢ºä¿è³‡æ–™ä¸€è‡´æ€§èˆ‡åŒæ­¥ã€‚

**æ ¸å¿ƒè™•ç†æµç¨‹**ï¼š
```
ç·¨è¼¯è§¸ç™¼ â†’ è¼‰å…¥ç¾æœ‰è³‡æ–™ â†’ ä¿®æ”¹è™•ç† â†’ è®Šæ›´é©—è­‰ â†’ APLèª¿ç”¨ â†’ ç‹€æ…‹åŒæ­¥ â†’ å¿«å–æ›´æ–°
```

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.1.2-01**ï¼šè¼‰å…¥ç¾æœ‰å¸³æˆ¶è³‡æ–™ä¸¦å¡«å…¥ç·¨è¼¯è¡¨å–®
- **FR-2.1.2-02**ï¼šåµæ¸¬è³‡æ–™è®Šæ›´ä¸¦åŸ·è¡Œå·®ç•°é©—è­‰
- **FR-2.1.2-03**ï¼šèª¿ç”¨APL.account.updateAccount()åŸ·è¡Œæ›´æ–°
- **FR-2.1.2-04**ï¼šè™•ç†æ›´æ–°çµæœä¸¦åŒæ­¥ç›¸é—œç‹€æ…‹ï¼š
  - å¸³æˆ¶æ¸…å–®ç‹€æ…‹æ›´æ–°
  - ç›¸é—œäº¤æ˜“è¨˜éŒ„çš„å¸³æˆ¶è³‡è¨Šæ›´æ–°
  - å¿«å–è³‡æ–™åŒæ­¥

#### 2.1.3 å¸³æˆ¶è³‡æ–™é©—è­‰é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šç¢ºä¿å¸³æˆ¶è³‡æ–™çš„æ­£ç¢ºæ€§èˆ‡å®Œæ•´æ€§ï¼Œé˜²æ­¢ç„¡æ•ˆè³‡æ–™é€²å…¥ç³»çµ±ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.1.3-01**ï¼šå³æ™‚é©—è­‰æ©Ÿåˆ¶ï¼š
  - å¸³æˆ¶åç¨±é‡è¤‡æ€§æª¢æŸ¥ï¼ˆæœ¬åœ°å¿«å– + APIé©—è­‰ï¼‰
  - é¤˜é¡æ ¼å¼èˆ‡ç¯„åœé©—è­‰
  - å¿…å¡«æ¬„ä½å®Œæ•´æ€§æª¢æŸ¥
- **FR-2.1.3-02**ï¼šèª¿ç”¨APL.accountæœå‹™é€²è¡Œå¾Œç«¯é©—è­‰
- **FR-2.1.3-03**ï¼šé©—è­‰éŒ¯èª¤è™•ç†ï¼š
  - å³æ™‚é¡¯ç¤ºé©—è­‰éŒ¯èª¤è¨Šæ¯
  - é˜»æ­¢ç„¡æ•ˆè³‡æ–™æäº¤
  - æä¾›ä¿®æ­£å»ºè­°

#### 2.1.4 å¸³æˆ¶è³‡æ–™å¿«å–é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šç®¡ç†å¸³æˆ¶è³‡æ–™çš„æœ¬åœ°å¿«å–ï¼Œæå‡ä½¿ç”¨è€…é«”é©—èˆ‡é›¢ç·šèƒ½åŠ›ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.1.4-01**ï¼šåŸºæœ¬å¿«å–ï¼š
  - å¸³æˆ¶åˆ—è¡¨è¼‰å…¥å¾Œæš«å­˜
  - ä½¿ç”¨è€…æ“ä½œå¾Œæ¸…é™¤å¿«å–é‡æ–°è¼‰å…¥



### 2.2 ç§‘ç›®éšå±¤ç®¡ç†é‚è¼¯

#### 2.2.1 ç§‘ç›®æ¨¹ç‹€çµæ§‹è™•ç†é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šè™•ç†ç§‘ç›®çš„éšå±¤é—œä¿‚ï¼Œç¶­è­·æ¨¹ç‹€çµæ§‹çš„å®Œæ•´æ€§èˆ‡ä¸€è‡´æ€§ã€‚

**æ ¸å¿ƒè™•ç†æµç¨‹**ï¼š
```
ç§‘ç›®è³‡æ–™è¼‰å…¥ â†’ éšå±¤é—œä¿‚è§£æ â†’ æ¨¹ç‹€çµæ§‹å»ºæ§‹ â†’ å±•é–‹/æ”¶åˆé‚è¼¯ â†’ æœå°‹/ç¯©é¸è™•ç†
```

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.2.1-01**ï¼šæ¨¹ç‹€çµæ§‹å»ºæ§‹ï¼š
  - å¾å¹³é¢ç§‘ç›®è³‡æ–™å»ºç«‹çˆ¶å­é—œä¿‚
  - æ”¯æ´æœ€å¤š3å±¤éšå±¤æ·±åº¦
  - è‡ªå‹•æ’åºï¼šé è¨­ç§‘ç›®å„ªå…ˆï¼Œè‡ªè¨‚ç§‘ç›®å…¶æ¬¡ï¼ŒæŒ‰ä½¿ç”¨é »ç‡æ’åº
- **FR-2.2.1-02**ï¼šæ¨¹ç‹€äº’å‹•é‚è¼¯ï¼š
  - å±•é–‹/æ”¶åˆç‹€æ…‹è¨˜æ†¶
  - çˆ¶ç¯€é»é¸æ“‡æ™‚é¡¯ç¤ºå­ç§‘ç›®é¸é …
  - å­ç§‘ç›®åå‘å°èˆªè‡³çˆ¶ç§‘ç›®
- **FR-2.2.1-03**ï¼šæœå°‹èˆ‡ç¯©é¸ï¼š
  - ç§‘ç›®åç¨±æ¨¡ç³Šæœå°‹
  - æ”¶æ”¯é¡å‹ç¯©é¸
  - ä½¿ç”¨é »ç‡ç¯©é¸
  - æœå°‹çµæœéšå±¤è·¯å¾‘é¡¯ç¤º



#### 2.2.2 ç§‘ç›®éšå±¤åŒæ­¥é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šç¢ºä¿ç§‘ç›®éšå±¤è³‡æ–™çš„åŒæ­¥æ€§ï¼Œè™•ç†éšå±¤é—œä¿‚è®Šæ›´ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.2.2-01**ï¼šéšå±¤åŒæ­¥ç­–ç•¥ï¼š
  - å®Œæ•´æ¨¹ç‹€çµæ§‹é‡å»ºï¼šåˆæ¬¡è¼‰å…¥æˆ–é‡å¤§è®Šæ›´
  - å¢é‡æ›´æ–°ï¼šå–®ä¸€ç§‘ç›®è®Šæ›´
  - é—œä¿‚ä¿®å¾©ï¼šç™¼ç¾è³‡æ–™ä¸ä¸€è‡´æ™‚çš„è‡ªå‹•ä¿®å¾©
- **FR-2.2.2-02**ï¼šåŒæ­¥è¡çªè™•ç†ï¼š
  - éšå±¤è¿´åœˆæª¢æ¸¬èˆ‡ä¿®å¾©
  - å­¤å…’ç§‘ç›®çš„é‡æ–°æ­¸é¡
  - é‡è¤‡ç§‘ç›®çš„åˆä½µè™•ç†
- **FR-2.2.2-03**ï¼šåŒæ­¥æ•ˆèƒ½å„ªåŒ–ï¼š
  - å·®ç•°æ¯”è¼ƒæ¼”ç®—æ³•
  - æ‰¹é‡æ›´æ–°è™•ç†
  - èƒŒæ™¯åŒæ­¥æ©Ÿåˆ¶

#### 2.2.3 ç§‘ç›®é—œä¿‚é©—è­‰é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šé©—è­‰ç§‘ç›®éšå±¤é—œä¿‚çš„é‚è¼¯æ­£ç¢ºæ€§ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.2.3-01**ï¼šéšå±¤é—œä¿‚é©—è­‰ï¼š
  - çˆ¶å­é—œä¿‚åˆç†æ€§æª¢æŸ¥
  - è¿´åœˆå¼•ç”¨æª¢æ¸¬
  - æ·±åº¦é™åˆ¶é©—è­‰ï¼ˆæœ€å¤š3å±¤ï¼‰
- **FR-2.2.3-02**ï¼šæ¥­å‹™é‚è¼¯é©—è­‰ï¼š
  - æ”¶æ”¯é¡å‹ä¸€è‡´æ€§ï¼šå­ç§‘ç›®å¿…é ˆèˆ‡çˆ¶ç§‘ç›®é¡å‹ç›¸åŒ
  - ç§‘ç›®åç¨±å”¯ä¸€æ€§ï¼šåŒå±¤ç´šç§‘ç›®åç¨±ä¸å¯é‡è¤‡
  - é è¨­ç§‘ç›®ä¿è­·ï¼šç³»çµ±é è¨­ç§‘ç›®ä¸å¯åˆªé™¤æˆ–ä¿®æ”¹éšå±¤

#### 2.2.4 ç§‘ç›®è³‡æ–™å¿«å–é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šç®¡ç†ç§‘ç›®æ¨¹ç‹€çµæ§‹çš„å¿«å–èˆ‡æ›´æ–°ç­–ç•¥ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.2.4-01**ï¼šåˆ†å±¤å¿«å–ç­–ç•¥ï¼š
  - å®Œæ•´ç§‘ç›®æ¨¹ï¼šå¿«å–120åˆ†é˜
  - å¸¸ç”¨ç§‘ç›®æ¸…å–®ï¼šå¿«å–60åˆ†é˜
  - ä½¿ç”¨çµ±è¨ˆè³‡æ–™ï¼šå¿«å–30åˆ†é˜
- **FR-2.2.4-02**ï¼šæ™ºæ…§é è¼‰æ©Ÿåˆ¶ï¼š
  - è¨˜å¸³é é¢é è¼‰å¸¸ç”¨ç§‘ç›®
  - èƒŒæ™¯é è¼‰å®Œæ•´ç§‘ç›®æ¨¹
  - é æ¸¬æ€§è¼‰å…¥ï¼šåŸºæ–¼ä½¿ç”¨ç¿’æ…£é è¼‰å¯èƒ½ä½¿ç”¨çš„ç§‘ç›®

### 2.3 å¸³æˆ¶é¤˜é¡è¨ˆç®—é‚è¼¯

#### 2.3.1 å³æ™‚é¤˜é¡è¨ˆç®—é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šæä¾›æº–ç¢ºçš„å¸³æˆ¶é¤˜é¡è¨ˆç®—èˆ‡é¡¯ç¤ºåŠŸèƒ½ã€‚

**æ ¸å¿ƒè™•ç†æµç¨‹**ï¼š
```
é¤˜é¡æŸ¥è©¢è§¸ç™¼ â†’ å¿«å–æª¢æŸ¥ â†’ APLèª¿ç”¨ â†’ è¨ˆç®—è™•ç† â†’ æ ¼å¼åŒ–é¡¯ç¤º â†’ å¿«å–æ›´æ–°
```

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.3.1-01**ï¼šé¤˜é¡è¨ˆç®—æ¨¡å¼ï¼š
  - å³æ™‚è¨ˆç®—ï¼šèª¿ç”¨APL.account.getAccountBalance()å–å¾—æœ€æ–°é¤˜é¡
  - å¿«é€Ÿé¡¯ç¤ºï¼šå„ªå…ˆé¡¯ç¤ºå¿«å–é¤˜é¡ï¼ŒèƒŒæ™¯æ›´æ–°æœ€æ–°å€¼
  - å·®ç•°æç¤ºï¼šå¿«å–èˆ‡æœ€æ–°å€¼å·®ç•°è¶…éé–¾å€¼æ™‚çš„æç¤ºæ©Ÿåˆ¶
- **FR-2.3.1-02**ï¼šå¤šå¹£åˆ¥è™•ç†ï¼š
  - åŸå¹£åˆ¥é¡¯ç¤ºï¼šé¡¯ç¤ºå¸³æˆ¶åŸå§‹å¹£åˆ¥é¤˜é¡
  - æ›ç®—é¡¯ç¤ºï¼šæä¾›ä¸»è¦å¹£åˆ¥ï¼ˆTWDï¼‰æ›ç®—é‡‘é¡
  - åŒ¯ç‡æ›´æ–°ï¼šå®šæœŸæ›´æ–°åŒ¯ç‡è³‡æ–™
- **FR-2.3.1-03**ï¼šé¤˜é¡é¡¯ç¤ºé‚è¼¯ï¼š
  - æ ¼å¼åŒ–é¡¯ç¤ºï¼šåƒåˆ†ä½ç¬¦è™Ÿã€å°æ•¸é»è™•ç†
  - è² å€¼é¡¯ç¤ºï¼šç´…è‰²é¡¯ç¤ºè² é¤˜é¡ï¼Œç‰¹æ®Šæ¨™ç¤º
  - éš±ç§æ¨¡å¼ï¼šæ”¯æ´é¤˜é¡éš±è—åŠŸèƒ½

#### 2.3.2 é¤˜é¡å¿«å–æ›´æ–°é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šç®¡ç†å¸³æˆ¶é¤˜é¡çš„å¿«å–ç­–ç•¥ï¼Œå¹³è¡¡æº–ç¢ºæ€§èˆ‡æ•ˆèƒ½ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.3.2-01**ï¼šå¿«å–æ›´æ–°è§¸ç™¼ï¼š
  - äº¤æ˜“å®Œæˆå¾Œç«‹å³æ›´æ–°ç›¸é—œå¸³æˆ¶é¤˜é¡
  - å®šæ™‚èƒŒæ™¯æ›´æ–°ï¼ˆæ¯10åˆ†é˜ï¼‰
  - ä½¿ç”¨è€…ä¸»å‹•åˆ·æ–°
- **FR-2.3.2-02**ï¼šå¿«å–ç­–ç•¥ï¼š
  - çŸ­æœŸå¿«å–ï¼š5åˆ†é˜å…§ç›´æ¥ä½¿ç”¨å¿«å–å€¼
  - ä¸­æœŸå¿«å–ï¼š5-15åˆ†é˜é¡¯ç¤ºå¿«å–å€¼ä½†èƒŒæ™¯æ›´æ–°
  - é•·æœŸå¿«å–ï¼šè¶…é15åˆ†é˜å¼·åˆ¶é‡æ–°è¼‰å…¥
- **FR-2.3.2-03**ï¼šæ›´æ–°å„ªå…ˆç´šï¼š
  - é«˜å„ªå…ˆç´šï¼šç•¶å‰æª¢è¦–çš„å¸³æˆ¶
  - ä¸­å„ªå…ˆç´šï¼šæœ€è¿‘ä½¿ç”¨çš„å¸³æˆ¶
  - ä½å„ªå…ˆç´šï¼šå…¶ä»–æ‰€æœ‰å¸³æˆ¶

#### 2.3.3 é¤˜é¡ä¸€è‡´æ€§æª¢æŸ¥é‚è¼¯
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šç¢ºä¿é¤˜é¡è³‡æ–™çš„æº–ç¢ºæ€§èˆ‡ä¸€è‡´æ€§ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.3.3-01**ï¼šä¸€è‡´æ€§æª¢æŸ¥æ©Ÿåˆ¶ï¼š
  - å®šæœŸæ ¡é©—ï¼šæ¯æ—¥èƒŒæ™¯æª¢æŸ¥é¤˜é¡ä¸€è‡´æ€§
  - å³æ™‚æª¢æŸ¥ï¼šé‡è¦æ“ä½œå¾Œçš„å³æ™‚æ ¡é©—
  - ç•°å¸¸åµæ¸¬ï¼šé¤˜é¡ç•°å¸¸è®Šå‹•çš„è‡ªå‹•åµæ¸¬
- **FR-2.3.3-02**ï¼šä¸ä¸€è‡´è™•ç†ï¼š
  - è‡ªå‹•ä¿®å¾©ï¼šå°é¡å·®ç•°çš„è‡ªå‹•èª¿æ•´
  - è­¦ç¤ºæé†’ï¼šå¤§é¡å·®ç•°çš„ä½¿ç”¨è€…æé†’
  - æ‰‹å‹•ç¢ºèªï¼šé‡å¤§ä¸ä¸€è‡´çš„æ‰‹å‹•ç¢ºèªæ©Ÿåˆ¶


### 2.4 åŸºæœ¬è³‡æ–™ç®¡ç†

#### 2.4.1 ç°¡å–®å¿«å–æ©Ÿåˆ¶
**æ¥­å‹™é‚è¼¯è·è²¬**ï¼šæä¾›åŸºæœ¬çš„è³‡æ–™æš«å­˜åŠŸèƒ½ã€‚

**å…·é«”åŠŸèƒ½éœ€æ±‚**ï¼š
- **FR-2.4.1-01**ï¼šåŸºæœ¬å¿«å–ï¼š
  - è¼‰å…¥çš„å¸³æˆ¶å’Œç§‘ç›®è³‡æ–™æš«å­˜åœ¨è¨˜æ†¶é«”ä¸­
  - ä½¿ç”¨è€…æ“ä½œå¾Œé‡æ–°è¼‰å…¥æœ€æ–°è³‡æ–™

---

## 3.0 è¼¸å…¥/è¼¸å‡ºè¦æ ¼ï¼ˆInput & Output Specificationsï¼‰

### 3.1 APL Gatewayè¼¸å…¥è¦æ ¼

#### 3.1.1 å¸³æˆ¶ç®¡ç†è¼¸å…¥è¦æ ¼
åŸºæ–¼APL.dart Gatewayçµ±ä¸€ä»‹é¢ï¼Œæœ¬åŠŸèƒ½ç¾¤è™•ç†ä»¥ä¸‹è¼¸å…¥æ ¼å¼ï¼š

**FR-3.1.1-01 å¸³æˆ¶å‰µå»ºè¼¸å…¥è¦æ ¼**
```dart
// PLå±¤æ¥æ”¶æ ¼å¼ï¼ˆéµå¾ª1311.FS.jsè¦ç¯„ï¼‰
class AccountCreationInput {
  String name;                    // å¸³æˆ¶åç¨± (1-50å­—å…ƒ)
  String type;                   // å¸³æˆ¶é¡å‹ (cash|bank|credit|ewallet)
  double initialBalance;         // åˆå§‹é¤˜é¡ (-999999.99 ~ 999999.99)
  String currency;              // å¹£åˆ¥ (TWD|USD|CNYç­‰)
  String? description;          // æè¿° (0-255å­—å…ƒ)
  String userId;               // ç”¨æˆ¶ID (ç¬¦åˆ1311.FS.jsè¦ç¯„)
  String? ledgerId;            // å¸³æœ¬IDï¼ˆé¸å¡«ï¼Œä½¿ç”¨é è¨­å¸³æœ¬ï¼‰

  // 1311.FS.jsæ¨™æº–æ¬„ä½
  DateTime? createdAt;         // å»ºç«‹æ™‚é–“ (timestampæ ¼å¼)
  DateTime? updatedAt;         // æ›´æ–°æ™‚é–“ (timestampæ ¼å¼)
  String status;               // ç‹€æ…‹ (active|inactive|archived)
  String? createdBy;           // å»ºç«‹è€…ID
}

// æ¥­å‹™é‚è¼¯é©—è­‰è¦å‰‡ï¼ˆç¬¦åˆ1311.FS.jsè¦ç¯„ï¼‰
ValidationRules accountValidation = {
  'name': {
    'required': true,
    'minLength': 1,
    'maxLength': 50,
    'pattern': r'^[a-zA-Z0-9\u4e00-\u9fff\s\-_]+$'
  },
  'type': {
    'required': true,
    'enum': ['cash', 'bank', 'credit', 'ewallet']
  },
  'initialBalance': {
    'required': true,
    'type': 'double',
    'min': -999999.99,
    'max': 999999.99
  },
  'currency': {
    'required': true,
    'enum': ['TWD', 'USD', 'CNY', 'EUR', 'JPY']
  },
  'userId': {
    'required': true,
    'pattern': r'^[a-zA-Z0-9@._-]+$'
  },
  'status': {
    'required': true,
    'enum': ['active', 'inactive', 'archived'],
    'default': 'active'
  },
  'createdAt': {
    'type': 'timestamp',
    'auto_generate': true
  },
  'updatedAt': {
    'type': 'timestamp',
    'auto_generate': true
  }
};
```

**FR-3.1.1-02 å¸³æˆ¶æŸ¥è©¢è¼¸å…¥è¦æ ¼**
```dart
// å¸³æˆ¶æŸ¥è©¢è¼¸å…¥ï¼ˆéµå¾ª1311.FS.jsæŸ¥è©¢è¦ç¯„ï¼‰
class AccountQueryInput {
  String userId;               // ç”¨æˆ¶IDï¼ˆå¿…å¡«ï¼Œç¬¦åˆ1311.FS.jsè¦ç¯„ï¼‰
  String? ledgerId;           // å¸³æœ¬IDç¯©é¸
  List<String>? types;        // å¸³æˆ¶é¡å‹ç¯©é¸
  String? currency;           // å¹£åˆ¥ç¯©é¸
  List<String>? status;       // ç‹€æ…‹ç¯©é¸ (active|inactive|archived)

  // åˆ†é åƒæ•¸ï¼ˆç¬¦åˆ1311.FS.jsæŸ¥è©¢è¦ç¯„ï¼‰
  int? limit;                 // é™åˆ¶ç­†æ•¸ (1-100, default: 20)
  int? offset;               // åˆ†é åç§» (default: 0)

  // æ’åºåƒæ•¸
  String? orderBy;           // æ’åºæ¬„ä½ (name|createdAt|updatedAt|type)
  String? orderDirection;    // æ’åºæ–¹å‘ (asc|desc, default: asc)

  // æ™‚é–“ç¯„åœç¯©é¸
  DateTime? createdAfter;    // å»ºç«‹æ™‚é–“èµ·å§‹
  DateTime? createdBefore;   // å»ºç«‹æ™‚é–“çµæŸ
  DateTime? updatedAfter;    // æ›´æ–°æ™‚é–“èµ·å§‹
  DateTime? updatedBefore;   // æ›´æ–°æ™‚é–“çµæŸ

  // æœå°‹åƒæ•¸
  String? searchKeyword;     // åç¨±æ¨¡ç³Šæœå°‹
}

// æŸ¥è©¢é©—è­‰è¦å‰‡
ValidationRules queryValidation = {
  'userId': {
    'required': true,
    'pattern': r'^[a-zA-Z0-9@._-]+$'
  },
  'limit': {
    'type': 'int',
    'min': 1,
    'max': 100,
    'default': 20
  },
  'offset': {
    'type': 'int',
    'min': 0,
    'default': 0
  },
  'orderBy': {
    'enum': ['name', 'createdAt', 'updatedAt', 'type', 'balance']
  },
  'orderDirection': {
    'enum': ['asc', 'desc'],
    'default': 'asc'
  },
  'status': {
    'enum': ['active', 'inactive', 'archived']
  }
};
```

#### 3.1.2 ç§‘ç›®ç®¡ç†è¼¸å…¥è¦æ ¼

**FR-3.1.2-01 ç§‘ç›®å‰µå»ºè¼¸å…¥è¦æ ¼**
```dart
// ç§‘ç›®å‰µå»ºè¼¸å…¥ï¼ˆéµå¾ª1311.FS.jsè¦ç¯„ï¼‰
class CategoryCreationInput {
  String name;                 // ç§‘ç›®åç¨± (å¿…å¡«)
  String type;                // ç§‘ç›®é¡å‹ (income|expense)
  String? parentId;           // çˆ¶ç§‘ç›®IDï¼ˆé¸å¡«ï¼‰
  String userId;              // ç”¨æˆ¶IDï¼ˆå¿…å¡«ï¼‰

  // 1311.FS.jsæ¨™æº–æ¬„ä½
  DateTime? createdAt;        // å»ºç«‹æ™‚é–“ (timestampæ ¼å¼)
  DateTime? updatedAt;        // æ›´æ–°æ™‚é–“ (timestampæ ¼å¼)
  String status;              // ç‹€æ…‹ (active|inactive|archived)
}

// åŸºæœ¬é©—è­‰è¦å‰‡
ValidationRules categoryValidation = {
  'name': {
    'required': true,
    'maxLength': 30
  },
  'type': {
    'required': true,
    'enum': ['income', 'expense']
  },
  'userId': {
    'required': true
  },
  'status': {
    'required': true,
    'enum': ['active', 'inactive', 'archived'],
    'default': 'active'
  }
};

**FR-3.1.2-02 ç§‘ç›®æŸ¥è©¢è¼¸å…¥è¦æ ¼**
```dart
// ç§‘ç›®æŸ¥è©¢è¼¸å…¥ï¼ˆéµå¾ª1311.FS.jsæŸ¥è©¢è¦ç¯„ï¼‰
class CategoryQueryInput {
  String userId;               // ç”¨æˆ¶IDï¼ˆå¿…å¡«ï¼‰
  String? ledgerId;           // å¸³æœ¬IDç¯©é¸
  String? type;               // ç§‘ç›®é¡å‹ç¯©é¸ (income|expense)
  String? parentId;           // çˆ¶ç§‘ç›®IDç¯©é¸
  List<String>? status;       // ç‹€æ…‹ç¯©é¸
  int? level;                 // éšå±¤æ·±åº¦ç¯©é¸
  bool? isDefault;            // æ˜¯å¦ç‚ºé è¨­ç§‘ç›®

  // åˆ†é åƒæ•¸
  int? limit;                 // é™åˆ¶ç­†æ•¸ (1-100, default: 50)
  int? offset;               // åˆ†é åç§»

  // æ’åºåƒæ•¸
  String? orderBy;           // æ’åºæ¬„ä½ (name|sortOrder|createdAt|type)
  String? orderDirection;    // æ’åºæ–¹å‘ (asc|desc)

  // æœå°‹åƒæ•¸
  String? searchKeyword;     // åç¨±æ¨¡ç³Šæœå°‹
  bool? includeChildren;     // æ˜¯å¦åŒ…å«å­ç§‘ç›®
}
```

#### 3.1.3 åˆªé™¤

### 3.2 APL Gatewayè¼¸å‡ºè¦æ ¼

#### 3.2.1 æ¨™æº–æˆåŠŸå›æ‡‰æ ¼å¼
åŸºæ–¼8088 APIè¨­è¨ˆè¦ç¯„ï¼Œæ¥­å‹™é‚è¼¯å±¤çµ±ä¸€è™•ç†ä»¥ä¸‹è¼¸å‡ºæ ¼å¼ï¼š

```dart
class StandardResponse<T> {
  bool success;                // æ“ä½œæˆåŠŸæ¨™è­˜
  T? data;                    // å¯¦éš›è³‡æ–™å…§å®¹
  ResponseMetadata metadata;   // å›æ‡‰å…ƒè³‡æ–™
  PaginationInfo? pagination; // åˆ†é è³‡è¨Šï¼ˆåˆ—è¡¨æŸ¥è©¢ï¼‰
}

class ResponseMetadata {
  String timestamp;           // å›æ‡‰æ™‚é–“æˆ³ (ISO 8601)
  String requestId;          // è«‹æ±‚è¿½è¹¤ID
  double processingTime;     // è™•ç†æ™‚é–“ (æ¯«ç§’)
}
```

#### 3.2.2 å¸³æˆ¶ç®¡ç†è¼¸å‡ºè¦æ ¼

**FR-3.2.2-01 å¸³æˆ¶å‰µå»ºæˆåŠŸå›æ‡‰**
```dart
class AccountCreationResponse {
  bool success = true;
  AccountData data;
  ResponseMetadata metadata;
}

class AccountData {
  String accountId;            // å¸³æˆ¶ID
  String name;                // å¸³æˆ¶åç¨±
  String type;                // å¸³æˆ¶é¡å‹
  double balance;             // ç•¶å‰é¤˜é¡
  String currency;            // å¹£åˆ¥
  DateTime createdAt;         // å»ºç«‹æ™‚é–“
  DateTime updatedAt;         // æ›´æ–°æ™‚é–“

  // é—œè¯è³‡æ–™
  LedgerInfo? ledgerInfo;     // æ‰€å±¬å¸³æœ¬è³‡è¨Š
  List<RecentTransaction>? recentTransactions; // æœ€è¿‘äº¤æ˜“
}
```

**FR-3.2.2-02 å¸³æˆ¶åˆ—è¡¨æŸ¥è©¢å›æ‡‰**
```dart
class AccountListResponse {
  bool success = true;
  AccountListData data;
  PaginationInfo pagination;
  ResponseMetadata metadata;
}

class AccountListData {
  List<AccountSummary> accounts;
  AccountStatistics? statistics;  // çµ±è¨ˆè³‡æ–™
  List<String>? recommendations;   // æ¨è–¦
}

class AccountSummary {
  String accountId;
  String name;
  String type;
  double balance;
  String currency;
  bool isDefault;
  DateTime lastUsed;
}
```

#### 3.2.3 ç§‘ç›®ç®¡ç†è¼¸å‡ºè¦æ ¼

**FR-3.2.3-01 ç§‘ç›®æ¨¹ç‹€çµæ§‹å›æ‡‰**
```dart
class CategoryTreeResponse {
  bool success = true;
  CategoryTreeData data;
  ResponseMetadata metadata;
}

class CategoryTreeData {
  List<CategoryNode> incomeCategories;   // æ”¶å…¥ç§‘ç›®æ¨¹
  List<CategoryNode> expenseCategories;  // æ”¯å‡ºç§‘ç›®æ¨¹
  CategoryStatistics? statistics;        // çµ±è¨ˆ
  List<CategoryRecommendation>? recommendations; // æ¨è–¦ç§‘ç›®
}

class CategoryNode {
  String categoryId;
  String name;
  String type;
  int level;                    // éšå±¤æ·±åº¦ (1-3)
  String? parentId;
  List<CategoryNode>? children; // å­ç§‘ç›®

  // ä½¿ç”¨çµ±è¨ˆ
  int usageCount;              // ä½¿ç”¨æ¬¡æ•¸
  DateTime? lastUsed;          // æœ€å¾Œä½¿ç”¨æ™‚é–“
  double? totalAmount;         // ç¸½äº¤æ˜“é‡‘é¡

  // é¡¯ç¤ºå±¬æ€§
  String color;                // é¡è‰²ä»£ç¢¼
  String icon;                 // åœ–ç¤º
  int sortOrder;              // æ’åºé †åº

  // ä½¿ç”¨æ¨™è¨˜
  bool isFrequent;            // å¸¸ç”¨ç§‘ç›®æ¨™è¨˜
}
```

#### 3.2.4 å¿«å–èˆ‡ç‹€æ…‹ç®¡ç†è¼¸å‡º

**FR-3.2.4-01 å¿«å–ç‹€æ…‹è³‡è¨Š**
```dart
class CacheStateInfo {
  Map<String, CacheStatus> cacheStatus;
  DateTime lastSyncTime;
  bool isOnline;
  List<PendingOperation>? pendingOperations;
}

class CacheStatus {
  String resourceType;        // è³‡æºé¡å‹ (accounts|categories|etc)
  DateTime cacheTime;         // å¿«å–æ™‚é–“
  DateTime expireTime;        // éæœŸæ™‚é–“
  bool isValid;              // æ˜¯å¦æœ‰æ•ˆ
  int itemCount;             // å¿«å–é …ç›®æ•¸é‡
}
```

### 3.3 WCM.jsæ¨¡çµ„ä»‹é¢è¦æ ¼

#### 3.3.1 BLå±¤å‡½æ•¸èª¿ç”¨ä»‹é¢
åŸºæ–¼WCM.jsæ¨¡çµ„æä¾›çš„å‡½æ•¸ï¼Œæ¥­å‹™é‚è¼¯å±¤å»ºç«‹ä»¥ä¸‹ä»‹é¢è¦ç¯„ï¼š

**FR-3.3.1-01 å¸³æˆ¶ç®¡ç†BLä»‹é¢**
```dart
// PLå±¤èª¿ç”¨APL Gatewayï¼ŒAPL Gatewayèª¿ç”¨WCM.js
class WCMAccountInterface {
  // å°æ‡‰WCM_createWalletå‡½æ•¸
  Future<StandardResponse<AccountData>> createAccount(
    AccountCreationInput input
  ) async {
    // æ¥­å‹™é‚è¼¯è™•ç†
    final processedInput = _preprocessAccountInput(input);

    // APL Gatewayèª¿ç”¨
    final aplResponse = await aplGateway.post(
      '/api/v1/accounts',
      body: processedInput
    );

    // å›æ‡‰è™•ç†èˆ‡å››æ¨¡å¼é©é…
    return _processAccountResponse(aplResponse, input.userMode);
  }

  // å°æ‡‰WCM_getWalletListå‡½æ•¸
  Future<StandardResponse<AccountListData>> getAccountList(
    AccountQueryInput input
  );

  // å°æ‡‰WCM_validateWalletExistså‡½æ•¸
  Future<StandardResponse<ValidationResult>> validateAccountExists(
    String accountId, String userId
  );

  // å°æ‡‰WCM_getWalletBalanceå‡½æ•¸
  Future<StandardResponse<BalanceData>> getAccountBalance(
    String accountId, String userId
  );
}
```

**FR-3.3.1-02 ç§‘ç›®ç®¡ç†BLä»‹é¢**
```dart
class WCMCategoryInterface {
  // å°æ‡‰WCM_createCategoryå‡½æ•¸
  Future<StandardResponse<CategoryData>> createCategory(
    CategoryCreationInput input
  );

  // å°æ‡‰WCM_getCategoryListå‡½æ•¸
  Future<StandardResponse<CategoryTreeData>> getCategoryTree(
    CategoryQueryInput input
  );

  // å°æ‡‰WCM_validateCategoryExistså‡½æ•¸
  Future<StandardResponse<ValidationResult>> validateCategoryExists(
    String categoryId, String userId
  );
}
```

#### 3.3.2 è³‡æ–™æ ¼å¼è½‰æ›è¦ç¯„

**FR-3.3.2-01 PL â†’ APLè³‡æ–™è½‰æ›**
```dart
class DataTransformer {
  // å¸³æˆ¶è³‡æ–™è½‰æ›
  Map<String, dynamic> transformAccountInput(AccountCreationInput input) {
    return {
      'name': input.name.trim(),
      'type': input.type,
      'balance': input.initialBalance,
      'currency': input.currency,
      'description': input.description?.trim() ?? '',
      'userId': input.userId,
      'ledgerId': input.ledgerId,
      // æ¥­å‹™é‚è¼¯æ“´å±•æ¬„ä½
      'source': 'app',
      'version': '1.0.0',
      'timestamp': DateTime.now().toIso8601String()
    };
  }

  // APL â†’ PLè³‡æ–™è½‰æ›
  AccountData transformAccountResponse(Map<String, dynamic> response) {
    return AccountData(
      accountId: response['walletId'] ?? response['accountId'],
      name: response['name'],
      type: response['type'],
      balance: response['balance']?.toDouble() ?? 0.0,
      currency: response['currency'] ?? 'TWD',
      createdAt: DateTime.parse(response['createdAt']),
      updatedAt: DateTime.parse(response['updatedAt'])
    );
  }
}
```

### 3.4 æœ¬åœ°å¿«å–èˆ‡åŒæ­¥è¦æ ¼

#### 3.4.1 å¿«å–è³‡æ–™çµæ§‹

**FR-3.4.1-01 å¸³æˆ¶å¿«å–çµæ§‹**
```dart
class AccountCache {
  Map<String, AccountData> accounts;      // å¸³æˆ¶è³‡æ–™å¿«å–
  Map<String, double> balances;           // é¤˜é¡å¿«å–
  Map<String, DateTime> lastUpdated;      // æœ€å¾Œæ›´æ–°æ™‚é–“
  Set<String> dirtyIds;                   // å¾…åŒæ­¥IDé›†åˆ

  // å¿«å–ç­–ç•¥é…ç½®
  Duration accountCacheExpiry = Duration(hours: 1);
  Duration balanceCacheExpiry = Duration(minutes: 10);
}

class CategoryCache {
  Map<String, CategoryNode> categories;   // ç§‘ç›®è³‡æ–™å¿«å–
  List<CategoryNode> treeStructure;       // æ¨¹ç‹€çµæ§‹å¿«å–
  Map<String, int> usageStats;           // ä½¿ç”¨çµ±è¨ˆå¿«å–
  DateTime treeLastBuilt;                 // æ¨¹ç‹€çµæ§‹å»ºç«‹æ™‚é–“

  // å¿«å–ç­–ç•¥é…ç½®
  Duration categoryCacheExpiry = Duration(hours: 2);
  Duration usageStatsCacheExpiry = Duration(minutes: 30);
}
```

#### 3.4.2 åŒæ­¥ç­–ç•¥è¦æ ¼

**FR-3.4.2-01 åŒæ­¥è§¸ç™¼æ©Ÿåˆ¶**
```dart
class SyncStrategy {
  // è‡ªå‹•åŒæ­¥è§¸ç™¼æ¢ä»¶
  List<SyncTrigger> autoSyncTriggers = [
    SyncTrigger.appForeground,      // APPé€²å…¥å‰æ™¯
    SyncTrigger.networkReconnect,   // ç¶²è·¯é‡é€£
    SyncTrigger.cacheExpired,       // å¿«å–éæœŸ
    SyncTrigger.userAction,         // ä½¿ç”¨è€…æ“ä½œ
    SyncTrigger.scheduled           // å®šæ™‚åŒæ­¥ï¼ˆ15åˆ†é˜ï¼‰
  ];

  // åŒæ­¥å„ªå…ˆç´š
  Map<String, SyncPriority> syncPriority = {
    'account_balance': SyncPriority.high,
    'account_list': SyncPriority.medium,
    'category_tree': SyncPriority.medium,
    'usage_stats': SyncPriority.low
  };
}
```

---

## 4.0 éŒ¯èª¤è™•ç†èˆ‡ä¾‹å¤–ç‹€æ³ï¼ˆError Handling & Edge Casesï¼‰

### 4.1 åŸºæœ¬éŒ¯èª¤è™•ç†

#### 4.1.1 åŸºæœ¬éŒ¯èª¤åˆ†é¡
```dart
enum ErrorCategory {
  validation,        // è³‡æ–™é©—è­‰éŒ¯èª¤
  business,         // æ¥­å‹™é‚è¼¯éŒ¯èª¤
  network,          // ç¶²è·¯é€£ç·šéŒ¯èª¤
  system            // ç³»çµ±ç´šéŒ¯èª¤
}
```

#### 4.1.2 åŸºæœ¬éŒ¯èª¤æ ¼å¼

**FR-4.1.2-01 åŸºæœ¬éŒ¯èª¤å›æ‡‰æ ¼å¼**
```dart
class ErrorResponse {
  bool success = false;
  String code;                 // éŒ¯èª¤ä»£ç¢¼
  String message;              // éŒ¯èª¤è¨Šæ¯
  ErrorCategory category;      // éŒ¯èª¤åˆ†é¡
}
```

### 4.2 å¸³æˆ¶ç®¡ç†ç›¸é—œéŒ¯èª¤

#### 4.2.1 å¸³æˆ¶é©—è­‰éŒ¯èª¤

**FR-4.2.1-01 éŒ¢åŒ…åç¨±é©—è­‰éŒ¯èª¤**
```dart
class WalletValidationErrors {
  static const String WALLET_NAME_REQUIRED = 'WALLET_NAME_REQUIRED';
  static const String WALLET_NAME_TOO_SHORT = 'WALLET_NAME_TOO_SHORT';
  static const String WALLET_NAME_TOO_LONG = 'WALLET_NAME_TOO_LONG';
  static const String WALLET_NAME_INVALID_CHARS = 'WALLET_NAME_INVALID_CHARS';
  static const String WALLET_NAME_DUPLICATE = 'WALLET_NAME_DUPLICATE';
</old_str>
with
<new_str>
- 4.2 éŒ¢åŒ…ç®¡ç†ç›¸é—œéŒ¯èª¤

### 4.2 éŒ¢åŒ…ç®¡ç†ç›¸é—œéŒ¯èª¤

#### 4.2.1 éŒ¢åŒ…é©—è­‰éŒ¯èª¤

**FR-4.2.1-01 éŒ¢åŒ…åç¨±é©—è­‰éŒ¯èª¤**
```dart
class WalletValidationErrors {
  static const String WALLET_NAME_REQUIRED = 'WALLET_NAME_REQUIRED';
  static const String WALLET_NAME_TOO_SHORT = 'WALLET_NAME_TOO_SHORT';
  static const String WALLET_NAME_TOO_LONG = 'WALLET_NAME_TOO_LONG';
  static const String WALLET_NAME_INVALID_CHARS = 'WALLET_NAME_INVALID_CHARS';
  static const String WALLET_NAME_DUPLICATE = 'WALLET_NAME_DUPLICATE';
</new_str>
#### 4.2.1 å¸³æˆ¶åç¨±é©—è­‰éŒ¯èª¤
```dart
class AccountValidationErrors {
  static const String ACCOUNT_NAME_REQUIRED = 'ACCOUNT_NAME_REQUIRED';
  static const String ACCOUNT_NAME_TOO_SHORT = 'ACCOUNT_NAME_TOO_SHORT';
  static const String ACCOUNT_NAME_TOO_LONG = 'ACCOUNT_NAME_TOO_LONG';
  static const String ACCOUNT_NAME_INVALID_CHARS = 'ACCOUNT_NAME_INVALID_CHARS';
  static const String ACCOUNT_NAME_DUPLICATE = 'ACCOUNT_NAME_DUPLICATE';
</old_str>
with
<new_str>
#### 4.2.1 éŒ¢åŒ…åç¨±é©—è­‰éŒ¯èª¤
```dart
class WalletValidationErrors {
  static const String WALLET_NAME_REQUIRED = 'WALLET_NAME_REQUIRED';
  static const String WALLET_NAME_TOO_SHORT = 'WALLET_NAME_TOO_SHORT';
  static const String WALLET_NAME_TOO_LONG = 'WALLET_NAME_TOO_LONG';
  static const String WALLET_NAME_INVALID_CHARS = 'WALLET_NAME_INVALID_CHARS';
  static const String WALLET_NAME_DUPLICATE = 'WALLET_NAME_DUPLICATE';
</new_str>
#### 4.2.1 å¸³æˆ¶é¤˜é¡é©—è­‰éŒ¯èª¤
```dart
class BalanceValidationErrors {
  static const String BALANCE_INVALID_FORMAT = 'BALANCE_INVALID_FORMAT';
  static const String BALANCE_OUT_OF_RANGE = 'BALANCE_OUT_OF_RANGE';
  static const String BALANCE_NEGATIVE_NOT_ALLOWED = 'BALANCE_NEGATIVE_NOT_ALLOWED';

  static ErrorResponse validateBalance(
    dynamic balance,
    String accountType
  ) {
    if (balance == null) {
      return ErrorResponse(
        success: false,
        code: 'BALANCE_REQUIRED',
        message: 'è«‹è¼¸å…¥å¸³æˆ¶åˆå§‹é¤˜é¡',
        category: ErrorCategory.validation
      );
    }

    double? numBalance = _parseBalance(balance);
    if (numBalance == null) {
      return ErrorResponse(
        success: false,
        code: BALANCE_INVALID_FORMAT,
        message: 'é¤˜é¡æ ¼å¼ç„¡æ•ˆï¼Œè«‹è¼¸å…¥æœ‰æ•ˆæ•¸å­—',
        category: ErrorCategory.validation
      );
    }

    // ä¿¡ç”¨å¡å¸³æˆ¶å…è¨±è² å€¼
    if (accountType != 'credit' && numBalance < 0) {
      return ErrorResponse(
        success: false,
        code: BALANCE_NEGATIVE_NOT_ALLOWED,
        message: 'æ­¤å¸³æˆ¶é¡å‹ä¸å…è¨±è² é¤˜é¡',
        category: ErrorCategory.validation
      );
    }

    return ErrorResponse.noError();
  }
}
```

#### 4.2.2 éŒ¢åŒ…æ¥­å‹™é‚è¼¯éŒ¯èª¤

**FR-4.2.2-01 éŒ¢åŒ…å­˜å–æ¬Šé™éŒ¯èª¤**
```dart
class WalletAccessErrors {
  static const String WALLET_NOT_FOUND = 'WALLET_NOT_FOUND';
  static const String WALLET_ACCESS_DENIED = 'WALLET_ACCESS_DENIED';
  static const String WALLET_INACTIVE = 'WALLET_INACTIVE';
  static const String WALLET_LEDGER_MISMATCH = 'WALLET_LEDGER_MISMATCH';

  static ErrorResponse handleWalletAccess(
    String? walletId,
    String userId,
    String? ledgerId
  ) {
    final wallet = _findWallet(walletId);

    if (wallet == null) {
      return ErrorResponse(
        success: false,
        code: WALLET_NOT_FOUND,
        message: 'æ‰¾ä¸åˆ°è©²éŒ¢åŒ…',
        category: ErrorCategory.business
      );
    }

    if (wallet.userId != userId) {
      return ErrorResponse(
        success: false,
        code: WALLET_ACCESS_DENIED,
        message: 'ç„¡æ¬Šé™å­˜å–æ­¤éŒ¢åŒ…',
        category: ErrorCategory.authentication
      );
    }

    return ErrorResponse.noError();
  }
}
```

### 4.3 ç§‘ç›®ç®¡ç†ç›¸é—œéŒ¯èª¤

#### 4.3.1 ç§‘ç›®éšå±¤éŒ¯èª¤

**FR-4.3.1-01 ç§‘ç›®éšå±¤é‚è¼¯éŒ¯èª¤**
```dart
class CategoryHierarchyErrors {
  static const String CATEGORY_CIRCULAR_REFERENCE = 'CATEGORY_CIRCULAR_REFERENCE';
  static const String CATEGORY_MAX_DEPTH_EXCEEDED = 'CATEGORY_MAX_DEPTH_EXCEEDED';
  static const String CATEGORY_TYPE_MISMATCH = 'CATEGORY_TYPE_MISMATCH';
  static const String CATEGORY_PARENT_NOT_FOUND = 'CATEGORY_PARENT_NOT_FOUND';

  static ErrorResponse validateHierarchy(
    String? parentId,
    String categoryType,
    String userId
  ) {
    if (parentId != null) {
      final parent = _findCategory(parentId, userId);

      if (parent == null) {
        return ErrorResponse(
          success: false,
          code: CATEGORY_PARENT_NOT_FOUND,
          message: 'æŒ‡å®šçš„çˆ¶ç§‘ç›®ä¸å­˜åœ¨',
          category: ErrorCategory.business
        );
      }

      // æª¢æŸ¥æ”¶æ”¯é¡å‹ä¸€è‡´æ€§
      if (parent.type != categoryType) {
        return ErrorResponse(
          success: false,
          code: CATEGORY_TYPE_MISMATCH,
          message: 'å­ç§‘ç›®é¡å‹å¿…é ˆèˆ‡çˆ¶ç§‘ç›®ä¸€è‡´',
          category: ErrorCategory.business
        );
      }

      // æª¢æŸ¥éšå±¤æ·±åº¦ï¼ˆæœ€å¤š3å±¤ï¼‰
      if (_calculateDepth(parent) >= 3) {
        return ErrorResponse(
          success: false,
          code: CATEGORY_MAX_DEPTH_EXCEEDED,
          message: 'ç§‘ç›®éšå±¤æ·±åº¦ä¸èƒ½è¶…é3å±¤',
          category: ErrorCategory.business
        );
      }
    }

    return ErrorResponse.noError();
  }
}
```

#### 4.3.2 ç§‘ç›®ä½¿ç”¨çµ±è¨ˆéŒ¯èª¤

**FR-4.3.2-01 çµ±è¨ˆè³‡æ–™éŒ¯èª¤è™•ç†**
```dart
class CategoryStatisticsErrors {
  static ErrorResponse handleStatisticsError(
    Exception exception,
    {bool isBackground = false}
  ) {
    return ErrorResponse(
      success: false,
      code: 'STATISTICS_CALCULATION_ERROR',
      message: 'çµ±è¨ˆè³‡æ–™æš«æ™‚ç„¡æ³•å–å¾—',
      category: ErrorCategory.system
    );
  }
}
```

### 4.4 ç¶²è·¯é€£ç·šéŒ¯èª¤

#### 4.4.1 é€£ç·šç‹€æ…‹è™•ç†

**FR-4.4.1-01 é€£ç·šç‹€æ…‹è™•ç†**
```dart
class NetworkErrorHandler {
  static const String NETWORK_UNAVAILABLE = 'NETWORK_UNAVAILABLE';
  static const String REQUEST_TIMEOUT = 'REQUEST_TIMEOUT';
  static const String SERVER_UNAVAILABLE = 'SERVER_UNAVAILABLE';
  static const String API_RATE_LIMIT = 'API_RATE_LIMIT';

  static ErrorResponse handleNetworkError(
    NetworkException exception,
    {bool hasCache = false}
  ) {
    switch (exception.type) {
      case NetworkExceptionType.noConnection:
        return _handleOfflineMode(hasCache);

      case NetworkExceptionType.timeout:
        return _handleTimeout();

      case NetworkExceptionType.serverError:
        return _handleServerError(exception);

      case NetworkExceptionType.rateLimited:
        return _handleRateLimit();

      default:
        return _handleGenericNetworkError(exception);
    }
  }

  static ErrorResponse _handleOfflineMode(bool hasCache) {
    if (hasCache) {
      return ErrorResponse(
        success: false,
        code: 'OFFLINE_MODE_CACHED',
        message: 'ç¶²è·¯æ–·ç·šï¼Œé¡¯ç¤ºå·²å„²å­˜çš„è³‡æ–™',
        category: ErrorCategory.network
      );
    }

    return ErrorResponse(
      success: false,
      code: NETWORK_UNAVAILABLE,
      message: 'ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œç„¡å¯ç”¨å¿«å–è³‡æ–™',
      category: ErrorCategory.network
    );
  }
}
```

#### 4.4.2 é‡è©¦æ©Ÿåˆ¶

**FR-4.4.2-01 æ™ºæ…§é‡è©¦ç­–ç•¥**
```dart
class RetryStrategy {
  static const int MAX_RETRY_ATTEMPTS = 3;
  static const Duration INITIAL_BACKOFF = Duration(seconds: 1);
  static const Duration MAX_BACKOFF = Duration(seconds: 30);

  static Future<T> executeWithRetry<T>(
    Future<T> Function() operation,
    {
      int maxAttempts = MAX_RETRY_ATTEMPTS,
      Duration initialDelay = INITIAL_BACKOFF
    }
  ) async {
    int attempts = 0;
    Duration delay = initialDelay;

    while (attempts < maxAttempts) {
      try {
        return await operation();
      } catch (exception) {
        attempts++;

        if (attempts >= maxAttempts) {
          throw RetryExhaustedException(
            originalException: exception,
            attempts: attempts
          );
        }

        await Future.delayed(delay);

        delay = Duration(
          milliseconds: (delay.inMilliseconds * 1.5).round()
        );
        if (delay > MAX_BACKOFF) delay = MAX_BACKOFF;
      }
    }

    throw StateError('Unexpected retry loop exit');
  }
}
```

### 4.5 æ¥­å‹™é‚è¼¯å±¤ç‰¹æ®Šè™•ç†

#### 4.5.1 å¿«å–åŒæ­¥éŒ¯èª¤

**FR-4.5.1-01 å¿«å–ä¸€è‡´æ€§éŒ¯èª¤**
```dart
class CacheSyncErrors {
  static const String CACHE_CORRUPTED = 'CACHE_CORRUPTED';
  static const String SYNC_CONFLICT = 'SYNC_CONFLICT';
  static const String CACHE_FULL = 'CACHE_FULL';

  static ErrorResponse handleCacheError(
    CacheException exception
  ) {
    switch (exception.type) {
      case CacheExceptionType.corrupted:
        return _handleCorruptedCache();

      case CacheExceptionType.syncConflict:
        return _handleSyncConflict(exception);

      case CacheExceptionType.storageFull:
        return _handleStorageFull();

      default:
        return _handleGenericCacheError(exception);
    }
  }

  static ErrorResponse _handleSyncConflict(
    CacheException exception
  ) {
    return ErrorResponse(
      success: false,
      code: SYNC_CONFLICT,
      message: 'è³‡æ–™åŒæ­¥æœ‰å•é¡Œ',
      category: ErrorCategory.business
    );
  }
}