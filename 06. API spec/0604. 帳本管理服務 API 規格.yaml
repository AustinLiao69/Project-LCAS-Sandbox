
openapi: 3.0.3
info:
  title: LCAS 2.0 - å¸³æœ¬ç®¡ç†æœå‹™ API è¦æ ¼
  version: 1.0.0
  description: |
    **LCAS 2.0 å¸³æœ¬ç®¡ç†æœå‹™ API è¦æ ¼**
    
    è² è²¬å¸³æœ¬çš„å®Œæ•´ç”Ÿå‘½é€±æœŸç®¡ç†ï¼ŒåŒ…å«å€‹äººå¸³æœ¬ã€å”ä½œå¸³æœ¬çš„å»ºç«‹ã€ç®¡ç†ã€æ¬Šé™æ§åˆ¶ç­‰åŠŸèƒ½ã€‚
    æ”¯æ´å¤šå¸³æœ¬æ¶æ§‹ï¼Œæä¾›å››æ¨¡å¼å·®ç•°åŒ–é«”é©—èˆ‡å”ä½œåŠŸèƒ½ã€‚
    
    **æœå‹™ç¯„åœ**:
    - å¸³æœ¬ CRUDï¼ˆå»ºç«‹ã€æŸ¥è©¢ã€ä¿®æ”¹ã€åˆªé™¤ï¼‰
    - å”ä½œå¸³æœ¬ç®¡ç†ï¼ˆé‚€è«‹ã€æ¬Šé™ã€æˆå“¡ç®¡ç†ï¼‰
    - å¸³æœ¬æ¬Šé™æ§åˆ¶ï¼ˆæª¢è¦–ã€ç·¨è¼¯ã€ç®¡ç†ã€åˆªé™¤æ¬Šé™ï¼‰
    - å¸³æœ¬çµ±è¨ˆèˆ‡åˆ†æï¼ˆä½¿ç”¨ç‹€æ³ã€æˆå“¡æ´»èºåº¦ï¼‰
    - å¸³æœ¬æ¨¡æ¿èˆ‡é è¨­è¨­å®š
    
    **å››æ¨¡å¼å·®ç•°åŒ–ç­–ç•¥**:
    - **Expert**: å®Œæ•´å¸³æœ¬ç®¡ç†å·¥å…·ã€ç´°ç²’åº¦æ¬Šé™æ§åˆ¶ã€é«˜ç´šå”ä½œåŠŸèƒ½
    - **Inertial**: æ¨™æº–å¸³æœ¬æ“ä½œã€ç°¡åŒ–æ¬Šé™è¨­å®šã€åŸºæœ¬å”ä½œ
    - **Cultivation**: å¼•å°å¼å¸³æœ¬å»ºç«‹ã€æ¨è–¦è¨­å®šã€æˆé•·è¿½è¹¤
    - **Guiding**: æ¥µç°¡å¸³æœ¬ç®¡ç†ã€é è¨­è¨­å®šã€æœ€å°‘æ±ºç­–
    
    **ç‰ˆæœ¬**: 1.0.0  
    **å»ºç«‹æ—¥æœŸ**: 2025-01-27  
    **å°æ‡‰æ–‡ä»¶**: 0021. Screen list.md (S-301~S-303)

servers:
  - url: https://api.lcas.app/v1
    description: "Production server"
  - url: https://api-staging.lcas.app/v1
    description: "Staging server"

security:
  - BearerAuth: []

paths:
  /ledgers:
    get:
      summary: "æŸ¥è©¢ç”¨æˆ¶å¸³æœ¬åˆ—è¡¨"
      description: |
        å–å¾—ç”¨æˆ¶æœ‰æ¬Šé™å­˜å–çš„æ‰€æœ‰å¸³æœ¬ï¼ŒåŒ…å«å€‹äººå¸³æœ¬èˆ‡å”ä½œå¸³æœ¬ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é 
        **å››æ¨¡å¼å·®ç•°**: é¡¯ç¤ºè³‡è¨Šè©³ç´°ç¨‹åº¦èˆ‡æ’åºæ–¹å¼ä¸åŒ
      tags:
        - "å¸³æœ¬æŸ¥è©¢"
      parameters:
        - name: type
          in: query
          description: "å¸³æœ¬é¡å‹ç¯©é¸"
          schema:
            type: string
            enum: [personal, collaboration, shared, all]
            default: all
        - name: role
          in: query
          description: "ç”¨æˆ¶è§’è‰²ç¯©é¸"
          schema:
            type: string
            enum: [owner, admin, editor, viewer]
        - name: status
          in: query
          description: "å¸³æœ¬ç‹€æ…‹ç¯©é¸"
          schema:
            type: string
            enum: [active, archived, deleted]
            default: active
        - name: search
          in: query
          description: "æœå°‹é—œéµå­—ï¼ˆå¸³æœ¬åç¨±ã€æè¿°ï¼‰"
          schema:
            type: string
            example: "å®¶åº­"
        - name: sortBy
          in: query
          description: "æ’åºæ¬„ä½"
          schema:
            type: string
            enum: [name, created_at, updated_at, last_used]
            default: updated_at
        - name: sortOrder
          in: query
          description: "æ’åºæ–¹å‘"
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          description: "é ç¢¼"
          schema:
            type: integer
            example: 1
            default: 1
        - name: limit
          in: query
          description: "æ¯é ç­†æ•¸"
          schema:
            type: integer
            example: 20
            default: 20
            maximum: 100
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å¸³æœ¬åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "ledger-uuid-001"
                            name:
                              type: string
                              example: "å€‹äººå¸³æœ¬"
                            description:
                              type: string
                              example: "å€‹äººæ—¥å¸¸è¨˜å¸³"
                            type:
                              type: string
                              enum: [personal, collaboration, shared]
                              example: "personal"
                            
                            # åŸºæœ¬è³‡è¨Šï¼ˆæ‰€æœ‰æ¨¡å¼ï¼‰
                            owner:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "user-uuid-12345"
                                name:
                                  type: string
                                  example: "å¼µå°æ˜"
                                avatar:
                                  type: string
                                  example: "https://api.lcas.app/avatars/user-001.jpg"
                            
                            userRole:
                              type: string
                              enum: [owner, admin, editor, viewer]
                              example: "owner"
                            
                            permissions:
                              type: object
                              properties:
                                canView:
                                  type: boolean
                                  example: true
                                canEdit:
                                  type: boolean
                                  example: true
                                canManage:
                                  type: boolean
                                  example: true
                                canDelete:
                                  type: boolean
                                  example: true
                                canInvite:
                                  type: boolean
                                  example: true
                            
                            # Expert Mode: è©³ç´°è³‡è¨Š
                            statistics:
                              type: object
                              properties:
                                transactionCount:
                                  type: integer
                                  example: 245
                                memberCount:
                                  type: integer
                                  example: 1
                                totalIncome:
                                  type: number
                                  example: 150000
                                totalExpense:
                                  type: number
                                  example: 89000
                                balance:
                                  type: number
                                  example: 61000
                                lastActivity:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                            
                            # å”ä½œè³‡è¨Š
                            collaboration:
                              type: object
                              properties:
                                isCollaborative:
                                  type: boolean
                                  example: false
                                memberCount:
                                  type: integer
                                  example: 1
                                pendingInvitations:
                                  type: integer
                                  example: 0
                                recentMembers:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      id:
                                        type: string
                                        example: "user-uuid-67890"
                                      name:
                                        type: string
                                        example: "æå°è¯"
                                      avatar:
                                        type: string
                                        example: "https://api.lcas.app/avatars/user-002.jpg"
                                      role:
                                        type: string
                                        example: "editor"
                                      lastActive:
                                        type: string
                                        format: date-time
                                        example: "2025-01-26T15:20:00Z"
                            
                            # è¨­å®šè³‡è¨Š
                            settings:
                              type: object
                              properties:
                                currency:
                                  type: string
                                  example: "TWD"
                                timezone:
                                  type: string
                                  example: "Asia/Taipei"
                                isDefault:
                                  type: boolean
                                  example: true
                                color:
                                  type: string
                                  example: "#4CAF50"
                                icon:
                                  type: string
                                  example: "ğŸ’°"
                            
                            # å¯©è¨ˆè³‡è¨Š
                            audit:
                              type: object
                              properties:
                                createdAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-01T00:00:00Z"
                                updatedAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                                status:
                                  type: string
                                  enum: [active, archived, deleted]
                                  example: "active"
                      
                      # åˆ†é è³‡è¨Š
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          totalPages:
                            type: integer
                            example: 1
                          totalRecords:
                            type: integer
                            example: 3
                          hasNextPage:
                            type: boolean
                            example: false
                          hasPreviousPage:
                            type: boolean
                            example: false
                      
                      # Expert Mode: ç¸½é«”çµ±è¨ˆ
                      summary:
                        type: object
                        properties:
                          totalLedgers:
                            type: integer
                            example: 3
                          personalLedgers:
                            type: integer
                            example: 2
                          collaborativeLedgers:
                            type: integer
                            example: 1
                          totalTransactions:
                            type: integer
                            example: 745
                          totalBalance:
                            type: number
                            example: 125000
                      
                      # Cultivation Mode: æˆå°±é€²åº¦
                      achievements:
                        type: object
                        properties:
                          createdLedgers:
                            type: integer
                            example: 3
                          collaborationCount:
                            type: integer
                            example: 1
                          consistency:
                            type: number
                            example: 85.5
                            description: "å¸³æœ¬ä½¿ç”¨ä¸€è‡´æ€§ç™¾åˆ†æ¯”"
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    post:
      summary: "å»ºç«‹æ–°å¸³æœ¬"
      description: |
        å»ºç«‹æ–°çš„å€‹äººæˆ–å”ä½œå¸³æœ¬ï¼Œæ”¯æ´æ¨¡æ¿èˆ‡è‡ªè¨‚è¨­å®šã€‚
        
        **å°æ‡‰ç•«é¢**: S-302 å»ºç«‹å¸³æœ¬é 
        **å››æ¨¡å¼å·®ç•°**: å¯è¨­å®šé¸é …èˆ‡é è¨­å€¼ä¸åŒ
      tags:
        - "å¸³æœ¬ç®¡ç†"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                # åŸºæœ¬è³‡è¨Šï¼ˆå¿…å¡«ï¼‰
                name:
                  type: string
                  example: "å®¶åº­æ”¯å‡ºå¸³æœ¬"
                  maxLength: 100
                  minLength: 1
                type:
                  type: string
                  enum: [personal, collaboration]
                  example: "collaboration"
                
                # é¸å¡«è³‡è¨Š
                description:
                  type: string
                  example: "è¨˜éŒ„å®¶åº­æ—¥å¸¸é–‹æ”¯èˆ‡æ”¶å…¥"
                  maxLength: 500
                
                # è¨­å®šé¸é …
                settings:
                  type: object
                  properties:
                    currency:
                      type: string
                      example: "TWD"
                      default: "TWD"
                    timezone:
                      type: string
                      example: "Asia/Taipei"
                      default: "Asia/Taipei"
                    isDefault:
                      type: boolean
                      example: false
                      default: false
                    color:
                      type: string
                      example: "#2196F3"
                      pattern: "^#[0-9A-Fa-f]{6}$"
                    icon:
                      type: string
                      example: "ğŸ "
                      maxLength: 2
                
                # Expert Mode: é€²éšè¨­å®š
                advanced:
                  type: object
                  properties:
                    autoBackup:
                      type: boolean
                      example: true
                      default: true
                    budgetTracking:
                      type: boolean
                      example: true
                      default: false
                    expenseApproval:
                      type: boolean
                      example: false
                      description: "æ˜¯å¦éœ€è¦æ”¯å‡ºå¯©æ ¸ï¼ˆå”ä½œå¸³æœ¬ï¼‰"
                    categoryRestrictions:
                      type: array
                      items:
                        type: string
                      example: ["category-uuid-gambling"]
                      description: "é™åˆ¶ä½¿ç”¨çš„ç§‘ç›® ID åˆ—è¡¨"
                
                # å”ä½œè¨­å®šï¼ˆtype = collaboration æ™‚ï¼‰
                collaboration:
                  type: object
                  properties:
                    initialMembers:
                      type: array
                      items:
                        type: object
                        properties:
                          email:
                            type: string
                            example: "member@example.com"
                          role:
                            type: string
                            enum: [admin, editor, viewer]
                            example: "editor"
                          sendInvitation:
                            type: boolean
                            example: true
                      maxItems: 10
                    defaultMemberRole:
                      type: string
                      enum: [editor, viewer]
                      example: "viewer"
                      default: "viewer"
                    allowMemberInvite:
                      type: boolean
                      example: false
                      default: false
                
                # æ¨¡æ¿è¨­å®š
                template:
                  type: object
                  properties:
                    useTemplate:
                      type: boolean
                      example: false
                    templateId:
                      type: string
                      example: "template-family-basic"
                    includeCategories:
                      type: boolean
                      example: true
                    includeAccounts:
                      type: boolean
                      example: true
                    includeBudgets:
                      type: boolean
                      example: false
              required:
                - name
                - type
      responses:
        '201':
          description: "å¸³æœ¬å»ºç«‹æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-002"
                      name:
                        type: string
                        example: "å®¶åº­æ”¯å‡ºå¸³æœ¬"
                      type:
                        type: string
                        example: "collaboration"
                      
                      # å»ºç«‹çµæœ
                      setupComplete:
                        type: boolean
                        example: true
                      
                      # åˆå§‹åŒ–è³‡è¨Š
                      initialization:
                        type: object
                        properties:
                          categoriesCreated:
                            type: integer
                            example: 15
                          accountsCreated:
                            type: integer
                            example: 3
                          budgetsCreated:
                            type: integer
                            example: 0
                          membersInvited:
                            type: integer
                            example: 2
                      
                      # é‚€è«‹çµæœï¼ˆå”ä½œå¸³æœ¬ï¼‰
                      invitations:
                        type: array
                        items:
                          type: object
                          properties:
                            email:
                              type: string
                              example: "member@example.com"
                            status:
                              type: string
                              enum: [sent, failed, skipped]
                              example: "sent"
                            invitationId:
                              type: string
                              example: "invite-uuid-001"
                            error:
                              type: string
                              example: "Email åœ°å€ç„¡æ•ˆ"
                      
                      # å››æ¨¡å¼å·®ç•°åŒ–å›æ‡‰
                      recommendations:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              enum: [setup_suggestion, feature_tip, best_practice]
                              example: "setup_suggestion"
                            title:
                              type: string
                              example: "å»ºè­°æ–°å¢é ç®—è¨­å®š"
                            description:
                              type: string
                              example: "ç‚ºä¸»è¦æ”¯å‡ºç§‘ç›®è¨­å®šæœˆé ç®—ï¼Œæœ‰åŠ©æ–¼æ§åˆ¶é–‹æ”¯"
                            actionUrl:
                              type: string
                              example: "/budgets/create"
                      
                      createdAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T12:30:00Z"
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /ledgers/{id}:
    get:
      summary: "å–å¾—å¸³æœ¬è©³ç´°è³‡è¨Š"
      description: |
        å–å¾—æŒ‡å®šå¸³æœ¬çš„å®Œæ•´è©³ç´°è³‡è¨Šï¼ŒåŒ…å«è¨­å®šã€çµ±è¨ˆã€æˆå“¡ç­‰ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é è©³ç´°æª¢è¦–
        **æ¬Šé™æª¢æŸ¥**: ç¢ºèªç”¨æˆ¶å°è©²å¸³æœ¬æœ‰å­˜å–æ¬Šé™
      tags:
        - "å¸³æœ¬æŸ¥è©¢"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: includeStatistics
          in: query
          description: "æ˜¯å¦åŒ…å«çµ±è¨ˆè³‡è¨Š"
          schema:
            type: boolean
            default: true
        - name: includeMembers
          in: query
          description: "æ˜¯å¦åŒ…å«æˆå“¡è³‡è¨Š"
          schema:
            type: boolean
            default: true
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—å¸³æœ¬è©³æƒ…"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      # åŸºæœ¬è³‡è¨Š
                      id:
                        type: string
                        example: "ledger-uuid-001"
                      name:
                        type: string
                        example: "å€‹äººå¸³æœ¬"
                      description:
                        type: string
                        example: "å€‹äººæ—¥å¸¸è¨˜å¸³"
                      type:
                        type: string
                        example: "personal"
                      
                      # æ“æœ‰è€…è³‡è¨Š
                      owner:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "user-uuid-12345"
                          name:
                            type: string
                            example: "å¼µå°æ˜"
                          email:
                            type: string
                            example: "ming@example.com"
                          avatar:
                            type: string
                            example: "https://api.lcas.app/avatars/user-001.jpg"
                      
                      # ç”¨æˆ¶æ¬Šé™
                      userRole:
                        type: string
                        example: "owner"
                      permissions:
                        type: object
                        properties:
                          canView:
                            type: boolean
                            example: true
                          canEdit:
                            type: boolean
                            example: true
                          canManage:
                            type: boolean
                            example: true
                          canDelete:
                            type: boolean
                            example: true
                          canInvite:
                            type: boolean
                            example: true
                          canExport:
                            type: boolean
                            example: true
                          canViewReports:
                            type: boolean
                            example: true
                      
                      # è¨­å®šè³‡è¨Š
                      settings:
                        type: object
                        properties:
                          currency:
                            type: string
                            example: "TWD"
                          timezone:
                            type: string
                            example: "Asia/Taipei"
                          isDefault:
                            type: boolean
                            example: true
                          color:
                            type: string
                            example: "#4CAF50"
                          icon:
                            type: string
                            example: "ğŸ’°"
                          autoBackup:
                            type: boolean
                            example: true
                          budgetTracking:
                            type: boolean
                            example: false
                          expenseApproval:
                            type: boolean
                            example: false
                      
                      # çµ±è¨ˆè³‡è¨Š
                      statistics:
                        type: object
                        properties:
                          # äº¤æ˜“çµ±è¨ˆ
                          transactions:
                            type: object
                            properties:
                              total:
                                type: integer
                                example: 245
                              thisMonth:
                                type: integer
                                example: 18
                              income:
                                type: integer
                                example: 45
                              expense:
                                type: integer
                                example: 200
                              
                          # é‡‘é¡çµ±è¨ˆ
                          amounts:
                            type: object
                            properties:
                              totalIncome:
                                type: number
                                example: 150000
                              totalExpense:
                                type: number
                                example: 89000
                              balance:
                                type: number
                                example: 61000
                              thisMonthIncome:
                                type: number
                                example: 12000
                              thisMonthExpense:
                                type: number
                                example: 8500
                              averageDaily:
                                type: number
                                example: 456.78
                          
                          # ä½¿ç”¨çµ±è¨ˆ
                          usage:
                            type: object
                            properties:
                              categoriesUsed:
                                type: integer
                                example: 12
                              accountsUsed:
                                type: integer
                                example: 3
                              daysActive:
                                type: integer
                                example: 89
                              lastActivity:
                                type: string
                                format: date-time
                                example: "2025-01-27T12:30:00Z"
                              recordingFrequency:
                                type: number
                                example: 2.75
                                description: "æ¯æ—¥å¹³å‡è¨˜å¸³æ¬¡æ•¸"
                      
                      # å”ä½œè³‡è¨Šï¼ˆå”ä½œå¸³æœ¬ï¼‰
                      collaboration:
                        type: object
                        properties:
                          isCollaborative:
                            type: boolean
                            example: false
                          memberCount:
                            type: integer
                            example: 1
                          pendingInvitations:
                            type: integer
                            example: 0
                          
                          # Expert Mode: è©³ç´°æˆå“¡è³‡è¨Š
                          members:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "user-uuid-12345"
                                name:
                                  type: string
                                  example: "å¼µå°æ˜"
                                email:
                                  type: string
                                  example: "ming@example.com"
                                avatar:
                                  type: string
                                  example: "https://api.lcas.app/avatars/user-001.jpg"
                                role:
                                  type: string
                                  example: "owner"
                                joinedAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-01T00:00:00Z"
                                lastActive:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                                contributionStats:
                                  type: object
                                  properties:
                                    transactionsAdded:
                                      type: integer
                                      example: 245
                                    editsmade:
                                      type: integer
                                      example: 12
                                    lastContribution:
                                      type: string
                                      format: date-time
                                      example: "2025-01-27T12:30:00Z"
                          
                          invitations:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "invite-uuid-001"
                                email:
                                  type: string
                                  example: "invited@example.com"
                                role:
                                  type: string
                                  example: "editor"
                                status:
                                  type: string
                                  enum: [pending, accepted, declined, expired]
                                  example: "pending"
                                invitedAt:
                                  type: string
                                  format: date-time
                                  example: "2025-01-26T10:00:00Z"
                                expiresAt:
                                  type: string
                                  format: date-time
                                  example: "2025-02-02T10:00:00Z"
                                invitedBy:
                                  type: object
                                  properties:
                                    id:
                                      type: string
                                      example: "user-uuid-12345"
                                    name:
                                      type: string
                                      example: "å¼µå°æ˜"
                      
                      # å¯©è¨ˆè³‡è¨Š
                      audit:
                        type: object
                        properties:
                          createdAt:
                            type: string
                            format: date-time
                            example: "2025-01-01T00:00:00Z"
                          updatedAt:
                            type: string
                            format: date-time
                            example: "2025-01-27T12:30:00Z"
                          status:
                            type: string
                            example: "active"
                          version:
                            type: integer
                            example: 5
                          
                          # Expert Mode: ä¿®æ”¹æ­·å²
                          recentChanges:
                            type: array
                            items:
                              type: object
                              properties:
                                timestamp:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                                changedBy:
                                  type: string
                                  example: "å¼µå°æ˜"
                                changeType:
                                  type: string
                                  enum: [created, updated, member_added, member_removed, settings_changed]
                                  example: "settings_changed"
                                description:
                                  type: string
                                  example: "æ›´æ–°å¸³æœ¬é¡è‰²è¨­å®š"
                                details:
                                  type: object
                                  example: {"color": {"from": "#4CAF50", "to": "#2196F3"}}
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™å­˜å–è©²å¸³æœ¬"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "ACCESS_DENIED"
                      message:
                        type: string
                        example: "æ‚¨æ²’æœ‰æ¬Šé™å­˜å–æ­¤å¸³æœ¬"
                      requiredPermission:
                        type: string
                        example: "view"

    put:
      summary: "æ›´æ–°å¸³æœ¬è³‡è¨Š"
      description: |
        æ›´æ–°å¸³æœ¬çš„åŸºæœ¬è³‡è¨Šã€è¨­å®šæˆ–æ¬Šé™é…ç½®ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é ç·¨è¼¯åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ manage æ¬Šé™
      tags:
        - "å¸³æœ¬ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                # åŸºæœ¬è³‡è¨Š
                name:
                  type: string
                  example: "å€‹äººç”Ÿæ´»å¸³æœ¬"
                  maxLength: 100
                description:
                  type: string
                  example: "è¨˜éŒ„å€‹äººæ—¥å¸¸ç”Ÿæ´»æ”¯å‡ºèˆ‡æ”¶å…¥"
                  maxLength: 500
                
                # è¨­å®šæ›´æ–°
                settings:
                  type: object
                  properties:
                    currency:
                      type: string
                      example: "TWD"
                    timezone:
                      type: string
                      example: "Asia/Taipei"
                    isDefault:
                      type: boolean
                      example: true
                    color:
                      type: string
                      example: "#2196F3"
                      pattern: "^#[0-9A-Fa-f]{6}$"
                    icon:
                      type: string
                      example: "ğŸ’"
                      maxLength: 2
                    autoBackup:
                      type: boolean
                      example: true
                    budgetTracking:
                      type: boolean
                      example: true
                    expenseApproval:
                      type: boolean
                      example: false
                
                # å”ä½œè¨­å®šï¼ˆå”ä½œå¸³æœ¬ï¼‰
                collaboration:
                  type: object
                  properties:
                    defaultMemberRole:
                      type: string
                      enum: [editor, viewer]
                      example: "editor"
                    allowMemberInvite:
                      type: boolean
                      example: true
                    requireApprovalAmount:
                      type: number
                      example: 1000
                      description: "éœ€è¦å¯©æ ¸çš„æ”¯å‡ºé‡‘é¡é–€æª»"
      responses:
        '200':
          description: "å¸³æœ¬æ›´æ–°æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      message:
                        type: string
                        example: "å¸³æœ¬æ›´æ–°æˆåŠŸ"
                      updatedFields:
                        type: array
                        items:
                          type: string
                        example: ["name", "color", "budgetTracking"]
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      
                      # å½±éŸ¿ç¯„åœ
                      affectedItems:
                        type: object
                        properties:
                          membersNotified:
                            type: integer
                            example: 3
                          relatedBudgetsUpdated:
                            type: integer
                            example: 5
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™ä¿®æ”¹è©²å¸³æœ¬"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "INSUFFICIENT_PERMISSION"
                      message:
                        type: string
                        example: "æ‚¨æ²’æœ‰æ¬Šé™ä¿®æ”¹æ­¤å¸³æœ¬"
                      requiredPermission:
                        type: string
                        example: "manage"

    delete:
      summary: "åˆªé™¤å¸³æœ¬"
      description: |
        åˆªé™¤æŒ‡å®šå¸³æœ¬ï¼ŒåŒ…å«æ‰€æœ‰ç›¸é—œè³‡æ–™çš„è™•ç†ã€‚
        
        **å°æ‡‰ç•«é¢**: S-301 å¸³æœ¬ç®¡ç†ä¸»é åˆªé™¤åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: åƒ…å¸³æœ¬æ“æœ‰è€…å¯åˆªé™¤
        **æ¥­å‹™é‚è¼¯**: è»Ÿåˆªé™¤ï¼Œä¿ç•™ 30 å¤©æ¢å¾©æœŸ
      tags:
        - "å¸³æœ¬ç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: deleteData
          in: query
          description: "æ˜¯å¦åŒæ™‚åˆªé™¤æ‰€æœ‰ç›¸é—œè³‡æ–™"
          schema:
            type: boolean
            default: false
        - name: transferTo
          in: query
          description: "è³‡æ–™è½‰ç§»ç›®æ¨™å¸³æœ¬ IDï¼ˆå¦‚ä¸åˆªé™¤è³‡æ–™ï¼‰"
          schema:
            type: string
            example: "ledger-uuid-002"
      responses:
        '200':
          description: "å¸³æœ¬åˆªé™¤æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      message:
                        type: string
                        example: "å¸³æœ¬å·²æ¨™è¨˜ç‚ºåˆªé™¤ï¼Œ30 å¤©å…§å¯æ¢å¾©"
                      deletedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      recoveryDeadline:
                        type: string
                        format: date-time
                        example: "2025-02-26T13:00:00Z"
                      
                      # è³‡æ–™è™•ç†çµæœ
                      dataProcessing:
                        type: object
                        properties:
                          action:
                            type: string
                            enum: [deleted, transferred, archived]
                            example: "archived"
                          transactionsCount:
                            type: integer
                            example: 245
                          membersNotified:
                            type: integer
                            example: 3
                          transferTargetLedger:
                            type: string
                            example: "ledger-uuid-002"
                          backupCreated:
                            type: boolean
                            example: true
                          backupLocation:
                            type: string
                            example: "backup-20250127-ledger-001.json"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™åˆªé™¤è©²å¸³æœ¬"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "DELETE_PERMISSION_DENIED"
                      message:
                        type: string
                        example: "åªæœ‰å¸³æœ¬æ“æœ‰è€…å¯ä»¥åˆªé™¤å¸³æœ¬"
                      currentRole:
                        type: string
                        example: "editor"

  /ledgers/{id}/members:
    get:
      summary: "æŸ¥è©¢å¸³æœ¬æˆå“¡åˆ—è¡¨"
      description: |
        å–å¾—æŒ‡å®šå¸³æœ¬çš„æ‰€æœ‰æˆå“¡è³‡è¨Šï¼ŒåŒ…å«æ¬Šé™èˆ‡çµ±è¨ˆã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é 
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ view æ¬Šé™
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: includeStatistics
          in: query
          description: "æ˜¯å¦åŒ…å«æˆå“¡çµ±è¨ˆè³‡è¨Š"
          schema:
            type: boolean
            default: true
        - name: role
          in: query
          description: "è§’è‰²ç¯©é¸"
          schema:
            type: string
            enum: [owner, admin, editor, viewer]
        - name: status
          in: query
          description: "æˆå“¡ç‹€æ…‹ç¯©é¸"
          schema:
            type: string
            enum: [active, inactive, suspended]
            default: active
      responses:
        '200':
          description: "æˆåŠŸå–å¾—æˆå“¡åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      ledgerName:
                        type: string
                        example: "å®¶åº­æ”¯å‡ºå¸³æœ¬"
                      
                      members:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "user-uuid-12345"
                            name:
                              type: string
                              example: "å¼µå°æ˜"
                            email:
                              type: string
                              example: "ming@example.com"
                            avatar:
                              type: string
                              example: "https://api.lcas.app/avatars/user-001.jpg"
                            
                            # æ¬Šé™è³‡è¨Š
                            role:
                              type: string
                              enum: [owner, admin, editor, viewer]
                              example: "owner"
                            permissions:
                              type: object
                              properties:
                                canView:
                                  type: boolean
                                  example: true
                                canEdit:
                                  type: boolean
                                  example: true
                                canManage:
                                  type: boolean
                                  example: true
                                canDelete:
                                  type: boolean
                                  example: true
                                canInvite:
                                  type: boolean
                                  example: true
                                canExport:
                                  type: boolean
                                  example: true
                            
                            # ç‹€æ…‹è³‡è¨Š
                            status:
                              type: string
                              enum: [active, inactive, suspended]
                              example: "active"
                            joinedAt:
                              type: string
                              format: date-time
                              example: "2025-01-01T00:00:00Z"
                            lastActive:
                              type: string
                              format: date-time
                              example: "2025-01-27T12:30:00Z"
                            
                            # Expert Mode: è©³ç´°çµ±è¨ˆ
                            statistics:
                              type: object
                              properties:
                                transactionsAdded:
                                  type: integer
                                  example: 245
                                editsPerformed:
                                  type: integer
                                  example: 12
                                categoriesUsed:
                                  type: integer
                                  example: 15
                                totalAmount:
                                  type: number
                                  example: 89000
                                averageTransaction:
                                  type: number
                                  example: 363.27
                                lastContribution:
                                  type: string
                                  format: date-time
                                  example: "2025-01-27T12:30:00Z"
                                daysActive:
                                  type: integer
                                  example: 25
                                contribution:
                                  type: object
                                  properties:
                                    percentage:
                                      type: number
                                      example: 68.5
                                    rank:
                                      type: integer
                                      example: 1
                      
                      # é‚€è«‹ä¸­çš„æˆå“¡
                      pendingInvitations:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "invite-uuid-001"
                            email:
                              type: string
                              example: "invited@example.com"
                            role:
                              type: string
                              example: "editor"
                            status:
                              type: string
                              example: "pending"
                            invitedAt:
                              type: string
                              format: date-time
                              example: "2025-01-26T10:00:00Z"
                            expiresAt:
                              type: string
                              format: date-time
                              example: "2025-02-02T10:00:00Z"
                            invitedBy:
                              type: object
                              properties:
                                id:
                                  type: string
                                  example: "user-uuid-12345"
                                name:
                                  type: string
                                  example: "å¼µå°æ˜"
                      
                      # çµ±è¨ˆæ‘˜è¦
                      summary:
                        type: object
                        properties:
                          totalMembers:
                            type: integer
                            example: 3
                          activeMembers:
                            type: integer
                            example: 2
                          pendingInvitations:
                            type: integer
                            example: 1
                          roleDistribution:
                            type: object
                            properties:
                              owner:
                                type: integer
                                example: 1
                              admin:
                                type: integer
                                example: 0
                              editor:
                                type: integer
                                example: 1
                              viewer:
                                type: integer
                                example: 1
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™æŸ¥çœ‹æˆå“¡è³‡è¨Š"

    post:
      summary: "é‚€è«‹æ–°æˆå“¡åŠ å…¥å¸³æœ¬"
      description: |
        é‚€è«‹æ–°ç”¨æˆ¶åŠ å…¥å”ä½œå¸³æœ¬ï¼Œæ”¯æ´æ‰¹æ¬¡é‚€è«‹ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é é‚€è«‹åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ invite æ¬Šé™
        **æ¥­å‹™é‚è¼¯**: ç™¼é€é‚€è«‹éƒµä»¶ï¼Œè¨­å®š 7 å¤©éæœŸæ™‚é–“
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                invitations:
                  type: array
                  items:
                    type: object
                    properties:
                      email:
                        type: string
                        format: email
                        example: "newmember@example.com"
                      role:
                        type: string
                        enum: [admin, editor, viewer]
                        example: "editor"
                      personalMessage:
                        type: string
                        example: "é‚€è«‹ä½ ä¸€èµ·ç®¡ç†æˆ‘å€‘çš„å®¶åº­å¸³æœ¬"
                        maxLength: 200
                    required:
                      - email
                      - role
                  maxItems: 10
                  minItems: 1
                
                # é‚€è«‹è¨­å®š
                settings:
                  type: object
                  properties:
                    expirationDays:
                      type: integer
                      example: 7
                      minimum: 1
                      maximum: 30
                      default: 7
                    sendNotification:
                      type: boolean
                      example: true
                      default: true
                    allowResend:
                      type: boolean
                      example: true
                      default: true
              required:
                - invitations
      responses:
        '200':
          description: "é‚€è«‹ç™¼é€å®Œæˆ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      
                      # é‚€è«‹çµæœ
                      results:
                        type: array
                        items:
                          type: object
                          properties:
                            email:
                              type: string
                              example: "newmember@example.com"
                            status:
                              type: string
                              enum: [sent, failed, skipped, duplicate]
                              example: "sent"
                            invitationId:
                              type: string
                              example: "invite-uuid-002"
                            expiresAt:
                              type: string
                              format: date-time
                              example: "2025-02-03T12:30:00Z"
                            error:
                              type: string
                              example: "Email æ ¼å¼ç„¡æ•ˆ"
                            reason:
                              type: string
                              example: "è©²ç”¨æˆ¶å·²æ˜¯å¸³æœ¬æˆå“¡"
                      
                      # çµ±è¨ˆæ‘˜è¦
                      summary:
                        type: object
                        properties:
                          totalInvitations:
                            type: integer
                            example: 3
                          successful:
                            type: integer
                            example: 2
                          failed:
                            type: integer
                            example: 1
                          skipped:
                            type: integer
                            example: 0
                      
                      # å¾ŒçºŒå»ºè­°
                      recommendations:
                        type: array
                        items:
                          type: object
                          properties:
                            type:
                              type: string
                              example: "follow_up"
                            message:
                              type: string
                              example: "å»ºè­°åœ¨ 3 å¤©å¾Œè¿½è¹¤é‚€è«‹ç‹€æ…‹"
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™é‚€è«‹æˆå“¡"

  /ledgers/{id}/members/{memberId}:
    put:
      summary: "æ›´æ–°æˆå“¡æ¬Šé™"
      description: |
        æ›´æ–°æŒ‡å®šæˆå“¡åœ¨å¸³æœ¬ä¸­çš„è§’è‰²èˆ‡æ¬Šé™ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é æ¬Šé™ç·¨è¼¯
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ manage æ¬Šé™ï¼Œä¸”ä¸èƒ½ä¿®æ”¹æ“æœ‰è€…æ¬Šé™
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: memberId
          in: path
          required: true
          description: "æˆå“¡ ID"
          schema:
            type: string
            example: "user-uuid-67890"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  enum: [admin, editor, viewer]
                  example: "admin"
                
                # Expert Mode: è‡ªè¨‚æ¬Šé™
                customPermissions:
                  type: object
                  properties:
                    canView:
                      type: boolean
                      example: true
                    canEdit:
                      type: boolean
                      example: true
                    canManage:
                      type: boolean
                      example: false
                    canDelete:
                      type: boolean
                      example: false
                    canInvite:
                      type: boolean
                      example: true
                    canExport:
                      type: boolean
                      example: true
                    
                    # é€²éšæ¬Šé™æ§åˆ¶
                    editOwnOnly:
                      type: boolean
                      example: false
                      description: "æ˜¯å¦åªèƒ½ç·¨è¼¯è‡ªå·±çš„è¨˜éŒ„"
                    approvalRequired:
                      type: boolean
                      example: false
                      description: "æ–°å¢è¨˜éŒ„æ˜¯å¦éœ€è¦å¯©æ ¸"
                    maxTransactionAmount:
                      type: number
                      example: 5000
                      description: "å–®ç­†äº¤æ˜“é‡‘é¡ä¸Šé™"
                
                reason:
                  type: string
                  example: "æå‡æ¬Šé™ä»¥å”åŠ©ç®¡ç†å¸³æœ¬"
                  maxLength: 200
              required:
                - role
      responses:
        '200':
          description: "æˆå“¡æ¬Šé™æ›´æ–°æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      memberId:
                        type: string
                        example: "user-uuid-67890"
                      message:
                        type: string
                        example: "æˆå“¡æ¬Šé™æ›´æ–°æˆåŠŸ"
                      
                      # æ¬Šé™è®Šæ›´è©³æƒ…
                      changes:
                        type: object
                        properties:
                          previousRole:
                            type: string
                            example: "editor"
                          newRole:
                            type: string
                            example: "admin"
                          permissionsChanged:
                            type: array
                            items:
                              type: string
                            example: ["canManage", "canInvite"]
                      
                      updatedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      
                      # é€šçŸ¥è³‡è¨Š
                      notificationSent:
                        type: boolean
                        example: true
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™ä¿®æ”¹æˆå“¡æ¬Šé™"

    delete:
      summary: "ç§»é™¤å¸³æœ¬æˆå“¡"
      description: |
        å¾å¸³æœ¬ä¸­ç§»é™¤æŒ‡å®šæˆå“¡ï¼Œè™•ç†ç›¸é—œè³‡æ–™æ­¸å±¬ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é ç§»é™¤åŠŸèƒ½
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ manage æ¬Šé™ï¼Œæ“æœ‰è€…ç„¡æ³•è¢«ç§»é™¤
        **æ¥­å‹™é‚è¼¯**: è™•ç†æˆå“¡å»ºç«‹çš„è¨˜éŒ„æ­¸å±¬å•é¡Œ
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: memberId
          in: path
          required: true
          description: "æˆå“¡ ID"
          schema:
            type: string
            example: "user-uuid-67890"
        - name: transferDataTo
          in: query
          description: "è³‡æ–™è½‰ç§»ç›®æ¨™æˆå“¡ ID"
          schema:
            type: string
            example: "user-uuid-12345"
        - name: anonymizeData
          in: query
          description: "æ˜¯å¦åŒ¿ååŒ–è©²æˆå“¡çš„æ­·å²è³‡æ–™"
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: "æˆå“¡ç§»é™¤æˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      ledgerId:
                        type: string
                        example: "ledger-uuid-001"
                      removedMemberId:
                        type: string
                        example: "user-uuid-67890"
                      message:
                        type: string
                        example: "æˆå“¡å·²å¾å¸³æœ¬ä¸­ç§»é™¤"
                      removedAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      
                      # è³‡æ–™è™•ç†çµæœ
                      dataProcessing:
                        type: object
                        properties:
                          action:
                            type: string
                            enum: [transferred, anonymized, retained]
                            example: "transferred"
                          transactionsAffected:
                            type: integer
                            example: 45
                          transferredTo:
                            type: string
                            example: "user-uuid-12345"
                          backupCreated:
                            type: boolean
                            example: true
                      
                      # é€šçŸ¥è³‡è¨Š
                      notifications:
                        type: object
                        properties:
                          memberNotified:
                            type: boolean
                            example: true
                          otherMembersNotified:
                            type: boolean
                            example: true
        '400':
          description: "ç§»é™¤æˆå“¡å¤±æ•—"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  error:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "CANNOT_REMOVE_OWNER"
                      message:
                        type: string
                        example: "ç„¡æ³•ç§»é™¤å¸³æœ¬æ“æœ‰è€…"
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™ç§»é™¤æˆå“¡"

  /ledgers/{id}/invitations/{invitationId}:
    delete:
      summary: "å–æ¶ˆå¸³æœ¬é‚€è«‹"
      description: |
        å–æ¶ˆå·²ç™¼é€ä½†å°šæœªæ¥å—çš„å¸³æœ¬é‚€è«‹ã€‚
        
        **å°æ‡‰ç•«é¢**: S-303 å”ä½œç®¡ç†é é‚€è«‹ç®¡ç†
        **æ¬Šé™æª¢æŸ¥**: éœ€è¦ invite æ¬Šé™æˆ–ç‚ºé‚€è«‹ç™¼é€è€…
      tags:
        - "å”ä½œç®¡ç†"
      parameters:
        - name: id
          in: path
          required: true
          description: "å¸³æœ¬ ID"
          schema:
            type: string
            example: "ledger-uuid-001"
        - name: invitationId
          in: path
          required: true
          description: "é‚€è«‹ ID"
          schema:
            type: string
            example: "invite-uuid-001"
      responses:
        '200':
          description: "é‚€è«‹å–æ¶ˆæˆåŠŸ"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      invitationId:
                        type: string
                        example: "invite-uuid-001"
                      message:
                        type: string
                        example: "é‚€è«‹å·²å–æ¶ˆ"
                      cancelledAt:
                        type: string
                        format: date-time
                        example: "2025-01-27T13:00:00Z"
                      
                      inviteeNotified:
                        type: boolean
                        example: true
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: "ç„¡æ¬Šé™å–æ¶ˆé‚€è«‹"

  /ledgers/templates:
    get:
      summary: "å–å¾—å¸³æœ¬æ¨¡æ¿åˆ—è¡¨"
      description: |
        å–å¾—å¯ç”¨çš„å¸³æœ¬æ¨¡æ¿ï¼Œç”¨æ–¼å¿«é€Ÿå»ºç«‹é è¨­å¸³æœ¬ã€‚
        
        **å°æ‡‰ç•«é¢**: S-302 å»ºç«‹å¸³æœ¬é æ¨¡æ¿é¸æ“‡
        **å››æ¨¡å¼å·®ç•°**: æ¨è–¦æ¨¡æ¿èˆ‡é¡¯ç¤ºè©³ç´°ç¨‹åº¦ä¸åŒ
      tags:
        - "å¸³æœ¬æ¨¡æ¿"
      parameters:
        - name: category
          in: query
          description: "æ¨¡æ¿åˆ†é¡"
          schema:
            type: string
            enum: [personal, family, business, student, travel]
        - name: X-User-Mode
          in: header
          description: "ç”¨æˆ¶æ¨¡å¼æ¨™è­˜"
          schema:
            type: string
            enum: [Expert, Inertial, Cultivation, Guiding]
      responses:
        '200':
          description: "æˆåŠŸå–å¾—æ¨¡æ¿åˆ—è¡¨"
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      templates:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "template-family-basic"
                            name:
                              type: string
                              example: "å®¶åº­åŸºæœ¬å¸³æœ¬"
                            description:
                              type: string
                              example: "é©åˆå°å®¶åº­ä½¿ç”¨çš„åŸºæœ¬è¨˜å¸³æ¨¡æ¿"
                            category:
                              type: string
                              example: "family"
                            
                            preview:
                              type: object
                              properties:
                                icon:
                                  type: string
                                  example: "ğŸ "
                                color:
                                  type: string
                                  example: "#4CAF50"
                                categoriesCount:
                                  type: integer
                                  example: 12
                                accountsCount:
                                  type: integer
                                  example: 4
                                budgetsCount:
                                  type: integer
                                  example: 6
                            
                            # Expert Mode: è©³ç´°å…§å®¹
                            contents:
                              type: object
                              properties:
                                categories:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      name:
                                        type: string
                                        example: "é£Ÿç‰©"
                                      type:
                                        type: string
                                        example: "expense"
                                      icon:
                                        type: string
                                        example: "ğŸ½ï¸"
                                accounts:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      name:
                                        type: string
                                        example: "ç¾é‡‘"
                                      type:
                                        type: string
                                        example: "cash"
                                budgets:
                                  type: array
                                  items:
                                    type: object
                                    properties:
                                      category:
                                        type: string
                                        example: "é£Ÿç‰©"
                                      amount:
                                        type: number
                                        example: 8000
                                      period:
                                        type: string
                                        example: "monthly"
                            
                            popularity:
                              type: object
                              properties:
                                usageCount:
                                  type: integer
                                  example: 1250
                                rating:
                                  type: number
                                  example: 4.7
                                isRecommended:
                                  type: boolean
                                  example: true
                      
                      # å››æ¨¡å¼å·®ç•°åŒ–æ¨è–¦
                      recommendations:
                        type: array
                        items:
                          type: object
                          properties:
                            templateId:
                              type: string
                              example: "template-family-basic"
                            reason:
                              type: string
                              example: "æœ€é©åˆå…¥é–€ç”¨æˆ¶çš„å®¶åº­è¨˜å¸³æ¨¡æ¿"
                            priority:
                              type: integer
                              example: 1
        '401':
          $ref: '#/components/responses/UnauthorizedError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Firebase Auth JWT Token"

  responses:
    UnauthorizedError:
      description: "æœªæˆæ¬Šå­˜å–"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "UNAUTHORIZED"
                  message:
                    type: string
                    example: "Token ç„¡æ•ˆæˆ–å·²éæœŸ"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

    ValidationError:
      description: "è«‹æ±‚åƒæ•¸é©—è­‰å¤±æ•—"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "VALIDATION_ERROR"
                  message:
                    type: string
                    example: "è«‹æ±‚åƒæ•¸ä¸æ­£ç¢º"
                  field:
                    type: string
                    example: "name"
                  details:
                    type: string
                    example: "å¸³æœ¬åç¨±ä¸èƒ½ç‚ºç©º"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

    NotFoundError:
      description: "è³‡æºä¸å­˜åœ¨"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "RESOURCE_NOT_FOUND"
                  message:
                    type: string
                    example: "å¸³æœ¬ä¸å­˜åœ¨"
                  resourceType:
                    type: string
                    example: "ledger"
                  resourceId:
                    type: string
                    example: "ledger-uuid-001"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

    InternalServerError:
      description: "å…§éƒ¨ä¼ºæœå™¨éŒ¯èª¤"
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: "INTERNAL_SERVER_ERROR"
                  message:
                    type: string
                    example: "ä¼ºæœå™¨æš«æ™‚ç„¡æ³•è™•ç†è«‹æ±‚ï¼Œè«‹ç¨å¾Œå†è©¦"
                  requestId:
                    type: string
                    example: "req-uuid-12345"
                  timestamp:
                    type: string
                    format: date-time
                    example: "2025-01-27T12:00:00Z"

tags:
  - name: "å¸³æœ¬æŸ¥è©¢"
    description: "å¸³æœ¬åˆ—è¡¨æŸ¥è©¢èˆ‡è©³ç´°è³‡è¨Šå–å¾—"
  - name: "å¸³æœ¬ç®¡ç†"
    description: "å¸³æœ¬çš„ CRUD æ“ä½œèˆ‡è¨­å®šç®¡ç†"
  - name: "å”ä½œç®¡ç†"
    description: "å”ä½œå¸³æœ¬çš„æˆå“¡èˆ‡æ¬Šé™ç®¡ç†"
  - name: "å¸³æœ¬æ¨¡æ¿"
    description: "å¸³æœ¬æ¨¡æ¿ç®¡ç†èˆ‡å¥—ç”¨"
